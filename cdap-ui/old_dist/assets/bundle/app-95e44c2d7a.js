"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e){console.time(e.name),angular.module(e.name,[angular.module(e.name+".features",[e.name+".feature.home",e.name+".feature.overview",e.name+".feature.login",e.name+".feature.dashboard",e.name+".feature.apps",e.name+".feature.data",e.name+".feature.admin",e.name+".feature.userprofile",e.name+".feature.experimental",e.name+".feature.hydratorplusplus",e.name+".feature.explore",e.name+".feature.search",e.name+".feature.tracker"]).name,angular.module(e.name+".commons",[angular.module(e.name+".services",[e.name+".config","ngAnimate","ngSanitize","ngResource","ngStorage","ui.router","cask-angular-window-manager","cask-angular-theme","cask-angular-focus","ngCookies"]).name,angular.module(e.name+".filters",[e.name+".services","cask-angular-capitalize"]).name,"cask-angular-sortable","cask-angular-confirmable","cask-angular-promptable","cask-angular-json-edit","cask-angular-eventpipe","cask-angular-observable-promise","cask-angular-socket-datasource","cask-angular-dispatcher","mgcrea.ngStrap.datepicker","mgcrea.ngStrap.timepicker","mgcrea.ngStrap.alert","mgcrea.ngStrap.popover","mgcrea.ngStrap.dropdown","mgcrea.ngStrap.typeahead","mgcrea.ngStrap.select","mgcrea.ngStrap.collapse","ui.bootstrap.modal","ui.bootstrap","mgcrea.ngStrap.modal","ncy-angular-breadcrumb","angularMoment","ui.ace","gridster","angular-cron-jobs","angularjs-dropdown-multiselect","hc.marked","ngFileSaver","infinite-scroll","angular-inview"]).name,"angular-loading-bar"]).run(["$rootScope","$state","$stateParams",function(e,t,a){e.$state=t,e.$stateParams=a,window.$go=t.go}]).config(["MyDataSourceProvider",function(e){e.defaultInterval=5}]).config(["$locationProvider",function(e){e.html5Mode(!0)}]).run(["$rootScope",function(e){e.defaultPollInterval=1e4}]).config(["$provide",function(e){e.decorator("$http",["$delegate","MyCDAPDataSource",function(e,t){function a(a){var n,r;if(a.options){switch(a.params&&a.params.scope&&angular.isObject(a.params.scope)?(r=t(a.params.scope),delete a.params.scope):r=t(),a.$isResource=!0,a.options.type){case"POLL":n=r.poll(a);break;case"REQUEST":n=r.request(a);break;case"POLL-STOP":n=r.stopPoll(a)}return n}return e(a)}return a.get=e.get,a["delete"]=e["delete"],a.save=e.save,a.query=e.query,a.remove=e.remove,a.post=e.post,a.put=e.put,a}])}]).config(["$httpProvider",function(e){e.interceptors.push(["$rootScope","myHelpers",function(e,t){return{request:function(a){if(e.currentUser&&!t.objectQuery(a,"data","profile_view")){var n={user:e.currentUser||null,headers:{"Content-Type":"application/json"}};e.currentUser.token&&(n.headers.Authorization="Bearer "+e.currentUser.token),angular.extend(a,n)}return a}}}])}]).config(["$alertProvider",function(e){angular.extend(e.defaults,{animation:"am-fade-and-scale",container:"#alerts",duration:!1})}]).config(["$uibTooltipProvider",function(e){e.setTriggers({customShow:"customHide"})}]).config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|blob):/),e.debugInfoEnabled(!1)}]).config(["cfpLoadingBarProvider",function(e){e.includeSpinner=!1}]).config(["caskThemeProvider",function(e){e.setThemes(["cdap"])}]).config(["markedProvider",function(e){e.setOptions({gfm:!0,tables:!0})}]).run(["mySettings","EventPipe","$state","$alert","$q",function(e,t,a,n,r){e.get("hydratorDrafts").then(function(t){var a={"default":{}};return t&&!t.isMigrated?(angular.forEach(t,function(e,t){a["default"][t]=e}),a.isMigrated=!0,e.set("hydratorDrafts",a)):r.reject(!1)}).then(function(){n({type:"info",content:"All current drafts can be found in Default namespace."})})}]).run(["MYSOCKET_EVENT","myAlert","EventPipe",function(e,t,a){a.on(e.message,function(e){e.statusCode>399&&!e.resource.suppressErrors&&t({title:e.statusCode.toString(),content:e.response||"Server had an issue, please try refreshing the page",type:"danger"}),e.warning&&"connect"!==e.error.syscall&&t({content:e.warning,type:"warning"})})}]).controller("BodyCtrl",["$scope","$cookies","$cookieStore","caskTheme","CASK_THEME_EVENT","$rootScope","$state","$log","MYSOCKET_EVENT","MyCDAPDataSource","MY_CONFIG","MYAUTH_EVENT","EventPipe","myAuth","$window","myAlertOnValium",function(t,a,n,r,s,i,o,l,c,u,p,d,m,f,h,g){function y(){S.request({_cdapPath:"/version"}).then(function(e){t.version=e.version,i.cdapVersion=t.version})}var v=r.getClassName(),S=new u(t);p.securityEnabled?f.isAuthenticated()?y():i.$on(d.loginSuccess,y):y(),t.copyrightYear=(new Date).getFullYear(),t.$on(s.changed,function(e,a){e.defaultPrevented||(t.bodyClass=t.bodyClass.replace(v,a),v=a)}),t.$on("$stateChangeSuccess",function(e,a,n,r){var s=[];if(a.data&&a.data.bodyClass)s=[a.data.bodyClass];else for(var i=a.name.split("."),o=i.length+1;1<o--;)s.push("state-"+i.slice(0,o).join("-"));a.name!==r.name&&g.isAnAlertOpened()&&g.destroy(),s.push(v),t.bodyClass=s.join(" "),h.scrollTo(0,0)}),m.on(c.reconnected,function(){l.log("[DataSource] reconnected, reloading to home"),h.location.reload()}),i.$on("$stateChangeError",function(){o.go("login")}),console.timeEnd(e.name)}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin",[e.name+".commons"])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.apps",[e.name+".commons",e.name+".feature.programs"])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.dashboard",[e.name+".commons"])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.data",[e.name+".commons",e.name+".feature.datasets",e.name+".feature.streams"])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.datasets",[e.name+".commons"])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.experimental",[e.name+".commons"])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.explore",[])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.flows",[])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.home",[e.name+".commons"])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus",[]).constant("IMPLICIT_SCHEMA",{clf:'{"type":"record","name":"etlSchemaBody","fields":[{"name":"remote_host","type":["string","null"]},{"name":"remote_login","type":["string","null"]},{"name":"auth_user","type":["string","null"]},{"name":"request_time","type":["string","null"]},{"name":"request","type":["string","null"]},{"name":"status","type":["int","null"]},{"name":"content_length","type":["int","null"]},{"name":"referrer","type":["string","null"]},{"name":"user_agent","type":["string","null"]}]}',syslog:'{"type":"record","name":"etlSchemaBody","fields":[{"name":"timestamp","type":["string","null"]},{"name":"logsource","type":["string","null"]},{"name":"program","type":["string","null"]},{"name":"message","type":["string","null"]},{"name":"pid","type":["string","null"]}]}',binary:'{"type":"record","name":"etlSchemaBody","fields":[{"name":"body","type":"bytes"}]}'}).constant("HYDRATOR_DEFAULT_VALUES",{instance:1,schedule:"0 * * * *",resources:{virtualCores:1,memoryMB:512}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.login",[e.name+".commons"])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.mapreduce",[e.name+".commons"])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.overview",[e.name+".commons"])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.programs",[e.name+".commons",e.name+".feature.mapreduce",e.name+".feature.services",e.name+".feature.flows",e.name+".feature.workflows",e.name+".feature.spark",e.name+".feature.worker"])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.search",[])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.services",[])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.spark",[])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.streams",[e.name+".commons"])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.tracker",[])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.userprofile",[])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.worker",[])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.workflows",[])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".filters").filter("bytes",function(){return function(e,t){if(1>e||isNaN(parseFloat(e))||!isFinite(e))return"0b";"undefined"==typeof t&&(t=e>1023?1:0);var a=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,Math.floor(a))).toFixed(t)+""+["b","kB","MB","GB","TB","PB"][a]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".filters").filter("myEllipsis",function(){return function(e,t){return"string"==typeof e&&e.length>t?e.substr(0,t-1)+"… ":e}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".filters").filter("myNumber",function(){return function(e,t){if(1>e||isNaN(parseFloat(e))||!isFinite(e))return"0";"undefined"==typeof t&&(t=e>1023?1:0);var a=Math.floor(Math.log(e)/Math.log(1e3));return(e/Math.pow(1e3,Math.floor(a))).toFixed(t)+""+["","k","M","G","T","P"][a]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".filters").filter("myPaginate",function(){return function(e,t,a){var n=a||10,r=(t-1)*n,s=r+n;return e.length<r&&(r=0,s=n),e.slice(r,s)}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".filters").filter("myTitleFilter",function(){return function(e){if(!e)return"";var t=e.data&&e.data.title;return(t?t+" | ":"")+"CDAP"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").factory("d3",["$window",function(e){return e.d3}]).factory("c3",["$window",function(e){return e.c3}]).factory("Redux",["$window",function(e){return e.Redux}]).factory("ReduxThunk",["$window",function(e){return e.ReduxThunk}]).factory("js_beautify",["$window",function(e){return e.js_beautify}]).factory("esprima",["$window",function(e){return e.esprima}]).factory("avsc",["$window",function(e){return e.avsc}]).factory("moment",["$window",function(e){return e.moment}]).factory("urlGenerator",["$window",function(e){return e.getAbsUIUrl}]).factory("getTrackerUrl",["$window",function(e){return e.getTrackerUrl}]).factory("getHydratorUrl",["$window",function(e){return e.getHydratorUrl}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").service("myAlert",function(){function e(e){angular.isObject(e)&&Object.keys(e).length&&(t.length>0&&t[0].content===e.content&&t[0].title===e.title?(t[0].count++,t[0].time=Date.now()):t.unshift({content:e.content,title:e.title,time:Date.now(),count:1}))}var t=[];return e.clear=function(){t=[]},e.isEmpty=function(){return 0===t.length},e.getAlerts=function(){return t},e.count=function(){return t.length},e.remove=function(e){t.splice(t.indexOf(e),1)},e})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").service("myLoadingService",["$q","EventPipe",function(e,t){var a;this.showLoadingIcon=function(){return a?a.promise:(a=e.defer(),t.emit("showLoadingIcon"),a.resolve(!0),a.promise)},this.hideLoadingIcon=function(){return a?(t.emit("hideLoadingIcon"),a.resolve(!0),void(a=null)):e.when(!0)},this.hideLoadingIconImmediate=function(){return a?(t.emit("hideLoadingIcon.immediate"),a.resolve(!0),void(a=null)):e.when(!0)}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myAppUploader",["myFileUploader","$state","myAlertOnValium",function(e,t,a){function n(n,r){function s(){t.reload().then(function(){a.show({type:"success",content:"Application has been successfully uploaded"})})}function i(e){a.show({type:"danger",title:"Upload failed",content:e||""})}for(var o=0;o<n.length;o++)e.upload({path:"/namespaces/"+(t.params.namespace||r)+"/apps",file:n[o]},{"Content-type":"application/octet-stream"}).then(s,i)}return{upload:n}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=angular.module(e.name+".services");t.constant("MYAUTH_EVENT",{loginSuccess:"myauth-login-success",loginFailed:"myauth-login-failed",logoutSuccess:"myauth-logout-success",sessionTimeout:"myauth-session-timeout",notAuthenticated:"myauth-not-authenticated",notAuthorized:"myauth-not-authorized"}),t.constant("MYAUTH_ROLE",{all:"*",user:"user",admin:"admin"}),t.run(["$location","$state","$rootScope","myAuth","MYAUTH_EVENT","MYAUTH_ROLE",function(e,t,a,n,r,s){a.$on("$stateChangeStart",function(e,i,o){var l=i.data&&i.data.authorizedRoles;if(l){var c=n.isAuthenticated();if(c){if(l===s.all)return;if(c.hasRole(l))return}e.preventDefault(),t.go("login",{next:i.name,nextParams:encodeURIComponent(JSON.stringify(o))}),a.$broadcast(c?r.notAuthorized:r.notAuthenticated)}})}]),t.service("myAuth",["MYAUTH_EVENT","MyAuthUser","myAuthPromise","$rootScope","$localStorage","$cookies",function(e,t,a,n,r,s){var i=angular.bind(this,function(e){this.currentUser=e,n.currentUser=e});this.remembered=function(){var e=r.remember;return angular.extend({remember:!!e},e||{})},this.login=function(o){return a(o).then(function(a){var l=new t(a);i(l),s.put("CDAP_Auth_Token",l.token,{path:"/"}),s.put("CDAP_Auth_User",l.username),r.remember=o.remember&&l.storable(),n.$broadcast(e.loginSuccess)},function(t){n.$broadcast(e.loginFailed,t)})},this.logout=function(){this.currentUser&&(i(null),s.remove("CDAP_Auth_Token",{path:"/"}),s.remove("CDAP_Auth_User",{path:"/"}),n.$broadcast(e.logoutSuccess))},this.isAuthenticated=function(){if(this.currentUser)return!!this.currentUser;if(s.get("CDAP_Auth_Token")&&s.get("CDAP_Auth_User")){var e=new t({access_token:s.get("CDAP_Auth_Token"),username:s.get("CDAP_Auth_User")});return i(e),!!this.currentUser}}}]),t.factory("myAuthPromise",["MY_CONFIG","$q","$http",function(e,t,a){return function(n){var r=t.defer();return e.securityEnabled?a({url:"/login",method:"POST",data:n}).success(function(e){r.resolve(angular.extend(e,{username:n.username}))}).error(function(e,t){r.reject({data:e,statusCode:t})}):(console.warn("Security is disabled, logging in automatically"),r.resolve({username:n.username})),r.promise}}]),t.factory("MyAuthUser",["MYAUTH_ROLE",function(e){function t(t){this.token=t.access_token,this.username=t.username,this.role=e.user,"admin"===t.username&&(this.role=e.admin)}return t.prototype.hasRole=function(t){return this.role===e.admin?!0:(angular.isArray(t)||(t=[t]),-1!==t.indexOf(this.role))},t.prototype.storable=function(){return{username:this.username}},t}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("MyChartHelpers",["myHelpers","MyMetricsQueryHelper",function(e,t){function a(e,a,n,r,i){var o,l,c,u,p,d,m,f={},h=[];for(p=e[a],o=n,d=0;d<o.length;d++)l=o[d],f[l]=s(r,p);for(d=0;d<p.series.length;d++)for(c=p.series[d].data,l=p.series[d].metricName,m=0;m<c.length;m++)u=c[m],f[l][u.time]=u.value;for(d=0;d<o.length;d++){var g=f[o[d]];i&&(g=t.aggregate(g,i)),h.push(g)}return h}function n(e,t){var a=t-e;return 600>=a?"1s":36e3>=a?"1m":"1h"}function r(e){switch(e){case"1h":return 3600;case"1m":return 60;case"1s":return 1;default:return 1}}function s(e,a){"auto"===e&&(e=n(a.startTime,a.endTime));for(var s=r(e),i=t.roundUpToNearest(a.startTime,s),o=t.roundDownToNearest(a.endTime,s),l={},c=i;o>=c;c+=s)l[c]=0;return l}function i(e,t,a){var n,r,s,i,o,l;return angular.isObject(e)&&e.length?(s=t.names.map(function(e){return i=a[e],void 0!==i&&(e=i),e}),n=[],e.forEach(function(e,t){o=Object.keys(e).map(function(t){return e[t]}),o.unshift(s[t]),n.push(o)}),l=Object.keys(e[0]),l.unshift("x"),n.push(l),r=[],n.forEach(function(e){e.length&&"x"!==e[0]&&r.push(e.reduce(function(e,t,a){return 1===a?t:e+t}))}),{columns:n,totals:r,metricNames:s,xCoords:l}):void 0}function o(e){return angular.isArray(e)&&e.forEach(function(e){var t=[];e.config.columns.forEach(function(e){t=t.concat(e)}),e.config.columns=t,t.forEach(function(e){e.settings={},e.settings.color=e.color,e.settings.isLive=e.isLive,e.settings.interval=e.interval,e.settings.aggregate=e.aggregate})}),e}function l(e,t,n,r){var s=a(t,"qid",r.names,r.resolution);s=i(s,r,r.names);var o=s.columns[0].slice(1),l=[];l.unshift(e-o[o.length-1]);for(var c=o.length-2;c>=0;c--)l.unshift(l[0]-o[c]);return l.unshift(s.columns[0][0]),s.columns[0]=l,n.chartData={x:"x",columns:s.columns,keys:{x:"x"}},n.max=Math.max.apply(Math,l.slice(1)),n}return{formatTimeseries:l,processData:a,resolutionFromAuto:n,skipAmtFromResolution:r,zeroFill:s,c3ifyData:i,convertDashboardToNewWidgets:o}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t={source:"Source",transform:"Transform",analytics:"Analytics",sink:"Sink",action:"Action"};angular.module(e.name+".services").constant("GLOBALS",{etlBatch:"cdap-etl-batch",etlRealtime:"cdap-etl-realtime",etlDataStreams:"cdap-data-streams",etlDataPipeline:"cdap-data-pipeline",etlBatchPipelines:["cdap-etl-batch","cdap-data-pipeline"],pluginTypes:{"cdap-etl-batch":{source:"batchsource",sink:"batchsink",transform:"transform"},"cdap-data-streams":{transform:"transform",source:"streamingsource",sparkcompute:"sparkcompute",batchaggregator:"batchaggregator",sink:"batchsink",batchjoiner:"batchjoiner",windower:"windower"},"cdap-etl-realtime":{source:"realtimesource",sink:"realtimesink",transform:"transform"},"cdap-data-pipeline":{source:"batchsource",sink:"batchsink",transform:"transform",batchaggregator:"batchaggregator",sparksink:"sparksink",sparkcompute:"sparkcompute",batchjoiner:"batchjoiner",action:"action"},"post-run-actions":{email:"Send Email",databasequery:"Run Database Query",httpcallback:"Make HTTP Call"}},pluginTypeToLabel:{transform:t.transform,batchsource:t.source,batchsink:t.sink,batchaggregator:t.analytics,realtimesink:t.sink,realtimesource:t.source,sparksink:t.analytics,sparkcompute:t.analytics,batchjoiner:t.analytics,action:"Action",streamingsource:t.source,windower:t.transform},pluginLabels:t,pluginConvert:{batchaggregator:"transform",streamingsource:"source",windower:"transform",batchsource:"source",realtimesource:"source",batchsink:"sink",realtimesink:"sink",transform:"transform",sparksink:"sink",sparkcompute:"transform",batchjoiner:"transform",action:"action"},artifactConvert:{"cdap-etl-batch":"Batch (Deprecated)","cdap-etl-realtime":"Realtime (Deprecated)","cdap-data-pipeline":"Data Pipeline - Batch","cdap-data-streams":"Data Pipeline - Realtime"},iconArtifact:{"cdap-etl-batch":"ETLBatch","cdap-etl-realtime":"ETLRealtime","cdap-data-pipeline":"ETLBatch"},en:{hydrator:{appLabel:"Hydrator Pipeline",studio:{info:{"DEFAULT-REFERENCE":"Please select a plugin to view reference information","NO-REFERENCE":"Currently, no reference information is available for this plugin.","NO-CONFIG":"No widgets JSON found for the plugin. Please check documentation on how to add.","ARTIFACT-UPLOAD-MESSAGE-JAR":"The plugin JAR needs to be a JAR file.","ARTIFACT-UPLOAD-MESSAGE-JSON":"The plugin JSON needs to be a JSON file.","ARTIFACT-UPLOAD-ERROR-JSON":"Error in parsing config json for the artifact."},error:{"SYNTAX-CONFIG-JSON":"Error parsing widgets JSON for the plugin. Please check the documentation to fix.","SEMANTIC-CONFIG-JSON":"Semantic error in the configuration JSON for the plugin.","GENERIC-MISSING-REQUIRED-FIELDS":"Please provide required information.","MISSING-REQUIRED-FIELDS":"is missing required fields","NO-SOURCE-FOUND":"Please add a source to your pipeline","MISSING-NAME":"Pipeline name is missing.","INVALID-NAME":"Pipeline names can only contain alphanumeric ('a-z A-Z 0-9'), underscore ('_'), and hyphen ('-') characters. Please remove any other characters.","MISSING-RESOURCES":"Pipeline resources missing value (Memory MB)","MISSING-DRIVERRESOURCES":"Pipeline driver resources missing value (Memory MB)","INVALID-RESOURCES":"Pipeline resources (Memory MB) should be positive numbers","INVALID-DRIVERRESOURCES":"Pipeline driver resources (Memory MB) should be positive numbers","NO-SINK-FOUND":"Please add a sink to your pipeline","NAME-ALREADY-EXISTS":"A pipeline with this name already exists. Please choose a different name.","DUPLICATE-NODE-NAMES":"Every node should have a unique name to be exported/published.","DUPLICATE-NAME":"Node with the same name already exists.","MISSING-CONNECTION":"is missing connection","IMPORT-JSON":{"INVALID-ARTIFACT":"Pipeline configuration should have a valild artifact specification.","INVALID-CONFIG":"Missing 'config' property in pipeline specification.","INVALID-SOURCE":"Pipeline configuration should have a valid source specification.","INVALID-SINKS":"Pipeline configuration should have a valid sink specification.","INVALID-SCHEDULE":"Batch pipeline should have a valid schedule specification.","INVALID-INSTANCE":"Realtime pipeline should have a valid instance specification.","INVALID-NODES-CONNECTIONS":"Unknown node(s) in 'connections' property in pipeline specification."},PREVIEW:{"NO-SOURCE-SINK":"Please add a source and sink to the pipeline"},"MISSING-SYSTEM-ARTIFACTS":"Missing system artifacts. Please load system artifacts to use hydrator studio."},pluginDoesNotExist:"This plugin does not exist: "},wizard:{welcomeMessage1:"Hydrator makes it easy to prepare data so you ",welcomeMessage2:"can get down to business faster. Let's get started!",createMessage:"ETL made simple. Hydrator offers four ways to get started.",createConsoleMessage:"Click a node from the menu to place it on the canvas above."}},admin:{templateNameExistsError:"This template name already exists! Please choose another name.",pluginSameNameError:"There is already a plugin with this name.",templateNameMissingError:"Please enter a template name.",pluginTypeMissingError:"Please choose a plugin type.",templateTypeMissingError:"Please choose a template type.",pluginMissingError:"Please choose a plugin.",pluginVersionMissingError:"Please choose artifact version for the plugin."}}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myFileUploader",["$q","$window","cfpLoadingBar","myAuth","myAlert",function(e,t,a,n,r){function s(s,i){var o,l,c,u=e.defer();return n.currentUser?(c=new t.XMLHttpRequest,c.upload.addEventListener("progress",function(e){"progress"===e.type&&console.info("App Upload in progress")}),o=s.path,c.open("POST",o,!0),angular.isObject(i)&&Object.keys(i).length>0&&(c.setRequestHeader("Content-type",i["Content-type"]),angular.isObject(i.customHeader)&&Object.keys(i.customHeader).length>0&&(l=Object.keys(i.customHeader),l.forEach(function(e){c.setRequestHeader(e,i.customHeader[e])}))),c.setRequestHeader("X-Archive-Name",s.file.name),n.currentUser.token&&c.setRequestHeader("Authorization","Bearer "+n.currentUser.token),c.send(s.file),a.start(),c.onreadystatechange=function(){4===c.readyState&&(c.status>399?u.reject(c.response):u.resolve(),a.complete())}):(u.reject(400),r({title:"Must specify user: ",content:"Could not find user.",type:"danger"})),u.promise}return{upload:s}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myHelpers",["myCdapUrl",function(e){function t(e,t,a){var n,r,s,i=e;if(t.indexOf(".")>-1)for(r=t.split("."),s=r.length-1,n=0;s>=n;n++)n!==s?(i[r[n]]=i[r[n]]||{},i=i[r[n]]):i[r[s]]=a;else e[t]=a;return e}function a(e,t,a){for(var n=e,r=0;r<t.length;r++)r===t.length-1?n[t[r]]=a:(n[t[r]]||(n[t[r]]={}),n=n[t[r]])}function n(e,t,a){var n=r.apply(null,[e].concat(t.split(".")));return a?angular.copy(n):n}function r(e){if(!angular.isObject(e))return null;for(var t=1;t<arguments.length;t++){if(!angular.isObject(e))return;e=e[arguments[t]]}return e}function s(t,a,n,r,s,i){var o={method:a,options:{type:n}};return t?o.url=e.constructUrl({_cdapNsPath:r}):o.url=e.constructUrl({_cdapPath:r}),s&&(o.isArray=!0),angular.extend(o,i||{})}function i(e,t,a,n,r){return s(!0,e,t,a,n,r)}function o(e,t,a,n,r){return s(!1,e,t,a,n,r)}return{deepSet:t,objectSetter:a,deepGet:n,objectQuery:r,getConfig:o,getConfigNs:i}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").service("MyOrderings",["myLocalStorage",function(e){function t(t,a,n){setTimeout(function(){var r=t.indexOf(a);-1!==r&&t.splice(r,1),t.unshift(a),e.set(n,t)},1e3);
}function a(e,t){var a=e.indexOf(t.name);return-1===a?e.length:a}var n="appOrdering",r="dataOrdering";e.get(n).then(function(e){"undefined"==typeof e?this.appList=[]:this.appList=e}.bind(this)),e.get(r).then(function(e){"undefined"==typeof e?this.dataList=[]:this.dataList=e}.bind(this)),this.appClicked=function(e){t(this.appList,e,n)},this.dataClicked=function(e){t(this.dataList,e,r)},this.appOrdering=function(e){return a(this.appList,e)}.bind(this),this.dataOrdering=function(e){return a(this.dataList,e)}.bind(this)}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").service("myNamespace",["$q","MyCDAPDataSource","EventPipe","$http","$rootScope","myAuth","MYAUTH_EVENT","myHelpers","$state","StatusFactory",function(e,t,a,n,r,s,i,o,l,c){this.namespaceList=[],c.startPolling();var u,p=new t,d=null;this.getList=function(t){return!t&&this.namespaceList.length?e.when(this.namespaceList):(d||(u=e.defer(),d=!0,p.request({_cdapPath:"/namespaces",method:"GET"}).then(function(e){e.length||l.includes("admin.**")||l.go("unauthorized"),this.namespaceList=e,a.emit("namespace.update"),u.resolve(e),d=null}.bind(this),function(e){u.reject(e),d=null})),u.promise)},this.getDisplayName=function(e){var t=this.namespaceList.filter(function(t){return t.name===e});return t[0].name||e}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").service("ServiceStatusFactory",["MyCDAPDataSource","$timeout","EventPipe","$state","myAuth","$rootScope","MYAUTH_EVENT",function(e,t,a,n,r,s,i){this.systemStatus={color:"green"};var o=new e,l=o.poll({_cdapPath:"/system/services/status",interval:1e4},function(e){var t=Object.keys(e).map(function(t){return e[t]});t.indexOf("NOTOK")>-1&&(this.systemStatus.color="yellow"),-1===t.indexOf("OK")&&(this.systemStatus.color="red"),-1===t.indexOf("NOTOK")&&(this.systemStatus.color="green")}.bind(this),function(e){angular.isObject(e)&&e.auth_uri?t(function(){a.emit("backendUp"),r.logout()}):e&&"ECONNREFUSED"===e.code?a.emit("backendDown","Unable to connect to CDAP Router","Attempting to connect…"):e||a.emit("backendUp")});s.$on(i.logoutSuccess,function(){o.stopPoll(l.__pollId__)})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("mySettings",["MyPersistentStorage",function(e){return new e("user")}]).factory("MyPersistentStorage",["$q","MyCDAPDataSource","myHelpers","$rootScope","myAuth","MYAUTH_EVENT","MY_CONFIG",function(e,t,a,n,r,s,i){function o(e){this.endpoint="/configuration/"+e,this.headers={"Content-Type":"application/json"},i.securityEnabled&&n.$on(s.logoutSuccess,function(){this.data=[],delete this.headers.Authorization}.bind(this)),this.data={},this.pending=null}var l=new t;return o.prototype.set=function(e,t){return a.deepSet(this.data,e,t),r.isAuthenticated()&&(this.headers.Authorization=n.currentUser.token?"Bearer "+n.currentUser.token:null),l.request({method:"PUT",_cdapPath:this.endpoint,headers:this.headers,body:this.data})},o.prototype.get=function(t,s){var i=a.deepGet(this.data,t,!0);if(r.isAuthenticated()&&(this.headers.Authorization=n.currentUser.token?"Bearer "+n.currentUser.token:null),!s&&i)return e.when(i);var o=this;if(this.pending){var c=e.defer();return this.pending.promise.then(function(){c.resolve(a.deepGet(o.data,t,!0))}),c.promise}this.pending=e.defer(),l.request({method:"GET",headers:this.headers,_cdapPath:this.endpoint},function(e){o.data=e.property,o.pending.resolve(a.deepGet(o.data,t,!0))},function(){o.pending=null});var u=this.pending.promise;return u["finally"](function(){o.pending=null}),u},o}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").service("StatusFactory",["$http","EventPipe","myAuth","$rootScope","MYAUTH_EVENT","MY_CONFIG","$timeout",function(e,t,a,n,r,s,i){function o(){_.debounce(function(){p&&e.get("/backendstatus",{ignoreLoadingBar:!0}).success(l.bind(this)).error(c.bind(this))}.bind(this),2e3)()}function l(){t.emit("backendUp"),this.startPolling()}function c(e,a){return e&&"ECONNREFUSED"===e.code?(this.startPolling(),void t.emit("backendDown","Unable to connect to CDAP Router","Attempting to connect...")):((503===a||500===a)&&(this.startPolling(),t.emit("backendDown")),void u(a))}function u(e){return 401===e||200===e?(i(function(){t.emit("backendUp"),a.logout()}),!0):!1}var p=!0;this.startPolling=function(){p&&o.bind(this)()},this.stopPolling=function(){p=!1},n.$on(r.logoutSuccess,this.stopPolling.bind(this)),n.$on(r.loginSuccess,function(){p=!0,this.startPolling()}.bind(this))}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myLocalStorage",["MyBrowserStorage",function(e){return new e("local")}]).factory("mySessionStorage",["MyBrowserStorage",function(e){return new e("session")}]).factory("MyBrowserStorage",["$q","$localStorage","$sessionStorage","myHelpers",function(t,a,n,r){function s(e){this.type=e,this.data="local"===e?a:n}return s.prototype.set=function(a,n){return"local"===this.type&&(a=e.name+"."+a),t.when(r.deepSet(this.data,a,n))},s.prototype.get=function(a){return"local"===this.type&&(a=e.name+"."+a),t.when(r.deepGet(this.data,a))},s}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e){function t(e,t){t=t||{};var n={},r=function(e,t,a){return e+a};for(var s in t)if(t.hasOwnProperty(s)){var i=t[s],o=new RegExp(":"+s+"(\\W|$)","g");o.test(e)?e=e.replace(o,r.bind(null,i)):n[s]=i}return e=a(e,n)}function a(e,t){function a(e,a,n){var r=Object.keys(t).sort();return r.forEach(function(t){a.call(n,e[t],t)}),r}function n(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,t?"%20":"+")}if(t=t||{},!t)return e;var r=[];return a(t,function(e,t){null!==e&&"undefined"!=typeof e&&(Array.isArray(e)||(e=[e]),e.forEach(function(a){"object"===("undefined"==typeof a?"undefined":_typeof(a))&&null!==a&&(a="[object Date]"===e.toString()?a.toISOString():JSON.stringify(a)),r.push(n(t)+"="+n(a))}))}),r.length>0&&(e+=(-1===e.indexOf("?")?"?":"&")+r.join("&")),e}window.getAbsUIUrl=function(e){e=e||{};var t=e.uiApp||"cdap",a=e.navigationObj,n=e.clientId,r=e.namepsaceId,s=e.appId,i=e.entityType,o=e.entityId,l=e.runId,c=location.protocol+"//"+location.host+"/"+t;return"login"===t&&(c+="?"),a&&(c+="redirectUrl="+encodeURIComponent(a)),n&&(c+="&clientId="+n),r&&(c+="/ns/"+r),s&&(c+="/apps/"+s),i&&o&&(c+="/"+i+"/"+o),l&&(c+="/runs/"+l),c},window.getTrackerUrl=function(e){e=e||{};var a,n;a=e.stateName,n=e.stateParams;var r="tracker",s=location.protocol+"//"+location.host+"/"+r+"/ns/:namespace",i={tracker:"","tracker.detail":"","tracker.detail.entity":"/entity/:entityType/:entityId","tracker.detail.entity.metadata":"/entity/:entityType/:entityId/metadata"},o=s+i[a||"tracker"];return o=t(o,n)},window.getHydratorUrl=function(e){e=e||{};var a,n;a=e.stateName,n=e.stateParams;var r="hydrator",s=location.protocol+"//"+location.host+"/"+r+"/ns/:namespace",i={hydrator:"","hydrator.create":"/studio","hydrator.detail":"/view/:pipelineId","hydrator.list":"?page"},o=s+i[a||"hydrator"];return o=t(o,n)}}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myAdminLogViewer",["$filter","$timeout","$state","$location",function(e,t,a,n){var r=e("caskCapitalizeFilter"),s=e("filter");return{restrict:"E",scope:{model:"=",next:"&",prev:"&",loadingNext:"=",loadingPrev:"="},templateUrl:"admin-log-viewer/admin-log-viewer.html",controller:["$scope",function(e){e.filters="all,info,warn,error,debug,other".split(",").map(function(e){var t;switch(e){case"all":t=function(){return!0};break;case"other":t=function(e){return!/- (INFO|WARN|ERROR|DEBUG)/.test(e.log)};break;default:t=function(t){return new RegExp("- "+e.toUpperCase()).test(t.log)}}return{key:e,label:r(e),entries:[],predicate:t}}),e.$watch("model",function(t){angular.forEach(e.filters,function(e){e.entries=s(t,e.predicate)})})}],link:function(e,r){var i=angular.element(r[0].querySelector(".terminal")),o="filter";e.setFilter=function(r){var l=s(e.filters,{key:r});e.activeFilter=l.length?l[0]:e.filters[0],t(function(){if(i.prop("scrollTop",i.prop("scrollHeight")),!1===a.current.reloadOnSearch){var t={};t[o]=e.activeFilter.key,n.search(t)}})},e.setFilter(a.params[o])}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("loadingIcon",["myLoadingService","$uibModal","$timeout","EventPipe","$state","myAlertOnValium",function(e,t,a,n,r,s){return{restrict:"EA",scope:!0,template:"<div></div>",controller:["$scope",function(e){var i,o={templateUrl:"app-level-loading-icon/loading.html",backdrop:"static",keyboard:!0,scope:e,windowClass:"custom-loading-modal"},l=!1,c="CDAP Services are not available",u="Trying to connect...",p=null;n.on("backendDown",function(a,n){l?(e.message=a||c,e.subtitle=n||u):(i&&i.close(),l=!0,e.message=a||c,e.subtitle=n||u,i=t.open(o),i.result["finally"](function(){r.go("overview",{reload:!0})}))}.bind(e)),n.on("backendUp",function(e){l&&(i.close(),i=null,l=!1,s.show({type:"success",content:e?e:"Services are online"}))}.bind(e)),n.on("hideLoadingIcon",function(){a.cancel(p),p=a(function(){l||(i&&!i.$state&&i.close(),i=null)},2e3)}),n.on("hideLoadingIcon.immediate",function(){i&&i.opened.then(function(){i.close(),i=null})}),n.on("showLoadingIcon",function(a){i||l||(e.message=a||"",i=t.open(o))}.bind(e))}]}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myBreadcrumb",function(){return{restrict:"E",templateUrl:"breadcrumb/breadcrumb.html",scope:{params:"="},replace:!0,controller:["$location","$scope",function(e,t){var a=t.$on("$stateChangeSuccess",function(){e.search("sourceId",null),e.search("sourceRunId",null),a()})}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myBreadcrumbs",["$stateParams",function(e){return{restrict:"E",templateUrl:"breadcrumbs/breadcrumbs.html",link:function(t,a,n){t.hideNsDropdown="true"===n.hideNsDropdown,t.element=a,t.$stateParams=e}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=angular.module(e.name+".commons"),a={restrict:"E",replace:!0,template:'<div class="c3"></div>',scope:{chartMetric:"=",chartMetricAlias:"@",chartSize:"=",chartSettings:"=",chartPadding:"=?"},controller:"c3Controller"};t.controller("c3Controller",["$scope","c3","$filter","$timeout",function(e,t,a,n){function r(){e.chartMetric&&(e.options.data=e.chartMetric,n(function(){s()}))}function s(){var n,r,s,i=e.options.data,o={};i.type=e.type,n={format:{value:d3.format(",")}},r={bindto:e.options.el,data:i,tooltip:n},r.size=e.options.size,o.count=e.options.xtickcount,o.culling=e.options.xTickCulling,e.options.formatAsTimestamp&&(s=function(e){return a("amDateFormat")(1e3*e,"h:mm:ss a")},o.format=s),e.chartPadding&&(r.padding=e.chartPadding),r.axis={x:{show:e.options.showx,tick:o},y:{show:e.options.showy,padding:{bottom:0}}},r.color=e.options.color,r.legend=e.options.legend,r.point={show:!1},e.options.subchart&&(r.subchart=e.options.subchart),r.zoom={enabled:!1},r.transition={duration:1e3},r.donut={width:45},r.spline={interpolation:{type:"monotone"}},e.chart=t.generate(r)}var t=t,a=a;e.metrics=e.chartMetric,e.alias=e.chartMetricAlias,e.$on("$destroy",function(){e.chart&&(e.chart=e.chart.destroy())}),e.pollId=null,e.initC3=function(t,a,i,o){var l={stack:!1,formatAsTimestamp:!0};angular.extend(l,o||{},{el:t[0]}),l.data={x:"x",columns:[]},e.type=a,e.options=l,e.options.showx=e.chartSettings.chartMetadata.showx,e.options.showy=e.chartSettings.chartMetadata.showy,e.options.legend=e.chartSettings.chartMetadata.legend,e.options.color=e.chartSettings.color,e.$watch("chartSize",function(t){e.options.size=t,n(function(){s()})},!0),e.metrics&&r(),e.$watch("chartMetric",r,!0)}}]),t.directive("c3Line",function(){return angular.extend({link:function(e,t,a){e.initC3(t,"line",a,{xtickcount:5})}},a)}),t.directive("c3Bar",function(){return angular.extend({link:function(e,t,a){e.initC3(t,"bar",a,{stack:!0,xTickCulling:{max:5}})}},a)}),t.directive("c3Pie",function(){return angular.extend({link:function(e,t,a){e.initC3(t,"pie",a,{formatAsTimestamp:!1})}},a)}),t.directive("c3Donut",function(){return angular.extend({link:function(e,t,a){e.initC3(t,"donut",a,{formatAsTimestamp:!1})}},a)}),t.directive("c3Scatter",function(){return angular.extend({link:function(e,t,a){e.initC3(t,"scatter",a,{xtickcount:5})}},a)}),t.directive("c3Spline",function(){return angular.extend({link:function(e,t,a){e.initC3(t,"spline",a,{xtickcount:5})}},a)}),t.directive("c3Step",function(){return angular.extend({link:function(e,t,a){e.initC3(t,"step",a,{xtickcount:5})}},a)}),t.directive("c3Area",function(){return angular.extend({link:function(e,t,a){e.initC3(t,"area",a,{xtickcount:5})}},a)}),t.directive("c3AreaStep",function(){return angular.extend({link:function(e,t,a){e.initC3(t,"area-step",a,{xtickcount:5})}},a)}),t.directive("c3AreaSpline",function(){return angular.extend({link:function(e,t,a){e.initC3(t,"area-spline",a,{xtickcount:5})}},a)}),t.directive("c3AreaSplineStacked",function(){return angular.extend({link:function(e,t,a){e.initC3(t,"area-spline",a,{stack:!0,xtickcount:5})}},a)})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").constant("SCHEMA_TYPES",{types:["boolean","bytes","double","float","int","long","string","array","enum","map","union","record"],simpleTypes:["boolean","bytes","double","float","int","long","string"]}).factory("SchemaHelper",function(){function e(e){var a=e,n=!1;return"union:wrapped"===e.getTypeName()?(e=e.getTypes(),e[1]&&"null"===e[1].getTypeName()?(a=e[0],e=e[0].getTypeName(),n=!0):e="union"):e=e.getTypeName(),{displayType:e,type:a,nullable:n,nested:t(e)}}function t(e){var t=["array","enum","map","record","union"];return-1!==t.indexOf(e)?!0:!1}return{parseType:e,checkComplexType:t}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t,a,n,r,s){"ngInject";function i(t){var a=function(e){return e?angular.isObject(e)&&!(e.fields||e.getFields&&e.getFields()||[]).length?!0:!1:!0};if(!(t&&"record"!==t||o.isDisabled))return o.addField(),l=o.recordName||"a"+n.v4().split("-").join(""),void o.formatOutput();if(a(t)&&o.isDisabled)return void(o.emptySchema=!0);var r=e.parse(t,{wrapUnions:!0});return l=o.recordName||r._name,o.parsedSchema=r.getFields().map(function(e){var t=e.getType(),a=s.parseType(t);return Object.assign({},a,{id:n.v4(),name:e.getName()})}),o.isDisabled||0!==o.parsedSchema.length?void o.formatOutput():void o.addField()}var o=this;o.SCHEMA_TYPES=t.types,o.parsedSchema=[];var l=void 0,c=void 0,u=void 0;o.emptySchema=!1,o.addField=function(e){var t=void 0===e?0:e+1,a={name:"",type:"string",displayType:"string",nullable:!1,id:n.v4(),nested:!1};o.parsedSchema.splice(t,0,a),o.formatOutput(),r.cancel(u),u=r(function(){var e=document.getElementById(a.id);angular.element(e)[0].focus()})},o.removeField=function(e){o.parsedSchema.splice(e,1),0===o.parsedSchema.length&&o.addField(),o.formatOutput()},o.changeType=function(e){-1!==t.simpleTypes.indexOf(e.displayType)?(e.type=e.displayType,o.formatOutput()):e.type=null,e.nested=s.checkComplexType(e.displayType)},o.formatOutput=function(){o.error="";var t=o.parsedSchema.filter(function(e){return e.name&&e.type?!0:!1}).map(function(e){var t={name:e.name,type:e.nullable?[e.type,"null"]:e.type};return t});if(t.length>0){var a={type:"record",name:l||"a"+n.v4().split("-").join(""),fields:t};try{e.parse(a)}catch(s){var i=""+s;return i=i.split(":"),void(o.error=i[0]+": "+i[1])}o.error||(o.model=a)}else o.model="";"function"==typeof o.parentFormatOutput&&(c=r(o.parentFormatOutput))},i(o.model),a.$on("$destroy",function(){r.cancel(c),r.cancel(u)})}t.$inject=["avsc","SCHEMA_TYPES","$scope","uuid","$timeout","SchemaHelper"],angular.module(e.name+".commons").directive("myComplexSchema",function(){return{restrict:"E",templateUrl:"complex-schema/complex-schema.html",controller:t,controllerAs:"ComplexSchema",bindToController:!0,scope:{model:"=ngModel",recordName:"=",hideHeader:"=",parentFormatOutput:"&",isDisabled:"=",schemaPrefix:"="}}}).directive("myRecordSchema",["$compile",function(e){return{restrict:"E",replace:!0,scope:{model:"=ngModel",recordName:"=",parentFormatOutput:"&",isDisabled:"=",schemaPrefix:"="},link:function(t,a){var n='<my-complex-schema\n                          ng-model="model"\n                          record-name="recordName"\n                          hide-header="true"\n                          parent-format-output="parentFormatOutput()"\n                          is-disabled="isDisabled"\n                          schema-prefix="schemaPrefix"\n                        </my-complex-schema>';e(n)(t,function(e){a.append(e)})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("CronScheduleViewController",["$scope",function(e){var t=e.model.split(" ");e.schedule={time:{}},e.schedule.time.min=t[0],e.schedule.time.hour=t[1],e.schedule.time.day=t[2],e.schedule.time.month=t[3],e.schedule.time.week=t[4]}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myCronScheduleView",function(){return{restrict:"EA",scope:{model:"=ngModel"},templateUrl:"cron-schedule-view/cron-schedule-view.html",controller:"CronScheduleViewController"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("DAGPlusPlusCtrl",["jsPlumb","$scope","$timeout","DAGPlusPlusFactory","GLOBALS","DAGPlusPlusNodesActionsFactory","$window","DAGPlusPlusNodesStore","$rootScope","$popover","$filter","uuid","$tooltip",function(e,t,a,n,r,s,i,o,l,c,u,p,d){function m(){W&&a.cancel(W),W=a(function(){b.instance.repaintEverything()})}function f(){t.nodes=o.getNodes(),t.connections=o.getConnections(),b.comments=o.getComments(),K=a(function(){v(),angular.forEach(t.connections,function(e){var a=t.nodes.filter(function(t){return t.name===e.from}),n=t.nodes.filter(function(t){return t.name===e.to});if(a.length&&n.length){var r="Origin"+e.from,s="Target"+e.to,i={uuids:[r,s]};b.instance.connect(i)}}),b.isDisabled&&angular.forEach(E,function(e){var t=b.instance.getEndpoints(e);angular.forEach(t,function(e){e.setEnabled(!1)})}),t.showMetrics&&(angular.forEach(t.nodes,function(e){var a=angular.element(document.getElementById(e.name)).children(),n=l.$new();n.data={nodeName:e.name},V[e.name]={scope:n,element:a,popover:null,isShowing:!1},t.$on("$destroy",function(){a.remove(),a=null,n.$destroy()})}),b.scale<=x&&g(),angular.forEach(j,function(e){var a=e.getOverlay("metricLabel"),n=d(angular.element(a.getElement()).children(),{trigger:"hover",title:"Records Out",delay:300,container:"body"});t.$on("$destroy",function(){n.destroy()})}),t.$watch("metricsData",function(){0===Object.keys(t.metricsData).length&&angular.forEach(V,function(e){e.scope.data.metrics=0}),angular.forEach(t.metricsData,function(e,t){V[t].scope.data.metrics=e}),angular.forEach(j,function(e){var a=e.getOverlay("metricLabel");if(null===t.metricsData[e.elementId]||void 0===t.metricsData[e.elementId])return void angular.element(a.getElement()).children().text(0);var n=t.metricsData[e.elementId].recordsOut;n>U?a.hide():U>=n&&b.scale>=x&&a.show(),angular.element(a.getElement()).children().text(A(n,0))})},!0))}),Y=a(function(){b.fitToScreen()},500)}function h(){angular.forEach(j,function(e){t.metricsData[e.elementId]&&t.metricsData[e.elementId].recordsOut>U||e.getOverlay("metricLabel").show()})}function g(){angular.forEach(j,function(e){e.getOverlay("metricLabel").hide()})}function y(a,n,r,s){if(0!==t.nodes.length){r=r||[.5,.5],n=n||e,s=s||n.getContainer();for(var i=["webkit","moz","ms","o"],o="scale("+a+")",l=100*r[0]+"% "+100*r[1]+"%",c=0;c<i.length;c++)s.style[i[c]+"Transform"]=o,s.style[i[c]+"TransformOrigin"]=l;s.style.transform=o,s.style.transformOrigin=l,n.setZoom(a)}}function v(){angular.forEach(t.nodes,function(e){if(-1===E.indexOf(e.name)){E.push(e.name);var t=r.pluginConvert[e.type];switch(t){case"source":b.instance.addEndpoint(e.name,k,{uuid:"Origin"+e.name}),b.instance.addEndpoint(e.name,O,{uuid:"Target"+e.name});break;case"sink":b.instance.addEndpoint(e.name,N,{uuid:"Origin"+e.name}),b.instance.addEndpoint(e.name,D,{uuid:"Target"+e.name});break;case"action":b.instance.addEndpoint(e.name,R,{uuid:"Origin"+e.name}),b.instance.addEndpoint(e.name,L,{uuid:"Target"+e.name});break;default:b.instance.addEndpoint(e.name,$,{uuid:"Origin"+e.name}),b.instance.addEndpoint(e.name,I,{uuid:"Target"+e.name})}}})}function S(e,t){b.panning.top+=e,b.panning.left+=t,b.panning.style={top:b.panning.top+"px",left:b.panning.left+"px"}}function P(){var e=[];angular.forEach(b.instance.getConnections(),function(t){e.push({from:t.sourceId,to:t.targetId})}),s.setConnections(e)}function T(){b.instance.clearDragSelection(),F=[],angular.forEach(t.nodes,function(e){e.selected&&F.push(e.name)}),b.instance.addToDragSelection(F)}function C(){angular.forEach(b.comments,function(e){e.isActive=!1})}var b=this,A=u("number"),E=[],w=n.getSettings(),k=w.sourceOrigin,O=w.sourceTarget,$=w.transformOrigin,I=w.transformTarget,N=w.sinkOrigin,D=w.sinkTarget,R=w.actionOrigin,L=w.actionTarget,M=void 0,H=void 0,x=.8,U=999999999999,F=[],j=[],G=t.separation||200,B=[["Custom",{create:function(e){return j.push(e),angular.element('<div><span class="metric-label-text"></span></div>')},width:100,location:[4.3,0],id:"metricLabel",cssClass:"metric-label"}]];t.showMetrics&&(k.overlays=B,$.overlays=B);var q=!1,Q=!1;b.isDisabled=t.isDisabled,b.disableNodeClick=t.disableNodeClick;var V={};b.scale=1,b.panning={style:{top:0,left:0},top:0,left:0},b.comments=[];var W=null,z=null,J=null,Y=null,K=null,X=null;b.nodeMouseEnter=function(e){if(t.showMetrics&&!(b.scale>=x)){var n=V[e.name];n.popover=c(n.element,{trigger:"manual",placement:"auto right",target:angular.element(n.element[0]),templateUrl:t.nodePopoverTemplate,container:"main",scope:n.scope}),n.popover.$promise.then(function(){X&&a.cancel(X),X=a(function(){n.popover.show()})})}},b.nodeMouseLeave=function(e){if(t.showMetrics&&!(b.scale>=x)){var a=V[e.name];a.popover&&(a.popover.hide(),a.popover.destroy(),a.popover=null)}},b.zoomIn=function(){b.scale+=.1,b.scale>=x&&h(),y(b.scale,b.instance)},b.zoomOut=function(){b.scale<=.2||(b.scale<=x&&g(),b.scale-=.1,y(b.scale,b.instance))},e.ready(function(){var r=n.getSettings()["default"];e.setContainer("dag-container"),b.instance=e.getInstance(r),f(),b.secondInstance=e.getInstance(),b.disableNodeClick||b.secondInstance.draggable("diagram-container",{stop:function(e){e.el.style.left="0px",e.el.style.top="0px",S(e.pos[1],e.pos[0]),s.resetPluginCount(),s.setCanvasPanning(b.panning)},start:function(){Q=!0}}),b.instance.bind("connection",P),b.instance.bind("connectionDetached",P),t.$watch("nodes",function(){J&&a.cancel(J),J=a(function(){var e=document.querySelectorAll(".box");v(),b.isDisabled||b.instance.draggable(e,{start:function(e){var t={x:e.e.clientX,y:e.e.clientY};(t.x!==M||t.y!==H)&&(M=t.x,H=t.y,-1===F.indexOf(e.el.id)&&b.clearNodeSelection(),q=!0)},stop:function(e){var t={_uiPosition:{top:e.el.style.top,left:e.el.style.left}};s.updateNode(e.el.id,t),m()}})})},!0),angular.element(i).on("resize",b.instance.repaintEverything),o.registerOnChangeListener(function(){b.comments=o.getComments(),b.isDisabled||(z&&a.cancel(z),z=a(function(){var e=document.querySelectorAll(".comment-box");b.instance.draggable(e,{start:function(){q=!0},stop:function(e){var t={_uiPosition:{top:e.el.style.top,left:e.el.style.left}};s.updateComment(e.el.id,t)}})}))})}),b.clearNodeSelection=function(){return Q?void(Q=!1):(F=[],b.instance.clearDragSelection(),s.resetSelectedNode(),angular.forEach(t.nodes,function(e){e.selected=!1}),void C())},b.onNodeClick=function(e,t){return e.stopPropagation(),q?void(q=!1):void(e.ctrlKey||e.metaKey?(t.selected=!t.selected,s.resetSelectedNode(),t.selected?T():b.instance.removeFromDragSelection(t.name)):(b.clearNodeSelection(),t.selected=!0,s.selectNode(t.name)))},b.onNodeDelete=function(e,t){e.stopPropagation(),s.removeNode(t.name),b.instance.remove(t.name)},b.cleanUpGraph=function(){if(0!==t.nodes.length){var e=n.getGraphLayout(t.nodes,t.connections,G)._nodes;angular.forEach(t.nodes,function(t){var a=e[t.name];t._uiPosition={left:a.x-50+"px",top:a.y+"px"}}),t.getGraphMargins(t.nodes),b.panning.top=0,b.panning.left=0,b.panning.style={top:b.panning.top+"px",left:b.panning.left+"px"},m(),s.resetPluginCount(),s.setCanvasPanning(b.panning)}},b.fitToScreen=function(){if(0!==t.nodes.length){var e=_.min(t.nodes,function(e){if(e._uiPosition.left.includes("vw")){var t=parseInt(e._uiPosition.left,10)/100*document.documentElement.clientWidth;e._uiPosition.left=t+"px"}return parseInt(e._uiPosition.left,10)}),a=_.max(t.nodes,function(e){if(e._uiPosition.left.includes("vw")){var t=parseInt(e._uiPosition.left,10)/100*document.documentElement.clientWidth;e._uiPosition.left=t+"px"}return parseInt(e._uiPosition.left,10)}),n=_.min(t.nodes,function(e){return parseInt(e._uiPosition.top,10)}),r=_.max(t.nodes,function(e){return parseInt(e._uiPosition.top,10)}),i=parseInt(a._uiPosition.left,10)-parseInt(e._uiPosition.left,10)+100,o=parseInt(r._uiPosition.top,10)-parseInt(n._uiPosition.top,10)+100,l=t.element[0].parentElement.getBoundingClientRect(),c=(l.width-150)/i,u=(l.height-100)/o;b.scale=Math.min(c,u),b.scale>1&&(b.scale=1),y(b.scale,b.instance);var p=parseInt(e._uiPosition.left,10);angular.forEach(t.nodes,function(e){e._uiPosition.left=parseInt(e._uiPosition.left,10)-p+"px"});var d=parseInt(n._uiPosition.top,10);angular.forEach(t.nodes,function(e){e._uiPosition.top=parseInt(e._uiPosition.top,10)-d+50+"px"}),t.getGraphMargins(t.nodes),m(),b.panning.left=0,b.panning.top=0,b.panning.style={top:b.panning.top+"px",left:b.panning.left+"px"},s.resetPluginCount(),s.setCanvasPanning(b.panning)}},b.addComment=function(){var e=o.getCanvasPanning(),t={content:"",isActive:!1,id:"comment-"+p.v4(),_uiPosition:{top:250-e.top+"px",left:.1*document.documentElement.clientWidth-e.left+"px"}};s.addComment(t)},b.commentSelect=function(e,t){return e.stopPropagation(),C(),q?void(q=!1):void(t.isActive=!0)},b.deleteComment=function(e){s.deleteComment(e)},t.$on("$destroy",function(){j=[],s.resetNodesAndConnections(),o.reset(),angular.element(i).off("resize",b.instance.repaintEverything),a.cancel(W),a.cancel(z),a.cancel(J),a.cancel(Y),a.cancel(K),a.cancel(X)})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").factory("DAGPlusPlusFactory",function(){function e(){var e={"default":n,commonSettings:angular.extend(i,s),sourceOrigin:angular.copy(o),sourceTarget:angular.copy(l),transformOrigin:angular.copy(o),transformTarget:angular.copy(l),sinkOrigin:angular.copy(o),sinkTarget:angular.copy(l),actionOrigin:angular.copy(o),actionTarget:angular.copy(l)};return e.sourceOrigin.anchor.push("sourceAnchor"),e.sourceTarget.anchor.push("sourceAnchor"),e.sourceTarget.endpoint="Rectangle",e.sourceTarget.endpointStyle=angular.copy(c),e.transformOrigin.anchor.push("transformAnchor"),e.transformTarget.anchor.push("transformAnchor"),e.sinkOrigin.anchor.push("sinkAnchor"),e.sinkTarget.anchor.push("sinkAnchor"),e.sinkOrigin.endpoint="Rectangle",e.sinkOrigin.endpointStyle=angular.copy(c),e.actionOrigin.anchor.push("actionAnchor"),e.actionTarget.anchor.push("actionAnchor"),e.actionOrigin.connectorStyle["stroke-dasharray"]=[2,2],e.sinkOrigin.connectorStyle["stroke-dasharray"]=[2,2],e.actionOrigin.endpoint="Rectangle",e.actionOrigin.endpointStyle=angular.copy(c),e.actionTarget.endpoint="Rectangle",e.actionTarget.endpointStyle=angular.copy(c),e}function t(e){var t={script:"icon-script",scriptfilter:"icon-scriptfilter",twitter:"icon-twitter",cube:"icon-cube",data:"fa-database",database:"icon-database",table:"icon-table",kafka:"icon-kafka",stream:"icon-streams",jms:"icon-jms",projection:"icon-projection",amazonsqs:"icon-amazonsqs",datagenerator:"icon-datagenerator",validator:"icon-validator",corevalidator:"corevalidator",logparser:"icon-logparser",file:"icon-file",kvtable:"icon-kvtable",s3:"icon-s3",s3avro:"icon-s3avro",s3parquet:"icon-s3parquet",snapshotavro:"icon-snapshotavro",snapshotparquet:"icon-snapshotparquet",tpfsavro:"icon-tpfsavro",tpfsparquet:"icon-tpfsparquet",sink:"icon-sink",hive:"icon-hive",structuredrecordtogenericrecord:"icon-structuredrecord",cassandra:"icon-cassandra",teradata:"icon-teradata",elasticsearch:"icon-elasticsearch",hbase:"icon-hbase",mongodb:"icon-mongodb",pythonevaluator:"icon-pythonevaluator",csvformatter:"icon-csvformatter",csvparser:"icon-csvparser",clonerecord:"icon-clonerecord",compressor:"icon-compressor",decompressor:"icon-decompressor",encoder:"icon-encoder",decoder:"icon-decoder",jsonformatter:"icon-jsonformatter",jsonparser:"icon-jsonparser",streamformatter:"icon-streamformatter",hdfs:"icon-hdfs",hasher:"icon-hasher",javascript:"icon-javascript",deduper:"icon-deduper",distinct:"icon-distinct",naivebayestrainer:"icon-naivebayestrainer",groupbyaggregate:"icon-groupbyaggregate",naivebayesclassifier:"icon-naivebayesclassifier",azureblobstore:"icon-azureblobstore",xmlreader:"icon-XMLreader",xmlparser:"icon-XMLparser",ftp:"icon-FTP",joiner:"icon-joiner",deduplicate:"icon-deduplicator",valuemapper:"icon-valuemapper",rowdenormalizer:"icon-rowdenormalizer",ssh:"icon-ssh",sshaction:"icon-sshaction",copybookreader:"icon-COBOLcopybookreader",excel:"icon-excelinputsource",encryptor:"icon-Encryptor",decryptor:"icon-Decryptor",hdfsfilemoveaction:"icon-filemoveaction",hdfsfilecopyaction:"icon-filecopyaction",sqlaction:"icon-SQLaction",impalahiveaction:"icon-impalahiveaction",email:"icon-emailaction",kinesissink:"icon-Amazon-Kinesis",bigquerysource:"icon-Big-Query",tpfsorc:"icon-ORC",groupby:"icon-groupby",sparkmachinelearning:"icon-sparkmachinelearning",solrsearch:"icon-solr",sparkstreaming:"icon-sparkstreaming",rename:"icon-rename",archive:"icon-archive"},a=e.toLowerCase(),n=t[a]?t[a]:"fa-plug";return n}function a(e,t,a){var n=a||200,r=new dagre.graphlib.Graph;return r.setGraph({nodesep:90,ranksep:n,rankdir:"LR",marginx:0,marginy:0}),r.setDefaultEdgeLabel(function(){return{}}),e.forEach(function(e){var t=e.id||e.name;r.setNode(t,{label:e.label,width:100,height:100})}),t.forEach(function(e){r.setEdge(e.from,e.to)}),dagre.layout(r),r}var n={Connector:["Flowchart",{gap:6,stub:[10,15],alwaysRespectStubs:!0}],ConnectionsDetachable:!0},r={strokeStyle:"#666e82",fillStyle:"#666e82",radius:5,lineWidth:2},s={connectorOverlays:[["Arrow",{location:1,length:12,width:12,height:10,foldback:1}]]},i={endpoint:"Dot",maxConnections:-1,paintStyle:{strokeStyle:"#666e82",fillStyle:"#666e82",radius:5,lineWidth:3},anchors:["Static"]},o=angular.extend({isSource:!0,connectorStyle:r,connectorOverlays:[["Arrow",{location:1,length:12,width:12,height:10,foldback:1}]],anchor:[.5,1,1,0,26,-43]},i),l=angular.extend({isTarget:!0,connectorOverlays:[["Arrow",{location:1,length:12,width:12,height:10,foldback:1}]],anchor:[.5,1,-1,0,-27,-43],connectorStyle:r},i),c={width:7,height:7,fillStyle:"#666e82",strokeStyle:"#666e82"};return{getSettings:e,getIcon:t,getGraphLayout:a}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=angular.module(e.name+".commons");t.factory("jsPlumb",["$window",function(e){return e.jsPlumb}]),t.directive("myDagPlus",function(){return{restrict:"E",scope:{isDisabled:"=",nodes:"=",connections:"=",nodeClick:"&",nodeDelete:"&",context:"=",showMetrics:"=",metricsData:"=",nodePopoverTemplate:"@",disableNodeClick:"=",separation:"=?",previewMode:"=?"},link:function(e,t){e.element=t,e.getGraphMargins=function(e){var t=this.element[0].parentElement.getBoundingClientRect(),a=t.width,n=t.height,r=1,s=0,i=0;angular.forEach(e,function(e){if(e._uiPosition){var t=parseInt(e._uiPosition.left,10),a=parseInt(e._uiPosition.top,10);s=t>s?t:s,
i=a>i?a:i}});var o=(a-s)/2-50,l=(n-i)/2-50;if(angular.forEach(e,function(e){if(e._uiPosition){var t=parseInt(e._uiPosition.left,10)+o,a=parseInt(e._uiPosition.top,10)+l;e._uiPosition.left=t+"px",e._uiPosition.top=a+"px"}}),s>a-100&&(r=(a-100)/s),i>n-100){var c=(n-100)/i;r=c>r?r:c}return{scale:r}}},templateUrl:"dag-plus/my-dag.html",controller:"DAGPlusPlusCtrl",controllerAs:"DAGPlusPlusCtrl"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myDataList",function(){return{restrict:"E",scope:{level:"@",program:"@",isHydrator:"="},templateUrl:"data-list/data-list.html",controller:["$scope","MyCDAPDataSource","$state","myPipelineApi",function(e,t,a,n){function r(){n.get({namespace:a.params.namespace,pipeline:a.params.appId,scope:e}).$promise.then(function(t){e.dataList=e.dataList.concat(t.datasets.map(function(e){return e.type="Dataset",e}),t.streams.map(function(e){return e.type="Stream",e}))})}function s(){var n=new t(e),r="/apps/"+a.params.appId;if("app"!==e.level){switch(e.program){case"mapreduce":r+="/mapreduce/";break;case"flow":r+="/flows/";break;case"service":r+="/services/"}r+=a.params.programId}n.request({_cdapNsPath:r+"/datasets"}).then(function(t){angular.forEach(t,function(t){e.dataList.push({name:t.instanceId,type:"Dataset"})})}),n.request({_cdapNsPath:r+"/streams"}).then(function(t){angular.forEach(t,function(t){e.dataList.push({name:t.streamName,type:"Stream"})})})}e.dataList=[],e.isHydrator&&"app"===e.level?r():s()}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e){"ngInject";function t(){n.date=angular.copy(e.dateObject),n.hour=e.dateObject.getHours(),n.minutes=e.dateObject.getMinutes()}function a(){var t=n.date.getFullYear(),a=n.date.getMonth(),r=n.date.getDate(),s=n.hour,i=n.minutes;e.dateObject=!s&&0!==s||!i&&0!==i?null:new Date(t,a,r,s,i,0)}var n=this;n.options={initDate:new Date,showWeeks:!1,startingDay:0},e.minDate&&(n.options.minDate=e.minDate),e.maxDate&&(n.options.maxDate=e.maxDate),e.dateObject=e.dateObject||new Date,t(),e.$watch("DatetimeController.hour",function(){n.hour=parseInt(n.hour,10),a()}),e.$watch("DatetimeController.minutes",function(){n.minutes=parseInt(n.minutes,10),a()}),e.$watch("DatetimeController.date",a)}t.$inject=["$scope"],angular.module(e.name+".commons").directive("myDatetimePicker",function(){return{restrict:"E",scope:{dateObject:"=",minDate:"=?",maxDate:"=?"},controller:t,controllerAs:"DatetimeController",templateUrl:"datetime-picker/datetime.html"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e){"ngInject";var t=this;t.startTimeOpen=!1,t.endTimeOpen=!1,t.openStartTime=function(){t.startTimeOpen=!0,t.endTimeOpen=!1},t.openEndTime=function(){t.startTimeOpen=!1,t.endTimeOpen=!0},t.done=function(){t.close(),e.onDone()},t.close=function(){t.startTimeOpen=!1,t.endTimeOpen=!1};var a=function(e){27===e.keyCode&&t.close()};document.addEventListener("keydown",a),document.body.addEventListener("click",t.close,!1),e.$on("$destroy",function(){document.removeEventListener("keydown",a),document.body.removeEventListener("click",t.close,!1)})}t.$inject=["$scope"],angular.module(e.name+".commons").directive("myDatetimeRange",function(){return{restrict:"E",scope:{dateRange:"=",onDone:"&"},controller:t,controllerAs:"RangeController",templateUrl:"datetime-range/datetime-range.html"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myDurationPicker",function(){return{restrict:"E",require:"ngModel",scope:{},templateUrl:"duration-picker/duration-picker.html",link:function(e,t,a,n){e.durationTypes=[{name:"1 Minute",startTime:"now-1m"},{name:"1 Hour",startTime:"now-1h"},{name:"1 Day",startTime:"now-1d"}],e.durationType=e.durationTypes[0],e.label=a.label||"Duration",n.$render=function(){e.timestamp=n.$viewValue},e.$watch("durationType",function(e,t,a){n.$setViewValue(a.durationType.startTime)})}}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("myErrorController",["$scope","myAlert",function(e,t){e.alerts=t.getAlerts(),e.clear=function(){t.clear(),e.alerts=t.getAlerts()},e.remove=function(e){t.remove(e)}}]).directive("myError",function(){return{restrict:"E",templateUrl:"error/error-template.html",controller:["$scope","myAlert",function(e,t){e.emptyError=function(){return t.isEmpty()},e.errorCount=t.count}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myEscapeClose",function(){return{restrict:"A",link:function(e,t,a){var n=a.myEscapeClose;t.bind("keyup",function(t){27===t.keyCode&&(e.$apply(function(){e.$eval(n)}),t.preventDefault())})}}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myExplore",function(){function e(e,t,a,n,r,s,i,o,l,c,u){var p=this,d=null;p.queries=[],p.currentPage=1;var m={namespace:n.params.namespace,scope:e};e.$watch("name",function(){p.query="SELECT * FROM "+e.type+"_"+e.name+" LIMIT 5"}),p.execute=function(){t.postQuery(m,{query:p.query},p.getQueries),p.currentPage=1},p.getQueries=function(){t.getQueries(m).$promise.then(function(a){p.queries=a,angular.forEach(p.queries,function(a){if(a.isOpen=!1,"FINISHED"!==a.status){var n={queryhandle:a.query_handle,scope:e};t.pollQueryStatus(n).$promise.then(function(e){a.status=e.status,"FINISHED"===e.status&&t.stopPollQueryStatus(n)})}}),i.cancel(d),d=i(function(){p.previous=p.queries.map(function(e){return e.query_handle})},1e3)})},p.getQueries(),p.preview=function(e){r.open({templateUrl:"explore/preview-modal.html",size:"lg",resolve:{query:function(){return e}},controller:["$scope","myExploreApi","query",function(e,t,a){var n={queryhandle:a.query_handle,scope:e};t.getQuerySchema(n).$promise.then(function(t){angular.forEach(t,function(e){-1!==e.name.indexOf(".")&&(e.name=e.name.split(".")[1])}),e.schema=t}),t.getQueryPreview(n,{},function(t){e.rows=t})}]})},p.download=function(e){e.downloading=!0,e.is_active=!1,a.post("/downloadQuery",{backendUrl:s.constructUrl({_cdapPath:"/data/explore/queries/"+e.query_handle+"/download"}),queryHandle:e.query_handle},{responseType:"blob"}).success(function(t){var a=new c([t],{type:"text/csv"}),n=e.query_handle+".csv";u.saveAs(a,n),e.downloading=!1}).error(function(t){console.info("Error downloading query"),o({title:"Error",content:t}),e.downloading=!1})},p.clone=function(e){p.query=e.statement},e.$on("$destroy",function(){i.cancel(d)})}return e.$inject=["$scope","myExploreApi","$http","$state","$uibModal","myCdapUrl","$timeout","myAlert","MY_CONFIG","Blob","FileSaver"],{restrict:"E",scope:{type:"=",name:"="},templateUrl:"explore/explore.html",controller:e,controllerAs:"MyExploreCtrl"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myFileSelect",["$parse",function(e){return{restrict:"E",scope:!0,templateUrl:"fileselect/fileselect.html",link:function(t,a,n){t.buttonLabel=n.buttonLabel||"Upload",t.buttonIcon=n.buttonIcon||"fa-plus",t.buttonClass=n.buttonClass||"",t.buttonDisabled="true"===n.buttonDisabled,n.$observe("buttonDisabled",function(){t.buttonDisabled="true"===n.buttonDisabled}),void 0===n.dropdown&&(n.dropdown=!1),t.isDropdown=n.dropdown;var r=angular.element('<input class="sr-only" type="file" multiple="true">');a.append(r),a.bind("click",function(){r[0].click()});var s=e(n.onFileSelect);r.bind("change",function(e){s(t,{$files:e.target.files}),this.value=null})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("myFlowController",["$scope","myHelpers",function(e,t){function a(a){t.objectQuery(a,"nodes")&&t.objectQuery(a,"edges")&&(n&&(e.render(),n=!1,e.centerImage()),e.update())}var n=!0;e.instanceMap={},e.labelMap={},e.$watch("onChangeFlag",function(t){t&&a(e.model)})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").factory("dagreD3",["$window",function(e){return e.dagreD3}]).factory("FlowFactories",function(){function e(e){e.translateX=0,e.translateY=0,e.currentScale=1.1,e.renderer=new dagreD3.render,e.g=new dagreD3.graphlib.Graph,e.g.setGraph({nodesep:90,ranksep:120,rankdir:"LR",marginx:30,marginy:50}).setDefaultEdgeLabel(function(){return{}}),angular.extend(e.renderer.shapes(),e.getShapes()),e.selector="",e.parentSelector&&(e.selector+=e.parentSelector),e.selector+=" svg",e.svg=d3.select(e.selector).attr("fill","white"),e.svgGroup=d3.select(e.selector+" g"),e.drag=d3.behavior.drag(),e.drag.on("drag",function(){d3.event.sourceEvent.stopPropagation(),e.translateX=e.translateX+d3.event.dx,e.translateY=e.translateY+d3.event.dy;var t=e.svg.node().getBoundingClientRect(),a=e.g.graph();e.translateX>t.width&&(e.translateX=t.width),e.translateX<-(a.width*e.currentScale)&&(e.translateX=-(a.width*e.currentScale)),e.translateY>t.height&&(e.translateY=t.height),e.translateY<-(a.height*e.currentScale)&&(e.translateY=-(a.height*e.currentScale));var n=[e.translateX,e.translateY];e.svgGroup.attr("transform","translate("+n+") scale("+e.currentScale+")")}),e.zoomIn=function(){e.currentScale+=.1,e.currentScale>2.5&&(e.currentScale=2.5),e.translateX=e.translateX-.1*e.translateX,e.translateY=e.translateY-.1*e.translateY;var t=[e.translateX,e.translateY];e.svgGroup.attr("transform","translate("+t+") scale("+e.currentScale+")")},e.zoomOut=function(){e.currentScale-=.1,e.currentScale<.1&&(e.currentScale=.1);var t=[e.translateX,e.translateY];e.svgGroup.attr("transform","translate("+t+") scale("+e.currentScale+")")};var t=d3.behavior.zoom();t.on("zoom",function(){e.svgGroup.attr("transform","translate("+d3.event.translate+") scale("+e.currentScale+")")}),e.centerImage=function(){var a=1;e.svg.attr("height",e.g.graph().height*a+40);var n=e.svg.node().getBoundingClientRect().width,r=e.svg.node().getBoundingClientRect().height;n-e.g.graph().width<=0?(e.currentScale=n/e.g.graph().width,e.translateX=0,e.translateY=(r-e.g.graph().height)*e.currentScale/2):(e.translateX=(n-e.g.graph().width*a)/2+10,e.translateY=20,e.currentScale=a),t.translate([e.translateX,e.translateY]).scale(e.currentScale).event(e.svg)}}function t(e,t,a,n){var r=e.model.nodes,s=e.model.edges;e.svg=d3.select(e.selector),e.svgGroup=d3.select(e.selector+" g"),e.svg.call(e.drag),angular.forEach(r,function(t){var a="";a=n?t.label&&t.label.length?t.label.length>24?t.label.substr(0,20)+"...":t.label:t.name.length>24?t.name.substr(0,20)+"...":t.name:t.label&&t.label.length?t.label.length>8?t.label.substr(0,5)+"...":t.label:t.name.length>8?t.name.substr(0,5)+"...":t.name,e.instanceMap[t.name]=t,e.labelMap[t.label||t.name]=t,e.g.setNode(t.name,{shape:e.getShape(t.type),label:a,labelId:t.name})}),angular.forEach(s,function(t){e.arrowheadRule(t)?e.g.setEdge(t.sourceName,t.targetName):e.g.setEdge(t.sourceName,t.targetName,{arrowhead:"undirected"})}),e.renderer(d3.select(e.selector+" g"),e.g);var i=e.svgGroup.selectAll("g.edgePath > path.path");angular.forEach(i[0],function(e){e.attributes["marker-end"].nodeValue="url("+a.absUrl()+e.attributes["marker-end"].nodeValue.substr(4)}),e.svg.selectAll("g.node").on("dblclick",e.handleNodeClick),n&&e.svg.selectAll("g.token").on("click",e.toggleToken),e.createTooltips()}return{genericRender:t,prepareGraph:e}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=angular.module(e.name+".commons"),a={restrict:"E",templateUrl:"flow-graph/flow.html",scope:{model:"=",onChangeFlag:"=",clickContext:"=",click:"&"},controller:"myFlowController"};t.directive("myFlowGraph",["$filter","$state","myStreamService","$location","FlowFactories","$tooltip",function(e,t,n,r,s,i){return angular.extend({link:function(t,a,o){function l(e,t){var a=f,n=h,r=g,s=u,i="flow-shapes leaf-shape";if(t&&"[object Object]"===Object.prototype.toString.call(t)&&(a=t.diagramWidth||a,n=t.yFactor||n,r=t.xFactor||r,s=t.circleRadius||s,angular.isArray(t.classNames))){var o=t.classNames.join(" ");i=o?"flow-shapes leaf-shape "+o:"flow-shapes leaf-shape"}var l=[{x:0,y:0},{x:a*r,y:-a*n},{x:2*a,y:0},{x:a*r,y:a*n},{x:0,y:0}],c=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("basis-closed");e.insert("svg:path").attr("d",c(l)).attr("class",i).attr("transform",function(){return"translate("+(-s+y)+", 0) rotate(-180)"})}function c(e,t){var a=e.select(".leaf-shape").node().getBBox().width;return-t.circleRadius-a/2+y/2}t.render=s.genericRender.bind(null,t,e,r),t.parentSelector=o.parent;var u=45,p=5,d=40,m=30,f=.75*u,h=.9,g=1.25,y=.2*u,v=e("myNumber");t.getShapes=function(){var e={};return e.flowlet=function(e,a,n){var r=t.model.instances[n.labelId]||1;e.select(".label").attr("transform","translate(20,"+a.height/3+")").attr("class","node-label");var s=e.insert("g",":first-child");s.insert("circle",":first-child").attr("x",-a.width/2).attr("y",-a.height/2).attr("r",u).attr("class","flow-shapes foundation-shape flowlet-svg"),s.insert("text").attr("y",-a.height/4).text("x"+r).attr("class","flow-shapes flowlet-instance-count").attr("id","instance-"+n.labelId);var i={classNames:["flowlet-events"],circleRadius:u,diagramWidth:f};return l(s,i),s.insert("text").attr("x",c(s,i)).attr("y",p).text(v(t.model.metrics[t.labelMap[n.labelId].name])).attr("class","flow-shapes flowlet-event-count").attr("id","metrics-"+n.labelId),s.attr("transform","translate(20, 0)"),n.intersect=function(e){return dagreD3.intersect.circle(n,u,e)},s},e.stream=function(e,a,n){var r=a.width,s=a.height/2,i=[{x:-d,y:m},{x:-d,y:-s-m},{x:r/2,y:-s-m},{x:r,y:-s/2},{x:r/2,y:m}],o=e.insert("g",":first-child");o.insert("polygon",":first-child").attr("points",i.map(function(e){return e.x+","+e.y}).join(" ")).attr("transform","translate("+-r/8+","+1*s/2+")").attr("class","flow-shapes foundation-shape stream-svg");var h={classNames:["stream-events"],circleRadius:u,diagramWidth:f};return l(o,h),o.append("text").attr("x",c(o,h)).attr("y",p).text(v(t.model.metrics[t.labelMap[n.labelId].name])).attr("class","flow-shapes stream-event-count").attr("id","metrics-"+n.labelId),e.select(".label").attr("transform","translate(20, 0)").attr("class","node-label"),o.attr("transform","translate(20, 0)"),n.intersect=function(e){return dagreD3.intersect.polygon(n,i,e)},o},e},t.getShape=function(e){var t;switch(e){case"STREAM":t="stream";break;default:t="flowlet"}return t},t.handleNodeClick=function(e){var a=t.instanceMap[e];"STREAM"===a.type?n.show(e):t.$apply(function(t){var a=t.click();"undefined"!=typeof a&&a.call(t.clickContext,e)})},t.arrowheadRule=function(){return!1},t.update=function(){angular.forEach(t.model.instances,function(e,t){d3.select("#instance-"+t).text("x"+e)}),angular.forEach(t.model.metrics,function(e,t){d3.select("#metrics-"+t).text(v(e))})},t.createTooltips=function(){var e=d3.selectAll(".node-label")[0],t={};angular.forEach(e,function(e){t[e.id]=i(angular.element(e),{title:e.id,trigger:"manual",delay:{show:300,hide:0},target:angular.element(e),container:".diagram-container"})}),d3.selectAll(".node-label").on("mouseover",function(e){t[e].enter()}).on("mouseout",function(e){t[e].leave()})},s.prepareGraph(t)}},a)}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=angular.module(e.name+".commons"),a={restrict:"E",templateUrl:"flow-graph/flow.html",scope:{model:"=",onChangeFlag:"=",clickContext:"=",click:"&",tokenClick:"&",workflowStatus:"="},controller:"myFlowController"};t.directive("myWorkflowGraph",["$filter","$location","FlowFactories","$tooltip",function(e,t,n,r){return angular.extend({link:function(a){a.render=n.genericRender.bind(null,a,e,t,!0);var s=30;a.getShapes=function(){var e={};return e.job=function(e,t,n){var r=7*s/8,i=1*s/2,o=[{x:0,y:s},{x:r,y:i},{x:r,y:-i},{x:0,y:-s},{x:-r,y:-i},{x:-r,y:i}];e.select(".label").attr("transform","translate(0,"+(s+20)+")").attr("class","node-label");var l=e.insert("polygon",":first-child").attr("points",o.map(function(e){return e.x+","+e.y}).join(" ")).attr("id","job-"+a.instanceMap[n.labelId].nodeId).attr("class","workflow-shapes foundation-shape job-svg"),c=e.append("g").attr("transform","translate(0, "+(-s-25)+")").attr("class","token hidden").attr("id","token-"+a.instanceMap[n.labelId].nodeId);return c.append("circle").attr("r",11).attr("class","workflow-token"),c.append("text").text("T").attr("x",-4).attr("y",5).attr("class","token-label"),n.intersect=function(e){return dagreD3.intersect.polygon(n,o,e)},l},e.start=function(e,t,a){var n=t.width,r=[{x:-20,y:-30},{x:20,y:0},{x:-20,y:30}];e.select(".label").attr("transform","translate(0,"+(t.height+20)+")");var s=e.insert("polygon",":first-child").attr("points",r.map(function(e){return e.x+","+e.y}).join(" ")).attr("transform","translate("+n/6+")").attr("class","workflow-shapes foundation-shape start-svg");return a.intersect=function(e){return dagreD3.intersect.polygon(a,r,e)},s},e.end=function(e,t,a){var n=t.width,r=[{x:-20,y:0},{x:20,y:30},{x:20,y:-30}];e.select(".label").attr("transform","translate(0,"+(t.height+20)+")");var s=e.insert("polygon",":first-child").attr("points",r.map(function(e){return e.x+","+e.y}).join(" ")).attr("transform","translate("+-n/6+")").attr("class","workflow-shapes foundation-shape end-svg");return a.intersect=function(e){return dagreD3.intersect.polygon(a,r,e)},s},e.conditional=function(e,t,n){var r=[{x:0,y:3*-s/4},{x:3*-s/4,y:0},{x:0,y:3*s/4},{x:3*s/4,y:0}];e.select(".label").attr("transform","translate(0,"+(t.height+20)+")");var i=e.insert("polygon",":first-child").attr("points",r.map(function(e){return e.x+","+e.y}).join(" ")).attr("class","workflow-shapes foundation-shape conditional-svg");if("IF"===n.label){e.attr("class","if-condition");var o=e.append("g").attr("transform","translate(0, "+(-s-25)+")").attr("class","token hidden").attr("id","token-"+a.instanceMap[n.labelId].nodeId);o.append("circle").attr("r",11).attr("class","workflow-token"),o.append("text").text("T").attr("x",-4).attr("y",5).attr("class","token-label")}return n.intersect=function(e){return dagreD3.intersect.polygon(n,r,e)},i},e.forkjoin=function(e,t,a){e.select(".label").attr("style","display: none;");var n=e.insert("circle",":first-child").attr("x",-t.width/2).attr("y",-t.height/2).attr("r",0);return a.intersect=function(e){return dagreD3.intersect.circle(a,1,e)},n},e},a.getShape=function(e){var t;switch(e){case"ACTION":t="job";break;case"FORKNODE":t="forkjoin";break;case"JOINNODE":t="forkjoin";break;case"START":t="start";break;case"END":t="end";break;default:t="conditional"}return t},a.handleNodeClick=function(e){var t=a.instanceMap[e];a.$apply(function(e){var a=e.click();"undefined"!=typeof a&&a.call(e.clickContext,t)})},a.toggleToken=function(e){var t=a.instanceMap[e];a.$apply(function(e){var a=e.tokenClick();"undefined"!=typeof a&&a.call(e.clickContext,t)})},a.arrowheadRule=function(e){return"JOINNODE"===e.targetType||"FORKNODE"===e.targetType?!1:!0},a.update=function(){if(angular.forEach(a.model.current,function(e,t){var n=a.instanceMap[t].nodeId,r=a.svg.select("#job-"+n);switch(e){case"COMPLETED":r.attr("class","workflow-shapes foundation-shape job-svg completed"),a.svg.select("#token-"+n).attr("class","token");break;case"RUNNING":r.attr("class","workflow-shapes foundation-shape job-svg running");break;case"FAILED":r.attr("class","workflow-shapes foundation-shape job-svg failed");break;case"KILLED":r.attr("class","workflow-shapes foundation-shape job-svg killed");break;default:r.attr("class","workflow-shapes foundation-shape job-svg")}}),"COMPLETED"===a.workflowStatus||"FAILED"===a.workflowStatus){var e=a.svg.selectAll(".if-condition")[0];angular.forEach(e,function(e){d3.select(e).select(".token").attr("class","token")})}},a.createTooltips=function(){var e=d3.selectAll(".node-label")[0],t={};angular.forEach(e,function(e){var n=a.instanceMap[e.id].program.programType||a.instanceMap[e.id].program.programName;t[e.id]=r(angular.element(e),{title:a.instanceMap[e.id].nodeId+" : "+n,trigger:"manual",delay:{show:300,hide:0},target:angular.element(e),container:".diagram-container"})}),d3.selectAll(".node-label").on("mouseover",function(e){t[e].enter()}).on("mouseout",function(e){t[e].leave()})},n.prepareGraph(a)}},a)}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myFocusWatch",["$timeout",function(e){return{scope:{model:"=myFocusWatch"},link:function(t,a){var n=null;t.$watch("model",function(){t.model&&(n&&e.cancel(n),n=e(function(){a[0].focus()}))}),t.$on("$destroy",function(){n&&e.cancel(n)})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("MySidePanel",["$scope",function(e){this.groups=e.panelGroups,this.groupGenericName=e.groupGenericName||"group",this.itemGenericName=e.itemGenericName||"item",this.view=e.view||"icon",e.$watch("MySidePanel.groups.length",function(){this.groups.length&&(this.openedGroup=this.groups[0].name),this.groupWrapperHeight="calc(100% - "+(35*this.groups.length-35-1)+"px)"}.bind(this)),this.onItemClicked=function(t,a){t.stopPropagation(),t.preventDefault();var n=e.onPanelItemClick();"undefined"!=typeof n&&n.call(e.onPanelItemClickContext,t,a)}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("mySidePanel",function(){return{restrict:"E",scope:{panelGroups:"=",view:"=",groupGenericName:"@",itemGenericName:"@",onAdd:"&",onPanelItemClick:"&",onPanelItemClickContext:"="},templateUrl:"group-side-panel/group-side-panel.html",controller:"MySidePanel",controllerAs:"MySidePanel"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("infiniteScroll",["$timeout",function(e){return{restrict:"A",link:function(t,a,n){function r(){a.prop("scrollTop")+a.prop("offsetHeight")>=a.prop("scrollHeight")?t.$apply(n.infiniteScrollNext):0===a.prop("scrollTop")&&t.$apply(n.infiniteScrollPrev)}var s=e(function(){a.prop("scrollTop",10),a.bind("scroll",_.debounce(r,1e3))},100);t.$on("$destroy",function(){a.unbind("scroll"),e.cancel(s)})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myInstanceControl",function(){return{restrict:"E",controller:"instanceControlController",scope:{basePath:"="},templateUrl:"instance-control/instance-control.html"}}).controller("instanceControlController",["$scope","MyCDAPDataSource","myAlertOnValium",function(e,t,a){var n=new t(e);n.request({_cdapPath:e.basePath+"/instances"}).then(function(t){t.instances?e.instance={provisioned:t.instances,requested:t.instances}:e.instance=t}),e.handleSet=function(){n.request({method:"PUT",_cdapPath:e.basePath+"/instances",body:{instances:e.instance.requested},suppressErrors:!0}).then(function(){e.instance.provisioned=e.instance.requested},function(e){a.show({type:"danger",title:"Error",content:angular.isObject(e)?e.data:e})})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=function(e,t,a){var n=function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0],a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];switch(a.type){case e.START_TIME:return a.payload.startTime?a.payload.startTime:t;case e.RESET:return null;default:return t}},r=function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0],a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];switch(a.type){case e.SCROLL_POSITION:return a.payload.scrollPosition?a.payload.scrollPosition:t;case e.RESET:return null;default:return t}},s=function(){var t=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];switch(a.type){case e.FULL_SCREEN:return a.payload.fullScreen;case e.RESET:return!1;default:return t}},i=function(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];switch(a.type){case e.SEARCH_RESULTS:return a.payload.searchResults?a.payload.searchResults:t;case e.RESET:return[];default:return t}},o=function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];switch(a.type){case e.TOTAL_LOGS:return a.payload.totalLogs?a.payload.totalLogs:t;case e.RESET:return 0;default:return t}},l=function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];switch(a.type){case e.TOTAL_ERRORS:return a.payload.totalErrors?a.payload.totalErrors:t;case e.RESET:return 0;default:return t}},c=function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0],a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];switch(a.type){case e.TOTAL_WARNINGS:return a.payload.totalWarnings?a.payload.totalWarnings:t;case e.RESET:return 0;default:return t}},u=t.combineReducers,p=t.applyMiddleware,d=u({startTime:n,scrollPosition:r,fullScreen:s,searchResults:i,totalLogs:o,totalErrors:l,totalWarnings:c}),m=function(){return{startTime:null,scrollPosition:null,fullScreen:!1,searchResults:[],totalLogs:0,totalErrors:0,totalWarnings:0}};return t.createStore(d,m(),t.compose(p(a["default"])))};t.$inject=["LOGVIEWERSTORE_ACTIONS","Redux","ReduxThunk"],angular.module(e.name+".commons").constant("LOGVIEWERSTORE_ACTIONS",{START_TIME:"START_TIME",SCROLL_POSITION:"SCROLL_POSITION",SEARCH_RESULTS:"SEARCH_RESULTS",FULL_SCREEN:"FULL_SCREEN",RESET:"RESET",TOTAL_LOGS:"TOTAL_LOGS",TOTAL_ERRORS:"TOTAL_ERRORS",TOTAL_WARNINGS:"TOTAL_WARNINGS"}).factory("LogViewerStore",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t,a,n,r,s,i,o,l,c){"ngInject";function u(){return T.namespaceId&&T.appId&&T.programType&&T.runId&&T.fromOffset}function p(){if(!T.loading){if(!u())return void(T.loading=!1);T.loading=!0,g&&(v.stopPoll(g.__pollId__),g=null),a.nextLogsJsonOffset({namespace:T.namespaceId,appId:T.appId,programType:T.programType,programId:T.programId,runId:T.runId,fromOffset:T.fromOffset}).$promise.then(function(e){return T.errorRetrievingLogs=!1,T.loading=!1,0===e.length?void d():(T.fromOffset=e[e.length-1].offset,angular.forEach(e,function(t,a){var n=new Date(e[a].log.timestamp);e[a].log.timestamp=n,e[a].log.displayTime=c(n).format("L H:mm:ss"),e[a].log.stackTrace=e[a].log.stackTrace.trim()}),T.data=T.data.concat(e),T.renderData(),void(T.displayData.length<T.viewLimit&&d()))},function(e){console.log("ERROR: ",e),T.errorRetrievingLogs=!0,T.loading=!1})}}function d(){a.getLogsMetadata({namespace:T.namespaceId,appId:T.appId,programType:T.programType,programId:T.programId,runId:T.runId}).$promise.then(function(e){T.setProgramMetadata(e.status),0===T.statusType?g||m():g&&v.stopPoll(g.__pollId__)},function(e){console.log("ERROR: ",e)})}function m(){g=v.poll({_cdapPath:"/namespaces/"+T.namespaceId+"/apps/"+T.appId+"/"+T.programType+"/"+T.programId+"/runs/"+T.runId+"/logs/next?format=json&max=100&fromOffset="+T.fromOffset,method:"GET"},function(e){T.errorRetrievingLogs=!1,e.length>0&&(T.fromOffset=e[e.length-1].offset,angular.forEach(e,function(t,a){var n=new Date(e[a].log.timestamp);e[a].log.timestamp=n,e[a].log.displayTime=c(n).format("L H:mm:ss"),e[a].log.stackTrace=e[a].log.stackTrace.trim()}),T.data=T.data.concat(e),T.renderData()),T.displayData.length>=T.viewLimit?(v.stopPoll(g.__pollId__),g=null):d()},function(e){console.log("ERROR: ",e),T.errorRetrievingLogs=!0})}function f(){return u()?(T.loading=!0,T.data=[],T.renderData(),g&&(v.stopPoll(g.__pollId__),g=null),angular.element(document.getElementsByClassName("logs-table"))[0].scrollTop=0,void a.nextLogsJsonOffset({namespace:T.namespaceId,appId:T.appId,programType:T.programType,programId:T.programId,runId:T.runId,fromOffset:T.fromOffset}).$promise.then(function(e){return T.errorRetrievingLogs=!1,T.loading=!1,T.data=e,0===e.length?(d(),0!==T.statusType&&(T.displayData=[]),void T.renderData()):(T.fromOffset=e[e.length-1].offset,T.displayData=[],angular.forEach(e,function(t,a){var n=new Date(e[a].log.timestamp);e[a].log.timestamp=n,e[a].log.displayTime=c(n).format("L H:mm:ss"),e[a].log.stackTrace=e[a].log.stackTrace.trim()}),T.renderData(),T.displayData.length>0&&T.updateScrollPositionInStore(T.displayData[0].log.timestamp),void(e.length<T.viewLimit&&d()))},function(e){T.setDefault(),T.errorRetrievingLogs=!0,console.log("ERROR: ",e)})):void(T.loading=!1)}function h(e,t){var a={month:e.getMonth()+1,day:e.getDate(),year:e.getFullYear(),hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()};return angular.forEach(a,function(e,t){10>e?a[t]="0"+e:a[t]=e.toString()}),t?a.year+a.day+a.month+a.hours+a.minutes+a.seconds:a.month+"/"+a.day+"/"+a.year+" "+a.hours+":"+a.minutes+":"+a.seconds}var g,y=this,v=new r(e),S=[],P=0,T=this;T.viewLimit=100,T.errorRetrievingLogs=!1,T.setProgramMetadata=function(e){switch(T.programStatus=e,T.entityName||(T.entityName=T.programId),e){case"RUNNING":case"STARTED":T.statusType=0;break;case"STOPPED":case"KILLED":case"FAILED":case"SUSPENDED":T.statusType=1;break;case"COMPLETED":T.statusType=2;break;default:T.statusType=3}};var C=angular.element(window);T.setDefault=function(){T.textFile=null,T.statusType=3,T.displayData=[],T.data=[],T.loading=!1,T.fullScreen=!1,T.programStatus="Not Started",T.configOptions={time:!0,level:!0,source:!0,message:!0},T.hiddenColumns={time:!1,level:!1,source:!1,message:!1};var e=T.configOptions;e.source&&S.push("source"),e.level&&S.push("level"),e.time&&S.push("time"),T.totalCount=0,T.warningCount=0,T.errorCount=0},T.setDefault(),angular.forEach(e.displayOptions,function(e,t){T.configOptions[t]=e}),T.logEvents=["ERROR","WARN","INFO","DEBUG","TRACE"];var b={ERROR:!1,WARN:!1,INFO:!1,DEBUG:!1,TRACE:!1},A=0;T.toggleExpandAll=!1;var E=t.subscribe(function(){T.totalCount=t.getState().totalLogs,T.warningCount=t.getState().totalWarnings,T.errorCount=t.getState().totalErrors,T.fullScreen=t.getState().fullScreen,T.logStartTime!==t.getState().startTime&&(T.logStartTime=t.getState().startTime,T.logStartTime&&T.startTimeMs!==T.logStartTime&&(T.startTimeMs=T.logStartTime instanceof Date?T.logStartTime.getTime():T.logStartTime,T.fromOffset=-1e4+"."+T.startTimeMs,f()))}),w=Number.MAX_VALUE,k=void 0;T.inViewScrollUpdate=function(t,a,n){if(a&&T.displayData&&T.displayData.length>0){var r=n.inViewTarget.parentElement.getBoundingClientRect().top,s=C[0].scrollY,i=n.inViewTarget.offsetTop,o=r+s+i,l=o-e.tableEl[0].offsetTop;T.fullScreen&&(l-=70),l>0&&(w>l||0>w)&&(t++,k=T.displayData[t].log.timestamp,T.updateScrollPositionInStore(k)),w=l}},T.runId&&a.getLogsMetadata({namespace:T.namespaceId,appId:T.appId,programType:T.programType,programId:T.programId,runId:T.runId}).$promise.then(function(e){T.setProgramMetadata(e.status)},function(e){console.log("ERROR: ",e)}),T.filterSearch=function(){if(T.renderData(),0===T.searchText.length)return void T.updateSearchResultsInStore([]);var e=[];T.displayData=T.displayData.filter(function(t){return-1!==t.log.message.toLowerCase().indexOf(T.searchText.toLowerCase())?(e.push(t.log.timestamp),!0):!1}),T.updateSearchResultsInStore(e)},T.toggleStackTrace=function(e){if(!T.displayData[e].stackTrace){if(e+1<T.displayData.length&&T.displayData[e+1].stackTrace)return T.displayData.splice(e+1,1),void(T.displayData[e].selected=!1);if(T.displayData[e].log.stackTrace){T.displayData[e].selected=!0;var t={log:{timestamp:T.displayData[e].log.timestamp,stackTrace:T.displayData[e].log.stackTrace},stackTrace:!0};T.displayData.splice(e+1,0,t)}else T.displayData[e].selected=!T.displayData[e].selected}},T.collapseColumns=function(){if(T.isMessageExpanded&&(T.isMessageExpanded=!T.isMessageExpanded),P<S.length)T.hiddenColumns[S[P++]]=!0,P===S.length&&(T.isMessageExpanded=!0);else{P=0;for(var e in T.hiddenColumns)T.hiddenColumns.hasOwnProperty(e)&&(T.hiddenColumns[e]=!1)}},T.updateScrollPositionInStore=function(e){t.dispatch({type:n.SCROLL_POSITION,payload:{scrollPosition:e}})},T.updateScreenChangeInStore=function(e){t.dispatch({type:n.FULL_SCREEN,payload:{fullScreen:e}})},T.updateSearchResultsInStore=function(e){t.dispatch({type:n.SEARCH_RESULTS,payload:{searchResults:e}})},T.getDownloadUrl=function(){var e=arguments.length<=0||void 0===arguments[0]?"download":arguments[0],t=Math.floor(T.startTimeMs/1e3),a="/namespaces/"+T.namespaceId+"/apps/"+T.appId+"/"+T.programType+"/"+T.programId+"/runs/"+T.runId+"/logs?start="+t+"&escape=false";
a=encodeURIComponent(i.constructUrl({_cdapPath:a}));var n="/downloadLogs?backendUrl="+a+"&type="+e;if("download"===e){var r="";r="undefined"!=typeof y.getDownloadFilename()?y.getDownloadFilename()+"-"+h(new Date(y.startTimeMs),!0):y.namespaceId+"-"+y.appId+"-"+y.programType+"-"+y.programId+"-"+h(new Date(y.startTimeMs),!0),n=n+"&filename="+r+".log"}return n},T.toggleLogExpansion=function(){var e=T.displayData.length;T.toggleExpandAll=!T.toggleExpandAll;for(var t=0;e>t;t++){var a=T.displayData[t];if(!a.stackTrace&&a.log.stackTrace.length>0)if(a.isStackTraceExpanded=T.toggleExpandAll,t<T.displayData.length&&T.toggleExpandAll&&(t+1===T.displayData.length||!T.displayData[t+1].stackTrace)){T.displayData[t].selected=!0;var n={log:{timestamp:T.displayData[t].log.timestamp,stackTrace:T.displayData[t].log.stackTrace},stackTrace:!0};T.displayData.splice(t+1,0,n),e++}else!T.toggleExpandAll&&!a.stackTrace&&t+1<T.displayData.length&&T.displayData[t+1].stackTrace&&(T.displayData[t].selected=!1,T.displayData.splice(t+1,1),e--);else T.displayData[t].selected=T.toggleExpandAll}},T.includeEvent=function(e){b[e]?A--:A++,b[e]=!b[e],T.renderData()},T.renderData=function(){return T.displayData=[],0===A?void angular.forEach(T.data,function(e,t){T.displayData.push(T.data[t])}):void angular.forEach(T.data,function(e,t){b[T.data[t].log.logLevel]&&T.displayData.push(T.data[t])})},T.highlight=function(e){return!T.searchText||T.searchText&&!T.searchText.length?s.trustAsHtml(e):s.trustAsHtml(e.replace(new RegExp(T.searchText,"gi"),'<span class="highlighted-text">$&</span>'))},T.eventFilter=function(e){return 0===A||b[e.log.logLevel]?e:void 0},T.scrollFn=function(){p()},T.preventClick=function(e){(!T.displayData.length||T.loading)&&e.preventDefault()},e.$on("$destroy",function(){E&&E(),t.dispatch({type:"RESET"}),g&&(v.stopPoll(g.__pollId__),g=null)})}t.$inject=["$scope","LogViewerStore","myLogsApi","LOGVIEWERSTORE_ACTIONS","MyCDAPDataSource","$sce","myCdapUrl","$timeout","$q","moment"];var a=function(e){e.tableEl=document.getElementsByClassName("logs-table")};angular.module(e.name+".commons").directive("myLogViewer",function(){return{templateUrl:"log-viewer/log-viewer.html",controller:t,controllerAs:"LogViewer",scope:{displayOptions:"=?",namespaceId:"@",appId:"@",programType:"@",programId:"@",runId:"@",getDownloadFilename:"&",entityName:"@"},link:a,bindToController:!0}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myMetadataTags",function(){return{restrict:"E",controller:"MetadataTagsController",controllerAs:"MetadataController",scope:{params:"=",type:"@",tagLimit:"="},templateUrl:"metadata-tags/metadata-tags.html"}}).controller("MetadataTagsController",["$scope","myMetadataFactory","caskFocusManager","$state",function(e,t,a,n){function r(e){var t=[];angular.forEach(e,function(e){"SYSTEM"===e.scope?t=e.tags.map(function(e){return{name:e,scope:"SYSTEM"}}):s.metadataTags=e.tags.map(function(e){return{name:e,scope:"USER"}})}),s.metadataTags=s.metadataTags.concat(t)}var s=this;s.metadataAddOpen=!1,s.metadataTags=[],s.tagLimit=e.tagLimit,s.limit=e.tagLimit;var i;switch(e.type){case"datasets":i=t.getDatasetsMetadata(e.params);break;case"apps":i=t.getAppsMetadata(e.params);break;case"programs":i=t.getProgramMetadata(e.params);break;case"streams":i=t.getStreamsMetadata(e.params)}i.then(function(e){r(e)}),this.addMetadata=function(){var a;switch(e.type){case"datasets":a=t.addDatasetsMetadata(s.tag,e.params);break;case"apps":a=t.addAppsMetadata(s.tag,e.params);break;case"programs":a=t.addProgramMetadata(s.tag,e.params);break;case"streams":a=t.addStreamsMetadata(s.tag,e.params)}a.then(function(e){r(e),s.tag=""})},this.deleteMetadata=function(a,n){a.stopPropagation();var s;switch(e.type){case"datasets":s=t.deleteDatasetsMetadata(n,e.params);break;case"apps":s=t.deleteAppsMetadata(n,e.params);break;case"programs":s=t.deleteProgramMetadata(n,e.params);break;case"streams":s=t.deleteStreamsMetadata(n,e.params)}s.then(function(e){r(e)})},s.escapeMetadata=function(){s.tag="",s.metadataAddOpen=!1},s.goToTag=function(e,t){e.stopPropagation(),n.go("search.objectswithtags",{tag:t})},a.focus("metadataInput")}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myMetricPicker",["MyCDAPDataSource","$stateParams","$log","MyMetricsQueryHelper",function(e,t,a,n){function r(e){var a=[t.namespace,"namespace"].join(" ");e.metricsSettings={externalProp:"",closeOnBlur:!1},e.available={contexts:[],types:["system",a],names:[]},e.metric={context:"",type:a,names:[],resetNames:function(){this.names=[]},getNames:function(){return this.names.map(function(e){return e.id})},getName:function(){return this.getNames().join(", ")}},e.deleteMetric=function(t){1===e.metric.names.length?e.metric.resetNames():e.metric.names.splice(t,1)}}r.$inject=["$scope"];var s=new e;return{restrict:"E",require:"ngModel",scope:{metricsLimit:"=",metricsSlotsFilled:"="},templateUrl:"metric-picker/metric-picker.html",controller:r,link:function(e,r,i,o){function l(){var n;return"system"===e.metric.type?n="system":(n=t.namespace,n||(n="default",a.warn("metric-picker using default namespace as context"))),"namespace."+n}function c(){var t=l(),a=t.length+1;e.metric.context&&(t+="."+e.metric.context);var r=t.split(".");if(r.length%2===0){var i=n.tagsToParams(n.contextToTags(t));e.available.contexts=[],s.request({method:"POST",_cdapPath:"/metrics/search?target=tag&"+i},function(r){r=r.map(function(e){return t+"."+n.tagToContext(e)}),e.available.contexts=r.map(function(t){return{value:t.substring(a),display:t.substring(a+e.metric.context.length)}}).filter(function(e){return e.display})}),e.available.names=[],s.request({method:"POST",_cdapPath:"/metrics/search?target=metric&"+i},function(t){var a=[];t.forEach(function(e){a.push({id:e,label:e})}),e.available.names=a})}}if(void 0!==i.required){var u=r.find("input").attr("required",!0);o.$validators.metricAndContext=function(e,t){var a=e||t;if(a.context&&a.context.split(".").length%2!==0)return!1;if(!a||!a.names||!a.names.length)return!1;for(var n=0;n<a.names.length;n++)if(!a.names[n].length)return!1;return!0}}var p=o.$setTouched.bind(o),d=r.find("button").on("blur",p),m=r.find("input").on("blur",p),f=function(t,a){if(o.$validate(),t.type!==a.type)return e.metric.context="",e.metric.resetNames(),void c();if(t.context!==a.context)return e.metric.resetNames(),void c();if(t.names){var n=l();t.context&&(n+="."+t.context),o.$setViewValue({context:n,names:t.getNames(),name:t.getName()})}else o.$dirty&&o.$setViewValue(null)};e.$watch("metric",f,!0),e.$on("$destroy",function(){u=d=m=null}),c()}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("MyCardCtrl",function(){this.minimize=!1,this.dominimize=function(){this.minimize=!this.minimize}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myCard",function(){return{restrict:"E",scope:{title:"@",tooltip:"=?"},transclude:!0,bindToController:!0,templateUrl:"my-card/my-card.html",controller:"MyCardCtrl",controllerAs:"MyCardCtrl"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t,a,n,r,s,i,o,l,c){"ngInject";function u(){return t.includes("hydratorplusplus.**")?"hydrator":t.includes("tracker.**")||t.is("tracker-enable")?"tracker":"cdap"}function p(){a.getList(!0).then(function(e){d.namespaces=e})}var d=this;d.getHydratorUrl=l,d.getTrackerUrl=c,d.$cookies=o,d.$cookies.put("DEFAULT_UI","OLD",{path:"/"}),d.showSidebar=!1,d.toggleSidebar=function(){d.showSidebar=!d.showSidebar},d.securityEnabled=i.securityEnabled,d.environment=i.isEnterprise?"Distributed":"Standalone",e.$on("$stateChangeSuccess",function(e,t){d.highlightTab=t.data&&t.data.highlightTab,d.activeProduct=u(),d.showSidebar=!1}),d.namespaces=[],n.on("namespace.update",p),d.currentUser=s.isAuthenticated(),e.$on(r.loginSuccess,function(){d.currentUser=s.isAuthenticated(),p()}),e.$on(r.logoutSuccess,function(){d.currentUser=s.isAuthenticated(),d.namespaces=[]}),d.logout=s.logout.bind(s),d.changeNamespace=function(e){t.params.namespace!==e.name&&(o.put("CDAP_Namespace",e.name),t.includes("hydratorplusplus.**")?t.go("hydratorplusplus.list",{namespace:e.name}):t.includes("tracker.**")||t.is("tracker-enable")?t.go("tracker.home",{namespace:e.name}):t.includes("dashboard.**")?t.go("dashboard.standard.cdap",{namespace:e.name}):t.go("overview",{namespace:e.name}))},e.$on("$destroy",function(){o.remove("CDAP_Namespace")})}t.$inject=["$scope","$state","myNamespace","EventPipe","MYAUTH_EVENT","myAuth","MY_CONFIG","$cookies","getHydratorUrl","getTrackerUrl"],angular.module(e.name+".commons").directive("myGlobalNavbar",function(){return{restrict:"E",templateUrl:"my-global-navbar/my-global-navbar.html",controller:t,controllerAs:"Navbar"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myLinkButton",function(){return{restrict:"E",scope:{entities:"="},bindToController:!0,controller:function(){},controllerAs:"MyLinkButtonCtrl",templateUrl:"my-link-button/my-link-button.html"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t){"ngInject";e.virtualCores=e.store.getDriverVirtualCores(),e.memoryMB=e.store.getDriverMemoryMB(),e.cores=Array.apply(null,{length:20}).map(function(e,t){return t+1}),e.isDisabled="true"===e.isDisabled?!0:!1,e.numberConfig={"widget-attributes":{min:0,"default":t.resources.memoryMB,showErrorMessage:!1,convertToInteger:!0}},e.isDisabled||(e.$watch("memoryMB",function(){e.actionCreator.setDriverMemoryMB(e.memoryMB)}),e.onVirtualCoresChange=function(){e.actionCreator.setDriverVirtualCores(e.virtualCores)})}t.$inject=["$scope","HYDRATOR_DEFAULT_VALUES"],angular.module(e.name+".commons").controller("MyPipelineDriverResourceCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t){"ngInject";e.virtualCores=e.store.getVirtualCores(),e.memoryMB=e.store.getMemoryMB(),e.cores=Array.apply(null,{length:20}).map(function(e,t){return t+1}),e.isDisabled="true"===e.isDisabled?!0:!1,e.numberConfig={"widget-attributes":{min:0,"default":t.resources.memoryMB,showErrorMessage:!1,convertToInteger:!0}},e.isDisabled||(e.$watch("memoryMB",function(){e.actionCreator.setMemoryMB(e.memoryMB)}),e.onVirtualCoresChange=function(){e.actionCreator.setVirtualCores(e.virtualCores)})}t.$inject=["$scope","HYDRATOR_DEFAULT_VALUES"],angular.module(e.name+".commons").controller("MyPipelineExecutorResourceCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").factory("MyPipelineResourceFactory",function(){return{driverResource:{element:"<my-pipeline-driver-resource></my-pipeline-driver-resource>",attributes:{store:"store","action-creator":"actionCreator","data-is-disabled":"{{::isDisabled}}"}},executorResource:{element:"<my-pipeline-executor-resource></my-pipeline-executor-resource>",attributes:{store:"store","action-creator":"actionCreator","data-is-disabled":"{{::isDisabled}}"}}}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myPipelineResourceFactory",["MyPipelineResourceFactory","$compile",function(e,t){return{restrict:"A",replace:!1,scope:{store:"=",actionCreator:"=",isDisabled:"@",resourceType:"@"},link:function(a,n){var r,s,i;if(n.removeAttr("my-pipeline-resource-factory"),s=e[a.resourceType]){i=angular.element("<div></div>"),r=angular.element(s.element),angular.forEach(s.attributes,function(e,t){r.attr(t,e)}),i.append(r);var o=t(i)(a);n.append(o)}}}}]).directive("myPipelineDriverResource",function(){return{restrict:"E",scope:{actionCreator:"=",store:"=",isDisabled:"@"},templateUrl:"my-pipeline-resource/my-pipeline-resource.html",controller:"MyPipelineDriverResourceCtrl"}}).directive("myPipelineExecutorResource",function(){return{restrict:"E",scope:{actionCreator:"=",store:"=",isDisabled:"@"},templateUrl:"my-pipeline-resource/my-pipeline-resource.html",controller:"MyPipelineExecutorResourceCtrl"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").factory("MyPipelineSettingsFactory",function(){var e={element:"<my-batch-pipeline-settings></my-batch-pipeline-settings>",attributes:{store:"store","action-creator":"actionCreator","data-is-disabled":"{{::isDisabled}}"}};return{"cdap-etl-batch":e,"cdap-data-pipeline":e,"cdap-data-streams":{element:"<my-datastreams-pipeline-settings></my-datastreams-pipeline-settings>",attributes:{store:"store","action-creator":"actionCreator","data-is-disabled":"{{::isDisabled}}"}},"cdap-etl-realtime":{element:"<my-realtime-pipeline-settings></my-realtime-pipeline-settings>",attributes:{store:"store","action-creator":"actionCreator","data-is-disabled":"{{::isDisabled}}"}}}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myPipelineSettings",["MyPipelineSettingsFactory","$compile",function(e,t){return{restrict:"A",scope:{store:"=",actionCreator:"=",isDisabled:"@",templateType:"@"},replace:!1,link:function(a,n){var r,s;if(n.removeAttr("my-pipeline-settings"),s=e[a.templateType]){r=angular.element(s.element),angular.forEach(s.attributes,function(e,t){r.attr(t,e)});var i=t(r)(a);n.append(i)}}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r){var s=this;_classCallCheck(this,e),this.runs=[],this.programId="",this.programType="",this.appId="",this.moment=a,this.setState();var i,o;this.store.registerOnChangeListener(this.setState.bind(this)),-1!==r.etlBatchPipelines.indexOf(this.pipelineType)&&(this.actionCreator.getNextRunTime(this.store.getApi(),this.store.getParams()),this.actionCreator.getStatistics(this.store.getApi(),this.store.getParams()),i=n(function(){s.actionCreator.getNextRunTime(s.store.getApi(),s.store.getParams())},1e4),o=n(function(){s.actionCreator.getStatistics(s.store.getApi(),s.store.getParams())},1e4)),t.$on("$destroy",function(){i&&n.cancel(i),o&&n.cancel(o)})}return e.$inject=["$scope","moment","$interval","GLOBALS"],_createClass(e,[{key:"setState",value:function(){this.totalRunsCount=this.store.getRunsCount(),this.runs=this.store.getRuns();var e=this.store.getParams();this.programType=e.programType.toUpperCase(),this.programId=e.programName,this.appId=e.app;var t=this.store.getNextRunTime();t&&t.length?this.nextRunTime=t[0].time?t[0].time:null:this.nextRunTime="N/A";var a=this.store.getStatistics().avgRunTime;a?this.avgRunTime=this.moment.utc(1e3*a).format("HH:mm:ss"):this.avgRunTime="N/A"}}]),e}();t.$inject=["$scope","moment","$interval","GLOBALS"],angular.module(e.name+".commons").controller("MyPipelineSummaryCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myPipelineSummary",function(){return{restrict:"A",scope:{store:"=",actionCreator:"=",pipelineType:"@"},replace:!1,templateUrl:"my-pipeline-summary/my-pipeline-summary.html",controller:"MyPipelineSummaryCtrl",controllerAs:"MyPipelineSummaryCtrl",bindToController:!0}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myPopover",["$compile","$popover","$timeout",function(e,t,a){return{restrict:"A",scope:{template:"=",contentData:"=",title:"@",placement:"@",popoverContext:"=",customClass:"@"},link:function(e,n){function r(){d&&a.cancel(d),m&&a.cancel(m)}function s(e){return r(),d=a(u,e)}function i(e){return r(),m=a(function(){f&&(f.hide(),o())},e)}function o(){f&&(f.destroy(),f=null)}function l(){return!e.template||e.template&&!e.template.length?void 0:(f=t(h,{title:e.title,contentTemplate:e.template,show:!1,placement:e.placement||"right",trigger:"manual",container:"body",customClass:"my-cdap-popover "+e.customClass}),e.contentData&&(f.$scope.contentData=e.contentData),e.popoverContext&&(f.$scope.popoverContext=e.popoverContext),f.$scope.delayClose=i,s(200),f.$promise)}function c(){h.on("mouseenter",function(){f?s(200):l()}).on("mouseleave",i.bind(null,200)).on("click",i.bind(null))}function u(){r(),f.show(),p=f.$element,p.on("mouseenter",r),p.on("mouseleave",i.bind(null,200))}e.isOpen=!1;var p,d,m,f,h=angular.element(n);h.removeAttr("my-popover"),h.removeAttr("data-template"),h.removeAttr("data-placement"),h.removeAttr("data-title"),c(),e.$on("$destroy",function(){o(),r()})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("MyPostRunActionWizardCtrl",["$scope","uuid","myAlertOnValium",function(e,t,a){"ngInject";var n=this;n.action=n.action||{},n.action&&Object.keys(n.action).length>1?n.selectedAction=Object.assign({},angular.copy(n.action.plugin),{defaultArtifact:n.action.plugin.artifact}):n.selectedAction={},"edit"===n.mode?n.currentStage=2:"view"===n.mode?(n.currentStage=3,n.configuredAction=n.selectedAction):"create"===n.mode&&(n.currentStage=1),n.goToPreviousStep=function(){n.currentStage-=1,1===n.currentStage&&(n.selectedAction={},e.$parent.action=n.selectedAction)},n.onActionSelect=function(t){n.selectedAction=t,e.$parent.action=n.selectedAction,n.currentStage=2},n.onActionConfigure=function(t){n.configuredAction=t,e.$parent.action=n.configuredAction,n.currentStage+=1},n.onActionConfirm=function(r){if(!r)return void e.$parent.$close();n.confirmedAction={name:n.action.name||r.name+t.v4(),plugin:{name:r.name,type:r.type,artifact:r.defaultArtifact,properties:r.properties},description:n.action.description};try{"edit"===n.mode?n.actionCreator.editPostAction(n.confirmedAction):n.actionCreator.addPostAction(n.confirmedAction),a.show({type:"success",content:n.confirmedAction.plugin.name+" post action saved."})}catch(s){console.log("ERROR",s)}e.$parent.$close()}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myPostRunActionWizard",function(){return{scope:{mode:"@",actionCreator:"=?",store:"=",action:"=?"},templateUrl:"my-post-run-action-wizard/my-post-run-action-wizard.html",bindToController:!0,controller:"MyPostRunActionWizardCtrl",controllerAs:"MyPostRunActionWizardCtrl"}}).service("myPostRunActionWizardService",["$uibModal",function(e){this.show=function(t,a,n,r){e.open({templateUrl:"my-post-run-action-wizard/my-post-run-action-wizard-modal.html",backdrop:!0,resolve:{rActionCreator:function(){return t||{}},rStore:function(){return a},rAction:function(){return r||null},rMode:function(){return n}},size:"lg",windowClass:"post-run-actions-modal hydrator-modal",controller:["$scope","rActionCreator","rStore","rMode","rAction",function(e,t,a,n,r){e.actionCreator=t,e.store=a,e.mode=n,e.action=r}]})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myPostRunActions",function(){return{restrict:"E",scope:{actionCreator:"=",store:"=",isDisabled:"@"},templateUrl:"my-post-run-actions/my-post-run-actions.html",bindToController:!0,controller:["$scope","myPostRunActionWizardService","myAlertOnValium",function(e,t,a){var n=this;this._isDisabled="true"===this.isDisabled,e.myPostRunActionWizardService=t;var r=this.store.registerOnChangeListener(function(){n.actions=n.store.getPostActions()});this.actions=this.store.getPostActions(),this.deletePostRunAction=function(e){this.actionCreator.deletePostAction(e),a.show({type:"success",content:e.plugin.name+" post action deleted."})},e.$on("$destroy",function(){r()})}],controllerAs:"MyPostRunActionsCtrl"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myOldLogViewer",["$filter","$timeout","$state","$location",function(e,t,a,n){var r=e("caskCapitalizeFilter"),s=e("filter");return{restrict:"E",scope:{params:"="},templateUrl:"old-log-viewer/log-viewer.html",controller:["$scope","myLogsApi","MyCDAPDataSource",function(e,a,n){function i(t){var a="/namespaces/"+t.namespace+"/apps/"+t.appId+"/"+t.programType+"/"+t.programId+"/runs/"+t.runId+"/logs/prev?max=50&escape=false";h=l.poll({_cdapPath:a,interval:3e3},function(t){e.model=t,t.length>=50&&(l.stopPoll(h.__pollId__),h=null)})}function o(){f={},angular.copy(e.params,f),f.max=50,f.escape=!1,f.scope=e,e.model=[],f.runId&&(h&&(l.stopPoll(h.__pollId__),h=null),e.loadingNext=!0,a.prevLogs(f).$promise.then(function(t){e.model=t,t.length<50&&i(f),e.loadingNext=!1}))}var l=new n(e);e.model=[];var c=null;e.filters="all,info,warn,error,debug,other".split(",").map(function(e){var t;switch(e){case"all":t=function(){return!0};break;case"other":t=function(e){return!/- (INFO|WARN|ERROR|DEBUG)/.test(e.log)};break;default:t=function(t){return new RegExp("- "+e.toUpperCase()).test(t.log)}}return{key:e,label:r(e),entries:[],predicate:t}}),e.$watch("model",function(t){angular.forEach(e.filters,function(e){e.entries=s(t,e.predicate)})});var u,p,d,m,f={},h=null;o(),e.$watch("params.runId",o),e.loadNextLogs=function(){e.loadingNext||e.loadingPrev||(h&&(l.stopPoll(h.__pollId__),h=null),e.loadingNext=!0,e.model.length&&(f.fromOffset=e.model[e.model.length-1].offset),a.nextLogs(f).$promise.then(function(t){e.model=_.uniq(e.model.concat(t)),e.loadingNext=!1}))},e.loadPrevLogs=function(){e.loadingPrev||e.loadingNext||(e.loadingPrev=!0,e.model.length&&(f.fromOffset=e.model[0].offset),a.prevLogs(f).$promise.then(function(a){e.model=_.uniq(a.concat(e.model)),e.loadingPrev=!1,c=t(function(){var e=angular.element(document.querySelector("[infinite-scroll]"))[0],t=angular.element(document.getElementById(f.fromOffset))[0];e.scrollTop=t.offsetTop})}))},e.$on("$destroy",function(){u=p=d=m=null,c&&t.cancel(c)})}],link:function(e,r){var i=angular.element(r[0].querySelector(".terminal")),o="filter",l=null;e.setFilter=function(r){var c=s(e.filters,{key:r});e.activeFilter=c.length?c[0]:e.filters[0],l&&t.cancel(l),l=t(function(){if(i.prop("scrollTop",i.prop("scrollHeight")),!1===a.current.reloadOnSearch){var t={};t[o]=e.activeFilter.key,n.search(t)}})},e.setFilter(a.params[o]),e.$on("$destroy",function(){i=null,l&&t.cancel(l)})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myPageslide",["$timeout",function(e){return{restrict:"E",transclude:!1,scope:{open:"=",width:"@"},link:function(t,a){function n(e){e.style.width=t.width+"px",i.style.backgroundColor="#F6F6F6",angular.element(a[0].childNodes[1])[0].style.height=a[0].scrollHeight}function r(e){e.style.width="0px",t.open=!1}var s=null;t.width=t.width||"600";var i=a[0];i.style.position="absolute",i.style.overflowX="hidden",i.style.width="0px",i.style.right="0px",i.style.bottom="58px",i.style.backgroundColor="#F6F6F6",i.style.padding="0",i.style.zIndex=1e3,i.style.transitionDuration="0.5s",i.style.webkitTransitionDuration="0.5s",i.style.transitionProperty="width, height",i.style.boxShadow="-3px 0px 5px 0px rgba(0,0,0,0.25)",s=e(function(){var e=angular.element(document.getElementById("sidepanel-anchor")),t=e[0].offsetTop+2;i.style.top=t+"px"}),t.$watch("open",function(e){e?n(i):r(i)}),t.$on("$destroy",function(){r(i),e.cancel(s)}),t.$on("$locationChangeStart",function(){r(i)}),t.$on("$stateChangeStart",function(){r(i)})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").service("PluginsFunctionsFactory",function(){this.registry={getSchema:{element:"<get-schema></get-schema>",attributes:{node:"node","fn-config":"fnConfig","class":"pull-right"}},outputSchema:{element:"<output-schema></output-schema>",attributes:{node:"node","fn-config":"fnConfig","class":"pull-right"}}}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("pluginFunctions",["$compile","$window","PluginsFunctionsFactory",function(e,t,a){return{restrict:"E",scope:{fnConfig:"=",node:"=",isDisabled:"="},replace:!1,link:function(t,n){if(t.fnConfig){var r=a.registry[t.fnConfig.widget],s=angular.element(r.element);angular.forEach(r.attributes,function(e,t){s.attr(t,e)}),n.append(s),e(n)(t)}}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("PluginTemplatesCtrl",["PluginTemplatesDirStore","PluginTemplatesDirActions","$scope","myPipelineApi","HydratorPlusPlusPluginConfigFactory","myHelpers","mySettings","$stateParams","$state","GLOBALS","$rootScope",function(e,t,a,n,r,s,i,o,l,c,u){function p(){if(m.pluginName){m.configFetched=!1;var e=n.fetchPluginProperties,t={namespace:o.namespace,pipelineType:m.templateType,extensionType:m.pluginType,pluginName:m.pluginName,version:u.cdapVersion};e(t).$promise.then(function(e){m.pluginVersions=e,m.isEdit&&(m.plugin=e.filter(function(e){return angular.equals(e.artifact,m.pluginConfig.artifact)})[0],m.onPluginVersionSelect())})}}var d,m=this;m.prefill={},m.GLOBALS=c,m.pluginList=[],m.isEdit="edit"===a.mode?!0:!1,m.isDisabled=!1,m.configFetched=!1,m.noConfig=!1,m.pipelineTypeOptions=[m.GLOBALS.etlBatch,m.GLOBALS.etlRealtime];var f=[c.pluginTypes[m.GLOBALS.etlBatch].source,c.pluginTypes[m.GLOBALS.etlBatch].sink,c.pluginTypes[m.GLOBALS.etlBatch].transform],h=[c.pluginTypes[m.GLOBALS.etlRealtime].source,c.pluginTypes[m.GLOBALS.etlRealtime].sink,c.pluginTypes[m.GLOBALS.etlRealtime].transform];m.pluginDescription="";var g;m.onPipelineTypeChange=function(){m.submitted=!1,m.pluginList=[],m.pluginVersions=[],m.pluginType=null,m.pluginTypeOptions=m.templateType===m.GLOBALS.etlBatch?f:h},m.getPluginsList=function(t){m.submitted=!1,m.pluginName=e.getPluginName(),m.pluginVersions=[],g=null,m.pluginConfig=null,m.configFetched=!1;var a,r={pipelineType:m.templateType,namespace:o.namespace,version:u.cdapVersion,extensionType:t};a=n.fetchPlugins(r).$promise,a.then(function(e){m.pluginList=_.uniq(e.map(function(e){return e.name}))})},m.onPluginSelect=function(){m.submitted=!1,p()},m.onPluginVersionSelect=function(){if(m.submitted=!1,m.plugin){m.pluginConfig?m.pluginConfig._backendProperties=m.plugin.properties:m.pluginConfig={_backendProperties:m.plugin.properties,properties:{},lock:{}};var e={name:m.plugin.artifact.name,version:m.plugin.artifact.version,scope:m.plugin.artifact.scope,key:"widgets."+m.plugin.name+"-"+m.plugin.type};r.fetchWidgetJson(e.name,e.version,e.scope,e.key).then(function(e){m.configFetched=!0,m.noConfig=!1,m.groupsConfig=r.generateNodeConfig(m.pluginConfig._backendProperties,e),m.pluginDescription=m.plugin.description||"",angular.forEach(m.groupsConfig.groups,function(e){angular.forEach(e.fields,function(e){e.defaultValue&&(m.pluginConfig.properties[e.name]=m.pluginConfig.properties[e.name]||e.defaultValue)})});var t=m.groupsConfig.outputSchema;if(t.implicitSchema){var a=Object.keys(t.implicitSchema),n=[];angular.forEach(a,function(e){n.push({name:e,type:t.implicitSchema[e]})}),m.pluginConfig.outputSchema=JSON.stringify({fields:n})}},function(){m.noConfig=!0,m.configFetched=!0})}},e.registerOnChangeListener(function(){var t=e.getMode(),a=e.getIsCloseCommand(),n=e.getIsSaveSuccessfull();if(!a&&!n)if("edit"===t)m.templateType=e.getTemplateType(),m.pluginType=e.getPluginType(),m.templateName=e.getTemplateName(),m.pluginName=e.getPluginName(),m.prefill={templateType:!0,pluginType:!0,pluginName:!0},m.isEdit=!0,i.get("pluginTemplates").then(function(e){var t=e[o.namespace][m.templateType][m.pluginType][m.templateName];m.pluginConfig={artifact:t.artifact,pluginTemplate:t.pluginTemplate,properties:t.properties,outputSchema:t.outputSchema,lock:t.lock},d=t.pluginTemplate,m.pluginDescription=t.description,p()});else{m.pluginName=e.getPluginName(),m.prefill.pluginName=!0;var r=e.getTemplateType(),s=e.getPluginType();r&&r.length&&!m.templateType&&(m.templateType=r,m.prefill.templateType=!0,m.onPipelineTypeChange()),s&&s.length&&!m.pluginType&&(m.pluginType=s,m.prefill.pluginType=!0,m.getPluginsList(s)),m.onPluginSelect()}}),m.cancel=function(){t.templateClose(!0)},m.save=function(e){if(e){var a=m.pluginList.map(function(e){return e.name});if(-1!==a.indexOf(m.pluginConfig.pluginTemplate))return void(m.pluginTemplateNameError=c.en.admin.pluginSameNameError);m.loading=!0;var n=s.objectQuery(m.groupsConfig,"outputSchema","outputSchemaProperty","0");n&&m.pluginConfig._backendProperties&&m.pluginConfig._backendProperties[n]&&(m.pluginConfig.properties[n]=m.pluginConfig.outputSchema);var r={artifact:m.plugin.artifact,pluginTemplate:m.pluginConfig.pluginTemplate,description:m.pluginDescription,properties:m.pluginConfig.properties,pluginType:m.pluginType,templateType:m.templateType,pluginName:m.pluginName,outputSchema:m.pluginConfig.outputSchema,lock:m.pluginConfig.lock,nodeClass:"plugin-templates"},l=o.namespace;i.get("pluginTemplates").then(function(e){angular.isObject(e)||(e={});var a=s.objectQuery(e,l,r.templateType,r.pluginType,r.pluginTemplate);if(a&&!m.isEdit)return m.pluginTemplateNameError=c.en.admin.templateNameExistsError,void(m.loading=!1);if(m.isEdit&&d!==m.pluginConfig.pluginTemplate){if(a)return m.pluginTemplateNameError=c.en.admin.templateNameExistsError,void(m.loading=!1);delete e[l][r.templateType][r.pluginType][d]}var n=[l,r.templateType,r.pluginType,r.pluginTemplate];s.objectSetter(e,n,r),i.set("pluginTemplates",e).then(function(){m.loading=!1,t.templateSavedSuccesfully()})})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("pluginTemplates",function(){return{restrict:"EA",scope:{},templateUrl:"plugin-templates/plugin-templates.html",controller:"PluginTemplatesCtrl",controllerAs:"PluginTemplatesCtrl"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myProgramHistory",function(){return{restrict:"EA",scope:{model:"=runs",type:"@",appId:"=",programId:"="},templateUrl:"program-history/program-history.html",controller:["$scope","$state",function(e,t){e.appId=e.appId||t.params.appId,e.programId=e.programId||t.params.programId,e.currentPage=1,e.$watchCollection("model",function(t){angular.isArray(t)&&(e.runs=t.map(function(e){return angular.extend({duration:e.end?e.end-e.start:0},e)}))})}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myProgramLink",function(){return{restrict:"E",scope:{type:"=",app:"=",program:"=",namespace:"=",bold:"="},templateUrl:"program-link/program-link.html"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("ProgramPreferencesController",["$scope","$state","myPreferenceApi",function(e,t,a){function n(){var n={namespace:t.params.namespace,appId:t.params.appId,scope:e,resolved:!0};a.getAppPreference(n).$promise.then(function(t){e.systemPreferences=r(t)})}function r(e){var t,a=[];try{t=JSON.parse(angular.toJson(e))}catch(n){return console.log("ERROR: ",n),a}return angular.forEach(t,function(e,t){a.push({key:t,value:e})}),a}e.heading=t.params.programId+" Preferences",e.preferences=[];var s={namespace:t.params.namespace,appId:t.params.appId,programType:e.type,programId:t.params.programId,scope:e};e.loadProperties=function(){n(),a.getProgramPreference(s).$promise.then(function(t){e.preferences=r(t)})},e.loadProperties(),e.addPreference=function(){e.preferences.push({key:"",value:""})},e.removePreference=function(t){e.preferences.splice(e.preferences.indexOf(t),1)},e.save=function(){var t={};angular.forEach(e.preferences,function(e){e.key&&(t[e.key]=e.value)}),a.setProgramPreference(s,t,function(){e.loadProperties(),e.$close(t)})},e.enter=function(t,a){a&&13===t.keyCode&&e.addPreference()}}]).directive("myProgramPreferences",function(){return{restrict:"E",controller:"ProgramPreferencesController",templateUrl:"program-preferences/program-preferences.html"}}).service("myProgramPreferencesService",["$uibModal","$rootScope",function(e,t){var a;this.show=function(n){var r=t.$new();return r.type=n,a=e.open({template:"<my-program-preferences></my-program-preferences>",size:"lg",scope:r})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myProgramStatus",function(){
return{restrict:"E",scope:{type:"@",runid:"=",pollInterval:"@",runs:"="},templateUrl:"program-status/program-status.html",controller:["$scope","MyCDAPDataSource","$state",function(e,t,a){if(0!==e.runs.length){var n,r,s=new t(e),i="",o=function(t){n!==t&&(n=t,r&&r.__pollId__&&s.stopPoll(r.__pollId__),i="/apps/"+a.params.appId+"/"+e.type+"/"+a.params.programId+"/runs/"+e.runid,r=s.poll({_cdapNsPath:i,interval:e.pollInterval||1e4},function(t){var a=t.start;e.start=new Date(1e3*a),e.status=t.status,e.duration=t.end?t.end-a:0,-1!==["COMPLETED","KILLED","STOPPED","FAILED"].indexOf(e.status)&&s.stopPoll(r.__pollId__)}))};o(),e.$watch("runid",o)}}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myRuntimeArgs",function(){return{restrict:"E",controller:"RuntimeArgumentsController",templateUrl:"runtime-args/runtime-args.html"}}).service("myRuntimeService",["$uibModal","$rootScope",function(e,t){var a;this.show=function(n){var r=t.$new();return r.preferences=[],angular.forEach(n,function(e,t){r.preferences.push({key:t,value:e})}),a=e.open({template:"<my-runtime-args></my-runtime-args>",size:"lg",scope:r})}}]).controller("RuntimeArgumentsController",["$scope",function(e){e.preferences=e.preferences||[],e.addPreference=function(){e.preferences.push({key:"",value:""})},e.removePreference=function(t){e.preferences.splice(e.preferences.indexOf(t),1)},e.save=function(){var t={};angular.forEach(e.preferences,function(e){e.key&&(t[e.key]=e.value)}),e.$close(t)}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("mySchedulesView",function(){return{restrict:"EA",scope:{schedules:"=",isSchedulesDisabled:"@",onScheduleAction:"&",scheduleContext:"=",error:"="},templateUrl:"schedules-view/schedules-view.html",controller:["$scope",function(e){e.disableSchedule="true"===e.isSchedulesDisabled,e.takeScheduleAction=function(t,a){var n=e.onScheduleAction();"undefined"!=typeof n&&n.call(e.scheduleContext,t,a)}}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("MySearchCtrl",["$stateParams","myTagsApi","$scope","$document","caskFocusManager",function(e,t,a,n,r){function s(e){switch(e.type){case"stream":return{name:e.id.streamName,stateParams:{namespaceId:e.id.namespace.id,streamId:e.id.streamName},stateLink:"streams.detail.overview.status(result.stateParams)",type:"Stream",icon:"icon-streams"};case"datasetinstance":return{name:e.id.instanceId,stateParams:{namespaceId:e.id.namespace.id,datasetId:e.id.instanceId},stateLink:"datasets.detail.overview.status(result.stateParams)",type:"Dataset",icon:"icon-datasets"};case"application":return{name:e.id.applicationId,stateParams:{namespaceId:e.id.namespace.id,appId:e.id.applicationId},stateLink:"apps.detail.overview.programs(result.stateParams)",type:"App",icon:"icon-app"};case"program":return{name:e.id.id,stateParams:{namespaceId:e.id.application.namespace.id,appId:e.id.application.applicationId,programId:e.id.id},stateLink:i(e.id.type),programType:e.id.type,type:e.id.type,icon:"flow"===e.id.type.toLowerCase()?"icon-tigon":"icon-"+e.id.type.toLowerCase()};default:return}}function i(e){switch(e){case"Flow":return"flows.detail(result.stateParams)";case"Mapreduce":return"mapreduce.detail(result.stateParams)";case"Service":return"services.detail(result.stateParams)";case"Spark":return"spark.detail(result.stateParams)";case"Worker":return"worker.detail(result.stateParams)";case"Workflow":return"workflows.detail(result.stateParams)"}}var o=this;o.showSearchBox=!1,o.searchTerm="",o.searchResults=[],o.searchEntered=!1,o.loading=!1,o.showSearch=function(){o.showSearchBox=!0,r.focus("globalSearch")},o.onBlur=function(){o.showSearchBox=!1,o.searchEntered=!1,o.loading=!1,o.searchTerm="",o.searchResults=[]},o.search=function(a){if(a.stopPropagation(),27===a.keyCode&&o.onBlur(),o.searchTerm.length&&13===a.keyCode){o.searchEntered=!0,o.loading=!0;var n={namespaceId:e.namespace||e.nsadmin,query:o.searchTerm,numCursors:10};t.searchTags(n).$promise.then(function(e){o.loading=!1;var t=e.results.slice(0,20),a=[];angular.forEach(t,function(e){var t=s(e.entityId);t&&a.push(t)}),o.searchResults=a})}},a.$on("$stateChangeSuccess",o.onBlur),n.bind("keypress",function(e){63===e.keyCode&&o.showSearch()})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("mySearch",function(){return{controller:"MySearchCtrl",controllerAs:"SearchCtrl",templateUrl:"search/search.html",replace:!0}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myStartStopButton",function(){return{restrict:"E",scope:{type:"@",isStoppable:"@",isRestartable:"@",preferencesHandler:"&",runtimeHandler:"&"},templateUrl:"start-stop-button/start-stop-button.html",controller:["$scope","$state","MyCDAPDataSource","myRuntimeService","myProgramPreferencesService","myAlertOnValium",function(e,t,a,n,r,s){e.isStoppable="true"===e.isStoppable,e.isRestartable="true"===e.isRestartable,e.runtimeArgs=[];var i="/apps/"+t.params.appId+"/"+e.type+"/"+t.params.programId,o=new a(e);o.poll({_cdapNsPath:i+"/status"},function(t){e.status=t.status}),e["do"]=function(a){var n={};n={_cdapNsPath:i+"/"+a,method:"POST"},"start"===a?(e.status="STARTING",Object.keys(e.runtimeArgs).length>0&&(n.body=e.runtimeArgs)):e.status="STOPPING",o.request(n).then(function(){t.includes("**.run")?t.go("^",t.params,{reload:!0}):t.go(t.current,t.params,{reload:!0})},function(e){s.show({type:"danger",title:"Error",content:angular.isObject(e)?e.data:e})})},e.openRuntime=function(){var t=e.runtimeHandler();"undefined"!=typeof t?t():n.show(e.runtimeArgs).result.then(function(t){e.runtimeArgs=t})},e.openPreferences=function(){var t=e.preferencesHandler();"undefined"!=typeof t?t():r.show(e.type)}}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t,a,n,r,s,i,o,l,c){var u=this,p=new s(e);this.pinScrollPosition=0,e.moment=o;var d=void 0;e.pinScrollingPosition=0,this.updateStartTimeInStore=function(e){t.dispatch({type:a.START_TIME,payload:{startTime:e}})},e.$on(c.event.resize,function(){l(e.initialize)}),this.updateTotalLogsInStore=function(e){t.dispatch({type:a.TOTAL_LOGS,payload:{totalLogs:e}})},this.updateScrollPositionInStore=function(e){t.dispatch({type:a.SCROLL_POSITION,payload:{scrollPosition:e}})},this.updateTotalErrorsInStore=function(e){t.dispatch({type:a.TOTAL_ERRORS,payload:{totalErrors:e}})},this.updateTotalWarningsInStore=function(e){t.dispatch({type:a.TOTAL_WARNINGS,payload:{totalWarnings:e}})};var m=null,f=i.getSingularName(this.programType),h={metric:{context:"namespace."+this.namespaceId+".app."+this.appId+"."+f+"."+this.programId+".run."+this.runId,names:["system.app.log.error","system.app.log.warn","system.app.log.info","system.app.log.debug"],startTime:"",endTime:"",resolution:"1m"}};this.setDefaultTimeWindow=function(){h.metric.startTime="",h.metric.endTime="",u.updateStartTimeInStore(h.metric.startTime)};var g=function(){m=p.poll({_cdapPath:"/metrics/query",method:"POST",body:r.constructQuery("qid",r.contextToTags(h.metric.context),h.metric)},function(a){e.metadata=a,e.sliderBarPositionRefresh=t.getState().startTime,e.initialize(),("KILLED"===a.status||"COMPLETED"===a.status||"FAILED"===a.status||"STOPPED"===a.status)&&(p.stopPoll(m.__pollId__),m=null)},function(t){e.initialize(),console.log("ERROR: ",t)})};return t.subscribe(function(){d!==t.getState().fullScreen&&(d=t.getState().fullScreen,l(e.initialize)),"undefined"!=typeof e.updateSliderHandle&&(e.updateSliderHandle(t.getState().startTime),u.pinScrollPosition=t.getState().scrollPosition,"undefined"!=typeof e.updatePin&&(e.pinScrollingPosition=u.pinScrollPosition,e.updatePin()),e.searchResultTimes!==t.getState().searchResults&&(e.searchResultTimes=t.getState().searchResults,e.renderSearchCircles(e.searchResultTimes)))}),d=t.getState().fullScreen,this.namespaceId&&this.appId&&this.programType&&this.programId&&this.runId?void n.getLogsMetadata({namespace:this.namespaceId,appId:this.appId,programType:this.programType,programId:this.programId,runId:this.runId}).$promise.then(function(t){e.metadata=t,t.start===t.end&&t.end++,h.metric.startTime=t.start,h.metric.endTime=t.end,e.renderSearchCircles([]),g()},function(e){u.setDefaultTimeWindow(),console.log("ERROR: ",e)}):void this.setDefaultTimeWindow()}t.$inject=["$scope","LogViewerStore","LOGVIEWERSTORE_ACTIONS","myLogsApi","MyMetricsQueryHelper","MyCDAPDataSource","ProgramsHelpers","moment","$timeout","caskWindowManager"],angular.module(e.name+".commons").controller("TimelineController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t){function a(){O.append("g").attr("class","xaxis-bottom").attr("transform","translate("+y+", "+(i-20)+")").call(I),C=d3.svg.brush().x(A).on("brush",function(){if(d3.event.sourceEvent){var e=d3.mouse(this)[0];n(e)}}).on("brushend",function(){if(d3.event.sourceEvent){var t=d3.mouse(this)[0];0>t&&(t=0),t>c&&(t=c),t=A(1e3*Math.floor(A.invert(t)/1e3)),n(t),e.Timeline.updateScrollPositionInStore(Math.floor(A.invert(t))),e.Timeline.updateStartTimeInStore(Math.floor(A.invert(t)))}}),N=O.append("g").attr("class","slider leftSlider").call(d3.svg.axis().scale(A).tickSize(0).tickFormat("")).select(".domain").attr("class","fill-bar"),w=O.append("g").attr("class","slider").attr("transform","translate(0,10)").call(C),S&&(S=!1,e.sliderBarPositionRefresh=A.invert(0),e.Timeline.updateStartTimeInStore(A.invert(0)));var t=A(e.sliderBarPositionRefresh);(0>t||t>c)&&(t=0),N.attr("d","M0,0V0H"+t+"V0"),P=w.append("svg:image").attr("width",y).attr("height",52).attr("xlink:href","/old_assets/img/sliderHandle.svg").attr("x",t-1).attr("y",-10),b=d3.svg.brush().x(A),$=d3.select(".top-bar").append("svg").attr("width",s).attr("height",20),$.append("g").attr("class","xaxis-top").call(d3.svg.axis().scale(A).orient("bottom")).select(".domain").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}),k=$.append("g").attr("class","slider").attr("width",s).call(b),k.select(".background").attr("height",15);var a=A(e.pinScrollingPosition);T=k.append("svg:image").attr("width",40).attr("height",60).attr("xlink:href","/old_assets/img/scrollPin.svg").attr("x",a-h).attr("y",0).on("mouseover",function(){_=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);var t=A(e.pinScrollingPosition)+250>c?250:0;_.transition().duration(200).style("opacity",.9).attr("class","timeline-tooltip");var a=e.pinScrollingPosition;a instanceof Date||(a=new Date(a)),_.html(a).style("left",d3.event.pageX-t+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(){d3.selectAll(".timeline-tooltip").remove()}),D=w.append("line").attr("x1",a+h-6).attr("x2",a+h-6).attr("y1",-10).attr("y2",40).attr("stroke-width",1).attr("stroke","grey")}function n(e){"undefined"!=typeof P&&(0>e&&(e=0),e>c&&(e=c),"undefined"!=typeof T&&T.attr("x")<e&&R(e),P.attr("x",e),N.attr("d","M0,0V0H"+e+"V0"))}var r=this,s=void 0,i=void 0,o=void 0,l=void 0,c=void 0,u=void 0,p=void 0,d=void 0,m=void 0,f=void 0,h=void 0,g=void 0,y=void 0,v=void 0,S=!0,P=void 0,T=void 0,C=void 0,b=void 0,A=void 0,E=void 0,w=void 0,k=void 0,O=void 0,$=void 0,I=void 0,N=void 0,D=void 0,_=void 0;e.initialize=function(){O&&(d3.selectAll(".timeline-container svg > *:not(.search-circle)").remove(),O.remove()),$&&$.remove(),s=t.parent()[0].offsetWidth,i=50,o=15,l=15,c=s-l+8,y=8,c=s-12,u=c,h=13,p=0,d={},E=e.metadata,v=0,e.plot()},e.plot=function(){if("undefined"!=typeof E.qid){m=1e3*E.qid.startTime,f=1e3*E.qid.endTime,O=d3.select(".timeline-log-chart").append("svg").attr("width",s).attr("height",i),A=d3.time.scale().range([0,c]),A.domain([m,f]);var e=d3.time.format.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%H:%M",function(e){return e.getMinutes()}],["%H:%M",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!==e.getDate()}],["%b %d",function(e){return 1!==e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",function(){return!0}]]);g=d3.select("body").append("div").attr("class","circle-tooltip").style("opacity",0),I=d3.svg.axis().scale(A).orient("bottom").innerTickSize(-40).outerTickSize(0).tickPadding(7).ticks(8).tickFormat(e),L(),M(),a()}},e.updateSliderHandle=function(e){"undefined"!=typeof A&&n(A(e))},e.updatePin=function(){var t=A(e.pinScrollingPosition);"undefined"!=typeof T&&(0===v&&(t=0),T.attr("x",t-h+1),D.attr("x1",t+8).attr("x2",t+8))};var R=function(e){"undefined"!=typeof T&&(T.attr("x",e-h+1),D.attr("x1",e+8).attr("x2",e+8))};e.renderSearchCircles=function(e){d3.selectAll(".search-circle").remove(),angular.forEach(e,function(e){O.append("circle").attr("cx",A(e)+y).attr("cy",35).attr("r",2).attr("class","search-circle")})},e.updateSlider=n;var L=function(){var t=0,a=0;if(E.qid.series.length>0)for(var n=0;n<E.qid.series.length;n++)for(var r=0;r<E.qid.series[n].data.length;r++){var s=E.qid.series[n].data[r],i=s.value;v+=i,"system.app.log.error"===E.qid.series[n].metricName?t+=i:"system.app.log.warn"===E.qid.series[n].metricName&&(a+=i)}e.Timeline.updateTotalLogsInStore(v),e.Timeline.updateTotalErrorsInStore(t),e.Timeline.updateTotalWarningsInStore(a)},M=function(){d3.selectAll(".circle-tooltip").remove(),g=d3.select("body").append("div").attr("class","circle-tooltip").style("opacity",0),d={};var t={},a={};E=e.metadata;var n=function(e,n){var r=void 0;"warn"===e?r=a:"error"===e&&(r=t);for(var s=0;s<n.length;s++){var i=n[s],o=1e3*i.time;r[o]=i.value}return r};if(E.qid.series.length>0)for(var s=0;s<E.qid.series.length;s++)switch(E.qid.series[s].metricName){case"system.app.log.error":t=n("error",E.qid.series[s].data);break;case"system.app.log.warn":a=n("warn",E.qid.series[s].data)}var i=function(t){var a=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?0:arguments[2];t=parseInt(t,10);var r=new Date(t);r=e.moment(r).format("MMMM Do YYYY, h:mm:ss a");var s=A(t)+180>c?180:0;g.transition().duration(200).style("opacity",.9),g.html(r+"<br/>Errors: "+a+"<br/>Warnings: "+n).style("left",d3.event.pageX-s+5+"px").style("top",d3.event.pageY-30+"px")},o=function(){g.transition().duration(500).style("opacity",0)},l={};Object.keys(t).forEach(function(e){l[e]={errors:t[e]}}),Object.keys(a).forEach(function(e){l[e]=l[e]||{},l[e]=Object.assign({},l[e],{warnings:a[e]})});for(var u in l)if(l.hasOwnProperty(u)){var p=0,m=0;l[u].errors&&(p=l[u].errors),l[u].warnings&&(m=l[u].warnings);for(var f=i.bind(r,u,l[u].errors,l[u].warnings),h=4;h>=0&&(p>0||m>0);h--)p>0?(O.append("circle").attr("cx",A(u)+y).attr("cy",7*(h+1)-2).attr("r",2).attr("class","red-circle").on("mouseover",f).on("mouseout",o),p--):m>0&&(O.append("circle").attr("cx",A(u)+y).attr("cy",7*(h+1)-2).attr("r",2).attr("class","yellow-circle").on("mouseover",f).on("mouseout",o),m--)}e.renderSearchCircles(e.searchResultTimes)};e.generateEventCircles=M}angular.module(e.name+".commons").directive("myTimeline",function(){return{templateUrl:"timeline/timeline.html",scope:{timelineData:"=?",namespaceId:"@",appId:"@",programType:"@",programId:"@",runId:"@"},link:t,bindToController:!0,controller:"TimelineController",controllerAs:"Timeline"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").config(["$datepickerProvider","$timepickerProvider",function(e,t){angular.extend(e.defaults,{iconLeft:"fa fa-chevron-left",iconRight:"fa fa-chevron-right"}),angular.extend(t.defaults,{iconUp:"fa fa-chevron-up",iconDown:"fa fa-chevron-down"})}]).directive("myTimestampPicker",function(){return{restrict:"E",require:"ngModel",scope:{},templateUrl:"timestamp-picker/datetime.html",link:function(e,t,a,n){e.label=a.label||"Timestamp",n.$render=function(){e.timestamp=n.$viewValue},e.$watch("timestamp",function(e){n.$setViewValue(e)})}}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("tooltipToggle",["$timeout",function(e){return{restrict:"A",link:function(t,a,n){n.tooltipTrigger="customShow";var r=null;t.$watch(n.tooltipToggle,function(t){e.cancel(r),r=e(function(){t?a.triggerHandler("customShow"):a.triggerHandler("customHide")})}),t.$on("$destroy",function(){e.cancel(r)})}}}]).directive("tooltipEllipsis",function(){return{restrict:"A",scope:{ellipsis:"=",offsetValue:"="},link:function(e,t){function a(t){return t[0].offsetWidth>t[0].parentElement.offsetWidth-e.offsetValue}e.$watch(function(){return t[0].parentElement.offsetWidth},function(){a(t)?e.ellipsis=!0:e.ellipsis=!1})}}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("MyValidatorsCtrl",["$scope","myHydratorValidatorsApi","EventPipe","HydratorPlusPlusConfigStore","myHelpers","NonStorePipelineErrorFactory","GLOBALS","js_beautify","HydratorPlusPlusHydratorService","ValidatorFactory",function(e,t,a,n,r,s,i,o,l,c){function u(){function t(e,t){-1===i.arguments.indexOf(t)&&delete s.arguments[t]}if(0!==Object.keys(d.validationFields).length){var a="",n=[];angular.forEach(d.validationFields,function(e){n=n.concat(e)});for(var r=n.length-1;r>=0;r--){var s=n[r];if(s.fieldName&&s.validation){var i=d.functionMap[s.validation];if(!(i.arguments.length>1)||s.arguments&&Object.keys(s.arguments).length===i.arguments.length-1){s.arguments&&angular.forEach(s.arguments,t);var l=i.emessage||"";l=l.replace(/<field:1>/g,'" + input.'+s.fieldName+' + "');var c="";c="if ("+i.className+"."+i.name+"(",angular.forEach(i.arguments,function(e,t){if(0!==t&&(c+=", "),c+="<field:1>"===e?"input."+s.fieldName:s.arguments[e],e.startsWith("<field")&&"<field:1>"!==e){var a=new RegExp(e,"g");l=l.replace(a,'" + input.'+s.arguments[e]+' + "')}}),c+=r===n.length-1||n[r+1].operation?")) {\n"+a+'} else {\nisValid = false;\nerrMsg = "'+l+'";\nerrCode = '+i.ecode+";\n}\n":")) {\n} else {\n"+a+"\n}\n",a=c}}}a+="\n";var u='function isValid(input, context) {\nvar isValid = true;\nvar errMsg = "";\nvar errCode = 0;\n',p="";angular.forEach(f,function(e){p=p+"var "+e+' = context.getValidator("'+e+'");\n'});var h="var logger = context.getLogger();\n\n",g='if (!isValid) {\nvar message = "(" + errCode + ") " + errMsg;\nlogger.warn("Validation failed with error {}", message);\n}\n\n',y=u+p+h+a+g+'return {\n"isValid": isValid,\n"errorCode": errCode,\n"errorMsg": errMsg\n};\n}\n',v={validators:m,validationScript:o(y,{indent_size:2})};e.model.properties!==v&&(e.model.properties=v),e.model.validationFields!==d.validationFields&&(e.model.validationFields=d.validationFields)}}function p(){var t=n.getNodes(),a=e.model.label;a&&s.isNodeNameUnique(a,t,function(e){e?d.nodeLabelError=i.en.hydrator.studio.error[e]:d.nodeLabelError=""})}var d=this;d.validators=[],d.isRule=!0,d.validationFields=e.model.validationFields||{},d.functionMap={},d.nodeLabelError="";var m,f=[];try{e.inputSchema=JSON.parse(e.inputSchema[0].schema)}catch(h){e.inputSchema={fields:[]}}e.outputSchema=l.formatOutputSchema(e.inputSchema.fields),t.get().$promise.then(function(t){delete t.$promise,delete t.$resolved,m=Object.keys(t).join(", "),angular.forEach(t,function(e,t){f.push(e.classname),angular.forEach(e.functions,function(a){a.className=e.classname,a.validator=t,a.validationKey=a.className+"."+a.name,a.displayName=a.name+" ("+t+")",d.functionMap[a.validationKey]=a}),d.validators=d.validators.concat(e.functions)}),e.model.validationFields||(d.validationFields=c.initValidationFields(e.model.properties,d.functionMap)),e.isDisabled||e.$watch(function(){return d.validationFields},u,!0)}),d.addFieldGroup=function(e){d.validationFields[e]||(d.validationFields[e]=[])},d.removeFieldGroup=function(e){d.validationFields[e].splice(0,d.validationFields[e].length),delete d.validationFields[e]},d.addRule=function(e){d.validationFields[e].push({fieldName:e,operation:!0})},d.removeRule=function(e,t){var a=d.validationFields[e].indexOf(t);d.validationFields[e].splice(a,1)},e.$watch("model.label",p),a.on("resetValidatorValidationFields",function(t){d.validationFields=t||{},e.model.validationFields=d.validationFields})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e){"ngInject";function t(t,a){if(!t.validationScript)return{};for(var s,i=e.parse(t.validationScript),o=i.body[0].body.body,l=0;l<o.length;l++)if("IfStatement"===o[l].type){s=o[l];break}var c={};return n(c,s,a,r),c}function a(e){for(var t=0;t<e.length;t++)if("MemberExpression"===e[t].type)return e[t]}function n(e,t,i,o){var l=a(t.test.arguments),c=l.property.name,u=t.test.callee.object.name+"."+t.test.callee.property.name;e[c]||(e[c]=[]);var p={fieldName:c,operation:o,validation:u},d=i[u].arguments;d.length>1&&(p.arguments={},angular.forEach(d,function(e,a){if(!e.startsWith("<field:")){var n=t.test.arguments[a];p.arguments[e]=n.value}})),e[c].push(p),t.consequent.body.length&&"IfStatement"===t.consequent.body[0].type?n(e,t.consequent.body[0],i,r):t.alternate.body.length&&"IfStatement"===t.alternate.body[0].type&&n(e,t.alternate.body[0],i,s)}var r=!0,s=!1;return{initValidationFields:t}}t.$inject=["esprima"],angular.module(e.name+".commons").factory("ValidatorFactory",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myValidators",function(){return{restrict:"E",scope:{model:"=ngModel",errorDatasetName:"=",inputSchema:"=",isDisabled:"=",outputSchema:"="},templateUrl:"validators/validators.html",controller:"MyValidatorsCtrl",controllerAs:"ValidatorsCtrl"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("widgetContainer",["$compile","$window","WidgetFactory",function(e,t,a){return{restrict:"A",scope:{name:"=",disabled:"=",model:"=",myconfig:"=",properties:"=",widgetDisabled:"=",inputSchema:"="},replace:!1,link:function(t,n){var r,s,i;n.removeAttr("widget-container"),s=a.registry[t.myconfig.widget]||a.registry[t.myconfig["widget-type"]],s||(s=a.registry.__default__),i=angular.element("<fieldset></fieldset>"),i.attr("ng-disabled",t.widgetDisabled),r=angular.element(s.element),angular.forEach(s.attributes,function(e,t){return t.includes("data-")?void r.attr(t,"::"+e):void r.attr(t,e)}),i.append(r);var o=e(i)(t);n.append(o)}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").service("WidgetFactory",function(){this.registry={number:{element:"<my-number-widget></my-number-widget>",attributes:{"ng-model":"model","data-config":"myconfig",disabled:"disabled"}},textbox:{element:"<input/>",attributes:{"class":"form-control","ng-trim":"false","ng-model":"model",placeholder:'{{ ::myconfig["widget-attributes"].default}}'}},textarea:{element:"<textarea></textarea>",attributes:{"class":"form-control","ng-trim":"false","ng-model":"model",rows:'{{myconfig["widget-attributes"].rows}}',placeholder:'{{::myconfig["widget-attributes"].default}}'}},password:{element:"<input/>",attributes:{"class":"form-control","ng-trim":"false","ng-model":"model",type:"password"}},datetime:{element:"<my-timestamp-picker></my-timestamp-picker>",attributes:{"ng-model":"model","data-label":"Date"}},csv:{element:"<my-dsv></my-dsv>",attributes:{"ng-model":"model",delimiter:'{{::myconfig["widget-attributes"].delimiter}}',type:"csv",config:"myconfig"}},dsv:{element:"<my-dsv></my-dsv>",attributes:{"ng-model":"model",delimiter:'{{::myconfig["widget-attributes"].delimiter}}',type:"dsv",config:"myconfig"}},"ds-multiplevalues":{element:"<my-ds-multiple-values></my-ds-multiple-values>",attributes:{"ng-model":"model","data-config":"myconfig"}},"json-editor":{element:"<my-json-textbox></my-json-textbox>",attributes:{"ng-model":"model",placeholder:'myconfig.properties.default || myconfig["widget-attributes"].default'}},"javascript-editor":{element:"<div my-ace-editor></div>",attributes:{"ng-model":"model",config:"myconfig",mode:"javascript",disabled:"disabled",placeholder:'{{::myconfig["widget-attributes"].default}}'}},"python-editor":{element:"<div my-ace-editor></div>",attributes:{"ng-model":"model","data-config":"myconfig",mode:"python",disabled:"disabled",placeholder:'{{::myconfig["widget-attributes"].default}}'}},schema:{element:"<my-schema-editor></my-schema-editor>",attributes:{"ng-model":"model","data-config":"myconfig"}},keyvalue:{element:"<my-key-value></my-key-value>",attributes:{"ng-model":"model","data-config":"myconfig"}},"keyvalue-dropdown":{element:"<my-key-value></my-key-value>",attributes:{"ng-model":"model","data-config":"myconfig","is-dropdown":"true"}},"function-dropdown-with-alias":{element:"<my-function-dropdown-with-alias></my-function-dropdown-with-alias>",attributes:{"ng-model":"model","data-config":"myconfig"}},schedule:{element:"<my-schedule></my-schedule>",attributes:{"ng-model":"model","data-config":"myconfig"}},select:{element:"<select></select>",attributes:{"ng-model":"model","class":"form-control","ng-options":'item as item for item in (myconfig.properties.values || myconfig["widget-attributes"].values)',"ng-init":'model = model.length ? model : (myconfig.properties.default || myconfig["widget-attributes"].default)'}},"stream-selector":{element:"<my-dataset-selector></my-dataset-selector>",attributes:{"ng-model":"model","dataset-type":"stream"}},"dataset-selector":{element:"<my-dataset-selector></my-dataset-selector>",attributes:{"ng-model":"model","dataset-type":"dataset"}},"sql-select-fields":{element:"<my-sql-selector></my-sql-selector>",attributes:{"ng-model":"model","input-schema":"inputSchema"}},"join-types":{element:"<my-join-types></my-join-types>",attributes:{"ng-model":"model","input-schema":"inputSchema"}},"sql-conditions":{element:"<my-sql-conditions></my-sql-conditions>",attributes:{"ng-model":"model",disabled:"disabled","input-schema":"inputSchema"}}},this.registry.__default__=this.registry.textbox})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myAlertOnValium",["$alert","$window",function(e,t){function a(a){s&&s.hide(),a.duration="success"===a.type?o:!1,s=e(a),a.templateUrl&&(s.$scope.templateScope=a.templateScope),t.scrollTo(0,0)}function n(){s.hide()}function r(){return i}var s,i=!1,o=3;return{show:a,isAnAlertOpened:r,destroy:n}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myAppsApi",["myCdapUrl","$resource","myAuth","myHelpers",function(e,t,a,n){var r=e.constructUrl,s="/namespaces/:namespace/apps",i=s,o=s+"/:appId";return t(r({_cdapPath:s}),{appId:"@appId"},{"delete":n.getConfig("DELETE","REQUEST",o),list:n.getConfig("GET","REQUEST",i,!0),get:n.getConfig("GET","REQUEST",o)})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("DashboardHelper",["MyCDAPDataSource","MyChartHelpers","MyMetricsQueryHelper",function(e,t,a){function n(e){e.pollId=p.poll({_cdapPath:"/metrics/query",method:"POST",interval:e.settings.interval,body:a.constructQuery("qid",a.contextToTags(e.metric.context),e.metric)},function(t){e.formattedData=u(t,e)}).__pollId__}function r(e){p.stopPoll(e.pollId)}function s(e){angular.forEach(e.columns,function(e){n(e)})}function i(e){angular.forEach(e.columns,function(e){r(e)})}function o(e){return p.request({_cdapPath:"/metrics/query",method:"POST",body:a.constructQuery("qid",a.contextToTags(e.metric.context),e.metric)}).then(function(t){e.formattedData=u(t,e)})}function l(e){return p.poll({_cdapPath:"/metrics/query",method:"POST",body:a.constructQuery("qid",a.contextToTags(e.metric.context),e.metric)}).then(function(t){e.formattedData=u(t,e)})}function c(e){angular.forEach(e.columns,function(e){o(e)})}function u(e,a){var n=t.processData(e,"qid",a.metric.names,a.metric.resolution,a.settings.aggregate);n=t.c3ifyData(n,a.metric,a.metricAlias);var r={x:"x",columns:n.columns,keys:{x:"x"}};return r}var p=new e;return{startPolling:n,stopPolling:r,startPollDashboard:s,stopPollDashboard:i,fetchData:o,pollData:l,fetchDataDashboard:c}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myCdapUrl",["$stateParams","$log","MY_CONFIG",function(e,t,a){function n(t){var n;if(t._cdapNsPath){var r=e.namespace;if(!r)throw new Error("_cdapNsPath requires $stateParams.namespace to be defined");t._cdapPath=["/namespaces/",r,t._cdapNsPath].join(""),delete t._cdapNsPath}return(t._cdapPath||t._cdapPathV2)&&(n=[a.sslEnabled?"https://":"http://",a.cdap.routerServerUrl,":",a.sslEnabled?a.cdap.routerSSLServerPort:a.cdap.routerServerPort,t._cdapPathV2?"/v2":"/v3",t._cdapPath||t._cdapPathV2].join(""),delete t._cdapPath,delete t._cdapPathV2),n}return{constructUrl:n}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("MyCDAPDataSource",["MyDataSource","$rootScope","myCdapUrl",function(e,t,a){function n(a){return a=a||t.$new(),this instanceof n?void(this.MyDataSource=new e(a)):new n(a)}return n.prototype.poll=function(e,n,r){return t.currentUser&&t.currentUser.token&&(e.headers={Authorization:"Bearer "+t.currentUser.token}),e.url||(e.url=a.constructUrl(e)),this.MyDataSource.poll(e,n,r)},n.prototype.stopPoll=function(e){return this.MyDataSource.stopPoll(e)},n.prototype.config=function(e,t,a){return e.actionName="template-config",this.MyDataSource.config(e,t,a)},n.prototype.request=function(e,n,r){return t.currentUser&&t.currentUser.token?e.headers={Authorization:"Bearer "+t.currentUser.token}:e.headers={},e.url||(e.url=a.constructUrl(e)),this.MyDataSource.request(e,n,r)},n}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myDatasetApi",["myCdapUrl","$resource","myAuth","myHelpers",function(e,t,a,n){var r=e.constructUrl,s="/namespaces/:namespace/data/datasets",i="/namespaces/:namespace/data/datasets/:datasetId";return t(r({_cdapPath:i}),{namespace:"@namespace",datasetId:"@datasetId"},{list:n.getConfig("GET","REQUEST",s,!0),get:n.getConfig("GET","REQUEST",i),"delete":n.getConfig("DELETE","REQUEST",i),truncate:n.getConfig("POST","REQUEST",i+"/admin/truncate"),programsList:n.getConfig("GET","REQUEST",i+"/programs",!0)})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myExploreApi",["myCdapUrl","$resource","myAuth","myHelpers",function(e,t,a,n){var r=e.constructUrl,s="/namespaces/:namespace/data/explore/tables",i="/namespaces/:namespace/data/explore/queries",o="/data/explore/queries/:queryhandle";return t(r({_cdapPath:s}),{table:"@table",queryhandle:"@queryhandle"},{list:n.getConfig("GET","REQUEST",s,!0),getInfo:n.getConfig("GET","REQUEST",s+"/:table/info"),postQuery:n.getConfig("POST","REQUEST",i),getQueries:n.getConfig("GET","REQUEST",i,!0),getQuerySchema:n.getConfig("GET","REQUEST",o+"/schema",!0),getQueryPreview:n.getConfig("POST","REQUEST",o+"/preview",!0),pollQueryStatus:n.getConfig("GET","POLL",o+"/status",!1,{interval:2e3}),stopPollQueryStatus:n.getConfig("GET","POLL-STOP",o+"/status")})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myFlowsApi",["myCdapUrl","$resource","myAuth","myHelpers",function(e,t,a,n){var r=e.constructUrl,s="/namespaces/:namespace/apps/:appId/flows/:flowId";return t(r({_cdapPath:s}),{namespace:"@namespace",appId:"@appId",flowId:"@flowId",runId:"@runId",flowletId:"@flowletId"},{get:n.getConfig("GET","REQUEST",s),runs:n.getConfig("GET","REQUEST",s+"/runs",!0),nextLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/next",!0),prevLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/prev",!0),getFlowletInstance:n.getConfig("GET","REQUEST",s+"/flowlets/:flowletId/instances"),pollFlowletInstance:n.getConfig("GET","POLL",s+"/flowlets/:flowletId/instances"),setFlowletInstance:n.getConfig("PUT","REQUEST",s+"/flowlets/:flowletId/instances")})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myHydratorFactory",["GLOBALS",function(e){function t(e){return!a(e)}function a(t){return-1!==[e.etlBatch,e.etlRealtime,e.etlDataPipeline,e.etlDataStreams].indexOf(t)}return{isCustomApp:t,isETLApp:a}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"
}),function(e){angular.module(e.name+".services").factory("myHydratorValidatorsApi",["$resource",function(e){return e("",{},{get:{url:"/validators",method:"GET"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myPipelineApi",["$resource","myHelpers","GLOBALS",function(e,t,a){var n="/templates",r="/namespaces/:namespace/apps/:pipeline",s=r+"/plugins",i="/namespaces/:namespace/artifacts/:artifactName",o=i+"/versions/:version/properties",l="/namespaces/:namespace/apps?artifactName="+a.etlBatch+","+a.etlRealtime+","+a.etlDataPipeline+","+a.etlDataStreams,c="/namespaces/:namespace/artifacts?scope=SYSTEM",u="/namespaces/:namespace/artifacts/:pipelineType/versions/:version/extensions",p=u+"/:extensionType",d=p+"?scope=system",m=u+"?scope=system",f=p+"/plugins/:pluginName?scope=system",h=p+"/plugins/:pluginName",g="/namespaces/:namespace/artifacts/:artifactName/versions/:artifactVersion/properties",y="/namespaces/:namespace/artifacts/:artifactName/versions/:version/plugintypes/:pluginType/plugins/:pluginName/methods/:methodName",v="/namespaces/:namespace/previews";return e("",{},{fetchMacros:t.getConfig("GET","REQUEST",s,!0),loadArtifact:t.getConfig("POST","REQUEST",i,!1,{contentType:"application/java-archive"}),loadJson:t.getConfig("PUT","REQUEST",o,!1,{contentType:"application/json"}),save:t.getConfig("PUT","REQUEST",r,!1,{contentType:"application/json"}),fetchArtifacts:t.getConfig("GET","REQUEST",c,!0),fetchExtensions:t.getConfig("GET","REQUEST",m,!0),fetchSources:t.getConfig("GET","REQUEST",d,!0),fetchSinks:t.getConfig("GET","REQUEST",d,!0),fetchTransforms:t.getConfig("GET","REQUEST",d,!0),fetchTemplates:t.getConfig("GET","REQUEST",n,!0),fetchPlugins:t.getConfig("GET","REQUEST",d,!0),fetchSourceProperties:t.getConfig("GET","REQUEST",f,!0),fetchSinkProperties:t.getConfig("GET","REQUEST",f,!0),fetchTransformProperties:t.getConfig("GET","REQUEST",f,!0),fetchArtifactProperties:t.getConfig("GET","REQUEST",g),fetchPluginProperties:t.getConfig("GET","REQUEST",f,!0),fetchPostActionProperties:t.getConfig("GET","REQUEST",h,!0),list:t.getConfig("GET","REQUEST",l,!0),pollStatus:t.getConfig("GET","POLL",r+"/status"),stopPollStatus:t.getConfig("GET","POLL-STOP",r+"/status"),"delete":t.getConfig("DELETE","REQUEST",r),runs:t.getConfig("GET","REQUEST",r+"/runs",!0),get:t.getConfig("GET","REQUEST",r),datasets:t.getConfig("GET","REQUEST",r+"/datasets",!0),streams:t.getConfig("GET","REQUEST",r+"/streams",!0),action:t.getConfig("POST","REQUEST",r+"/:action"),postPluginMethod:t.getConfig("POST","REQUEST",y,!1,{suppressErrors:!0}),getPluginMethod:t.getConfig("GET","REQUEST",y,!1,{suppressErrors:!0}),putPluginMethod:t.getConfig("PUT","REQUEST",y,!1,{suppressErrors:!0}),deletePluginMethod:t.getConfig("DELETE","REQUEST",y,!1,{suppressErrors:!0}),runPreview:t.getConfig("POST","REQUEST","/namespaces/:namespace/preview",!1,{suppressErrors:!0}),getStagePreview:t.getConfig("GET","REQUEST",v+"/:previewId/stages/:stage",!1,{suppressErrors:!0})})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myPipelineCommonApi",["$resource","myHelpers",function(e,t){var a="/namespaces/:namespace/apps/:app/:programType/:programName",n=a+"/runs",r="/namespaces/:namespace/apps/:app/schedules/:schedule";return e("",{namespace:"@namespace",app:"@app",programType:"@programType",programName:"@programName",schedule:"@schedule"},{start:t.getConfig("POST","REQUEST",a+"/start"),stop:t.getConfig("POST","REQUEST",a+"/stop"),schedule:t.getConfig("POST","REQUEST",r+"/resume"),suspend:t.getConfig("POST","REQUEST",r+"/suspend"),scheduleStatus:t.getConfig("GET","REQUEST",r+"/status"),getStatistics:t.getConfig("GET","REQUEST",a+"/statistics"),getRuns:t.getConfig("GET","REQUEST",n),pollRuns:t.getConfig("GET","POLL",a+"/runs",!0),nextRunTime:t.getConfig("GET","REQUEST",a+"/nextruntime",!0)})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myPipelineTemplatesApi",["$resource",function(e){return e("",{apptype:"@apptype",appname:"@appname"},{list:{url:"/predefinedapps/:apptype",method:"GET",isArray:!0},get:{url:"/predefinedapps/:apptype/:appname",method:"GET"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myLogsApi",["myCdapUrl","$resource","myAuth","myHelpers",function(e,t,a,n){var r=e.constructUrl,s="/namespaces/:namespace/apps/:appId/:programType/:programId",i=s+"/runs/:runId/logs?";return t(r({_cdapPath:s}),{namespace:"@namespace",appId:"@appId",programType:"@programType",programId:"@flowId",runId:"@runId",start:"@start",stop:"@stop",fromOffset:"@fromOffset"},{getLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs",!0),getLogsStartAsJson:n.getConfig("GET","REQUEST",i+"format=json&max=100&start=:start",!0),getLogsStartAsRaw:n.getConfig("GET","REQUEST",i+"start=:start",!1,{interceptor:{response:function(e){return e.data}}}),getLogsMetadata:n.getConfig("GET","REQUEST",s+"/runs/:runId/",!1),nextLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/next",!0),nextLogsJson:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/next?format=json",!0),nextLogsJsonOffset:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/next?format=json&max=100&fromOffset=:fromOffset",!0),prevLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/prev",!0),prevLogsJson:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/prev",!0)})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myMapreduceApi",["myCdapUrl","$resource","myAuth","myHelpers",function(e,t,a,n){var r=e.constructUrl,s="/namespaces/:namespace/apps/:appId/mapreduce/:mapreduceId";return t(r({_cdapPath:s}),{namespace:"@namespace",appId:"@appId",mapreduceId:"@mapreduceId",runId:"@runId"},{get:n.getConfig("GET","REQUEST",s),runs:n.getConfig("GET","REQUEST",s+"/runs",!0),pollLatestRun:n.getConfig("GET","POLL",s+"/runs?limit=1",!0,{interval:2e3}),stopPollLatestRun:n.getConfig("GET","POLL-STOP",s+"/runs?limit=1",!0),nextLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/next",!0),prevLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/prev",!0),runDetail:n.getConfig("GET","REQUEST",s+"/runs/:runId")})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myMetadataApi",["myCdapUrl","$resource","myAuth","myHelpers",function(e,t,a,n){var r=e.constructUrl,s="/namespaces/:namespace/apps/:appId/:programType/:programId/metadata",i="/namespaces/:namespace/datasets/:datasetId/metadata",o="/namespaces/:namespace/streams/:streamId/metadata",l="/namespaces/:namespace/apps/:appId/metadata";return t(r({_cdapPath:s}),{namespace:"@namespace",appId:"@appId",programType:"@programType",programId:"@programId"},{setProgramMetadata:n.getConfig("POST","REQUEST",s+"/tags"),getProgramMetadata:n.getConfig("GET","REQUEST",s,!0),deleteProgramMetadata:n.getConfig("DELETE","REQUEST",s+"/tags/:tag"),setAppsMetadata:n.getConfig("POST","REQUEST",l+"/tags"),getAppsMetadata:n.getConfig("GET","REQUEST",l,!0),deleteAppsMetadata:n.getConfig("DELETE","REQUEST",l+"/tags/:tag"),setDatasetsMetadata:n.getConfig("POST","REQUEST",i+"/tags"),getDatasetsMetadata:n.getConfig("GET","REQUEST",i,!0),deleteDatasetsMetadata:n.getConfig("DELETE","REQUEST",i+"/tags/:tag"),setStreamsMetadata:n.getConfig("POST","REQUEST",o+"/tags"),getStreamsMetadata:n.getConfig("GET","REQUEST",o,!0),deleteStreamsMetadata:n.getConfig("DELETE","REQUEST",o+"/tags/:tag")})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myMetadataFactory",["myMetadataApi","$q",function(e,t){function a(a){var n=t.defer();return e.getProgramMetadata(a).$promise.then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}function n(a){var n=t.defer();return e.getAppsMetadata(a).$promise.then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}function r(a){var n=t.defer();return e.getDatasetsMetadata(a).$promise.then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}function s(a){var n=t.defer();return e.getStreamsMetadata(a).$promise.then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}function i(n,r){var s=[n],i=t.defer();return e.setProgramMetadata(r,s).$promise.then(function(){return a(r)}).then(function(e){i.resolve(e)}),i.promise}function o(a,n){var r=[a],s=t.defer();return e.setAppsMetadata(n,r).$promise.then(function(){return e.getAppsMetadata(n).$promise}).then(function(e){s.resolve(e)}),s.promise}function l(a,n){var r=[a],s=t.defer();return e.setDatasetsMetadata(n,r).$promise.then(function(){return e.getDatasetsMetadata(n).$promise}).then(function(e){s.resolve(e)}),s.promise}function c(a,n){var r=[a],s=t.defer();return e.setStreamsMetadata(n,r).$promise.then(function(){return e.getStreamsMetadata(n).$promise}).then(function(e){s.resolve(e)}),s.promise}function u(n,r){var s=angular.extend({tag:n},r),i=t.defer();return e.deleteProgramMetadata(s).$promise.then(function(){return a(r)}).then(function(e){i.resolve(e)}),i.promise}function p(a,n){var r=angular.extend({tag:a},n),s=t.defer();return e.deleteAppsMetadata(r).$promise.then(function(){return e.getAppsMetadata(n).$promise}).then(function(e){s.resolve(e)}),s.promise}function d(a,n){var r=angular.extend({tag:a},n),s=t.defer();return e.deleteDatasetsMetadata(r).$promise.then(function(){return e.getDatasetsMetadata(n).$promise}).then(function(e){s.resolve(e)}),s.promise}function m(a,n){var r=angular.extend({tag:a},n),s=t.defer();return e.deleteStreamsMetadata(r).$promise.then(function(){return e.getStreamsMetadata(n).$promise}).then(function(e){s.resolve(e)}),s.promise}return{getProgramMetadata:a,getAppsMetadata:n,getStreamsMetadata:s,getDatasetsMetadata:r,addProgramMetadata:i,deleteProgramMetadata:u,addAppsMetadata:o,deleteAppsMetadata:p,addDatasetsMetadata:l,deleteDatasetsMetadata:d,addStreamsMetadata:c,deleteStreamsMetadata:m}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").service("myPipelineExportModalService",["$uibModal",function(e){this.show=function(t,a){t&&a&&e.open({templateUrl:"pipeline-export-modal/pipeline-export-modal-template.html",size:"lg",keyboard:!0,animation:!1,windowTopClass:"node-config-modal hydrator-modal",controller:["$scope","config","$timeout","exportConfig",function(e,t,a,n){var r=null;e.config=JSON.stringify(t),e["export"]=function(){var t=new Blob([JSON.stringify(n,null,4)],{type:"application/json"});e.url=URL.createObjectURL(t),e.exportFileName=(n.name?n.name:"noname")+"-"+n.artifact.name,e.$on("$destroy",function(){URL.revokeObjectURL(e.url)}),a.cancel(r),r=a(function(){document.getElementById("pipeline-export-config-link").click()})},e.$on("$destroy",function(){a.cancel(r)})}],resolve:{config:function(){return t},exportConfig:function(){return a}}})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myPreferenceApi",["myCdapUrl","$resource","myAuth","myHelpers",function(e,t,a,n){var r=e.constructUrl,s="/namespaces/:namespace";return t(r({_cdapPath:s}),{namespace:"@namespace",appId:"@appId",programType:"@programType",programId:"@programId"},{getSystemPreference:n.getConfig("GET","REQUEST","/preferences"),setSystemPreference:n.getConfig("PUT","REQUEST","/preferences"),getNamespacePreference:n.getConfig("GET","REQUEST",s+"/preferences"),setNamespacePreference:n.getConfig("PUT","REQUEST",s+"/preferences"),getAppPreference:n.getConfig("GET","REQUEST",s+"/apps/:appId/preferences"),setAppPreference:n.getConfig("PUT","REQUEST",s+"/apps/:appId/preferences"),getProgramPreference:n.getConfig("GET","REQUEST",s+"/apps/:appId/:programType/:programId/preferences"),setProgramPreference:n.getConfig("PUT","REQUEST",s+"/apps/:appId/:programType/:programId/preferences")})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("ProgramsHelpers",function(){var e=function(e){return angular.isString(e)&&"s"===e.slice(-1)?e.slice(0,e.length-1):e},t=function(e){return e+"s"};return{getSingularName:e,getPluralName:t}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myServiceApi",["myCdapUrl","$resource","myAuth","myHelpers",function(e,t,a,n){var r=e.constructUrl,s="/namespaces/:namespace/apps/:appId/services/:serviceId";return t(r({_cdapPath:s}),{namespace:"@namespace",appId:"@appId",serviceId:"@mapreduceId",runId:"@runId"},{get:n.getConfig("GET","REQUEST",s),runs:n.getConfig("GET","REQUEST",s+"/runs",!0),nextLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/next",!0),prevLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/prev",!0),runDetail:n.getConfig("GET","REQUEST",s+"/runs/:runId")})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("mySparkApi",["myCdapUrl","$resource","myAuth","myHelpers",function(e,t,a,n){var r=e.constructUrl,s="/namespaces/:namespace/apps/:appId/spark/:sparkId";return t(r({_cdapPath:s}),{namespace:"@namespace",appId:"@appId",sparkId:"@mapreduceId",runId:"@runId"},{get:n.getConfig("GET","REQUEST",s),runs:n.getConfig("GET","REQUEST",s+"/runs",!0),nextLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/next",!0),prevLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/prev",!0),runDetail:n.getConfig("GET","REQUEST",s+"/runs/:runId")})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myStreamApi",["myCdapUrl","$resource","myAuth","myHelpers",function(e,t,a,n){var r=e.constructUrl,s="/namespaces/:namespace/streams",i="/namespaces/:namespace/streams/:streamId";return t(r({_cdapPath:i}),{namespace:"@namespace",streamId:"@streamId"},{list:n.getConfig("GET","REQUEST",s,!0),get:n.getConfig("GET","REQUEST",i),create:n.getConfig("PUT","REQUEST",i,!1,{suppressErrors:!0}),setProperties:n.getConfig("PUT","REQUEST",i+"/properties",!1,{suppressErrors:!0}),truncate:n.getConfig("POST","REQUEST",i+"/truncate"),programsList:n.getConfig("GET","REQUEST",i+"/programs",!0),eventSearch:n.getConfig("GET","REQUEST",i+"/events",!0),sendEvent:n.getConfig("POST","REQUEST",i,!1,{json:!1,suppressErrors:!0}),"delete":n.getConfig("DELETE","REQUEST",i)})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").service("myStreamService",["$uibModal","$rootScope",function(e,t){var a;this.show=function(n){var r=t.$new();return r.streamId=n,a=e.open({controller:"FlowStreamDetailController",templateUrl:"/old_assets/features/flows/templates/tabs/runs/streams/detail.html",scope:r})},this.hide=function(){a.hide()},this.dismiss=function(){a.dismiss()}}]).controller("FlowStreamDetailController",["$scope","myStreamApi","$state","myFileUploader","myAlertOnValium",function(e,t,a,n,r){e.loading=!1,e.doInject=function(){if(!e.userInput)return void(e.userInput=null);var n={namespace:a.params.namespace,streamId:e.streamId,scope:e},r=e.userInput.replace(/\r\n/g,"\n").split("\n");angular.forEach(r,function(a){t.sendEvent(n,a).$promise.then(null,function(t){e.error=t.data})}),e.userInput=null},e.dismiss=function(){e.$dismiss()},e.uploadFile=function(t){function s(){e.dismiss(),e.loading=!1,r.show({type:"success",title:"Upload success",content:"The file has been uploaded successfully"})}function i(){r.show({type:"danger",title:"Upload failed",content:"The file could not be uploaded"}),e.dismiss(),e.loading=!1}e.loading=!0;for(var o="/namespaces/"+a.params.namespace+"/streams/"+e.streamId+"/batch",l=0;l<t.length;l++)n.upload({path:o,file:t[l]},{"Content-type":"text/csv"}).then(s,i)}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myTagsApi",["myCdapUrl","$resource","myHelpers",function(e,t,a){var n=e.constructUrl,r="/metadata/tags",s="/namespaces/:namespaceId",i=s+"/apps/:appId",o=i+"/:programType/:programId",l=s+"/datasets/:datasetId",c=s+"/streams/:streamId",u=s+"/metadata/search";return t(n({_cdapPath:s}),{namespaceId:"@namespaceId",datasetId:"@datasetId",streamId:"@streamId",programType:"@programType",programId:"@programId",appId:"@appId"},{getAppTags:a.getConfig("GET","REQUEST",i+r,!0),getProgramTags:a.getConfig("GET","REQUEST",o+r,!0),getDatasetTags:a.getConfig("GET","REQUEST",l+r,!0),getStreamTags:a.getConfig("GET","REQUEST",c+r,!0),searchTags:a.getConfig("GET","REQUEST",u)})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myWorkersApi",["myCdapUrl","$resource","myAuth","myHelpers",function(e,t,a,n){var r=e.constructUrl,s="/namespaces/:namespace/apps/:appId/workers/:workerId";return t(r({_cdapPath:s}),{namespace:"@namespace",appId:"@appId",sparkId:"@mapreduceId",runId:"@runId"},{get:n.getConfig("GET","REQUEST",s),runs:n.getConfig("GET","REQUEST",s+"/runs",!0),pollRuns:n.getConfig("GET","POLL",s+"/runs",!0),pollLatestRun:n.getConfig("GET","POLL",s+"/runs?limit=1",!0,{interval:2e3}),stopPollLatestRun:n.getConfig("GET","POLL-STOP",s+"/runs?limit=1",!0),nextLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/next",!0),prevLogs:n.getConfig("GET","REQUEST",s+"/runs/:runId/logs/prev",!0),runDetail:n.getConfig("GET","REQUEST",s+"/runs/:runId"),doAction:n.getConfig("POST","REQUEST",s+"/:action"),getProgramStatus:n.getConfig("GET","REQUEST",s+"/status"),pollStatus:n.getConfig("GET","POLL",s+"/status")})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("myWorkFlowApi",["$state","myCdapUrl","$resource","myHelpers",function(e,t,a,n){var r=t.constructUrl,s="/namespaces/:namespace/apps/:appId/schedules/:scheduleId",i="/namespaces/:namespace/apps/:appId/workflows/:workflowId";return a(r({_cdapPath:i}),{namespace:"@namespace",appId:"@appId",workflowId:"@workflowId",scheduleId:"@scheduleId",runId:"@runId"},{get:n.getConfig("GET","REQUEST",i),status:n.getConfig("GET","REQUEST",i+"/status"),start:n.getConfig("POST","REQUEST",i+"/start"),stop:n.getConfig("POST","REQUEST",i+"/stop"),doAction:n.getConfig("POST","REQUEST",i+"/:action"),pollStatus:n.getConfig("GET","POLL",i+"/status"),runs:n.getConfig("GET","REQUEST",i+"/runs",!0),runDetail:n.getConfig("GET","REQUEST",i+"/runs/:runId"),pollRuns:n.getConfig("GET","POLL",i+"/runs",!0),stopPollRuns:n.getConfig("GET","POLL-STOP",i+"/runs",!0),pollRunDetail:n.getConfig("GET","POLL",i+"/runs/:runId",!1),pollRunDetailOften:n.getConfig("GET","POLL",i+"/runs/:runId",!1,{interval:1e3}),stopPollRunDetail:n.getConfig("GET","POLL-STOP",i+"/runs/:runId"),stopRun:n.getConfig("POST","REQUEST",i+"/runs/:runId/stop"),suspendRun:n.getConfig("POST","REQUEST",i+"/runs/:runId/suspend"),resumeRun:n.getConfig("POST","REQUEST",i+"/runs/:runId/resume"),nextLogs:n.getConfig("GET","REQUEST",i+"/runs/:runId/logs/next",!0),prevLogs:n.getConfig("GET","REQUEST",i+"/runs/:runId/logs/prev",!0),schedules:n.getConfig("GET","REQUEST",i+"/schedules",!0),schedulesPreviousRunTime:n.getConfig("GET","REQUEST",i+"/previousruntime",!0),pollScheduleStatus:n.getConfig("GET","POLL",s+"/status",!1,{interval:2e3}),getScheduleStatus:n.getConfig("GET","REQUEST",s+"/status"),scheduleSuspend:n.getConfig("POST","REQUEST",s+"/suspend"),scheduleResume:n.getConfig("POST","REQUEST",s+"/resume"),getCurrent:n.getConfig("GET","REQUEST",i+"/:runid/current",!0),getUserNodeToken:n.getConfig("GET","REQUEST",i+"/runs/:runId/nodes/:nodeId/token?scope=user"),getSystemNodeToken:n.getConfig("GET","REQUEST",i+"/runs/:runId/nodes/:nodeId/token?scope=system"),getStatistics:n.getConfig("GET","REQUEST",i+"/statistics"),pollStatistics:n.getConfig("GET","POLL",i+"/statistics"),getNodesState:n.getConfig("GET","REQUEST",i+"/runs/:runId/nodes/state")})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("admin",{"abstract":!0,data:{authorizedRoles:a.all,highlightTab:"management"},url:"/admin",templateUrl:"/old_assets/features/admin/templates/admin.html",controller:"AdminController"}).state("admin.overview",{url:"",templateUrl:"/old_assets/features/admin/templates/overview.html",controller:"OverviewController",ncyBreadcrumb:{label:"Management"}}).state("admin.system",{"abstract":!0,url:"/system",template:"<ui-view/>"}).state("admin.system.overview",{url:"",templateUrl:"/old_assets/features/admin/templates/system.html"}).state("admin.system.configuration",{url:"/configuration",templateUrl:"/old_assets/features/admin/templates/system/configuration.html",controller:"SystemConfigurationController",ncyBreadcrumb:{label:"Configuration",parent:"admin.overview"}}).state("admin.system.services",{url:"/services",templateUrl:"/old_assets/features/admin/templates/system/services.html",controller:"SystemServicesController",ncyBreadcrumb:{label:"Services",parent:"admin.overview"}}).state("admin.system.services.detail",{parent:"admin.system",url:"/services/detail/:serviceName",templateUrl:"/old_assets/features/admin/templates/system/service-detail.html",controller:"SystemServiceDetailController"}).state("admin.system.services.detail.metadata",{url:"/metadata",templateUrl:"/old_assets/features/admin/templates/partials/service-detail-metadata.html",ncyBreadcrumb:{label:"Metadata",parent:"admin.system.services"}}).state("admin.system.services.detail.logs",{url:"/logs",templateUrl:"/old_assets/features/admin/templates/partials/service-detail-log.html",controller:"SystemServiceLogController",ncyBreadcrumb:{label:"Logs",parent:"admin.system.services"}}).state("admin.system.preferences",{url:"/preferences",templateUrl:"/old_assets/features/admin/templates/preferences.html",controller:"PreferencesController",ncyBreadcrumb:{label:"Preferences",parent:"admin.overview"},resolve:{rSource:function(){return"SYSTEM"}}}).state("admin.namespace",{"abstract":!0,url:"/namespace",resolve:{nsList:["myNamespace",function(e){return e.getList(!0)}]},template:"<ui-view/>"}).state("admin.namespace.create",{url:"/create",onEnter:["$uibModal","$state",function(e,t){e.open({templateUrl:"/old_assets/features/admin/templates/namespace/create.html",size:"lg",backdrop:!0,keyboard:!0,controller:"NamespaceCreateController"}).result["finally"](function(){t.go("admin.overview",{},{reload:!0})})}],onExit:["$uibModalStack",function(e){e.dismissAll()}],ncyBreadcrumb:{skip:!0}}).state("admin.namespace.detail",{url:"/detail/:nsadmin",templateUrl:"/old_assets/features/admin/templates/namespace.html"}).state("admin.namespace.detail.preferences",{url:"/preferences",templateUrl:"/old_assets/features/admin/templates/preferences.html",controller:"PreferencesController",resolve:{rSource:function(){return"NAMESPACE"}},ncyBreadcrumb:{label:"Preferences",parent:"admin.namespace.detail.settings"}}).state("admin.namespace.detail.templateslist",{url:"/templates",templateUrl:"/old_assets/features/admin/templates/namespace/templates-list.html",controller:"NamespaceTemplatesListController",controllerAs:"TemplatesListController",ncyBreadcrumb:{label:"Templates",parent:"admin.namespace.detail.settings"}}).state("admin.namespace.detail.templates",{url:"/templates/create",templateUrl:"/old_assets/features/admin/templates/namespace/templates.html",controller:"NamespaceTemplatesController",controllerAs:"TemplatesController",ncyBreadcrumb:{label:"Create",parent:"admin.namespace.detail.templateslist"}}).state("admin.namespace.detail.templateedit",{url:"/templates/edit/:templateType/:pluginType/:pluginTemplate",templateUrl:"/old_assets/features/admin/templates/namespace/templates.html",controller:"NamespaceTemplatesController",controllerAs:"TemplatesController",ncyBreadcrumb:{label:"{{$state.params.pluginTemplate}}",parent:"admin.namespace.detail.templateslist"}}).state("admin.namespace.detail.settings",{url:"/settings",templateUrl:"/old_assets/features/admin/templates/namespace/settings.html",controller:"NamespaceSettingsController",ncyBreadcrumb:{label:"{{$state.params.nsadmin}}",parent:"admin.overview"}}).state("admin.namespace.detail.data",{url:"/data",templateUrl:"/old_assets/features/admin/templates/namespace/datasets.html",controller:"NamespaceDatasetsController",ncyBreadcrumb:{label:"Datasets",parent:"admin.namespace.detail.settings"}}).state("admin.namespace.detail.data.datasetmetadata",{url:"/datasets/:datasetId",controller:"NamespaceDatasetMetadataController",templateUrl:"/old_assets/features/admin/templates/namespace/dataset-metadata.html",ncyBreadcrumb:{label:"{{$state.params.datasetId}}",parent:"admin.namespace.detail.data"}}).state("admin.namespace.detail.data.streamcreate",{url:"/streams/create",onEnter:["$uibModal",function(e){e.open({templateUrl:"/old_assets/features/admin/templates/namespace/streamscreate.html",size:"lg",backdrop:!0,keyboard:!0,controller:"NamespaceStreamsCreateController"})}],onExit:["$uibModalStack",function(e){e.dismissAll()}],ncyBreadcrumb:{skip:!0}}).state("admin.namespace.detail.data.streammetadata",{url:"/streams/detail/:streamId",controller:"NamespaceStreamMetadataController",templateUrl:"/old_assets/features/admin/templates/namespace/stream-metadata.html",ncyBreadcrumb:{label:"{{$state.params.streamId}}",parent:"admin.namespace.detail.data"}}).state("admin.namespace.detail.apps",{url:"/apps",templateUrl:"/old_assets/features/admin/templates/namespace/apps.html",controller:"NamespaceAppController",ncyBreadcrumb:{label:"Applications",parent:"admin.namespace.detail.settings"}}).state("admin.namespace.detail.apps.metadata",{parent:"admin.namespace.detail",url:"/:appId",templateUrl:"/old_assets/features/admin/templates/namespace/app-metadata.html",controller:"NamespaceAppMetadataController",ncyBreadcrumb:{label:"Metadata",parent:"admin.namespace.detail.apps"}}).state("admin.namespace.detail.apps.metadata.preference",{url:"/preferences",templateUrl:"/old_assets/features/admin/templates/preferences.html",controller:"PreferencesController",ncyBreadcrumb:{label:"Preferences",parent:"admin.namespace.detail.settings"},resolve:{rSource:function(){return"APPLICATION"}}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.apps").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("apps",{"abstract":!0,template:"<ui-view/>",url:"/apps",data:{authorizedRoles:a.all,highlightTab:"development"},parent:"ns"}).state("apps.list",{url:"",templateUrl:"/old_assets/features/apps/templates/list.html",controller:"AppListController",controllerAs:"ListController",ncyBreadcrumb:{label:"Applications",parent:"overview"}}).state("apps.detail",{url:"/:appId","abstract":!0,template:"<ui-view/>"}).state("apps.detail.overview",{url:"/overview",templateUrl:"/old_assets/features/apps/templates/detail.html",resolve:{rAppData:["MyCDAPDataSource","$stateParams","$q","$state",function(e,t,a,n){var r=new e,s=a.defer();return r.request({_cdapPath:"/namespaces/"+t.namespace+"/apps/"+t.appId}).then(function(e){s.resolve(e)},function(){s.reject(),n.go("404")}),s.promise}]},controller:"AppDetailController",controllerAs:"DetailController",ncyBreadcrumb:{skip:!0}}).state("apps.detail.overview.status",{url:"/status",ncyBreadcrumb:{parent:"apps.list",label:"{{$state.params.appId}}"},controller:"AppDetailStatusController",controllerAs:"StatusController",templateUrl:"/old_assets/features/apps/templates/tabs/status.html",resolve:{rPipelineDetail:["$stateParams","$q","myPipelineApi",function(e,t,a){var n={namespace:e.namespace,pipeline:e.appId};return a.get(n).$promise}]}}).state("apps.detail.overview.programs",{url:"/programs",ncyBreadcrumb:{parent:"apps.list",label:"{{$state.params.appId}}"},controller:"AppDetailProgramsController",controllerAs:"ProgramsController",templateUrl:"/old_assets/features/apps/templates/tabs/programs.html"}).state("apps.detail.overview.datasets",{url:"/datasets",ncyBreadcrumb:{label:"Datasets",parent:"apps.detail.overview.status"},templateUrl:"/old_assets/features/apps/templates/tabs/datasets.html"})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.dashboard").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("dashboard",{url:"/dashboard",parent:"ns",data:{authorizedRoles:a.all,highlightTab:"dashboard"},templateUrl:"/old_assets/features/dashboard/templates/dashboard.html",resolve:{rDashboardsModel:["$stateParams","MyDashboardsModel",function(e,t){return new t(e.namespace).$promise}]},controller:"DashboardCtrl"}).state("dashboard.standard",{url:"/standard","abstract":!0,template:"<ui-view/>"}).state("dashboard.standard.cdap",{url:"/cdap",templateUrl:"/old_assets/features/dashboard/templates/staticdashboard.html",controller:"OpsCdapCtrl"}).state("dashboard.user",{url:"/user/:tab",templateUrl:"/old_assets/features/dashboard/templates/userdashboard.html",controller:"UserDashboardCtrl",resolve:{tab:["$stateParams",function(e){return e.tab}]}}).state("dashboard.user.addwdgt",{url:"/widget/add",onEnter:["$stateParams","$state","$uibModal","$rootScope","rDashboardsModel","tab",function(e,t,a,n,r,s){var i=n.$new(),o=r.data[e.tab];i.currentBoard=o,i.metricsLimit=o.WIDGET_LIMIT,i.metricsSlotsFilled=o.columns.length,a.open({templateUrl:"/old_assets/features/dashboard/templates/partials/addwdgt.html",size:"lg",backdrop:!0,windowClass:"cdap-modal",keyboard:!0,scope:i,controller:"DashboardAddWdgtCtrl"}).result["finally"](function(){t.go("dashboard.user",{tab:s},{reload:!0})})}],onExit:["$uibModalStack",function(e){e.dismissAll()}]})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.data").controller("CdapDataListController",["$state","$scope","MyOrderings","myStreamApi","myDatasetApi",function(e,t,a,n,r){this.MyOrderings=a,this.dataList=[],this.currentPage=1,this.searchText="";var s={namespace:e.params.namespace,scope:t};r.list(s).$promise.then(function(a){this.dataList=a.filter(function(e){return"externalDataset"!==e.type}).map(function(a){a.dataType="Dataset";var n={namespace:e.params.namespace,datasetId:a.name,scope:t};return r.programsList(n).$promise.then(function(e){a.programs=e}),a}.bind(this)).concat(this.dataList)}.bind(this)),n.list(s).$promise.then(function(a){this.dataList=a.map(function(a){a.dataType="Stream";var r={namespace:e.params.namespace,streamId:a.name,scope:t};return n.programsList(r).$promise.then(function(e){a.programs=e}),a}.bind(this)).concat(this.dataList)}.bind(this)),this.goToDetail=function(t){"Dataset"===t.dataType?e.go("datasets.detail.overview.status",{datasetId:t.name}):"Stream"===t.dataType&&e.go("streams.detail.overview.status",{streamId:t.name}),a.dataClicked(t.name)}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.data").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("data",{"abstract":!0,template:"<ui-view/>",url:"/data",data:{authorizedRoles:a.all,highlightTab:"development"},parent:"ns"}).state("data.list",{url:"",templateUrl:"/old_assets/features/data/list.html",controller:"CdapDataListController as dataCtrl",ncyBreadcrumb:{label:"Data",parent:"overview"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.datasets").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("datasets",{"abstract":!0,template:"<ui-view/>",url:"/datasets",data:{authorizedRoles:a.all,highlightTab:"development"},parent:"ns"}).state("datasets.detail",{url:"/:datasetId","abstract":!0,resolve:{explorableDatasets:["myExploreApi","$stateParams","$q","$filter",function(e,t,a,n){var r={namespace:t.namespace},s=a.defer(),i=n("filter");return e.list(r).$promise.then(function(e){var a=t.datasetId;a=a.replace(/[\.\-]/g,"_");var n=i(e,a);0===n.length?s.resolve(!1):s.resolve(!0)},function(){s.resolve(!1)}),s.promise}]},template:"<ui-view/>"}).state("datasets.detail.overview",{url:"/overview",templateUrl:"/old_assets/features/datasets/templates/detail.html",controller:"DatasetsDetailController",controllerAs:"DetailController",ncyBreadcrumb:{skip:!0}}).state("datasets.detail.overview.status",{url:"/status",templateUrl:"/old_assets/features/datasets/templates/tabs/status.html",
controller:"DatasetDetailStatusController",controllerAs:"StatusController",ncyBreadcrumb:{parent:"data.list",label:"{{$state.params.datasetId}}"}}).state("datasets.detail.overview.explore",{url:"/explore",templateUrl:"/old_assets/features/datasets/templates/tabs/explore.html",controller:"DatasetExploreController",controllerAs:"ExploreController",ncyBreadcrumb:{label:"Explore",parent:"datasets.detail.overview.status"}}).state("datasets.detail.overview.programs",{url:"/programs",templateUrl:"/old_assets/features/datasets/templates/tabs/programs.html",ncyBreadcrumb:{label:"Programs",parent:"datasets.detail.overview.status"},controller:"DatasetDetailProgramsController",controllerAs:"ProgramsController"}).state("datasets.detail.overview.metadata",{url:"/metadata",templateUrl:"/old_assets/features/datasets/templates/tabs/metadata.html",ncyBreadcrumb:{label:"Metadata",parent:"datasets.detail.overview.status"},controller:"DatasetMetadataController",controllerAs:"MetadataController"})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.experimental").config(["$stateProvider",function(e){e.state("experimental",{parent:"ns",url:"/experimental","abstract":!0,templateUrl:"/old_assets/features/experimental/templates/experimental.html"}).state("experimental.home",{url:"",templateUrl:"/old_assets/features/experimental/templates/experiments-home.html",ncyBreadcrumb:{label:"Experiments",parent:"experimental"}}).state("experimental.uitemplate",{url:"/uitemplate",templateUrl:"/old_assets/features/experimental/templates/ui-template.html",ncyBreadcrumb:{label:"UI Templates",parent:"experimental.home"}}).state("experimental.directivesPlayground",{url:"/experimental-directives",templateUrl:"/old_assets/features/experimental/templates/directives-playground.html",controller:"DirectivePlayGround",controllerAs:"DirectivePlayGround",ncyBreadcrumb:{label:"Directives Playground",parent:"experimental.home"}}).state("experimental.datetime",{url:"/datetime",templateUrl:"/old_assets/features/experimental/templates/datetime.html",controller:"DateCtrl",controllerAs:"Date",ncyBreadcrumb:{label:"Datetime Playground",parent:"experimental.home"}}).state("experimental.schema",{url:"/schema",templateUrl:"/old_assets/features/experimental/templates/schema.html",controller:"SchemaController",controllerAs:"vm",ncyBreadcrumb:{label:"Schema Widget",parent:"experimental.home"}}).state("experimental.logs",{url:"/logs",templateUrl:"/old_assets/features/experimental/templates/logs.html",controller:"LogsController",controllerAs:"LogsController",ncyBreadcrumb:{label:"Log",parent:"experimental.home"}}).state("experimental.complexSchema",{url:"/complex-schema",templateUrl:"/old_assets/features/experimental/templates/complex-schema.html",controller:"ComplexSchemaController",controllerAs:"vm",ncyBreadcrumb:{label:"Complex Schema",parent:"experimental.home"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.explore").controller("GlobalExploreController",["$scope","$state","EventPipe","myExploreApi",function(e,t,a,n){this.activeTab=0,this.activePanel=[0],this.openGeneral=!0,this.openSchema=!1,this.openPartition=!1,this.dataList=[];var r={namespace:t.params.namespace,scope:e};n.list(r).$promise.then(function(e){angular.forEach(e,function(e){var t=e.table.split("_");e.type=t[0],t.splice(0,1),e.name=t.join("_")}),this.dataList=e,this.selectTable(e[0])}.bind(this)),a.on("explore.newQuery",function(){-1===this.activePanel.indexOf(1)&&(this.activePanel=[0,1])}.bind(this)),this.selectTable=function(e){this.type=e.type,this.name=e.name,r.table=e.table,n.getInfo(r).$promise.then(function(e){this.selectedInfo=e}.bind(this))}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.explore").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("explore",{url:"/explore",data:{authorizedRoles:a.all,highlightTab:"development"},templateUrl:"/old_assets/features/explore/explore.html",controller:"GlobalExploreController",controllerAs:"GlobalExploreController",parent:"ns",ncyBreadcrumb:{label:"Explore",parent:"overview"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.flows").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("flows",{url:"/flows/:programId","abstract":!0,parent:"programs",data:{authorizedRoles:a.all,highlightTab:"development"},resolve:{rRuns:["$stateParams","$q","myFlowsApi","$state",function(e,t,a,n){var r=t.defer(),s={namespace:e.namespace,appId:e.appId,flowId:e.programId};return a.runs(s).$promise.then(function(e){r.resolve(e)},function(){r.reject(),n.go("404")}),r.promise}],rFlowsDetail:["$stateParams","myFlowsApi","$q","$state",function(e,t,a,n){var r={namespace:e.namespace,appId:e.appId,flowId:e.programId},s=a.defer();return t.get(r).$promise.then(function(e){s.resolve(e)},function(){s.reject(),n.go("404")}),s.promise}]},template:"<ui-view/>"}).state("flows.detail",{url:"/runs",templateUrl:"/old_assets/features/flows/templates/detail.html",controller:"FlowsRunsController",controllerAs:"RunsController",data:{authorizedRoles:a.all,highlightTab:"development"},ncyBreadcrumb:{parent:"apps.detail.overview.programs",label:"{{$state.params.programId}}"}}).state("flows.detail.run",{url:"/:runid",templateUrl:"/old_assets/features/flows/templates/tabs/runs/run-detail.html",controller:"FlowsRunDetailController",ncyBreadcrumb:{label:"{{$state.params.runid}}",parent:"flows.detail"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.home").controller("HomeController",["$state","$stateParams","rNsList","mySessionStorage","myLoadingService","$filter",function(e,t,a,n,r,s){function i(e){var t=s("filter")(a,{name:e},!0);return t.length>0?!0:!1}if(!a.length)return void e.go("unauthorized");var o=a.filter(function(t){return t.name===e.params.namespace}),l="feature.home.ns.latest";o.length?n.set(l,e.params.namespace):n.get(l).then(function(t){return t&&i(t)?void e.go(e.current,{namespace:t},{reload:!0}):i("default")?void e.go(e.current,{namespace:"default"},{reload:!0}):void e.go(e.current,{namespace:a[0].name},{reload:!0})}),r.hideLoadingIcon()}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.home").config(["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","MYAUTH_ROLE",function(e,t,a,n){a.strictMode(!1),t.otherwise(function(e,t){e.get("$state").go(t.path()?"404":"home")}),e.state("home",{url:"/",templateUrl:"/old_assets/features/home/home.html",onEnter:["MY_CONFIG","myAuth","$state","myLoadingService","$rootScope","MYAUTH_EVENT",function(e,t,a,n,r,s){e.securityEnabled?t.isAuthenticated()?r.$broadcast(s.loginSuccess):a.go("login"):t.login({username:"admin"}).then(function(){n.showLoadingIcon(),a.go("overview")})}]}).state("ns",{url:"/ns/:namespace","abstract":!0,template:"<ui-view/>",data:{authorizedRoles:n.all,highlightTab:"development"},resolve:{rNsList:["myNamespace",function(e){return e.getList()}]},controller:"HomeController"}).state("404",{templateUrl:"/old_assets/features/home/404.html"}).state("unauthorized",{templateUrl:"/old_assets/features/home/unauthorized-namespace.html"})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("hydratorplusplus",{url:"/metadata","abstract":!0,parent:"ns",data:{authorizedRoles:a.all,highlightTab:"hydratorList"},template:"<ui-view/>"}).state("hydratorplusplus.create",{url:"/studio?artifactType&draftId",params:{data:null,isClone:null},data:{authorizedRoles:a.all,highlightTab:"hydratorStudioPlusPlus"},resolve:{rConfig:["$stateParams","mySettings","$q","myHelpers",function(e,t,a,n){var r=a.defer();return e.draftId?t.get("hydratorDrafts",!0).then(function(t){var a=n.objectQuery(t,e.namespace,e.draftId);angular.isObject(a)?r.resolve(a):r.resolve(!1)}):e.data?r.resolve(e.data):r.resolve(!1),r.promise}],rSelectedArtifact:["$stateParams","$q","myPipelineApi","myAlertOnValium","$state","GLOBALS","$rootScope",function(e,t,a,n,r,s,i){var o=t.defer(),l=[s.etlBatch,s.etlRealtime,s.etlDataPipeline,s.etlDataStreams],c=function(e,t){return e.filter(function(e){return e.name===t&&e.version===i.cdapVersion}).length},u=function(e){return e.filter(function(e){return e.version===i.cdapVersion}).filter(function(e){return-1!==l.indexOf(e.name)})},p=function(e){var t=u(e);return t.length?t[0]:!1},d=function(e){e="string"==typeof e?e:s.en.hydrator.studio.error["MISSING-SYSTEM-ARTIFACTS"],n.show({type:"danger",content:e})};return a.fetchArtifacts({namespace:e.namespace}).$promise.then(function(t){var a=function(){return r.current.name.length?void r.go(r.current).then(d):void r.go("hydratorplusplus.list").then(d)},n=function(){if(c(t,s.etlDataPipeline))e.artifactType=s.etlDataPipeline,o.resolve(e.artifactType);else{if(!u(t).length)return a();e.artifactType=p(t).name,o.resolve(e.artifactType)}};return t.length?void(c(t,e.artifactType)?o.resolve(e.artifactType):n()):a()},function(e){d(e)}),o.promise}],rArtifacts:["myPipelineApi","$stateParams","$q","HydratorPlusPlusOrderingFactory","GLOBALS","$rootScope",function(e,t,a,n,r,s){var i=a.defer();return e.fetchArtifacts({namespace:t.namespace}).$promise.then(function(e){e.length&&!function(){var t=[r.etlBatch,r.etlRealtime,r.etlDataPipeline,r.etlDataStreams],a=e.filter(function(e){return e.version===s.cdapVersion}).filter(function(e){return-1!==t.indexOf(e.name)});a=a.map(function(e){return e.label=n.getArtifactDisplayName(e.name),e}),i.resolve(a)}()}),i.promise}],rVersion:["$state","MyCDAPDataSource",function(e,t){var a=new t;return a.request({_cdapPath:"/version"})}]},views:{"":{templateUrl:"/old_assets/features/hydratorplusplus/templates/create/studio.html",controller:"HydratorPlusPlusStudioCtrl as HydratorPlusPlusStudioCtrl"},"canvas@hydratorplusplus.create":{templateUrl:"/old_assets/features/hydratorplusplus/templates/create/canvas.html",controller:"HydratorPlusPlusCreateCanvasCtrl",controllerAs:"CanvasCtrl"},"leftpanel@hydratorplusplus.create":{templateUrl:"/old_assets/features/hydratorplusplus/templates/create/leftpanel.html",controller:"HydratorPlusPlusLeftPanelCtrl as HydratorPlusPlusLeftPanelCtrl"},"toppanel@hydratorplusplus.create":{templateUrl:"/old_assets/features/hydratorplusplus/templates/create/toppanel.html",controller:"HydratorPlusPlusTopPanelCtrl as HydratorPlusPlusTopPanelCtrl"}},onExit:["$uibModalStack",function(e){e.dismissAll()}]}).state("hydratorplusplus.detail",{url:"/view/:pipelineId",data:{authorizedRoles:a.all,highlightTab:"hydratorList"},resolve:{rPipelineDetail:["$stateParams","$q","myPipelineApi","myAlertOnValium","$state",function(e,t,a,n,r){var s={namespace:e.namespace,pipeline:e.pipelineId};return a.get(s).$promise.then(function(e){var a=e.configuration;try{a=JSON.parse(a)}catch(s){return n.show({type:"danger",content:"Invalid configuration JSON."}),t.reject(!1),void r.go("hydratorplusplus.list")}return a.stages?t.resolve(e):(n.show({type:"danger",content:"Pipeline is created using older version of hydrator. Please upgrage the pipeline to newer version(3.4) to view in UI."}),t.reject(!1),void r.go("hydratorplusplus.list"))})}]},ncyBreadcrumb:{parent:"apps.list",label:"{{$state.params.pipelineId}}"},views:{"":{templateUrl:"/old_assets/features/hydratorplusplus/templates/detail.html",controller:"HydratorPlusPlusDetailCtrl"},"toppanel@hydratorplusplus.detail":{templateUrl:"/old_assets/features/hydratorplusplus/templates/detail/top-panel.html",controller:"HydratorDetailTopPanelController",controllerAs:"TopPanelCtrl"},"canvas@hydratorplusplus.detail":{templateUrl:"/old_assets/features/hydratorplusplus/templates/detail/canvas.html",controller:"HydratorPlusPlusDetailCanvasCtrl",controllerAs:"CanvasCtrl"}},onExit:["$uibModalStack",function(e){e.dismissAll()}]}).state("hydratorplusplus.list",{url:"?page",data:{authorizedRoles:a.all,highlightTab:"hydratorList"},templateUrl:"/old_assets/features/hydratorplusplus/templates/list.html",controller:"HydratorPlusPlusListController",controllerAs:"ListController"})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.login").controller("LoginCtrl",["$scope","myAuth","myAlert","$state","cfpLoadingBar","$timeout","MYAUTH_EVENT","MY_CONFIG","caskFocusManager","myLoadingService",function(e,t,a,n,r,s,i,o,l,c){function u(){s(function(){l.select(e.credentials.username?"password":"username")},10)}e.credentials=t.remembered(),e.submitting=!1,e.isAuthenticated=o.securityEnabled||t.isAuthenticated(),e.doLogin=function(a){e.submitting=!0,c.showLoadingIcon(),r.start(),t.login(a)["finally"](function(){e.submitting=!1,c.hideLoadingIcon(),r.complete()})},e.$on("$viewContentLoaded",function(){o.securityEnabled&&u()}),e.$on(i.loginFailed,function(t,a){u(),e.error=401===a.statusCode?"Login failed. Invalid username or password":a.data})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.login").config(["$stateProvider",function(e){e.state("login",{url:"/login?next&nextParams",templateUrl:"/old_assets/features/login/login.html",controller:"LoginCtrl",onEnter:["MY_CONFIG","myLoadingService","myAuth","$rootScope","MYAUTH_EVENT",function(e,t,a,n,r){e.securityEnabled?a.isAuthenticated()&&n.$broadcast(r.loginSuccess):t.showLoadingIcon().then(function(){return a.login({username:"admin"})}).then(function(){t.hideLoadingIcon()})}]})}]).run(["$rootScope","$state","$location","MYAUTH_EVENT","myNamespace","$q","myHelpers","myAlert",function(e,t,a,n,r,s,i,o){e.$on(n.loginSuccess,function(){var a=s.defer();r.getList().then(function(){return a.resolve(),a.promise},function(e){return a.reject(e),a.promise}).then(function(){var e=t.is("login")&&t.params.next,a=t.params.nextParams;if(o.clear(),e){console.log("After login, will redirect to:",e);var n;try{n=JSON.parse(decodeURIComponent(a))}catch(r){console.warn("Unable to decode next state after login. Going to overview",r),t.go("overview")}t.go(e,n)}else t.go("overview")},function(a){i.objectQuery(a,"data","auth_uri")&&(e.$broadcast(n.sessionTimeout),t.go("login"))})})}]).run(["$rootScope","$state","myAlertOnValium","MYAUTH_EVENT","MY_CONFIG","myAlert","myAuth",function(e,t,a,n,r,s,i){e.$on(n.logoutSuccess,function(){t.go("login")}),e.$on(n.sessionTimeout,function(){a.show({type:"danger",title:"Session Timeout",message:"Your current session has timed out. Please login again."}),i.logout()})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.mapreduce").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("mapreduce",{url:"/mapreduce/:programId","abstract":!0,parent:"programs",data:{authorizedRoles:a.all,highlightTab:"development"},resolve:{rRuns:["$stateParams","$q","myMapreduceApi","$state",function(e,t,a,n){var r=t.defer(),s={namespace:e.namespace,appId:e.appId,mapreduceId:e.programId};return a.runs(s).$promise.then(function(e){r.resolve(e)},function(){r.reject(),n.go("404")}),r.promise}],rMapreduceDetail:["$stateParams","myMapreduceApi","$q","$state",function(e,t,a,n){var r={namespace:e.namespace,appId:e.appId,mapreduceId:e.programId},s=a.defer();return t.get(r).$promise.then(function(e){s.resolve(e)},function(){s.reject(),n.go("404")}),s.promise}]},template:"<ui-view/>"}).state("mapreduce.detail",{url:"/runs",templateUrl:"/old_assets/features/mapreduce/templates/detail.html",controller:"MapreduceRunsController",controllerAs:"RunsController",data:{authorizedRoles:a.all,highlightTab:"development"},ncyBreadcrumb:{parent:"apps.detail.overview.programs",label:"{{$state.params.programId}}"}}).state("mapreduce.detail.run",{url:"/:runid?sourceId&sourceRunId&destinationType",templateUrl:"/old_assets/features/mapreduce/templates/tabs/runs/run-detail.html",controller:"MapreduceRunsDetailController",controllerAs:"RunsDetailController",ncyBreadcrumb:{label:"{{$state.params.runid}}",parent:"mapreduce.detail"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.dashboard").controller("OpsCdapCtrl",["$scope","opshelper",function(e,t){var a=[["Router Requests","",["system.request.received","system.response.client-error","system.response.successful"],"c3-scatter",{sizeX:4,sizeY:2,row:0,col:0}],["Dataset Service","component.dataset~service",["system.request.received","system.response.client-error","system.response.successful"],"c3-scatter",{sizeX:2,sizeY:2,row:0,col:4}],["Transaction Commits","",["system.canCommit","system.commit","system.start.long","system.start.short"],"c3-area-spline",{sizeX:2,sizeY:1,row:2,col:0}],["Transaction Latency","",["system.commit.latency","system.start.short.latency"],"c3-area-spline",{sizeX:2,sizeY:1,row:2,col:2}],["System Errors and Warnings","",["system.services.log.error","system.services.log.warn"],"c3-area-step",{sizeX:2,sizeY:1,row:2,col:4}],["Explore Service","component.explore~service",["system.request.received","system.response.successful"],"c3-area-spline",{sizeX:2,sizeY:1,row:3,col:0}],["Events Processed","namespace.*",["system.process.events.processed"],"c3-line",{sizeX:4,sizeY:1,row:3,col:2}],["Bytes Stored","namespace.*",["system.dataset.store.bytes"],"c3-line",{sizeX:2,sizeY:1,row:4,col:0}],["Dataset Reads and Writes","namespace.*",["system.dataset.store.reads","system.dataset.store.writes"],"c3-area-spline",{sizeX:2,sizeY:1,row:4,col:2}],["Containers Used","namespace.*",["system.resources.used.containers","system.process.instance"],"c3-area-step",{sizeX:2,sizeY:1,row:4,col:4}]];e.currentBoard=t.createBoardFromPanels(a),e.gridsterOpts={rowHeight:"280",columns:6,minSizeX:2,mobileBreakPoint:800,swapping:!0,resizable:{enabled:!0,stop:function(e,t,a){var n=parseInt(t[0].style.height,10),r=parseInt(t[0].style.width,10);a.height=300>n?200:n-70,a.width=450>r?370:r-32}}},angular.forEach(e.currentBoard.columns,function(e){t.startPolling(e)}),e.$on("$destroy",function(){angular.forEach(e.currentBoard.columns,function(e){t.stopPolling(e)})})}]).controller("OpsAppsCtrl",["$scope","$state","myHelpers","MyCDAPDataSource",function(e,t,a,n){function r(t){angular.forEach(e.apps,function(e){angular.forEach(t.series,function(t){e.id===t.grouping.app&&a.deepSet(e,"metric."+t.metricName.split(".").pop(),t.data[0].value)})})}var s=new n(e);e.apps=[],s.request({_cdapNsPath:"/apps"},function(t){e.apps=t;for(var a=["vcores","containers","memory"],n=0;n<a.length;n++)s.poll({_cdapPath:"/metrics/query?tag=namespace:system&metric=system.resources.used."+a[n]+"&groupBy=app",method:"POST"},r)})}]).factory("opshelper",["Widget","MyCDAPDataSource","MyMetricsQueryHelper","MyChartHelpers",function(e,t,a,n){function r(t,a,n,r){return new e({title:t,type:r,settings:{isLive:!0,interval:15e3},metric:{context:a,names:n,startTime:"now-3600s",endTime:"now",resolution:"1m"}})}function s(e){var t=[];return e.forEach(function(e){var a=r(e[0],e[1],e[2],e[3]);angular.extend(a,e[4]),t.push(a)}),{title:"System Metrics",columns:t}}function i(e){e.pollId=l.poll({_cdapPath:"/metrics/query",method:"POST",body:a.constructQuery("qid",a.contextToTags(e.metric.context),e.metric)},function(t){var a=n.processData(t,"qid",e.metric.names,e.metric.resolution,e.settings.aggregate);a=n.c3ifyData(a,e.metric,e.metricAlias);var r={x:"x",columns:a.columns,keys:{x:"x"}};e.formattedData=r}).__pollId__}function o(e){l.stopPoll(e.pollId)}var l=new t;return{createBoardFromPanels:s,startPolling:i,stopPolling:o}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.overview").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("overview",{data:{authorizedRoles:a.all,highlightTab:"development"},parent:"ns",url:"",templateUrl:"/old_assets/features/overview/overview.html",controller:"OverviewCtrl",controllerAs:"OverviewCtrl",ncyBreadcrumb:{skip:!0}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.programs").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("programs",{parent:"apps.detail",url:"/programs",data:{authorizedRoles:a.all,highlightTab:"development"},template:"<ui-view/>","abstract":!0})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.search").config(["$stateProvider",function(e){e.state("search",{parent:"ns",url:"/search","abstract":!0,templateUrl:"/old_assets/features/search/templates/search.html"}).state("search.objectswithtags",{url:"/:tag",templateUrl:"/old_assets/features/search/templates/search-objects-with-tags.html",controller:"SearchObjectWithTagsController",controllerAs:"SearchObjectWithTagsController",ncyBreadcrumb:{label:"Search Results"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.services").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("services",{url:"/services/:programId","abstract":!0,parent:"programs",data:{authorizedRoles:a.all,highlightTab:"development"},resolve:{rRuns:["$stateParams","$q","myServiceApi","$state",function(e,t,a,n){var r=t.defer(),s={namespace:e.namespace,appId:e.appId,serviceId:e.programId};return a.runs(s).$promise.then(function(e){r.resolve(e)},function(){r.reject(),n.go("404")}),r.promise}],rServiceDetail:["$stateParams","myServiceApi","$q","$state",function(e,t,a,n){var r={namespace:e.namespace,appId:e.appId,serviceId:e.programId},s=a.defer();return t.get(r).$promise.then(function(e){s.resolve(e)},function(){s.reject(),n.go("404")}),s.promise}]},template:"<ui-view/>"}).state("services.detail",{url:"/runs",templateUrl:"/old_assets/features/services/templates/detail.html",controller:"ServicesRunsController",controllerAs:"RunsController",ncyBreadcrumb:{parent:"apps.detail.overview.programs",label:"{{$state.params.programId}}"}}).state("services.detail.run",{url:"/:runid",templateUrl:"/old_assets/features/services/templates/tabs/runs/run-detail.html",controller:"ServicesRunsDetailController",controllerAs:"RunsDetailController",ncyBreadcrumb:{label:"{{$state.params.runid}}",parent:"services.detail"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.spark").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("spark",{url:"/spark/:programId","abstract":!0,parent:"programs",data:{authorizedRoles:a.all,highlightTab:"development"},resolve:{rRuns:["$stateParams","$q","mySparkApi","$state",function(e,t,a,n){var r=t.defer(),s={namespace:e.namespace,appId:e.appId,sparkId:e.programId};return a.runs(s).$promise.then(function(e){r.resolve(e)},function(){r.reject(),n.go("404")}),r.promise}],rSparkDetail:["$stateParams","mySparkApi","$q","$state",function(e,t,a,n){var r={namespace:e.namespace,appId:e.appId,sparkId:e.programId},s=a.defer();return t.get(r).$promise.then(function(e){s.resolve(e)},function(){s.reject(),n.go("404")}),s.promise}]},template:"<ui-view/>"}).state("spark.detail",{url:"/runs",templateUrl:"/old_assets/features/spark/templates/detail.html",controller:"SparkRunsController",controllerAs:"RunsController",data:{authorizedRoles:a.all,highlightTab:"development"},ncyBreadcrumb:{parent:"apps.detail.overview.programs",label:"{{$state.params.programId}}"}}).state("spark.detail.run",{url:"/:runid?sourceId&sourceRunId&destinationType",templateUrl:"/old_assets/features/spark/templates/tabs/runs/run-detail.html",controller:"SparkRunDetailController",controllerAs:"RunsDetailController",ncyBreadcrumb:{label:"{{$state.params.runid}}",parent:"spark.detail"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.streams").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("streams",{"abstract":!0,template:"<ui-view/>",url:"/streams",data:{authorizedRoles:a.all,highlightTab:"development"},parent:"ns"}).state("streams.detail",{url:"/:streamId","abstract":!0,template:"<ui-view/>"}).state("streams.detail.overview",{url:"/overview",parent:"streams.detail",resolve:{rStreamData:["$state","$q","myStreamApi","$stateParams",function(e,t,a,n){var r={namespace:n.namespace,streamId:n.streamId},s=t.defer();return a.get(r).$promise.then(function(e){s.resolve(e)},function(){s.reject(),e.go("404")}),s.promise}]},templateUrl:"/old_assets/features/streams/templates/detail.html",controller:"CdapStreamDetailController",controllerAs:"DetailController",ncyBreadcrumb:{parent:"data.list",label:"{{$state.params.streamId}}"}}).state("streams.detail.overview.status",{url:"/status",templateUrl:"/old_assets/features/streams/templates/tabs/status.html",ncyBreadcrumb:{parent:"data.list",label:"{{$state.params.streamId}}"},controller:"StreamDetailStatusController",controllerAs:"StatusController"}).state("streams.detail.overview.explore",{url:"/explore",templateUrl:"/old_assets/features/streams/templates/tabs/explore.html",controller:"StreamExploreController",controllerAs:"ExploreController",ncyBreadcrumb:{label:"Explore",parent:"streams.detail.overview.status"}}).state("streams.detail.overview.programs",{url:"/programs",templateUrl:"/old_assets/features/streams/templates/tabs/programs.html",controller:"StreamProgramsController",controllerAs:"ProgramsController",ncyBreadcrumb:{label:"Programs",parent:"streams.detail.overview.status"}}).state("streams.detail.overview.metadata",{url:"/metadata",templateUrl:"/old_assets/features/streams/templates/tabs/metadata.html",controller:"StreamMetadataController",controllerAs:"MetadataController",ncyBreadcrumb:{label:"Metadata",parent:"streams.detail.overview.status"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.tracker").config(["$stateProvider","MYAUTH_ROLE",function(e,t){e.state("tracker-enable",{url:"/enable-tracker",parent:"ns",templateUrl:"/old_assets/features/tracker/templates/tracker-enable.html",controller:"TrackerEnableController",controllerAs:"EnableController",data:{authorizedRoles:t.all},resolve:{rTrackerApp:["myTrackerApi","$q","$stateParams","$state","UI_CONFIG","myAlertOnValium","$cookies",function(e,t,a,n,r,s,i){var o=t.defer(),l={namespace:a.namespace||i.get("CDAP_Namespace")||"default"};return e.getTrackerApp(l).$promise.then(function(i){if(i.artifact.version!==r.tracker.artifact.version)return void o.resolve(!0);var l={namespace:a.namespace,programType:"services",programId:r.tracker.serviceId},c={namespace:a.namespace,programType:"flows",programId:r.tracker.flowProgramId};t.all([e.trackerProgramStatus(l).$promise,e.trackerProgramStatus(c).$promise]).then(function(e){var t=!0;angular.forEach(e,function(e){"STOPPED"===e.status&&(t=!1)}),t?n.go("tracker.home",a):o.resolve(!0)},function(e){s.show({type:"danger",content:e.data})})},function(){o.resolve(!0)}),o.promise}]}}).state("tracker",{url:"/metadata","abstract":!0,parent:"ns",template:"<ui-view/>",resolve:{rTrackerApp:["myTrackerApi","$q","$stateParams","$state","UI_CONFIG","myAlertOnValium","$cookies",function(e,t,a,n,r,s,i){var o=t.defer(),l={namespace:a.namespace||i.get("CDAP_Namespace")||"default"};return e.getTrackerApp(l).$promise.then(function(i){if(i.artifact.version!==r.tracker.artifact.version)return void n.go("tracker-enable",a);var l={namespace:a.namespace,programType:"services",programId:r.tracker.serviceId},c={namespace:a.namespace,programType:"flows",programId:r.tracker.flowProgramId};t.all([e.trackerProgramStatus(l).$promise,e.trackerProgramStatus(c).$promise]).then(function(e){var t=!0;angular.forEach(e,function(e){"STOPPED"===e.status&&(t=!1)}),t?o.resolve(!0):n.go("tracker-enable",a)},function(e){s.show({type:"danger",content:e.data})})},function(){n.go("tracker-enable",a)}),o.promise}]}}).state("tracker.home",{url:"/home",data:{authorizedRoles:t.all,highlightTab:"search"},templateUrl:"/old_assets/features/tracker/templates/main.html",controller:"TrackerMainController",controllerAs:"MainController"}).state("tracker.integrations",{url:"/integrations",templateUrl:"/old_assets/features/tracker/templates/integrations.html",controller:"TrackerIntegrationsController",controllerAs:"IntegrationsController",data:{authorizedRoles:t.all,highlightTab:"integrations"}}).state("tracker.tags",{url:"/tags",templateUrl:"/old_assets/features/tracker/templates/tags.html",controller:"TrackerTagsController",controllerAs:"TagsController",data:{authorizedRoles:t.all,highlightTab:"tags"}}).state("tracker.detail",{url:"",data:{authorizedRoles:t.all,highlightTab:"search"},templateUrl:"/old_assets/features/tracker/templates/container.html",controller:"TrackerContainerController",controllerAs:"ContainerController"}).state("tracker.detail.result",{url:"/search/:searchQuery/result",templateUrl:"/old_assets/features/tracker/templates/results.html",controller:"TrackerResultsController",controllerAs:"ResultsController",data:{authorizedRoles:t.all,highlightTab:"search"}}).state("tracker.detail.entity",{url:"/entity/:entityType/:entityId?searchTerm",templateUrl:"/old_assets/features/tracker/templates/entity.html",controller:"TrackerEntityController",controllerAs:"EntityController",data:{authorizedRoles:t.all,highlightTab:"search"},resolve:{rDatasetType:["$q","myTrackerApi","$stateParams",function(e,t,a){if("datasets"!==a.entityType)return null;var n=e.defer(),r={namespace:a.namespace,entityType:a.entityType,entityId:a.entityId};return t.getDatasetSystemProperties(r).$promise.then(function(e){n.resolve(e.type)},function(){n.reject()}),n.promise}],rSystemTags:["$q","myTrackerApi","$stateParams",function(e,t,a){if("datasets"!==a.entityType)return null;var n=e.defer(),r={namespace:a.namespace,entityType:a.entityType,entityId:a.entityId};return t.getSystemTags(r).$promise.then(n.resolve,n.reject),n.promise}]}}).state("tracker.detail.entity.metadata",{url:"/metadata",templateUrl:"/old_assets/features/tracker/templates/metadata.html",controller:"TrackerMetadataController",controllerAs:"MetadataController",data:{authorizedRoles:t.all,highlightTab:"search"}}).state("tracker.detail.entity.lineage",{url:"/lineage?start&end&method",templateUrl:"/old_assets/features/tracker/templates/lineage.html",controller:"TrackerLineageController",controllerAs:"LineageController",data:{authorizedRoles:t.all,highlightTab:"search"}}).state("tracker.detail.entity.audit",{url:"/audit?start&end",templateUrl:"/old_assets/features/tracker/templates/audit.html",controller:"TrackerAuditController",controllerAs:"AuditController",data:{authorizedRoles:t.all,highlightTab:"search"}}).state("tracker.detail.entity.usage",{url:"/usage?startTime&endTime",templateUrl:"/old_assets/features/tracker/templates/usage.html",controller:"TrackerUsageController",controllerAs:"UsageController",data:{authorizedRoles:t.all,highlightTab:"search"}}).state("tracker.detail.entity.preview",{url:"/preview",templateUrl:"/old_assets/features/tracker/templates/preview.html",controller:"TrackerPreviewController",controllerAs:"PreviewController",data:{authorizedRoles:t.all,highlightTab:"search"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.userprofile").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("userprofile",{data:{authorizedRoles:a.all,highlightTab:"development"},url:"/profile",templateUrl:"/old_assets/features/userprofile/templates/profile.html",controller:"UserProfileController"})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.worker").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("worker",{url:"/workers/:programId","abstract":!0,parent:"programs",data:{authorizedRoles:a.all,highlightTab:"development"},resolve:{rRuns:["MyCDAPDataSource","$stateParams","$q","$state",function(e,t,a,n){var r=a.defer(),s=new e;return s.request({_cdapPath:"/namespaces/"+t.namespace+"/apps/"+t.appId+"/workers/"+t.programId+"/runs"}).then(function(e){r.resolve(e)},function(){r.reject(),n.go("404")}),r.promise}],rWorkerDetail:["MyCDAPDataSource","$stateParams","$q","$state",function(e,t,a,n){var r=a.defer(),s=new e;
return s.request({_cdapPath:"/namespaces/"+t.namespace+"/apps/"+t.appId+"/workers/"+t.programId}).then(function(e){r.resolve(e)},function(){r.reject(),n.go("404")}),r.promise}]},template:"<ui-view/>"}).state("worker.detail",{url:"/runs",templateUrl:"/old_assets/features/workers/templates/detail.html",controller:"WorkersRunsController",controllerAs:"RunsController",data:{authorizedRoles:a.all,highlightTab:"development"},ncyBreadcrumb:{parent:"apps.detail.overview.programs",label:"{{$state.params.programId}}"}}).state("worker.detail.run",{url:"/:runid",templateUrl:"/old_assets/features/workers/templates/tabs/runs/run-detail.html",controller:"WorkersRunDetailController",controllerAs:"RunsDetailController",ncyBreadcrumb:{label:"{{$state.params.runid}}",parent:"worker.detail"}})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.workflows").config(["$stateProvider","$urlRouterProvider","MYAUTH_ROLE",function(e,t,a){e.state("workflows",{url:"/workflows/:programId","abstract":!0,parent:"programs",data:{authorizedRoles:a.all,highlightTab:"development"},resolve:{rRuns:["MyCDAPDataSource","$stateParams","$q","$state",function(e,t,a,n){var r=a.defer(),s=new e;return s.request({_cdapPath:"/namespaces/"+t.namespace+"/apps/"+t.appId+"/workflows/"+t.programId+"/runs"}).then(function(e){r.resolve(e)},function(){r.reject(),n.go("404")}),r.promise}],rWorkflowDetail:["myWorkFlowApi","$stateParams","$q","$state",function(e,t,a,n){var r={namespace:t.namespace,appId:t.appId,workflowId:t.programId},s=a.defer();return e.get(r).$promise.then(function(e){s.resolve(e)},function(){s.reject(),n.go("404")}),s.promise}]},template:"<ui-view/>"}).state("workflows.detail",{url:"/runs",templateUrl:"/old_assets/features/workflows/templates/detail.html",controller:"WorkflowsRunsController",controllerAs:"RunsController",data:{authorizedRoles:a.all,highlightTab:"development"},ncyBreadcrumb:{parent:"apps.detail.overview.programs",label:"{{$state.params.programId}}"},onExit:["$uibModalStack",function(e){e.dismissAll()}]}).state("workflows.detail.run",{url:"/:runid",templateUrl:"/old_assets/features/workflows/templates/tabs/runs/run-detail.html",controller:"WorkflowsRunsDetailController",controllerAs:"RunsDetailController",ncyBreadcrumb:{label:"{{$state.params.runid}}",parent:"workflows.detail"},onExit:["$uibModalStack",function(e){e.dismissAll()}]})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t,a,n,r){"ngInject";function s(t){if(!t||"array"===t)return i.items={displayType:"string",type:"string",nullable:!1,nested:!1},void i.formatOutput();var a=e.parse(t,{wrapUnions:!0}),n=a.getItemsType();i.items=r.parseType(n),i.formatOutput()}var i=this;i.SCHEMA_TYPES=t.types,i.items={};var o=void 0;i.changeType=function(){-1!==t.simpleTypes.indexOf(i.items.displayType)?(i.items.type=i.items.displayType,i.formatOutput()):i.items.type=null,i.items.nested=r.checkComplexType(i.items.displayType)},i.formatOutput=function(){i.error="";var t={type:"array",items:i.items.nullable?[i.items.type,"null"]:i.items.type};try{e.parse(t)}catch(n){var r=""+n;return r=r.split(":"),void(i.error=r[0]+": "+r[1])}i.model=t,"function"==typeof i.parentFormatOutput&&(o=a(i.parentFormatOutput))},s(i.model),n.$on("$destroy",function(){a.cancel(o)})}t.$inject=["avsc","SCHEMA_TYPES","$timeout","$scope","SchemaHelper"],angular.module(e.name+".commons").directive("myArraySchema",function(){return{restrict:"E",templateUrl:"complex-schema/array-schema/array-schema.html",controller:t,controllerAs:"ArraySchema",bindToController:!0,scope:{model:"=ngModel",parentFormatOutput:"&",isDisabled:"="}}}).directive("myArraySchemaWrapper",["$compile",function(e){return{restrict:"E",replace:!0,scope:{model:"=ngModel",parentFormatOutput:"&",isDisabled:"="},link:function(t,a){var n='<my-array-schema\n                          ng-model="model"\n                          parent-format-output="parentFormatOutput()"\n                          is-disabled="isDisabled">\n                        </my-array-schema>';e(n)(t,function(e){a.append(e)})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myEmbeddedSchemaSelector",function(){return{restrict:"E",templateUrl:"complex-schema/embedded-schema-selector/embedded-schema-selector.html",scope:{type:"=",displayType:"=",parentFormatOutput:"&",isDisabled:"="},bindToController:!0,controller:["SchemaHelper",function(e){var t=this;t.checkComplexType=e.checkComplexType,t.expanded=!0}],controllerAs:"Embedded"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t,a,n){"ngInject";function r(t){if(!t||"enum"===t)return s.addSymbol(),void s.formatOutput();var a=e.parse(t,{wrapUnions:!0});s.symbols=a.getSymbols().map(function(e){return{name:e,id:n.v4()}}),s.formatOutput()}var s=this;s.symbols=[];var i=void 0,o=void 0;s.addSymbol=function(e){var a=void 0===e?0:e+1,r={name:"",id:n.v4()};s.symbols.splice(a,0,r),t.cancel(o),o=t(function(){var e=document.getElementById(r.id);angular.element(e)[0].focus()})},s.removeSymbol=function(e){s.symbols.splice(e,1),0===s.symbols.length&&s.addSymbol(),s.formatOutput()},s.formatOutput=function(){s.error="";var a=s.symbols.filter(function(e){return e.name?!0:!1}).map(function(e){return e.name});if(0===a.length)return void(s.model="");var n={type:"enum",symbols:a};try{e.parse(n)}catch(r){return void(s.error=""+r)}s.model=n,"function"==typeof s.parentFormatOutput&&(i=t(s.parentFormatOutput))},r(s.model),a.$on("$destroy",function(){t.cancel(i),t.cancel(o)})}t.$inject=["avsc","$timeout","$scope","uuid"],angular.module(e.name+".commons").directive("myEnumSchema",function(){return{restrict:"E",templateUrl:"complex-schema/enum-schema/enum-schema.html",controller:t,controllerAs:"EnumSchema",bindToController:!0,scope:{model:"=ngModel",parentFormatOutput:"&",isDisabled:"="}}}).directive("myEnumSchemaWrapper",["$compile",function(e){return{restrict:"E",replace:!0,scope:{model:"=ngModel",parentFormatOutput:"&",isDisabled:"="},link:function(t,a){var n='<my-enum-schema\n                          ng-model="model"\n                          parent-format-output="parentFormatOutput()"\n                          is-disabled="isDisabled">\n                        </my-enum-schema>';e(n)(t,function(e){a.append(e)})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t,a,n,r){"ngInject";function s(t){if(!t||"map"===t)return i.fields.keys={type:"string",displayType:"string",nullable:!1,nested:!1},i.fields.values={type:"string",displayType:"string",nullable:!1,nested:!1},void i.formatOutput();var n=e.parse(t,{wrapUnions:!0});i.fields.keys=a.parseType(n.getKeysType()),i.fields.values=a.parseType(n.getValuesType()),i.formatOutput()}var i=this,o=void 0;i.SCHEMA_TYPES=t.types,i.fields={keys:null,values:null},i.changeType=function(e){-1!==t.simpleTypes.indexOf(e.displayType)?(e.type=e.displayType,i.formatOutput()):e.type=null,e.nested=a.checkComplexType(e.displayType)},i.formatOutput=function(){i.error="";var t={type:"map",keys:i.fields.keys.nullable?[i.fields.keys.type,"null"]:i.fields.keys.type,values:i.fields.values.nullable?[i.fields.values.type,"null"]:i.fields.values.type};try{e.parse(t)}catch(a){var n=""+a;return n=n.split(":"),void(i.error=n[0]+": "+n[1])}i.model=t,"function"==typeof i.parentFormatOutput&&(o=r(i.parentFormatOutput))},s(i.model),n.$on("$destroy",function(){r.cancel(o)})}t.$inject=["avsc","SCHEMA_TYPES","SchemaHelper","$scope","$timeout"],angular.module(e.name+".commons").directive("myMapSchema",function(){return{restrict:"E",templateUrl:"complex-schema/map-schema/map-schema.html",controller:t,controllerAs:"MapSchema",bindToController:!0,scope:{model:"=ngModel",parentFormatOutput:"&",isDisabled:"="}}}).directive("myMapSchemaWrapper",["$compile",function(e){return{restrict:"E",replace:!0,scope:{model:"=ngModel",parentFormatOutput:"&",isDisabled:"="},link:function(t,a){var n='<my-map-schema\n                          ng-model="model"\n                          parent-format-output="parentFormatOutput()"\n                          is-disabled="isDisabled">\n                        </my-map-schema>';e(n)(t,function(e){a.append(e)})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t,a,n,r){"ngInject";function s(t){if(!t||"union"===t)return i.addType(),void i.formatOutput();var n=e.parse(t,{wrapUnions:!0});i.types=n.getTypes().map(a.parseType),i.formatOutput()}var i=this;i.SCHEMA_TYPES=t.types;var o=void 0;i.types=[],i.addType=function(e){var t=void 0===e?0:e+1;i.types.splice(t,0,{type:"string",displayType:"string",nullable:!1,nested:!1}),i.formatOutput()},i.removeType=function(e){i.types.splice(e,1),0===i.types.length&&i.addType(),i.formatOutput()},i.changeType=function(e){-1!==t.simpleTypes.indexOf(e.displayType)?(e.type=e.displayType,i.formatOutput()):e.type=null,e.nested=a.checkComplexType(e.displayType)},i.formatOutput=function(){i.error="";var t=i.types.map(function(e){return e.nullable?[e.type,"null"]:e.type});if(0===t.length)return void(i.model="");try{e.parse(t)}catch(a){var n=""+a;return n=n.split(":"),void(i.error=n[0]+": "+n[1])}i.model=t,"function"==typeof i.parentFormatOutput&&(o=r(i.parentFormatOutput))},s(i.model),n.$on("$destroy",function(){r.cancel(o)})}t.$inject=["avsc","SCHEMA_TYPES","SchemaHelper","$scope","$timeout"],angular.module(e.name+".commons").directive("myUnionSchema",function(){return{restrict:"E",templateUrl:"complex-schema/union-schema/union-schema.html",controller:t,controllerAs:"UnionSchema",bindToController:!0,scope:{model:"=ngModel",parentFormatOutput:"&",isDisabled:"="}}}).directive("myUnionSchemaWrapper",["$compile",function(e){return{restrict:"E",replace:!0,scope:{model:"=ngModel",parentFormatOutput:"&",isDisabled:"="},link:function(t,a){var n='<my-union-schema\n                          ng-model="model"\n                          parent-format-output="parentFormatOutput()"\n                          is-disabled="isDisabled">\n                        </my-union-schema>';e(n)(t,function(e){a.append(e)})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n){var r=this;if(_classCallCheck(this,e),this.GLOBALS=t,this.isDistributed=n.isEnterprise?!0:!1,this._isDisabled="true"===this.isDisabled,this.templateType=this.store.getArtifact().name,this.scheduleWidget={type:"basic"},this.initialCron=this.store.getSchedule(),this.cron=this.initialCron,this.checkCron(this.initialCron)||(this.scheduleWidget.type="advanced"),this.engine=this.store.getEngine(),!this._isDisabled){var s=_.debounce(function(){return r.actionCreator.setSchedule(r.cron)},1e3),i=a.$watch("MyBatchPipelineSettingsCtrl.cron",s);a.$on("$destroy",i)}}return e.$inject=["GLOBALS","$scope","MY_CONFIG"],_createClass(e,[{key:"checkCron",value:function(e){for(var t=/^[0-9\*\s]*$/g,a=e.split(""),n=0;n<a.length;n++)if(!a[n].match(t))return!1;return!0}},{key:"onEngineChange",value:function(){this.actionCreator.setEngine(this.engine)}},{key:"changeScheduler",value:function(){this.initialCron=this.store.getDefaultSchedule(),this.cron=this.initialCron}}]),e}();t.$inject=["GLOBALS","$scope","MY_CONFIG"],angular.module(e.name+".commons").controller("MyBatchPipelineSettingsCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myBatchPipelineSettings",function(){return{restrict:"E",scope:{store:"=",actionCreator:"=",isDisabled:"@"},bindToController:!0,templateUrl:"my-pipeline-settings/my-batch-pipeline-settings/my-batch-pipeline-settings.html",controller:"MyBatchPipelineSettingsCtrl",controllerAs:"MyBatchPipelineSettingsCtrl"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("MyDataStreamsPipelineSettingsCtrl",["$scope","MY_CONFIG",function(e,t){var a=this;if(this.batchInterval=this.store.getBatchInterval(),this.isDistributed=t.isEnterprise?!0:!1,this._isDisabled="true"===this.isDisabled,!this._isDisabled){var n=_.debounce(function(){a.actionCreator.setBatchInterval(a.batchInterval)},1e3),r=e.$watch("MyDataStreamsPipelineSettingsCtrl.batchInterval",n);e.$on("$destroy",r)}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myDatastreamsPipelineSettings",function(){return{restrict:"E",scope:{store:"=",actionCreator:"=",isDisabled:"@"},bindToController:!0,templateUrl:"my-pipeline-settings/my-datastreams-pipeline-settings/my-datastreams-pipeline-settings.html",controller:"MyDataStreamsPipelineSettingsCtrl",controllerAs:"MyDataStreamsPipelineSettingsCtrl"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("MyRealtimePipelineSettingsCtrl",["$scope",function(e){var t=this;if(this.instance=this.store.getInstance(),this._isDisabled="true"===this.isDisabled,!this._isDisabled){var a=_.debounce(function(){t.actionCreator.setInstance(t.instance)},1e3),n=e.$watch("MyRealtimePipelineSettingsCtrl.instance",a);e.$on("$destroy",n)}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myRealtimePipelineSettings",function(){return{restrict:"E",scope:{store:"=",actionCreator:"=",isDisabled:"@"},bindToController:!0,controller:"MyRealtimePipelineSettingsCtrl",controllerAs:"MyRealtimePipelineSettingsCtrl",templateUrl:"my-pipeline-settings/my-realtime-pipeline-settings/my-realtime-pipeline-settings.html"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r){var s=this;_classCallCheck(this,e),this.$state=t,this._isDisabled="true"===this.isDisabled,this.myPipelineApi=a,this.HydratorPlusPlusPluginConfigFactory=n,this.showLoadingIcon=!0,this.action.properties=this.action.properties||{},this.requiredPropertyError=r.en.hydrator.studio.error["GENERIC-MISSING-REQUIRED-FIELDS"],this.action&&!Object.keys(this.action._backendProperties||{}).length?this.pluginFetch(this.action).then(function(){return s.showLoadingIcon=!1}):this.fetchWidgets(this.action)}return e.$inject=["$state","myPipelineApi","HydratorPlusPlusPluginConfigFactory","GLOBALS"],_createClass(e,[{key:"pluginFetch",value:function(e){var t=this,a=e.defaultArtifact,n=a.name,r=a.version,s=a.scope;this.errorInConfig=!1;var i={namespace:this.$state.params.namespace,pipelineType:n,version:r,scope:s,extensionType:e.type,pluginName:e.name};return this.loadingPlugin=!0,this.myPipelineApi.fetchPostActionProperties(i).$promise.then(function(a){t.action._backendProperties=a[0].properties,t.fetchWidgets(e)})}},{key:"fetchWidgets",value:function(e){var t=this,a=e.defaultArtifact,n=a.name,r=a.version,s=a.scope,i={name:n,version:r,scope:s,key:"widgets."+e.name+"-"+e.type};return this.HydratorPlusPlusPluginConfigFactory.fetchWidgetJson(i.name,i.version,i.scope,i.key).then(function(e){t.noConfig=!1,t.groupsConfig=t.HydratorPlusPlusPluginConfigFactory.generateNodeConfig(t.action._backendProperties,e),angular.forEach(t.groupsConfig.groups,function(e){angular.forEach(e.fields,function(e){e.defaultValue&&(t.action.properties[e.name]=t.action.properties[e.name]||e.defaultValue)})}),t.loadingPlugin=!1},function(){t.loadingPlugin=!1,t.noConfig=!0})}},{key:"addAction",value:function(e){var t=this.onActionConfigure();"undefined"!=typeof t&&t.call(null,e?null:this.action)}},{key:"gotoPreviousStep",value:function(){var e=this.onGotoPreviousStep();"undefined"!=typeof e&&e.call(null)}},{key:"isValid",value:function(){this.errorInConfig=!1;var e=function(e){var t=!0;return angular.forEach(e._backendProperties,function(a,n){a.required&&!e.properties[n]&&(t=!1)}),t};return e(this.action)?!0:(this.errorInConfig=!0,!1)}},{key:"onItemClicked",value:function(e,t){e.stopPropagation(),e.preventDefault(),this.action=t,this.addAction()}}]),e}();t.$inject=["$state","myPipelineApi","HydratorPlusPlusPluginConfigFactory","GLOBALS"],angular.module(e.name+".commons").controller("WizardConfigureConfirmStepCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("wizardConfigureConfirmStep",function(){return{restrict:"E",scope:{action:"=",isDisabled:"@",mode:"@",onActionConfigure:"&",onGotoPreviousStep:"&"},templateUrl:"my-post-run-action-wizard/wizard-configure-confirm-step/wizard-configure-confirm-step.html",controller:"WizardConfigureConfirmStepCtrl",controllerAs:"WizardConfigureConfirmStepCtrl",bindToController:!0}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s){var i=this;_classCallCheck(this,e);var o=this.store.getArtifact();this.postActionsList=[],this.$scope=t,this.onItemClicked=function(e,t){this.chooseAction(t)},this.loadingPlugins=!0;var l={namespace:a.params.namespace,pipelineType:o.name,version:o.version,extensionType:"postaction"};n.fetchPlugins(l).$promise.then(function(e){var t=i.filterPlugins(e);i.postActionsList=Object.keys(t).map(function(e){return Object.assign({},t[e],{template:"/old_assets/features/hydratorplusplus/templates/create/popovers/leftpanel-plugin-popover.html",label:r.objectQuery(s.pluginTypes,"post-run-actions",t[e].name.toLowerCase())||t[e].name,description:t[e].description||""})}),i.loadingPlugins=!1},function(e){i.loadingPlugins=!1,console.log("ERROR: ",e)})}return e.$inject=["$scope","$state","myPipelineApi","myHelpers","GLOBALS"],_createClass(e,[{key:"chooseAction",value:function(e){var t=this.onActionSelect();"undefined"!=typeof t&&t.call(null,e)}},{key:"filterPlugins",value:function(e){var t={};return angular.forEach(e,function(e){t[e.name]||(t[e.name]=Object.assign({},e,{defaultArtifact:e.artifact,allArtifacts:[]})),t[e.name].allArtifacts.push(e)}),t}}]),e}();t.$inject=["$scope","$state","myPipelineApi","myHelpers","GLOBALS"],angular.module(e.name+".commons").controller("WizardSelectActionStepCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("wizardSelectActionStep",function(){return{restrict:"E",scope:{store:"=",onActionSelect:"&"},templateUrl:"my-post-run-action-wizard/wizard-select-action-step/wizard-select-action-step.html",controller:"WizardSelectActionStepCtrl",controllerAs:"WizardSelectActionStepCtrl",bindToController:!0}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){_classCallCheck(this,e),this.state={},this.setDefaults(),this.changeListeners=[];var a=t.getDispatcher();a.register("onInit",this.initStore.bind(this)),a.register("onSaveSuccessfull",this.setIsSaveSuccessfull.bind(this)),a.register("onCloseCommand",this.setIsCloseCommand.bind(this)),a.register("onReset",this.setDefaults.bind(this))}return e.$inject=["PluginTemplatesDirDispatcher"],_createClass(e,[{key:"setDefaults",value:function(){this.state={templateType:null,pluginType:null,pluginName:null,mode:null,isSaveSuccessful:null},this.changeListeners=[]}},{key:"initStore",value:function(e){this.state.pluginType=e.pluginType,this.state.templateType=e.templateType,this.state.templateName=e.templateName,this.state.pluginName=e.pluginName,this.state.mode=e.mode,this.emitChange()}},{key:"getPluginType",value:function(){return this.state.pluginType}},{key:"getTemplateType",value:function(){return this.state.templateType}},{key:"getPluginName",value:function(){return this.state.pluginName}},{key:"setPluginName",value:function(e){this.state.pluginName=e}},{key:"getTemplateName",value:function(){return this.state.templateName}},{key:"setTemplateName",value:function(e){this.state.templateName=e}},{key:"getMode",value:function(){return this.state.mode}},{key:"setMode",value:function(e){this.state.mode=e}},{key:"getIsSaveSuccessfull",value:function(){return this.state.isSaveSuccessful}},{key:"setIsSaveSuccessfull",value:function(){this.state.isSaveSuccessful=!0,this.emitChange()}},{key:"getIsCloseCommand",value:function(){return this.state.isCloseCommand}},{key:"setIsCloseCommand",value:function(e){this.state.isCloseCommand=e,this.emitChange()}},{key:"registerOnChangeListener",value:function(e){this.changeListeners.push(e)}},{key:"emitChange",value:function(){this.changeListeners.forEach(function(e){return e()})}}]),e}();t.$inject=["PluginTemplatesDirDispatcher"],angular.module(e.name+".commons").service("PluginTemplatesDirStore",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){_classCallCheck(this,e),this.pluginTemplatesDirDispatcher=t.getDispatcher()}return e.$inject=["PluginTemplatesDirDispatcher"],_createClass(e,[{key:"init",value:function(e){this.pluginTemplatesDirDispatcher.dispatch("onInit",e)}},{key:"reset",value:function(){this.pluginTemplatesDirDispatcher.dispatch("onReset")}},{key:"triggerSave",value:function(){this.pluginTemplatesDirDispatcher.dispatch("onSaveTriggered")}},{key:"cancelTriggerSave",value:function(){this.pluginTemplatesDirDispatcher.dispatch("onSaveTriggerCancel")}},{key:"templateSavedSuccesfully",value:function(){this.pluginTemplatesDirDispatcher.dispatch("onSaveSuccessfull")}},{key:"templateClose",value:function(e){this.pluginTemplatesDirDispatcher.dispatch("onCloseCommand",e)}},{key:"templateSaveFailed",value:function(e){this.pluginTemplatesDirDispatcher.dispatch("onSaveFailure",e)}}]),e}();t.$inject=["PluginTemplatesDirDispatcher"],angular.module(e.name+".commons").service("PluginTemplatesDirActions",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){_classCallCheck(this,e),this.__dispatcher__=null,this.baseDispatcher=t}return e.$inject=["CaskAngularDispatcher"],_createClass(e,[{key:"getDispatcher",value:function(){return this.__dispatcher__||(this.__dispatcher__=new this.baseDispatcher),this.__dispatcher__}},{key:"destroyDispatcher",value:function(){delete this.__dispatcher__}}]),e}();t.$inject=["CaskAngularDispatcher"],angular.module(e.name+".commons").service("PluginTemplatesDirDispatcher",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t,a,n,r,s,i){"ngInject";function o(){var e=p.pluginProperties[h],t=Object.keys(i);return-1===t.indexOf(e)?void(p.implicitSchemaPresent=!1):(p.clearDOM=!0,p.implicitSchemaPresent=!0,p.schemaObj=i[e],void c())}function l(){if(p.url&&URL.revokeObjectURL(p.url),!p.model)return void(p.error="Cannot export empty schema");var e;try{e=JSON.parse(p.model)}catch(t){console.log("ERROR: ",t),e={fields:[]}}e=e.fields,"Stream"===p.pluginName&&(e=p.schemaPrefix.fields.concat(e));var n=new Blob([JSON.stringify(e,null,4)],{type:"application/json"});p.url=URL.createObjectURL(n),p.exportFileName="schema",a.cancel(d),d=a(function(){document.getElementById("schema-export-link").click()})}function c(){p.clearDOM=!0,a.cancel(m),a.cancel(f),m=a(function(){f=a(function(){p.clearDOM=!1},500)})}function u(e){e.fields&&0===e.fields.length||"ts"===e.fields[0].name&&"headers"===e.fields[1].name&&(e.fields=e.fields.slice(2))}var p=this,d=void 0,m=void 0,f=void 0;p.schemaObj=p.model,p.clearDOM=!1,p.implicitSchemaPresent=!1;var h=s.objectQuery(p.config,"property-watch")||s.objectQuery(p.config,"widget-attributes","property-watch");"Stream"===p.pluginName&&(p.schemaPrefix={name:"schemaPrefix",type:"record",fields:[{name:"ts",type:"long"},{name:"headers",type:{type:"map",keys:"string",values:"string"}}]}),h&&e.$watch(function(){return p.pluginProperties[h]},o),p.formatOutput=function(){p.error="","string"!=typeof p.schemaObj?p.model=JSON.stringify(p.schemaObj):p.model=p.schemaObj},t.on("dataset.selected",function(e,t){h&&t&&(p.pluginProperties[h]=t),p.schemaObj=e,c()}),t.on("schema.export",l),t.on("schema.clear",function(){p.schemaObj="",c()}),t.on("schema.import",function(e){p.clearDOM=!0;var t=void 0;try{if(t=JSON.parse(e),Array.isArray(t)){var a={name:"etlSchemaBody",type:"record",fields:t};t=a}else if("record"!==t.type)return n.show({type:"danger",content:"Imported schema is not a valid Avro schema"}),void(p.clearDOM=!1);"Stream"===p.pluginName&&u(t),p.schemaObj=r.parse(t,{wrapUnions:!0})}catch(s){return n.show({type:"danger",content:"Imported schema is not a valid Avro schema: "+s}),void(p.clearDOM=!1)}c()}),e.$on("$destroy",function(){t.cancelEvent("dataset.selected"),t.cancelEvent("schema.export"),t.cancelEvent("schema.import"),t.cancelEvent("schema.clear"),URL.revokeObjectURL(e.url),a.cancel(d),a.cancel(m),a.cancel(f)})}t.$inject=["$scope","EventPipe","$timeout","myAlertOnValium","avsc","myHelpers","IMPLICIT_SCHEMA"],angular.module(e.name+".commons").directive("myComplexSchemaEditor",function(){return{restrict:"E",templateUrl:"widget-container/widget-complex-schema-editor/widget-complex-schema-editor.html",bindToController:!0,scope:{model:"=ngModel",isDisabled:"=",pluginProperties:"=?",config:"=?",pluginName:"="},controller:t,controllerAs:"SchemaEditor"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myDatasetSelector",function(){return{restrict:"E",scope:{model:"=ngModel",datasetType:"@"},templateUrl:"widget-container/widget-dataset-selector/widget-dataset-selector.html",controller:["$scope","myDatasetApi","myStreamApi","$state","EventPipe",function(e,t,a,n,r){var s;e.list=[],"stream"===e.datasetType?s=a:"dataset"===e.datasetType&&(s=t);var i={namespace:n.params.namespace||n.params.nsadmin},o=[];s.list(i).$promise.then(function(t){e.list=t,o=t.map(function(e){return e.name})}),e.$watch("model",function(){e.model&&-1!==o.indexOf(e.model)&&("stream"===e.datasetType?i.streamId=e.model:"dataset"===e.datasetType&&(i.datasetId=e.model),s.get(i).$promise.then(function(t){var a;if("stream"===e.datasetType){a=JSON.stringify(t.format.schema);var n=t.format.name;r.emit("dataset.selected",a,n)}else"dataset"===e.datasetType&&(a=t.spec.properties.schema,r.emit("dataset.selected",a))}))}),e.$on("$destroy",function(){r.cancelEvent("dataset.selected")})}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myDsMultipleValues",function(){return{restrict:"E",scope:{model:"=ngModel",config:"="},templateUrl:"widget-container/widget-ds-multiplevalues/widget-ds-multiplevalues.html",controller:["$scope","myHelpers",function(e,t){function a(){var t=e.model;if(e.properties=[],!t)return void e.properties.push({values:Array(e.numValues).join(".").split(".")});var a=t.split(e.delimiter);angular.forEach(a,function(t){var a=t.split(e.valuesdelimiter);e.properties.push({values:a})})}e.valuesdelimiter=t.objectQuery(e.config,"widget-attributes","values-delimiter")||":",e.delimiter=t.objectQuery(e.config,"widget-attributes","delimiter")||",",e.numValues=t.objectQuery(e.config,"widget-attributes","numValues")||2,e.placeholders=t.objectQuery(e.config,"widget-attributes","placeholders")||[],e.numValues=parseInt(e.numValues,10),e.showDelimiter=!1;var n=t.objectQuery(e.config,"widget-attributes","showDelimiter");(e.config&&e.config.properties&&"true"===e.config.properties.showDelimiter||"true"===n)&&(e.showDelimiter=!0),a(),e.$watch("properties",function(){var t="";angular.forEach(e.properties,function(a){var n=a.values.filter(function(e){return 0===e.length});n.length||(t=t+a.values.join(e.valuesdelimiter)+e.delimiter)}),t.length>0&&t.charAt(t.length-1)===e.delimiter&&(t=t.substring(0,t.length-1)),e.model=t},!0),e.addProperty=function(){e.properties.push({values:Array(e.numValues).join(".").split("."),newField:"add"})},e.removeProperty=function(t){var a=e.properties.indexOf(t);e.properties.splice(a,1)},e.enter=function(t,a){a&&13===t.keyCode&&e.addProperty()}}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myDsv",function(){return{restrict:"E",scope:{model:"=ngModel",delimiter:"@",type:"@",config:"="},templateUrl:"widget-container/widget-dsv/widget-dsv.html",controller:["$scope","myHelpers",function(e,t){function a(){var t=e.model;if(e.properties=[],!t)return void e.properties.push({value:""});var a=t.split(n);angular.forEach(a,function(t){e.properties.push({value:t})})}"csv"===e.type?e.showDelimiter=!1:e.showDelimiter=!0,e.placeholder=t.objectQuery(e.config,"widget-attributes","value-placeholder")||"value";var n=e.delimiter||",";a();var r=e.$watch("properties",function(){var t="";angular.forEach(e.properties,function(e){e.value&&(t=t+e.value+n)}),t.length>0&&t.charAt(t.length-1)===n&&(t=t.substring(0,t.length-1)),e.model=t},!0);e.$on("$destroy",function(){r()}),e.addProperty=function(){e.properties.push({value:"",newField:"add"})},e.removeProperty=function(t){var a=e.properties.indexOf(t);e.properties.splice(a,1)},e.enter=function(t,a){a&&13===t.keyCode&&e.addProperty()}}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myFunctionDropdownWithAlias",function(){return{restrict:"E",scope:{model:"=ngModel",config:"="},templateUrl:"widget-container/widget-function-dropdown-with-alias/widget-function-dropdown-with-alias.html",controller:["$scope","myHelpers",function(e,t){e.functionAliasList=[],e.placeholders=t.objectQuery(e.config,"widget-attributes","placeholders"),e.dropdownOptions=t.objectQuery(e.config,"widget-attributes","dropdownOptions"),angular.isObject(e.placeholders)&&(e.aliasPlaceholder=e.placeholders.alias||"",e.fieldPlaceholder=e.placeholders.field||""),e.addFunctionAlias=function(){e.functionAliasList.push({functionName:"",field:"",alias:""})},e.removeFunctionAlias=function(t){e.functionAliasList.splice(t,1),e.functionAliasList.length||e.addFunctionAlias()},e.convertInternalToExternalModel=function(){var t="";return e.functionAliasList.forEach(function(e){-1===[e.functionName.length,e.field.length,e.alias.length].indexOf(0)&&(t.length&&(t+=","),t+=e.alias+":"+e.functionName+"("+e.field+")")}),t},e.convertExternalToInternalModel=function(){var t=e.model.split(",");t.forEach(function(t){if(t.length){var a=t.indexOf(":"),n=t.indexOf("("),r=t.indexOf(")");-1===[a,n,r].indexOf(-1)&&e.functionAliasList.push({alias:t.substring(0,a),functionName:t.substring(a+1,n),field:t.substring(n+1,r)})}})},e.model&&e.model.length?e.convertExternalToInternalModel():e.addFunctionAlias(),e.$watch("functionAliasList",function(){e.model=e.convertInternalToExternalModel()},!0)}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").controller("MyInputSchemaCtrl",["$scope",function(e){this.doLoadNextSetOfInputSchemaRows=function(){this.inputSchemaRowLimit+=10},this.inputSchemaRowLimit=15,this.multipleInputs="true"===e.multipleInputs?!0:!1;try{this.inputSchemas=JSON.parse(e.inputSchema)}catch(t){this.inputSchemas=[]}this.inputSchemas=this.inputSchemas.map(function(e){var t;try{t=JSON.parse(e.schema)}catch(a){t={name:"etlSchemaBody",
type:"record",fields:[]}}return{name:e.name,schema:t}}),this.currentIndex=0}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myInputSchema",function(){return{restrict:"EA",scope:{inputSchema:"@",multipleInputs:"@"},templateUrl:"widget-container/widget-input-schema/widget-input-schema.html",controller:"MyInputSchemaCtrl",controllerAs:"MyInputSchemaCtrl"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(){"ngInject";function e(){if(t.joinType="Outer",t.inputs=[],!t.model)return angular.forEach(t.inputSchema,function(e){t.inputs.push({name:e.name,selected:!1})}),void t.formatOutput();var e=t.model.split(",").map(function(e){return e.trim()});return e.length===t.inputSchema.length?(t.joinType="Inner",angular.forEach(t.inputSchema,function(e){t.inputs.push({name:e.name,selected:!0})}),void t.formatOutput()):void angular.forEach(t.inputSchema,function(a){t.inputs.push({name:a.name,selected:-1!==e.indexOf(a.name)?!0:!1})})}var t=this;t.optionsDropdown=["Inner","Outer"],t.changeJoinType=function(){"Inner"===t.joinType&&(angular.forEach(t.inputs,function(e){e.selected=!0}),t.formatOutput())},t.formatOutput=function(){var e=[];angular.forEach(t.inputs,function(t){t.selected&&e.push(t.name)}),t.model=e.join(",")},e()}angular.module(e.name+".commons").directive("myJoinTypes",function(){return{restrict:"E",templateUrl:"widget-container/widget-join-types/widget-join-types.html",bindToController:!0,scope:{model:"=ngModel",inputSchema:"="},controller:t,controllerAs:"JoinTypes"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myAceEditor",["$window",function(e){return{restrict:"EA",scope:{model:"=ngModel",config:"=",mode:"@",disabled:"="},template:'<div ui-ace="aceoptions" ng-model="model" ng-readonly="disabled" aceEditorStyle></div>',controller:["$scope",function(t){var a=e.ace.require("ace/config");a.set("modePath","/old_assets/bundle/ace-editor-worker-scripts/"),t.aceoptions={workerPath:"/old_assets/bundle/ace-editor-worker-scripts",mode:t.mode||"javascript",useWrapMode:!0,newLineMode:"unix",advanced:{tabSize:2}}}]}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myJsonTextbox",function(){return{restrict:"EA",scope:{model:"=ngModel",placeholder:"="},template:'<textarea class="form-control" data-ng-trim="false" cask-json-edit="internalModel" placeholder="placeholder"></textarea>',controller:["$scope",function(e){function t(){try{e.internalModel=JSON.parse(e.model)}catch(t){e.internalModel=""}}t(),e.$watch("model",t),e.$watch("internalModel",function(t,a){t!==a&&(e.model=angular.toJson(e.internalModel))})}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myKeyValue",function(){return{restrict:"E",scope:{model:"=ngModel",config:"=",isDropdown:"="},templateUrl:"widget-container/widget-keyvalue/widget-keyvalue.html",controller:["$scope","myHelpers",function(e,t){function a(){var t=e.model;if(e.properties=[],!t)return void e.properties.push({key:"",value:""});var a=t.split(e.delimiter);angular.forEach(a,function(t){var a=t.split(e.kvdelimiter);e.properties.push({key:a[0],value:a[1]})})}e.kvdelimiter=t.objectQuery(e.config,"kv-delimiter")||t.objectQuery(e.config,"widget-attributes","kv-delimiter")||":",e.delimiter=t.objectQuery(e.config,"delimiter")||t.objectQuery(e.config,"widget-attributes","delimiter")||",",e.keyPlaceholder=t.objectQuery(e.config,"widget-attributes","key-placeholder")||"key",e.valuePlaceholder=t.objectQuery(e.config,"widget-attributes","value-placeholder")||"value",e.showDelimiter=!0;var n=t.objectQuery(e.config,"widget-attributes","showDelimiter");(e.config.properties&&"false"===e.config.properties.showDelimiter||"false"===n)&&(e.showDelimiter=!1),e.isDropdown&&(e.dropdownOptions=t.objectQuery(e.config,"widget-attributes","dropdownOptions")),a(),e.$watch("properties",function(){var t="";angular.forEach(e.properties,function(a){a.key.length>0&&(t=t+a.key+e.kvdelimiter+a.value+e.delimiter)}),t.length>0&&t.charAt(t.length-1)===e.delimiter&&(t=t.substring(0,t.length-1)),e.model=t},!0),e.addProperty=function(){e.properties.push({key:"",value:"",newField:"add"})},e.removeProperty=function(t){var a=e.properties.indexOf(t);e.properties.splice(a,1)},e.enter=function(t,a){a&&13===t.keyCode&&e.addProperty()}}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("myNumberWidget",function(){return{restrict:"E",scope:{disabled:"=",model:"=ngModel",config:"="},templateUrl:"widget-container/widget-number/widget-number.html",controller:["$scope","myHelpers",function(e,t){var a=t.objectQuery(e.config,"widget-attributes","default");e.model=e.model||angular.copy(a),e.internalModel=e.model;var n=t.objectQuery(e.config,"widget-attributes","min"),r=t.objectQuery(e.config,"widget-attributes","max");e.showErrorMessage=t.objectQuery(e.config,"widget-attributes","showErrorMessage"),e.convertToInteger=t.objectQuery(e.config,"widget-attributes","convertToInteger")||!1,e.showErrorMessage=e.showErrorMessage===!1?!1:!0,"number"==typeof n&&(n=n.toString()),"number"==typeof r&&(r=r.toString());var s=function(t){return e.disabled?!0:t?t<e.min||t>e.max?(e.error="Value exceeds the limit [min: "+e.min+", max: "+e.max+"]",!1):void(e.error=""):(e.error="Value cannot be empty",a&&(e.error+=". Default value: "+a),!1)};e.min=n||-(1/0),e.max=r||1/0,"number"!=typeof e.model&&(e.internalModel=parseInt(e.model,10)),e.$watch("internalModel",function(t,a){return a!==t&&s(t)?(e.model="number"==typeof e.internalModel&&!Number.isNaN(e.internalModel)&&e.internalModel||"",void(e.convertToInteger||(e.model=e.internalModel.toString()))):(e.model="number"==typeof t&&!Number.isNaN(t)&&t||"",void(e.convertToInteger||(e.model=e.model.toString())))}),e.$watch("model",function(){e.internalModel=parseInt(e.model,10),s(e.internalModel)})}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("mySchedule",function(){return{restrict:"E",scope:{model:"=ngModel",config:"="},templateUrl:"widget-container/widget-schedule/widget-schedule.html",controller:["$scope","myHelpers",function(e,t){function a(){if(e.schedule={},!e.model)return e.schedule.min=n[0],e.schedule.hour=n[1],e.schedule.day=n[2],e.schedule.month=n[3],void(e.schedule.week=n[4]);var t=e.model.split(" ");e.schedule.min=t[0],e.schedule.hour=t[1],e.schedule.day=t[2],e.schedule.month=t[3],e.schedule.week=t[4]}var n=t.objectQuery(e.config,"properties","default")||t.objectQuery(e.config,"widget-attributes","default")||["*","*","*","*","*"];a(),e.$watch("schedule",function(){var t="";angular.forEach(e.schedule,function(e){t+=e+" "}),t=t.trim(),e.model=t},!0)}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("mySchemaEditor",function(){return{restrict:"EA",scope:{model:"=ngModel",config:"=",pluginProperties:"=",disabled:"="},templateUrl:"widget-container/widget-schema-editor/widget-schema-editor.html",controller:["$scope","myHelpers","EventPipe","IMPLICIT_SCHEMA","HydratorPlusPlusHydratorService","$timeout","myAlertOnValium",function(e,t,a,n,r,s,i){function o(){v&&(v(),v=null)}function l(){if(e.pluginProperties){o();var t=Object.keys(n);if(t.concat([""]).indexOf(e.pluginProperties[g])>-1)if(e.model=null,e.disableEdit=!0,e.pluginProperties["format.setting.pattern"]=null,t.indexOf(e.pluginProperties[g])>-1){var a=n[e.pluginProperties[g]];c(a)}else e.fields="NOTHING";else if("avro"===e.pluginProperties[g]){if(e.disableEdit=!1,e.fields="AVRO",e.pluginProperties["format.setting.pattern"]=null,v=e.$watch("avro",u,!0),e.model)try{e.avro.schema=JSON.parse(e.model)}catch(r){e.error="Invalid JSON string"}}else"grok"===e.pluginProperties[g]?(e.disableEdit=!1,e.fields="GROK",v=e.$watch("grok",function(){e.pluginProperties["format.setting.pattern"]=e.grok.pattern},!0)):(e.disableEdit=!1,e.fields="SHOW",e.pluginProperties["format.setting.pattern"]=null,c(e.model))}}function c(a){S=0;var n={};if(e.avro={},e.grok={pattern:e.pluginProperties["format.setting.pattern"]},e.error=null,a)try{n=JSON.parse(a),e.avro.schema=n}catch(r){e.error="Invalid JSON string"}if(n=t.objectQuery(n,"fields"),e.properties=[],e.activeCell=!1,angular.forEach(n,function(t){if(angular.isArray(t.type)){var a=t.type[0];"map"===a.type&&(a="string"===a.keys&&"string"===a.values?m:null),e.properties.push({name:t.name,type:a,nullable:!0,readonly:t.readonly})}else angular.isObject(t.type)?"map"===t.type.type?e.properties.push({name:t.name,type:"string"===t.type.keys&&"string"===t.type.values?m:null,nullable:t.nullable,readonly:t.readonly}):e.properties.push({name:t.name,type:t.type.items,nullable:t.nullable,readonly:t.readonly}):e.properties.push({name:t.name,type:t.type,nullable:t.nullable,readonly:t.readonly})}),S=e.properties.length,e.properties.length<15){0===e.properties.length&&(e.properties.push({name:"",type:h,nullable:!1}),S=1);for(var s=e.properties.length;15>s;s++)e.properties.push({empty:!0})}else e.properties.push({empty:!0});p()}function u(){if("avro"===e.pluginProperties[g]){var t=JSON.stringify(e.avro.schema);e.model=t}}function p(){e.model=r.formatOutputSchema(e.properties)}function d(){e.url&&URL.revokeObjectURL(e.url);var t=JSON.parse(e.model);t=t.fields,angular.forEach(t,function(e){e.readonly&&delete e.readonly});var a=new Blob([JSON.stringify(t,null,4)],{type:"application/json"});e.url=URL.createObjectURL(a),e.exportFileName="schema",y&&s.cancel(y),y=s(function(){document.getElementById("schema-export-link").click()})}e.limitedToView=15;var m="map<string, string>",f=["boolean","int","long","float","double","bytes","string","map<string, string>"],h=null,g=null,y=null;e.fields="SHOW",e.config?(e.options=t.objectQuery(e.config,"widget-attributes","schema-types")||t.objectQuery(e.config,"schema-types"),h=t.objectQuery(e.config,"widget-attributes","schema-default-type")||t.objectQuery(e.config,"schema-default-type")||e.options[0],g=t.objectQuery(e.config,"property-watch")||t.objectQuery(e.config,"widget-attributes","property-watch"),g&&(a.on("dataset.selected",function(t,a){e.pluginProperties[g]=a}),e.$watch(function(){return e.pluginProperties[g]},l))):(e.options=f,h="string");var v,S;e.config&&e.config["property-watch"]&&l(),c(e.model),a.on("schema.clear",function(){var t;try{t=JSON.parse(e.model),t.fields=t.fields.filter(function(e){return e.readonly}),e.model=JSON.stringify(t)}catch(a){e.model=JSON.stringify({fields:[]})}c(e.model)}),a.on("dataset.selected",function(t){try{var a=JSON.parse(e.model).fields.filter(function(e){return!e.readonly});if(a.length)throw"Model already set"}catch(n){if(e.model)return}var r={fields:[]};try{r.fields=JSON.parse(e.model).fields.filter(function(e){return e.readonly}),r.fields=r.fields.concat(JSON.parse(t).fields)}catch(s){r=t}c(JSON.stringify(r))}),e.$watch("properties",p,!0),e.emptyRowClick=function(t,a){t.empty&&a===S&&!e.disabled&&(delete t.empty,t.name="",t.type=h,t.nullable=!1,t.newField="add",S++,S>=15&&e.properties.push({empty:!0}))},e.addProperties=function(){e.properties.push({name:"",type:h,nullable:!1,newField:"add"}),S++,e.properties.length>=15&&e.properties.push({empty:!0})},e.removeProperty=function(t){var a=e.properties.indexOf(t);e.properties.splice(a,1),e.properties.length<=15&&e.properties.push({empty:!0}),S--},e.enter=function(t,a){a===S-1&&13===t.keyCode&&(S<e.properties.length?e.emptyRowClick(e.properties[a+1],a+1):e.addProperties())},a.on("schema.export",d),a.on("schema.import",function(e){var t=[];try{t=JSON.parse(e)}catch(a){i.show({type:"danger",content:"Error parsing imported schema"})}var n={fields:t};c(JSON.stringify(n))}),e.$on("$destroy",function(){a.cancelEvent("schema.export"),a.cancelEvent("schema.import"),a.cancelEvent("schema.clear"),a.cancelEvent("dataset.selected"),URL.revokeObjectURL(e.url),y&&s.cancel(y)}),e.loadNextSetOfRows=function(){e.limitedToView=e.limitedToView+10}}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("mySchemaEditorStream",function(){return{restrict:"EA",scope:{model:"=ngModel",config:"=",pluginProperties:"=",disabled:"="},templateUrl:"widget-container/widget-schema-editor-stream/widget-schema-editor-stream.html",controller:["$scope","myHelpers","EventPipe","IMPLICIT_SCHEMA","HydratorPlusPlusHydratorService","$timeout","myAlertOnValium",function(e,t,a,n,r,s,i){function o(){S&&(S(),S=null)}function l(){if(e.pluginProperties){o();var t=Object.keys(n);if(t.concat([""]).indexOf(e.pluginProperties[y])>-1)if(e.model=null,e.disableEdit=!0,e.pluginProperties["format.setting.pattern"]=null,t.indexOf(e.pluginProperties[y])>-1){var a=n[e.pluginProperties[y]];c(a)}else e.fields="NOTHING";else if("avro"===e.pluginProperties[y]){if(e.disableEdit=!1,e.fields="AVRO",e.pluginProperties["format.setting.pattern"]=null,S=e.$watch("avro",u,!0),e.model)try{e.avro.schema=JSON.parse(e.model)}catch(r){e.error="Invalid JSON string"}}else"grok"===e.pluginProperties[y]?(e.disableEdit=!1,e.fields="GROK",S=e.$watch("grok",function(){e.pluginProperties["format.setting.pattern"]=e.grok.pattern},!0)):(e.disableEdit=!1,e.fields="SHOW",e.pluginProperties["format.setting.pattern"]=null,c(e.model))}}function c(a){P=0;var n={};if(e.avro={},e.grok={pattern:e.pluginProperties["format.setting.pattern"]},e.error=null,a)try{n=JSON.parse(a),e.avro.schema=n}catch(r){e.error="Invalid JSON string"}if(n=t.objectQuery(n,"fields"),e.properties=[],e.activeCell=!1,angular.forEach(n,function(t){if(angular.isArray(t.type)){var a=t.type[0];"map"===a.type&&(a="string"===a.keys&&"string"===a.values?f:null),e.properties.push({name:t.name,type:a,nullable:!0,readonly:t.readonly})}else angular.isObject(t.type)?"map"===t.type.type?e.properties.push({name:t.name,type:"string"===t.type.keys&&"string"===t.type.values?f:null,nullable:t.nullable,readonly:t.readonly}):e.properties.push({name:t.name,type:t.type.items,nullable:t.nullable,readonly:t.readonly}):e.properties.push({name:t.name,type:t.type,nullable:t.nullable,readonly:t.readonly})}),P=e.properties.length,e.properties.length<15){0===e.properties.length&&(e.properties.push({name:"",type:g,nullable:!1}),P=1);for(var s=e.properties.length;15>s;s++)e.properties.push({empty:!0})}else e.properties.push({empty:!0});d()}function u(){if("avro"===e.pluginProperties[y]){var t=JSON.stringify(e.avro.schema);e.model=t}}function p(){var t={name:"headers",type:"map<string, string>",readonly:!0},a={name:"ts",type:"long",readonly:!0};angular.isArray(e.properties)&&("headers"===e.properties[1].name&&"map<string, string>"===e.properties[1].type?e.properties[1].readonly=!0:e.properties.unshift(t),"ts"===e.properties[0].name&&"long"===e.properties[0].type?e.properties[0].readonly=!0:e.properties.unshift(a))}function d(){var t=["avro","grok"];-1===t.indexOf(e.pluginProperties[y])&&p(),e.model=r.formatOutputSchema(e.properties)}function m(){e.url&&URL.revokeObjectURL(e.url);var t=JSON.parse(e.model);t=t.fields,angular.forEach(t,function(e){e.readonly&&delete e.readonly});var a=new Blob([JSON.stringify(t,null,4)],{type:"application/json"});e.url=URL.createObjectURL(a),e.exportFileName="schema",v&&s.cancel(v),v=s(function(){document.getElementById("schema-export-link").click()})}e.limitedToView=15;var f="map<string, string>",h=["boolean","int","long","float","double","bytes","string","map<string, string>"],g=null,y=null,v=null;e.fields="SHOW",e.config?(e.options=t.objectQuery(e.config,"widget-attributes","schema-types")||t.objectQuery(e.config,"schema-types"),g=t.objectQuery(e.config,"widget-attributes","schema-default-type")||t.objectQuery(e.config,"schema-default-type")||e.options[0],y=t.objectQuery(e.config,"property-watch")||t.objectQuery(e.config,"widget-attributes","property-watch"),y&&(a.on("dataset.selected",function(t,a){e.pluginProperties[y]=a}),e.$watch(function(){return e.pluginProperties[y]},l))):(e.options=h,g="string");var S,P;e.config&&e.config["property-watch"]&&l(),c(e.model),a.on("schema.clear",function(){var t;try{t=JSON.parse(e.model),t.fields=t.fields.filter(function(e){return e.readonly}),e.model=JSON.stringify(t)}catch(a){e.model=JSON.stringify({fields:[]})}c(e.model)}),a.on("dataset.selected",function(t){try{var a=JSON.parse(e.model).fields.filter(function(e){return!e.readonly});if(a.length)throw"Model already set"}catch(n){if(e.model)return}var r={fields:[]};try{r.fields=JSON.parse(e.model).fields.filter(function(e){return e.readonly}),r.fields=r.fields.concat(JSON.parse(t).fields)}catch(s){r=t}c(JSON.stringify(r))}),e.$watch("properties",d,!0),e.emptyRowClick=function(t,a){t.empty&&a===P&&!e.disabled&&(delete t.empty,t.name="",t.type=g,t.nullable=!1,t.newField="add",P++,P>=15&&e.properties.push({empty:!0}))},e.addProperties=function(){e.properties.push({name:"",type:g,nullable:!1,newField:"add"}),P++,e.properties.length>=15&&e.properties.push({empty:!0})},e.removeProperty=function(t){var a=e.properties.indexOf(t);e.properties.splice(a,1),e.properties.length<=15&&e.properties.push({empty:!0}),P--},e.enter=function(t,a){a===P-1&&13===t.keyCode&&(P<e.properties.length?e.emptyRowClick(e.properties[a+1],a+1):e.addProperties())},a.on("schema.export",m),a.on("schema.import",function(e){var t=[];try{t=JSON.parse(e)}catch(a){i.show({type:"danger",content:"Error parsing imported schema"})}var n={fields:t};c(JSON.stringify(n))}),e.$on("$destroy",function(){a.cancelEvent("schema.export"),a.cancelEvent("schema.import"),a.cancelEvent("schema.clear"),a.cancelEvent("dataset.selected"),URL.revokeObjectURL(e.url),v&&s.cancel(v)}),e.loadNextSetOfRows=function(){e.limitedToView=e.limitedToView+10}}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(){"ngInject";function e(){angular.forEach(a.inputSchema,function(e){a.stageList.push(e.name);try{a.mapInputSchema[e.name]=JSON.parse(e.schema).fields.map(function(e){return e.name})}catch(t){console.log("ERROR: ",t),a.error="Error parsing input schemas.",a.mapInputSchema[e.name]=[]}}),a.stageList.length<2&&(a.error="Please connect 2 or more stages.")}function t(){if(e(),!a.model)return void a.addRule();var t=a.model.split("&").map(function(e){return e.trim()});angular.forEach(t,function(e){var t=[];angular.forEach(e.split("="),function(e){var n=e.trim().split(".");-1!==a.stageList.indexOf(n[0])&&t.push({stageName:n[0],fieldName:n[1]})});var n=a.stageList.filter(function(e){var a=t.filter(function(t){return t.stageName===e});return 0===a.length?!0:!1});n.length>0&&(angular.forEach(n,function(e){t.push({stageName:e,fieldName:a.mapInputSchema[e][0]})}),a.warning="Input stages have changed since the last time you edit this node's configuration. Please verify the condition is still valid."),a.rules.push(t)}),a.formatOutput()}var a=this;a.rules=[],a.mapInputSchema={},a.stageList=[],a.formatOutput=function(){if(a.stageList.length<2)return void(a.model="");var e=[];angular.forEach(a.rules,function(t){var a=t.filter(function(e){return!e.fieldName});if(!(a.length>0)){var n=t.map(function(e){return e.stageName+"."+e.fieldName}),r=n.join(" = ");e.push(r)}}),a.model=e.join(" & ")},a.addRule=function(){if(0!==a.stageList.length){var e=[];angular.forEach(a.stageList,function(t){e.push({stageName:t,fieldName:a.mapInputSchema[t][0]})}),a.rules.push(e),a.formatOutput()}},a.deleteRule=function(e){a.rules.splice(e,1),a.formatOutput()},t()}angular.module(e.name+".commons").directive("mySqlConditions",function(){return{restrict:"E",templateUrl:"widget-container/widget-sql-conditions/widget-sql-conditions.html",bindToController:!0,scope:{model:"=ngModel",inputSchema:"=",disabled:"="},controller:t,controllerAs:"SqlConditions"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(){"ngInject";function e(){angular.forEach(a.parsedInputSchemas,function(e){angular.forEach(e.schema,function(t){a.aliases[t.alias]>1&&(a.errors.stageCount[e.name]?a.errors.stageCount[e.name]++:a.errors.stageCount[e.name]=1)})})}function t(e){var t={};if(e){var n=e.split(",");angular.forEach(n,function(e){var a=e.split(" as "),n=a[0].split(".");t[n[0]]||(t[n[0]]={}),t[n[0]][n[1]]=a[1]?a[1]:!0})}angular.forEach(a.inputSchema,function(n){var r=void 0;try{r=JSON.parse(n.schema)}catch(s){console.log("ERROR: ",s),r={fields:[]}}r=r.fields.map(function(a){return t[n.name]&&t[n.name][a.name]?(a.selected=!0,a.alias=t[n.name][a.name]===!0?"":t[n.name][a.name]):(a.selected=e?!1:!0,a.alias=a.name),a}),a.parsedInputSchemas.push({name:n.name,schema:r,expanded:!1})}),a.formatOutput()}var a=this;a.expandedButton=!0,a.parsedInputSchemas=[],a.aliases={},a.errors={stageCount:{},message:"Please create one or more aliases for duplicate field names.",exist:!1};var n=angular.copy(a.model);a.toggleAll=function(e){angular.forEach(a.parsedInputSchemas,function(t){t.expanded=e}),a.expandedButton=!a.expandedButton},a.resetAll=function(){a.parsedInputSchemas=[],t(n)},a.formatOutput=function(){var t=[];a.errors.stageCount={},a.errors.exist=!1,a.aliases={},angular.forEach(a.parsedInputSchemas,function(e){angular.forEach(e.schema,function(n){if(n.selected){var r=e.name+"."+n.name;n.alias&&(r+=" as "+n.alias),a.aliases[n.alias]?(a.aliases[n.alias]++,a.errors.exist=!0):a.aliases[n.alias]=1,t.push(r)}})}),e(),a.model=t.join(",")},a.toggleAllFields=function(e,t){angular.forEach(e.schema,function(e){e.selected=t}),a.formatOutput()},t(a.model)}angular.module(e.name+".commons").directive("mySqlSelector",function(){return{restrict:"E",templateUrl:"widget-container/widget-sql-select-fields/widget-sql-select-fields.html",bindToController:!0,scope:{model:"=ngModel",inputSchema:"="},controller:t,controllerAs:"SqlSelector"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("AdminController",["$scope","$state","myNamespace",function(e,t,a){function n(){e.submenu.security||(e.submenu.security=t.is("admin.security")||t.includes("admin.security.**")),e.submenu.system||(e.submenu.system=t.is("admin.system")||t.includes("admin.system.**")),e.submenu.namespaces||(e.submenu.namespaces=t.is("admin.namespace")||t.includes("admin.namespace.**")),t.params.nsadmin&&(e.submenu.perNs[t.params.nsadmin]=!0)}a.getList().then(function(t){e.nsList=t,n()}),e.submenu={system:!0,security:!1,namespaces:!0,perNs:{}},e.$on("$stateChangeSuccess",n)}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("OverviewController",["$scope","$state","myNamespace","MyCDAPDataSource","myLocalStorage","MY_CONFIG","myStreamApi","myDatasetApi",function(e,t,a,n,r,s,i,o){function l(e){return p.request({_cdapPath:"/namespaces/"+e.name+"/apps"})}function c(t){var a={namespace:t.name,scope:e};return o.list(a).$promise}function u(t){var a={namespace:t.name,scope:e};return i.list(a).$promise}var p=new n(e),d="feature.admin.overview.welcomeIsHidden";r.get(d).then(function(t){e.welcomeIsHidden=t}),e.hideWelcome=function(){r.set(d,!0),e.welcomeIsHidden=!0},e.isEnterprise=s.isEnterprise,a.getList().then(function(t){e.nsList=t,e.nsList.forEach(function(e){l(e).then(function(t){e.appsCount=t.length}),c(e).then(function(t){e.datasetsCount=t.length},function(e){console.log("ERROR: Fetching Datasets failed ",e)}),u(e).then(function(t){e.streamsCount=t.length})})})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("PreferencesController",["$scope","$filter","$state","rSource","myPreferenceApi","myAlertOnValium",function(e,t,a,n,r,s){function i(e){var t,a=[];try{t=JSON.parse(angular.toJson(e))}catch(n){return console.log("ERROR: ",n),a}return angular.forEach(t,function(e,t){a.push({key:t,value:e})}),a}var o=t("filter");e.parentPreferences=[],e.preferences=[];var l,c,u,p,d;"SYSTEM"===n?(e.heading="System Preferences",c={scope:e},l=r.getSystemPreference,d=r.setSystemPreference):"NAMESPACE"===n?(e.heading="Namespace Preferences: "+a.params.nsadmin,e.messages="Specify new or override existing system configurations that will be accessible in all applications and datasets within this namespace",p={scope:e,resolved:!0},u=r.getSystemPreference,c={namespace:a.params.nsadmin,scope:e},l=r.getNamespacePreference,d=r.setNamespacePreference):"APPLICATION"===n&&(e.heading="Application Preferences: "+a.params.appId,e.messages="Specify new or override existing namespace configurations that will be accessible in all programs within this application",p={namespace:a.params.nsadmin,scope:e,resolved:!0},u=r.getNamespacePreference,c={namespace:a.params.nsadmin,appId:a.params.appId,scope:e},l=r.getAppPreference,d=r.setAppPreference),e.preferences=[],e.loadProperties=function(){"SYSTEM"!==n&&u(p).$promise.then(function(t){e.parentPreferences=i(t)}),l(c).$promise.then(function(t){e.preferences=i(t)})},e.loadProperties(),e.addPreference=function(){e.preferences.push({key:"",value:""})},e.removePreference=function(t){var a=o(e.preferences,t);a.length&&e.preferences.splice(e.preferences.indexOf(a[0]),1)},e.save=function(){var t={};angular.forEach(e.preferences,function(e){e.key&&(t[e.key]=e.value)}),d(c,t,function(){s.show({content:"Your preferences have been successfully saved",type:"success"}),e.loadProperties()})},e.enter=function(t,a){a&&13===t.keyCode&&e.addPreference()}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=function a(e,t,n,r,s){_classCallCheck(this,a),this.getHydratorUrl=s,this.myHydratorFactory=n,this.isHydrator=-1!==[].concat(_toConsumableArray(t.etlBatchPipelines),[t.etlRealtime,t.etlDataStreams]).indexOf(e.artifact.name),this.artifact={name:e.artifact.name},this.metadataParams={namespace:r.params.namespace,appId:r.params.appId},this.GLOBALS=t};t.$inject=["rAppData","GLOBALS","myHydratorFactory","$state","getHydratorUrl"],angular.module(e.name+".feature.apps").controller("AppDetailController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=function a(e,t,n,r,s,i,o){var l=this;_classCallCheck(this,a),this.getHydratorUrl=o,this.MyOrderings=r,this.apps=[],this.currentPage=1,this.searchText="",this.GLOBALS=s,this.myHydratorFactory=i;var c=new t(e);c.request({_cdapNsPath:"/apps/"}).then(function(e){l.apps=l.apps.concat(e)}),this.onFileSelected=n.upload};t.$inject=["$scope","MyCDAPDataSource","myAppUploader","MyOrderings","GLOBALS","myHydratorFactory","getHydratorUrl"],angular.module(e.name+".feature.apps").controller("AppListController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.dashboard").controller("DashboardAddWdgtCtrl",["$scope","$uibModalInstance","caskFocusManager","Widget",function(e,t,a,n){a.focus("addWdgtType"),e.model=new n,e.addType="INDIVIDUAL",e.widgetTypes=[{name:"Line",type:"c3-line"},{name:"Bar",type:"c3-bar"},{name:"Pie",type:"c3-pie"},{name:"Donut",type:"c3-donut"},{name:"Scatter",type:"c3-scatter"},{name:"Spline",type:"c3-spline"},{name:"Area",type:"c3-area"},{name:"Area Spline",type:"c3-area-spline"},{name:"Area Spline Stacked",type:"c3-area-spline-stacked"},{name:"Area Step",type:"c3-area-step"},{name:"Step",type:"c3-step"},{name:"Table",type:"table"}],e.addWidget=function(){"MULTIPLE"===e.addType?e.addMetricsToWidget():e.addMetricsToIndividualWidgets()},e.addMetricsToIndividualWidgets=_.debounce(function(){var t=[];angular.forEach(e.model.metric.names,function(a){t.push(new n({type:e.model.type,title:a,metric:{context:e.model.metric.context,names:[a],name:a}}))}),e.currentBoard.addWidget(t),e.$close()},1e3),e.addMetricsToWidget=_.debounce(function(){var t=e.model.metric;t&&(e.currentBoard.addWidget(e.model),e.$close())},1e3),e.closeModal=function(){t.close()}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.dashboard").controller("DashboardCtrl",["$scope","$state","rDashboardsModel","MY_CONFIG","myAlertOnValium","$timeout",function(e,t,a,n,r,s){e.unknownBoard=!1,e.isEnterprise=n.isEnterprise,e.dashboards=a.data||[];var i=parseInt(t.params.tab,10);isNaN(i)?e.dashboards.activeIndex="system":e.dashboards.activeIndex=i,e.activeTabClick=function(a,n){return"system"===n?(e.unknownBoard=!0,t.go("dashboard.standard.cdap"),void(e.dashboards.activeIndex="system")):n===e.dashboards.activeIndex&&t.includes("dashboard.user")?(e.dashboards[n].isopen=!e.dashboards[n].isopen,a.preventDefault(),void a.stopPropagation()):(e.unknownBoard=!0,t.go("dashboard.user",{tab:n}),void(e.dashboards.activeIndex=n))},e.addWidget=function(){return a.current().canAddWidget()?void t.go("dashboard.user.addwdgt",{tab:t.params.tab},{reload:!1}):void r.show({content:"Cannot add more than "+a.current().WIDGET_LIMIT+" widgets.",type:"warning"})},e.addDashboard=_.throttle(function(e){a.add({title:e}).then(function(){var e=a.data.length-1;t.go("dashboard.user",{tab:e},{reload:!0})})},2e3,{trailing:!1}),e.removeDashboard=function(){a.remove(e.dashboards.activeIndex).then(function(){t.go("dashboard.standard.cdap",{},{reload:!0})})},e.$on("$stateChangeSuccess",function(a,n,r,s){-1!==s.name.indexOf("dashboard")&&-1!==n.name.indexOf("dashboard")&&(t.includes("dashboard.standard.*")?(e.unknownBoard=!0,e.dashboards.activeIndex="system"):e.dashboards.activeIndex=parseInt(r.tab,10))}),e.reorderDashboard=function(e){var n=a.reorder(e);n>0&&s(function(){t.go(t.current,{tab:n},{reload:!0})})}}]).directive("tabDdMenu",function(){return{replace:!0,restrict:"E",templateUrl:"/old_assets/features/dashboard/templates/partials/tab-dd.html"}}).directive("widgetDdMenu",function(){return{replace:!0,restrict:"E",templateUrl:"/old_assets/features/dashboard/templates/partials/wdgt-dd.html"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.dashboard").controller("UserDashboardCtrl",["$scope","$state","$dropdown","rDashboardsModel","MY_CONFIG","myAlertOnValium","DashboardHelper",function(e,t,a,n,r,s,i){function o(e,t){var a,n=e.current().columns;for(a=0;a<n.length;a++)t(n[a])}e.unknownBoard=!1,e.liveDashboard=!1,e.refreshIntervals=[{name:"5 seconds",value:5},{name:"10 seconds",value:10},{name:"30 seconds",value:30},{name:"1 minute",value:60},{name:"5 minutes",value:300}];var l=Date.now();e.timeOptions={startMs:l-6e4,endMs:l,refreshInterval:e.refreshIntervals[1]},e.currentBoard=n.current(),e.gridsterOpts={rowHeight:"280",columns:6,minSizeX:2,mobileBreakPoint:800,swapping:!0,resizable:{enabled:!0,stop:function(e,t,a){var n=parseInt(t[0].style.height,10),r=parseInt(t[0].style.width,10);a&&(a.height=300>n?200:n-70,a.width=450>r?370:r-32)}}},e.$on("$destroy",function(){e.liveDashboard&&i.stopPollDashboard(e.currentBoard)}),e.activateTab=function(t){e.currentTab=t},e.tabs=["Time Range","Frequency"],e.currentTab=1,e.updateWithTimeRange=function(t){var a=864e5,r=30,l=e.timeOptions.endMs-e.timeOptions.startMs;return l>r*a?void s.show({content:"Please choose a shorter time range. Current time range limit is "+r+" days.",type:"warning"}):(t!==!1&&(e.liveDashboard=!1,i.stopPollDashboard(e.currentBoard)),o(n,function(t){t.metric.startTime=Math.floor(e.timeOptions.startMs/1e3),t.metric.endTime=Math.floor(e.timeOptions.endMs/1e3),t.metric.resolution="auto",t.settings.isLive=!1}),void i.fetchDataDashboard(e.currentBoard))},e.updateWithTimeRange(!1),e.updateWithFrequency=function(){e.liveDashboard=!0,o(n,function(t){t.metric.startTime=e.timeOptions.durationMs,t.metric.endTime="now",t.metric.resolution="auto",t.settings.isLive=!0,t.settings.interval=1e3*e.timeOptions.refreshInterval.value}),i.startPollDashboard(e.currentBoard)},e.$watch("timeOptions.durationMs",function(){e.liveDashboard&&e.updateWithFrequency()}),e.updateRefreshInterval=function(){e.liveDashboard&&e.updateWithFrequency()},e.stopPolling=function(){e.liveDashboard=!1,o(n,function(e){e.settings.isLive=!1}),i.stopPollDashboard(e.currentBoard)}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.dashboard").factory("Widget",["MyCDAPDataSource","myHelpers",function(e,t){function a(e){e=e||{},this.title=e.title||"Widget",this.isOpen=!1,this.type=e.type,this.metric=e.metric||!1,this.metricAlias=e.metricAlias||{},this.settings={},e.settings=e.settings||{},
this.settings.color=e.settings.color||n(this.metric.names||[]),t.objectQuery(e,"settings","size")?(this.width=e.settings.size.width,this.height=e.settings.size.height):(this.width="",this.height=200),this.settings.chartMetadata={},e.settings.chartMetadata&&(this.settings.chartMetadata=e.settings.chartMetadata),this.settings.isLive=e.settings.isLive||!1,this.settings.interval=e.settings.interval,this.settings.aggregate=e.settings.aggregate}function n(e){for(var t=[],a=0;a<e.length;a++)t.push(r(e[a]));return{pattern:t}}a.prototype.getPartial=function(){return"/old_assets/features/dashboard/templates/widgets/"+this.type+".html"};var r=function(e){var t,a,n;for(t=0,a=0;t<e.length;)a=e.charCodeAt(t++)+((a<<100)-a);for(t=0,n="#";3>t;)n+=("00"+(a>>8*t++&255).toString(16)).slice(-2);return n};return a.prototype.ddWidget=function(e){return this.isOpen=!this.isOpen,e.preventDefault(),e.stopPropagation(),!1},a}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.dashboard").factory("MyDashboardsModel",["Widget","MyCDAPDataSource","mySettings","$q","MyChartHelpers",function(e,t,a,n,r){function s(t){this.WIDGET_LIMIT=12,t=t||{},angular.extend(this,{id:t.id,title:t.title||"Dashboard",columns:[],numColumn:t.numColumn||3,draggable:!0}),angular.isArray(t.columns)&&angular.forEach(t.columns,function(t){var a=new e(t);a.sizeX=2,a.sizeY=1,a.row=null,a.col=null,this.push(a)},this.columns),this.checkForEmptyDashboard()}function i(e){var t=[],i=this,c=n.defer();t.activeIndex=0,this.data=t,this.$promise=c.promise,this._key="dashsbyns",e&&(this._key+="."+e),a.get(this._key,!0).then(function(t){return angular.isArray(t)||(t=[]),n.all(t.map(function(t){return o.request({method:"GET",_cdapPath:"/namespaces/"+e+l+"/"+t})}))}).then(function(e){var a=[];e.length&&(a=r.convertDashboardToNewWidgets(angular.copy(e)),angular.forEach(a,function(e){var a=e.config;a.id=e.id,t.push(new s(a))})),c.resolve(i)},function(e){console.log("Dashboard delete failed for some reason"),console.log(e),c.resolve(i)})}var o=new t,l="/configuration/dashboards";return s.prototype.renameWidget=function(e,t){t&&(e.title=t,this.persist())},s.prototype.removeWidget=function(e){this.columns=this.columns.filter(function(t){return e!==t}),this.checkForEmptyDashboard(),this.persist()},s.prototype.checkForEmptyDashboard=function(){return this.isEmpty=0===this.columns.length,this.isEmpty},s.prototype.addWidget=function(e){angular.isArray(e)?this.columns=this.columns.concat(e):this.columns.unshift(e),this.persist()},s.prototype.canAddWidget=function(){return this.columns.length<this.WIDGET_LIMIT},s.prototype.rename=function(e){e&&(this.title=e,this.persist())},s.prototype.properties=function(){return angular.fromJson(angular.toJson(this))},s.prototype.persist=function(){var e=this.properties();return this.id?o.request({method:"PUT",_cdapNsPath:l+"/"+this.id,body:e}):o.request({method:"POST",_cdapNsPath:l,body:e}).then(function(e){return this.id=e.id,n.when(e)}.bind(this))},i.prototype.current=function(){return this.data[this.data.activeIndex||0]},i.prototype.persist=function(){return a.set(this._key,this.data.map(function(e){return e.id}))},i.prototype.remove=function(e){var t=this.data.splice(e,1)[0];return o.request({method:"DELETE",_cdapNsPath:l+"/"+t.id}).then(function(){return this.persist()}.bind(this))},i.prototype.reorder=function(e){var t=this.data.length-1,a=this.data.activeIndex,n=a+(e?-1:1);return n>t||0>n?-1:(this.data.splice(n,0,this.data.splice(a,1)[0]),this.persist(),n)},i.prototype.add=function(e){var t=new s(e);return this.data.push(t),t.persist().then(function(){return this.persist()}.bind(this))},i}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.dashboard").factory("MyMetricsQueryHelper",function(){function e(e){var t,a,n,r;if(t=e.length?e.split("."):[],t.length%2!==0)return null;for(a={},n=0;n<t.length;n+=2)r=t[n+1].replace(/~/g,"."),a[t[n]]=r;return a}function t(e,t,a,n,r){var s,i;return s={start:a.startTime||"now-60s",end:a.endTime||"now"},a.resolution&&(s.resolution=a.resolution),i={},i[e]={tags:t,metrics:a.names},r=r||[],r.length&&(i[e].groupBy=r),n=n!==!1,n&&(i[e].timeRange=s),i}function a(e,t){return Math.ceil(e/t)*t}function n(e,t){return Math.floor(e/t)*t}function r(e,t){for(var a={},r=Object.keys(e),s=n(r.length,t),i=0;s>i;i+=t){for(var o=0,l=0;t>l;l++)o+=e[r[i+l]];a[r[i]]=o}if(s<r.length){var c=r[s];for(a[c]=0,i=s;i<r.length;i++)a[c]+=e[r[i]]}return a}function s(e){var t=e.name.replace(/\./g,"~"),a=e.value.replace(/\./g,"~");return t+"."+a}function i(e){var t=Object.keys(e),a=[];return t.forEach(function(t){var n=e[t];a.push("tag="+t+":"+n)}),a.join("&")}return{contextToTags:e,constructQuery:t,roundUpToNearest:a,roundDownToNearest:n,aggregate:r,tagToContext:s,tagsToParams:i}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.datasets").controller("DatasetsDetailController",["$scope","$state","MyCDAPDataSource","myAlertOnValium","$filter","myDatasetApi","explorableDatasets",function(e,t,a,n,r,s,i){var o={namespace:t.params.namespace,scope:e};this.explorable=i,this.truncate=function(){o.datasetId=t.params.datasetId,s.truncate(o,{}).$promise.then(function(){n.show({content:"Succesfully truncated "+t.params.datasetId+" dataset",type:"success"})})},this.metadataParams={namespace:t.params.namespace,datasetId:t.params.datasetId}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.experimental").controller("ComplexSchemaController",function(){this.schema='{"type":"record","name":"rec","fields":[{"name":"bool_field","type":["boolean","null"]},{"name":"int_field","type":"int"},{"name":"long_field","type":"long"},{"name":"float_field","type":"float"},{"name":"double_field","type":"double"},{"name":"bytes_field","type":"bytes"},{"name":"array_field","type":{"type":"array","items":["string","null"]}},{"name":"enum_field","type":{"type":"enum","symbols":["Monday","Tuesday","Wednesday"]}},{"name":"union_field","type":["double",{"type": "array", "items": "string" },"bytes"]},{"name":"map_field","type":{"type":"map","keys":["string","null"],"values":["int","null"]}},{"name":"record_field","type":[{"type":"record","name":"rec1","fields":[{"name":"x","type":["int","null"]},{"name":"y","type":["double","null"]}]},"null"]},{"name":"string_field","type":["string","null"]}]}',this.testSchema=""})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.experimental").controller("DateCtrl",["$scope",function(e){e.dateObj={startTime:null,endTime:null},e.test=function(){console.log("Time",e.dateObj.startTime,e.dateObj.endTime)}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.experimental").controller("DirectivePlayGround",function(){this.dsMultipleValuesModel="value1:value2:value3,newValue1:newValue2:newValue3",this.topAppsData={total:15,results:[{label:"Application1",value:93},{label:"Application3",value:61},{label:"Application2",value:32},{label:"Application5",value:32},{label:"Application4",value:1}]},this.topAppsData2={total:2,results:[{label:"Application1",value:85},{label:"Application3",value:61}]},this.auditLogCounts={bucket_interval:"day",results:[{timestamp:1451606400,log_count:25},{timestamp:1451692800,log_count:26},{timestamp:1451779200,log_count:27},{timestamp:1451865600,log_count:22},{timestamp:1451952e3,log_count:29},{timestamp:1452038400,log_count:0},{timestamp:1452124800,log_count:32},{timestamp:1452211200,log_count:33},{timestamp:1452297600,log_count:1},{timestamp:1452384e3,log_count:4},{timestamp:1452470400,log_count:4},{timestamp:1452556800,log_count:4},{timestamp:1452643200,log_count:4},{timestamp:1452729600,log_count:4},{timestamp:1452816e3,log_count:4},{timestamp:1452902400,log_count:4},{timestamp:1452988800,log_count:4},{timestamp:1453075200,log_count:4},{timestamp:1453161600,log_count:4},{timestamp:1453248e3,log_count:0},{timestamp:1453334400,log_count:0},{timestamp:1453420800,log_count:5},{timestamp:1453507200,log_count:7},{timestamp:1453593600,log_count:12},{timestamp:145368e4,log_count:4},{timestamp:1453766400,log_count:2},{timestamp:1453852800,log_count:1},{timestamp:1453939200,log_count:4},{timestamp:1454025600,log_count:4},{timestamp:1454112e3,log_count:4},{timestamp:1454198400,log_count:7},{timestamp:1454284800,log_count:4},{timestamp:1454371200,log_count:4},{timestamp:1454457600,log_count:9},{timestamp:1454544e3,log_count:7}]}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.experimental").controller("LogsController",function(){this.namespaceId="default",this.appId="_Tracker",this.programType="flows",this.programId="AuditLogFlow",this.runId="9417a6b1-46e2-11e6-b588-56219b501a22"})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.experimental").controller("PopoverTestController",["$scope",function(e){e.something="COOOOl"}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.experimental").controller("SchemaController",["EventPipe","$timeout",function(e,t){var a=this;a.props={},a.outputSchema="",a["import"]=function(){t(function(){document.getElementById("schema-import-link").click()})},a.importFiles=function(t){var a=new FileReader;a.readAsText(t[0],"UTF-8"),a.onload=function(t){var a=t.target.result;e.emit("schema.import",a)}},a["export"]=function(){e.emit("schema.export")}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n){_classCallCheck(this,e),this.data={},this.$state=t,this.$q=a,this.myFlowsApi=n}return e.$inject=["$state","$q","myFlowsApi"],_createClass(e,[{key:"fetchData",value:function(e,t){var a=this,n=Object.keys(this.data);if(n.indexOf(t)>-1)return this.$q.when(this.data[t]);var r=this.$q.defer(),s={namespace:this.$state.params.namespace,appId:e,flowId:t};return this.myFlowsApi.get(s).$promise.then(function(e){var n=[];angular.forEach(e.connections,function(e){"STREAM"===e.sourceType&&n.push({type:e.sourceType,name:e.sourceName})}),angular.forEach(e.flowlets,function(e,t){e.type="FLOWLET",e.name=t,n.push(e)}),a.data[t]={flowlets:e.flowlets,nodes:n,edges:e.connections,metrics:{}},r.resolve(a.data[t])}),r.promise}},{key:"reset",value:function(){this.data={}}}]),e}();t.$inject=["$state","$q","myFlowsApi"],angular.module(e.name+".feature.flows").service("FlowDiagramData",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusDetailCtrl",["HydratorPlusPlusDetailRunsStore","rPipelineDetail","HydratorPlusPlusDetailActions","$scope","HydratorPlusPlusDetailNonRunsStore","HydratorPlusPlusDetailMetricsActions",function(e,t,a,n,r,s){e.init(t),r.init(t);var i=e.getParams();i.scope=n;var o;e.registerOnChangeListener(function(){var t=e.getLatestMetricRunId();if(o!==t&&(o=t,s.reset(),t)){var a=e.getParams(),n=e.getLogsParams(),r={namespace:a.namespace,app:a.app,run:t},i=e.getMetricProgramType();r[i]=n.programId,s.pollForMetrics(r)}}),a.pollRuns(e.getApi(),i),n.$on("$destroy",function(){e.reset(),r.reset(),s.reset()})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusListController",["$scope","myPipelineApi","$stateParams","GLOBALS","mySettings","$state","myHelpers","myWorkFlowApi","myWorkersApi","MyCDAPDataSource","myAppsApi","myAlertOnValium","myLoadingService","mySparkApi",function(e,t,a,n,r,s,i,o,l,c,u,p,d,m){function f(t){var a,r={namespace:s.params.namespace,appId:t.id,scope:e};if(t.artifact.name===n.etlBatch||t.artifact.name===n.etlDataPipeline){a=o;var i=t.artifact.name===n.etlDataPipeline?"DataPipelineWorkflow":"ETLWorkflow";r.workflowId=i,b.push({appId:t.id,programType:"Workflow",programId:i})}else t.artifact.name===n.etlDataStreams?(a=m,C.push({appId:t.id,programType:"Spark",programId:"DataStreamsSparkStreaming"})):(a=l,r.workerId="ETLWorker",C.push({appId:t.id,programType:"Worker",programId:"ETLWorker"}));a.runs(r).$promise.then(function(e){t._stats.numRuns=e.length,t._stats.lastStartTime=e.length>0?e[0].start:"N/A";for(var a=0;a<e.length;a++){var n=e[a].status;if(-1===["RUNNING","STARTING","STOPPING"].indexOf(n)){t._latest=e[a];break}}})}function h(){v.request({_cdapNsPath:"/status",method:"POST",body:b}).then(function(t){angular.forEach(t,function(t){"RUNNING"===t.status?(A[t.appId]="Running",S.statusCount.running++):o.getScheduleStatus({namespace:s.params.namespace,appId:t.appId,scheduleId:"ETLWorkflow"===t.programId?"etlWorkflow":"dataPipelineSchedule",scope:e}).$promise.then(function(e){"SCHEDULED"===e.status?(A[t.appId]="Scheduled",S.statusCount.scheduled++):(A[t.appId]="Suspended",S.statusCount.suspended++),g()})}),g()}),v.request({_cdapNsPath:"/status",method:"POST",body:C}).then(function(e){angular.forEach(e,function(e){"RUNNING"===e.status?(A[e.appId]="Running",S.statusCount.running++):(A[e.appId]="Suspended",S.statusCount.suspended++)}),g()})}function g(){angular.forEach(S.pipelineList,function(e){e._status=e._status||A[e.id]})}function y(){return r.get("hydratorDrafts").then(function(e){var t=i.objectQuery(e,a.namespace);angular.isObject(t)&&Object.keys(t).length&&angular.forEach(e[a.namespace],function(e,t){S.statusCount.draft++,S.pipelineList.push({isDraft:!0,name:e.name,id:e.__ui__&&e.__ui__.draftId?e.__ui__.draftId:t,artifact:e.artifact,description:i.objectQuery(e,"description"),_status:"Draft",_stats:{numRuns:"N/A",lastStartTime:"N/A"}})})})}var v=new c(e),S=this,P=function(e){return!Number.isNaN(e)&&Array.isArray(S.pipelineList)&&Math.floor(S.pipelineList.length)>=e};S.pipelineList=[];var T=function(){var e=parseInt(a.page,10);e&&P(e)?S.currentPage=e:S.currentPage=1,S.goToPage()};S.goToPage=function(){S.currentPage&&(a.page=S.currentPage,s.go("hydratorplusplus.list",a,{notify:!1}))},S.statusCount={running:0,scheduled:0,suspended:0,draft:0},S.GLOBALS=n;var C=[],b=[],A={};t.list({namespace:a.namespace}).$promise.then(function(e){S.pipelineList=e,y().then(T),angular.forEach(S.pipelineList,function(e){e._stats={},f(e)}),h()}),S.deleteDraft=function(e){d.showLoadingIcon().then(function(){var t=void 0;r.get("hydratorDrafts").then(function(n){var s=i.objectQuery(n,a.namespace,e);return s&&(t=s.name,delete n[a.namespace][e]),r.set("hydratorDrafts",n)}).then(function(){d.hideLoadingIconImmediate(),s.reload().then(function(){p.show({type:"success",content:"Pipeline draft "+t+" deleted successfully"})})},function(){d.hideLoadingIconImmediate(),s.reload().then(function(){p.show({type:"danger",content:"Pipeline draft "+t+" delete failed"})})})})},S.deleteApp=function(t){d.showLoadingIcon().then(function(){var a={namespace:s.params.namespace,appId:t,scope:e};return u["delete"](a).$promise}).then(function(){d.hideLoadingIconImmediate(),s.reload().then(function(){p.show({type:"success",content:"Pipeline "+t+" deleted successfully"})})},function(){d.hideLoadingIconImmediate(),s.reload().then(function(){p.show({type:"danger",content:"Pipeline "+t+" delete failed"})})})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").factory("HydratorPlusPlusCanvasFactory",["myHelpers","$q","myAlertOnValium","GLOBALS",function(e,t,a,n){function r(e,t,a){if(e.visited)return t;e.visited=!0,t.push(e);var n=a.filter(function(t){return e.to===t.from?t:void 0});return n.length?r(n[0],t,a):void 0}function s(e){function t(e){return e.to===r.from?e:void 0}for(var a={},n=0;n<e.length;n++){var r=e[n],s=e.filter(t);if(!s.length){a=r;break}}return a}function i(e,t,a){var i=angular.copy(e);if(!i.length)return i;var o=[],l=[],c={};a.forEach(function(e){c[e.name]=e});var u=e.filter(function(e){return c[e.from].type===n.pluginTypes[t].source?e:void 0});return u.length||(u=[s(i)]),r(u[0],o,i),o.length<i.length&&(i.forEach(function(e){var t=0===o.filter(function(t){return t.from===e.from&&t.to===e.to}).length;t&&l.push(e)}),o=o.concat(l)),o.map(function(e){return delete e.visited,e})}function o(t){function a(e,t){return t&&angular.forEach(e,function(a,n){var r=t[n]&&t[n].required,s="format.setting.pattern"===n,i=""===e[n]||null===e[n],o=!t[n]&&"errorDatasetName"!==n;(!s||i)&&(o||!r&&i)&&delete e[n]}),angular.forEach(e,function(t,a){var n=angular.isDefined(e[a])&&angular.isString(e[a]),r=""===e[a]||null===e[a];n&&(e[a]=e[a].toString()),r&&delete e[a]}),e}angular.isArray(t.stages)&&t.stages.forEach(function(t){angular.isObject(e.objectQuery(t,"plugin","properties"))&&Object.keys(t.plugin.properties).length>0&&(t.plugin.properties=a(t.plugin.properties,t.plugin._backendProperties))})}function l(e){return o(e),angular.isArray(e.stages)&&e.stages.forEach(function(e){delete e.plugin._backendProperties}),e}return{orderConnections:i,pruneProperties:l}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s){_classCallCheck(this,e),this.$q=t,this.HydratorPlusPlusHydratorService=a,this.myHelpers=r,this.IMPLICIT_SCHEMA=n,this.GLOBALS=s}return e.$inject=["$q","HydratorPlusPlusHydratorService","IMPLICIT_SCHEMA","myHelpers","GLOBALS"],_createClass(e,[{key:"getPluginInfo",value:function(e,t,a,n){var r,s=this;return r=angular.isObject(e._backendProperties)&&Object.keys(e._backendProperties).length?this.$q.when(e):this.HydratorPlusPlusHydratorService.fetchBackendProperties(e,t,n),r.then(function(e){return s.configurePluginInfo(e,t,a)})}},{key:"configurePluginInfo",value:function(e,t,a){var n=this,r=function(e){var t,a=e.outputSchema,r=!1,s=function(e,t){return angular.isObject(t)&&Array.isArray(t.fields)?t.fields.filter(function(t){return t.name===e.name}).length:!1};if("Stream"===e.plugin.name&&(r=!0),-1!==Object.keys(n.IMPLICIT_SCHEMA).indexOf(e.plugin.properties.format)&&(a=n.IMPLICIT_SCHEMA[e.plugin.properties.format]),"string"==typeof a)try{t=JSON.parse(a)}catch(i){t=null}else t=a;if(r){var o=[],l={name:"ts",type:"long"},c={name:"headers",type:{type:"map",keys:"string",values:"string"}};s(l,t)||o.push(l),s(c,t)||o.push(c),t=n.HydratorPlusPlusHydratorService.formatOutputSchemaToAvro({fields:o.concat(n.myHelpers.objectQuery(t,"fields")||[])})}return t};return-1===["action","source"].indexOf(this.GLOBALS.pluginConvert[e.type])&&(e.inputSchema=a.map(function(e){return{name:e.plugin.label,schema:n.HydratorPlusPlusHydratorService.formatOutputSchemaToAvro(r(e))}})),e}}]),e}();t.$inject=["$q","HydratorPlusPlusHydratorService","IMPLICIT_SCHEMA","myHelpers","GLOBALS"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusNodeService",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e){function t(t){return e.artifactConvert[t]||t}function a(t){return e.pluginTypeToLabel[t]||t}function n(t){if(!t.length)return t;var a=[],n=t.filter(function(t){return t.name===e.pluginLabels.action}),r=t.filter(function(t){return t.name===e.pluginLabels.source}),s=t.filter(function(t){return t.name===e.pluginLabels.transform}),i=t.filter(function(t){return t.name===e.pluginLabels.sink}),o=t.filter(function(t){return t.name===e.pluginLabels.analytics});return r.length&&a.push(r[0]),s.length&&a.push(s[0]),o.length&&a.push(o[0]),i.length&&a.push(i[0]),n.length&&a.push(n[0]),angular.forEach(a,function(e,a){t[a]=e}),t}return{getArtifactDisplayName:t,getPluginTypeDisplayName:a,orderPluginTypes:n}}t.$inject=["GLOBALS"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusOrderingFactory",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i,o,l,c,u){_classCallCheck(this,e),this.GLOBALS=t,this.DAGPlusPlusFactory=a,this.uuid=n,this.$state=r,this.$rootScope=s,this.myPipelineApi=i,this.$q=o,this.IMPLICIT_SCHEMA=l,this.DAGPlusPlusNodesStore=c,this.myHelpers=u}return e.$inject=["GLOBALS","DAGPlusPlusFactory","uuid","$state","$rootScope","myPipelineApi","$q","IMPLICIT_SCHEMA","DAGPlusPlusNodesStore","myHelpers"],_createClass(e,[{key:"getNodesAndConnectionsFromConfig",value:function(e,t){return e.config&&e.config.stages?this._parseNewConfigStages(e.config,t):this._parseOldConfig(e,t)}},{key:"_parseNewConfigStages",value:function(e,t){var a=this,n=[],r=[];e.stages.forEach(function(e){var t=angular.extend(e,{type:e.plugin.type,label:e.plugin.label,icon:a.DAGPlusPlusFactory.getIcon(e.plugin.name)});n.push(t)}),r=e.connections;var s;return s=t?this.DAGPlusPlusFactory.getGraphLayout(n,r,100):this.DAGPlusPlusFactory.getGraphLayout(n,r),angular.forEach(n,function(e){e._uiPosition={top:s._nodes[e.name].y+"px",left:s._nodes[e.name].x+"px"}}),{nodes:n,connections:r}}},{key:"_parseOldConfig",value:function(e,t){var a=this,n=[],r=[],s=e.config,i=this.GLOBALS.pluginTypes[e.artifact.name],o=angular.copy(s.source),l=angular.copy(s.transforms||[]).map(function(e){return e.type=i.transform,e.label=e.label||e.name,e.icon=a.DAGPlusPlusFactory.getIcon(e.plugin.name),e}),c=angular.copy(s.sinks).map(function(e){return e.type=i.sink,e.icon=a.DAGPlusPlusFactory.getIcon(e.plugin.name),e});Object.keys(o).length>0&&(o.type=i.source,o.icon=this.DAGPlusPlusFactory.getIcon(o.plugin.name),n.push(o)),n=n.concat(l),n=n.concat(c),r=s.connections;var u;return u=t?this.DAGPlusPlusFactory.getGraphLayout(n,r,100):this.DAGPlusPlusFactory.getGraphLayout(n,r),angular.forEach(n,function(e){e._uiPosition={top:u._nodes[e.name].y+"px",left:u._nodes[e.name].x+"px"}}),{nodes:n,connections:r}}},{key:"fetchBackendProperties",value:function(e,t,a){var n=this,r=this.$q.defer(),s={namespace:this.$state.params.namespace,pipelineType:t,version:a||this.$rootScope.cdapVersion,extensionType:e.type,pluginName:e.plugin.name};return this.myPipelineApi.fetchPluginProperties(s).$promise.then(function(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],a=e.plugin.artifact;if(e.plugin&&!e.plugin.artifact&&t.length){var s=t.length-1;e._backendProperties=t[s].properties||{},e.description=t[s].description,e.plugin.artifact=t[s].artifact,r.resolve(e)}else{var i=t.filter(function(e){return angular.equals(e.artifact,a)}),o=i.length?i[0].properties:{};t.length&&!n.myHelpers.objectQuery(e,"description","length")&&(e.description=t[0].description),e._backendProperties=o,r.resolve(e)}return r.promise})}},{key:"formatSchema",value:function(e){var t="Stream"===e.name,a=void 0,n=void 0,r=void 0;if(t){var s=Object.keys(this.IMPLICIT_SCHEMA);r=-1!==s.indexOf(e.plugin.properties.format)?this.IMPLICIT_SCHEMA[e.plugin.properties.format]:e.outputSchema}else r=e.outputSchema;try{n=JSON.parse(r)}catch(i){n=null}return t&&(n||(n={fields:[{name:"body",type:"string"}]},n.fields.unshift({name:"headers",type:{type:"map",keys:"string",values:"string"}}),n.fields.unshift({name:"ts",type:"long"}))),a=n?n.fields:null,angular.forEach(a,function(e){angular.isArray(e.type)?(e.type=e.type[0],e.nullable=!0):e.nullable=!1}),a}},{key:"generateSchemaOnEdge",value:function(e){for(var t,a=this.DAGPlusPlusNodesStore.getNodes(),n=0;n<a.length;n++)if(a[n].name===e){t=a[n];break}return this.formatSchema(t)}},{key:"formatOutputSchema",value:function(e){var t="map<string, string>",a={type:"map",keys:"string",values:"string"},n=[];if(angular.forEach(e,function(e){if(e.name){var r;r=e.type===t?angular.copy(a):e.type,n.push({name:e.name,type:e.nullable?[r,"null"]:r})}}),0!==n.length){var r={type:"record",name:"etlSchemaBody",fields:n},s=JSON.stringify(r);return s}return null}},{key:"formatOutputSchemaToAvro",value:function(e){var t="map<string, string>",a={type:"map",keys:"string",values:"string"},n=[],r=void 0;if("string"==typeof e)try{r=JSON.parse(e)}catch(s){return console.log("ERROR: Parsing schema JSON ",s),e}else{if(null===e||"undefined"==typeof e)return"";r=angular.copy(e)}return r.name&&r.type&&r.fields?JSON.stringify(r):(n=Object.keys(r).map(function(e){return r[e]===t?{name:e,type:a}:{name:e,type:r[e]}}),JSON.stringify({name:r.name||"etlSchemaBody",type:r.type||"record",fields:r.fields||n}))}}]),e}();t.$inject=["GLOBALS","DAGPlusPlusFactory","uuid","$state","$rootScope","myPipelineApi","$q","IMPLICIT_SCHEMA","DAGPlusPlusNodesStore","myHelpers"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusHydratorService",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=function(e){var t=0;return angular.isObject(e._backendProperties)&&Object.keys(e._backendProperties).length&&angular.forEach(e._backendProperties,function(a,n){a.required&&(e.plugin.properties&&e.plugin.properties[n]||t++)}),t},a=function(e,a,n){e.objectQuery(a,"length")&&a.forEach(function(e){var a=t(e),r="MISSING-REQUIRED-FIELDS";a>0?n(r,e,a):n(!1,e,a)})},n=function(e,t,a){var n=!0;if(!e.objectQuery(t,"length"))return n;var r={};return angular.forEach(t,function(e){var t=e.plugin.label||e.name;r[t]||(r[t]=[]),r[t].push(e)}),angular.forEach(r,function(e){e.length>1?e.forEach(function(e){var t="DUPLICATE-NAME";a(t,e)}):a(!1,e[0])}),n},r=function(e,t,a,n){var r=void 0,s=0;return e.objectQuery(a,"length")||n(!1),a.forEach(function(e){"source"===t.pluginConvert[e.type]&&s++}),0===s?(r="NO-SOURCE-FOUND",void n(r)):void n(!1)},s=function(e,t,a,n){if(!e.objectQuery(a,"length")||!t.length)return void n(!1);var r=void 0,s=a.filter(function(e){var a=e.plugin.label||e.name;return a===t});return s.length>1?(r="DUPLICATE-NAME",void n(r)):void n(!1)},i=function(e,t){var a=void 0,n=/^[\w-]+$/;return e?n.test(e)?void t(!1):(a="INVALID-NAME",void t(a)):(a="MISSING-NAME",void t(a))},o=function(e,t,a,n){var r=void 0,s=0;return e.objectQuery(a,"length")||n(!1),a.forEach(function(e){"sink"===t.pluginConvert[e.type]&&s++}),0===s?(r="NO-SINK-FOUND",void n(r)):void n(!1)},l=function(e,t,a,n){var r={},s={};angular.forEach(a,function(e){r[e.to]=e.from,s[e.from]=e.to}),angular.forEach(t,function(t){switch(e.pluginConvert[t.type]){case"source":s[t.name]||n(t);break;case"transform":r[t.name]&&s[t.name]||n(t);break;case"sink":r[t.name]||n(t);break;case"action":r[t.name]||s[t.name]||n(t)}})},c=function(e,t,a,n){var r={};angular.forEach(t,function(e){r[e.name]=e}),angular.forEach(a,function(t){var a=r[t.from],s=r[t.to],i=e.pluginConvert[a.type],o=e.pluginConvert[s.type];switch(i){case"source":case"transform":"transform"!==o&&"sink"!==o&&n(a.plugin.label+" → "+s.plugin.label);break;case"sink":"action"!==o&&n(a.plugin.label+" → "+s.plugin.label);break;case"action":"action"!==o&&"source"!==o&&n(a.plugin.label+" → "+s.plugin.label)}})},u=function(e){return e.artifact&&e.artifact.name.length&&e.artifact.version.length&&e.artifact.scope.length},p=function(e){return e.config},d=function(e,t){var a=-1!==t.etlBatchPipelines.indexOf(e.artifact.name);return a?e.config.schedule:!0},m=function(e,t){var a=e.artifact.name===t.etlRealtime;return a?e.config.instances:!0},f=function(e){if(!e.config.connections)return!0;var t=e.config,a=!0,n={},r=void 0;return r=e.__ui__?e.__ui__.nodes:t.stages?t.stages:[],r.forEach(function(e){return n[e.name]=e}),t.connections.forEach(function(e){a=a&&n[e.from]&&n[e.to]}),a},h=function(e){var t=function(e){return e>0};return t(e.virtualCores)&&t(e.memoryMB)},g=function(e){return!e||!e.virtualCores||!e.memoryMB},y=function(e,t){var a=e.resources;g(a)?t("MISSING-RESOURCES"):h(a)||t("INVALID-RESOURCES")},v=function(e,t){var a=e.driverResources;g(a)?t("MISSING-DRIVERRESOURCES"):h(a)||t("INVALID-DRIVERRESOURCES")},S=function(e,t,a){var n=["en","hydrator","studio","error","IMPORT-JSON"],r=[{fn:u,messagePath:n.concat(["INVALID-ARTIFACT"])},{fn:p,messagePath:n.concat(["INVALID-CONFIG"])},{fn:d,messagePath:n.concat(["INVALID-SCHEDULE"])},{fn:m,messagePath:n.concat(["INVALID-INSTANCE"])},{fn:f,messagePath:n.concat(["INVALID-NODES-CONNECTIONS"])}],s=void 0;for(s=0;s<r.length;s++){var i=r[s];if(!i.fn.call(null,a,t))return e.objectQuery.apply(null,[t].concat(i.messagePath))}return!1},P=function(e,u){return{isUniqueNodeNames:n.bind(null,u),isRequiredFieldsFilled:a.bind(null,u),countUnFilledRequiredFields:t,hasValidName:i,hasValidResources:y,hasValidDriverResources:v,hasAtleastOneSource:r.bind(null,u,e),hasAtLeastOneSink:o.bind(null,u,e),isNodeNameUnique:s.bind(null,u),allNodesConnected:l.bind(null,e),allConnectionsValid:c.bind(null,e),validateImportJSON:S.bind(null,u,e)}};P.$inject=["GLOBALS","myHelpers"],angular.module(e.name+".feature.hydratorplusplus").factory("NonStorePipelineErrorFactory",P)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r){_classCallCheck(this,e),this.$q=t,this.myHelpers=a,this.myPipelineApi=n,this.$state=r,this.data={}}return e.$inject=["$q","myHelpers","myPipelineApi","$state"],_createClass(e,[{key:"fetchWidgetJson",value:function(e,t,a,n){var r=this,s=this.data[e+"-"+t+"-"+a+"-"+n];return s?this.$q.when(s):this.myPipelineApi.fetchArtifactProperties({namespace:this.$state.params.namespace||this.$state.params.nsadmin,artifactName:e,artifactVersion:t,scope:a,keys:n}).$promise.then(function(a){try{var s=a[n];if(s)return s=JSON.parse(s),r.data[e+"-"+t+"-"+n]=s,s;throw"NO_JSON_FOUND"}catch(i){throw i&&"SyntaxError"===i.name?"CONFIG_SYNTAX_JSON_ERROR":i}},function(){throw"NO_JSON_FOUND"})}},{key:"fetchDocJson",value:function(e,t,a,n){return this.myPipelineApi.fetchArtifactProperties({namespace:this.$state.params.namespace,artifactName:e,artifactVersion:t,scope:a,keys:n}).$promise}},{key:"generateNodeConfig",value:function(e,t){var a=this.myHelpers.objectQuery(t,"metadata","spec-version")||"0.0";switch(a){case"0.0":return this.generateConfigForOlderSpec(e,t);case"1.0":case"1.1":return this.generateConfigForNewSpec(e,t);case"1.2":return this.generateConfigFor12Spec(e,t);case"1.3":return this.generateConfigFor13Spec(e,t);default:throw"NO_JSON_FOUND"}}},{key:"generateConfigFor13Spec",value:function(e,t){var a=this.generateConfigFor12Spec(e,t);return a.jumpConfig={},"object"===_typeof(t["jump-config"])&&(a.jumpConfig=t["jump-config"]),a}},{key:"generateConfigFor12Spec",value:function(e,t){var a=this.generateConfigForNewSpec(e,t);return a.inputs={},"object"===_typeof(t.inputs)&&t.inputs.multipleInputs&&(a.inputs.multipleInputs=!0),a}},{key:"generateConfigForNewSpec",value:function(e,t){var a=this,n=Object.keys(e),r={backendProperties:n,outputSchema:{isOutputSchemaExists:!1,schemaProperties:null,outputSchemaProperty:null,isOutputSchemaRequired:null,implicitSchema:null,watchProperty:null},groups:[]},s={display:"Generic",fields:[]};return t["configuration-groups"].forEach(function(t){var s=t.properties.filter(function(t){var r=n.indexOf(t.name);if(-1!==r){n.splice(r,1);var s=t.description;return(!s||s&&!s.length)&&(s=a.myHelpers.objectQuery(e,t.name,"description"),t.description=s||"No Description Available"),t.label=t.label||t.name,t.defaultValue=a.myHelpers.objectQuery(t,"widget-attributes","default"),!0}return!1});r.groups.push({display:t.label,fields:s})}),t.outputs&&t.outputs.length&&t.outputs.forEach(function(t){var a;"non-editable-schema-editor"===t["widget-type"]?(r.outputSchema.isOutputSchemaExists=!0,
r.outputSchema.implicitSchema=t.schema):(a=n.indexOf(t.name),-1!==a&&(n.splice(a,1),r.outputSchema.isOutputSchemaExists=!0,r.outputSchema.outputSchemaProperty=[t.name],r.outputSchema.schemaProperties=t["widget-attributes"],r.outputSchema.isOutputSchemaRequired=e[t.name].required))}),n.length&&(n.forEach(function(t){s.fields.push({"widget-type":"textbox",label:t,name:t,info:"Info",description:a.myHelpers.objectQuery(e,t,"description")||"No Description Available"})}),r.groups.push(s)),r}},{key:"generateConfigForOlderSpec",value:function(e,t){var a,n,r=this,s=Object.keys(e),i={backendProperties:s,outputSchema:{isOutputSchemaExists:!1,schemaProperties:null,outputSchemaProperty:null,isOutputSchemaRequired:null,implicitSchema:!1},groups:[]};return t.outputschema?(i.outputSchema.outputSchemaProperty=Object.keys(t.outputschema),t.outputschema.implicit?t.outputschema&&t.outputschema.implicit&&(i.outputSchema.implicitSchema=t.outputschema.implict,i.outputSchema.isOutputSchemaExists=!0):(i.outputSchema.isOutputSchemaExists=-1!==s.indexOf(i.outputSchema.outputSchemaProperty[0]),i.outputSchema.isOutputSchemaExists&&(n=i.outputSchema.outputSchemaProperty[0],a=s.indexOf(n),i.outputSchema.schemaProperties=t.outputschema[n],i.outputSchema.isOutputSchemaRequired=e[n].required,s.splice(a,1)))):i.outputSchema.isOutputSchemaExists=!1,angular.forEach(t.groups.position,function(e){var a=t.groups[e],n={};n.label=a.display,n.fields=[],angular.forEach(a.position,function(o){var l=a.fields[o],c=s.indexOf(o);if(-1!==c){s.splice(c,1),l.name=o,l.info=r.myHelpers.objectQuery(i,"groups",e,"fields",o,"info")||"Info";var u=r.myHelpers.objectQuery(t,"groups",e,"fields",o,"description");(!u||u&&!u.length)&&(u=r.myHelpers.objectQuery("backendProperties",o,"description"),l.description=u||"No Description Available");var p=r.myHelpers.objectQuery(t,"groups",e,"fields",o,"label");p||(l.label=o),l.defaultValue=r.myHelpers.objectQuery(t,"groups",e,"fields",o,"properties","default")}n.fields.push(l)}),i.groups.push(n)}),s.length&&!function(){var t={label:"Generic",fields:[]};angular.forEach(s,function(a){t.fields.push({widget:"textbox",label:a,info:"Info",description:r.myHelpers.objectQuery(e,a,"description")||"No Description Available"})}),i.groups.push(t)}(),i}}]),e}();t.$inject=["$q","myHelpers","myPipelineApi","$state"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusPluginConfigFactory",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.overview").controller("AppsSectionCtrl",["myAppUploader","myStreamApi","myDatasetApi","MyCDAPDataSource","MyOrderings","$scope","$state","GLOBALS","myHydratorFactory","getHydratorUrl","getTrackerUrl",function(e,t,a,n,r,s,i,o,l,c,u){this.getHydratorUrl=c,this.getTrackerUrl=u;var p=new n(s);this.MyOrderings=r,this.apps=[],this.GLOBALS=o,this.myHydratorFactory=l,this.dataList=[],p.request({_cdapNsPath:"/apps"}).then(function(e){this.apps=this.apps.concat(e).filter(function(e){return"_"!==e.name[0]})}.bind(this));var d={namespace:i.params.namespace,scope:s};a.list(d).$promise.then(function(e){this.dataList=this.dataList.concat(e).filter(function(e){return 0!==e.name.indexOf("_")&&"externalDataset"!==e.type})}.bind(this)),t.list(d).$promise.then(function(e){angular.isArray(e)&&e.length&&(angular.forEach(e,function(e){e.type="Stream"}),this.dataList=this.dataList.concat(e).filter(function(e){return 0!==e.name.indexOf("_")}))}.bind(this)),this.onFileSelected=e.upload}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.overview").controller("OverviewCtrl",["$scope","$state","myLocalStorage","MY_CONFIG","Widget","MyMetricsQueryHelper","MyChartHelpers","MyCDAPDataSource","ServiceStatusFactory","getHydratorUrl","getTrackerUrl",function(e,t,a,n,r,s,i,o,l,c,u){var p=new o(e);if(t.params.namespace){this.getHydratorUrl=c,this.getTrackerUrl=u,this.isEnterprise=n.isEnterprise,this.systemStatus=l.systemStatus,this.wdgts=[];var d={size:{height:100,width:280},chartMetadata:{showx:!1,showy:!1,legend:{show:!1,position:"inset"}},color:{pattern:["red","#f4b400"]},isLive:!0,interval:6e4,aggregate:5};this.wdgts.push(new r({title:"System",type:"c3-line",settings:d,metric:{context:"namespace.*",names:["system.services.log.error","system.services.log.warn"],startTime:"now-3600s",endTime:"now",resolution:"1m"},metricAlias:{"system.services.log.error":"System Errors","system.services.log.warn":"System Warnings"}}),new r({title:"Applications",type:"c3-line",settings:d,metric:{context:"namespace."+t.params.namespace,names:["system.app.log.error","system.app.log.warn"],startTime:"now-3600s",endTime:"now",resolution:"1m"},metricAlias:{"system.app.log.error":"Application Errors","system.app.log.warn":"Application Warnings"}})),angular.forEach(this.wdgts,function(e){p.poll({_cdapPath:"/metrics/query",method:"POST",body:s.constructQuery("qid",s.contextToTags(e.metric.context),e.metric)},function(t){var a=i.processData(t,"qid",e.metric.names,e.metric.resolution,e.settings.aggregate);a=i.c3ifyData(a,e.metric,e.metricAlias);var n={x:"x",columns:a.columns,keys:{x:"x"}};e.formattedData=n,e.chartData=angular.copy(a)})})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s){_classCallCheck(this,e),this.tag=t.tag,this.$stateParams=t,this.taggedObjects=[],this.myTagsApi=a,this.loading=!1,n.select("searchObjectWithTags"),this.fetchAssociatedObjects(),this.myHydratorFactory=r,this.GLOBALS=s}return e.$inject=["$stateParams","myTagsApi","caskFocusManager","myHydratorFactory","GLOBALS"],_createClass(e,[{key:"fetchAssociatedObjects",value:function(){var e=this;this.loading=!0;var t={namespaceId:this.$stateParams.namespace,query:""+this.tag};this.myTagsApi.searchTags(t).$promise.then(function(t){t.results.forEach(function(t){e.parseTaggedObject(t)}),e.loading=!1},function(){e.loading=!1})}},{key:"parseTaggedObject",value:function(e){var t=e.entityId.type,a=e.entityId.id,n={sizeX:2,sizeY:1,row:null,col:null};switch(t){case"stream":angular.extend(n,{namespaceId:a.namespace.id,streamId:a.streamName,type:t,icon:"icon-app"});break;case"datasetinstance":angular.extend(n,{namespaceId:a.namespace.id,datasetId:a.instanceId,type:t,icon:"icon-datasets"});break;case"application":angular.extend(n,{namespaceId:a.namespace.id,appId:a.applicationId,type:t,icon:"icon-app"});break;case"program":angular.extend(n,{namespaceId:a.application.namespace.id,appId:a.application.applicationId,programType:a.type,programId:a.id,type:t,icon:"flow"===a.type.toLowerCase()?"icon-tigon":"icon-"+a.type.toLowerCase()});break;default:return}this.taggedObjects.push(n)}}]),e}();t.$inject=["$stateParams","myTagsApi","caskFocusManager","myHydratorFactory","GLOBALS"],angular.module(e.name+".feature.search").controller("SearchObjectWithTagsController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.spark").controller("SparkDetailController",["$scope","MyCDAPDataSource","$state","MY_CONFIG",function(e,t,a,n){this.isEnterprise=n.isEnterprise}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.streams").controller("StreamsCreateController",["$scope","MyCDAPDataSource","$uibModalInstance","caskFocusManager",function(e,t,a,n){n.focus("streamId");var r=new t(e);this.streamId="",this.createStream=function(){r.request({_cdapNsPath:"/streams/"+e.streamId,method:"PUT"}).then(function(e){a.close(e)},function(e){this.error=e}.bind(this))},this.closeModal=function(){a.close()}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.streams").controller("CdapStreamDetailController",["$scope","$state","myAlertOnValium","myStreamService","myStreamApi",function(e,t,a,n,r){this.truncate=function(){var n={namespace:t.params.namespace,streamId:t.params.streamId,scope:e};r.truncate(n,{}).$promise.then(function(){a.show({type:"success",content:"Successfully truncated "+t.params.streamId+" stream"})})},this.metadataParams={namespace:t.params.namespace,streamId:t.params.streamId},this.sendEvents=function(){n.show(t.params.streamId)}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r){_classCallCheck(this,e),this.$state=t,this.$scope=a,this.myTrackerApi=n,this.myAlertOnValium=r,this.timeRangeOptions=[{label:"Last 7 days",start:"now-7d",end:"now"},{label:"Last 14 days",start:"now-14d",end:"now"},{label:"Last month",start:"now-30d",end:"now"},{label:"Last 6 months",start:"now-180d",end:"now"},{label:"Last 12 months",start:"now-365d",end:"now"}],this.timeRange={start:t.params.start||"now-7d",end:t.params.end||"now"},this.customTimeRange={startTime:null,endTime:null},this.enableTrackerLoading=!1,this.selectedTimeRange=this.findTimeRange(),this.currentPage=1,this.auditLogs=[],this.fetchAuditLogs(this.currentPage)}return e.$inject=["$state","$scope","myTrackerApi","myAlertOnValium"],_createClass(e,[{key:"findTimeRange",value:function(){var e=this,t=this.timeRangeOptions.filter(function(t){return t.start===e.timeRange.start&&t.end===e.timeRange.end});return 0===t.length&&(this.isCustom=!0,this.customTimeRange.startTime=new Date(1e3*parseInt(this.$state.params.start,10)),this.customTimeRange.endTime=new Date(1e3*parseInt(this.$state.params.end,10))),t.length>0?t[0]:{label:"Custom"}}},{key:"goToCustomTimeRangeEntityDetailView",value:function(){var e=parseInt(this.customTimeRange.startTime.valueOf()/1e3,10),t=parseInt(this.customTimeRange.endTime.valueOf()/1e3,10);this.$state.go("tracker.detail.entity.audit",{start:e,end:t})}},{key:"selectCustom",value:function(){this.isCustom=!0,this.selectedTimeRange.label="Custom"}},{key:"fetchAuditLogs",value:function(e){var t=this;this.enableTrackerLoading=!1;var a={namespace:this.$state.params.namespace,entityType:"streams"===this.$state.params.entityType?"stream":"dataset",entityId:this.$state.params.entityId,startTime:this.timeRange.start,endTime:this.timeRange.end,offset:10*(e-1),scope:this.$scope};this.myTrackerApi.getAuditLogs(a).$promise.then(function(e){t.auditLogs=e},function(e){t.myAlertOnValium.show({type:"danger",content:e.data})})}}]),e}();t.$inject=["$state","$scope","myTrackerApi","myAlertOnValium"],angular.module(e.name+".feature.tracker").controller("TrackerAuditController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){_classCallCheck(this,e),this.$state=t,this.searchQuery=this.$state.params.searchQuery||this.$state.params.searchTerm}return e.$inject=["$state"],_createClass(e,[{key:"search",value:function(e){13===e.keyCode&&this.searchQuery&&this.$state.go("tracker.detail.result",{searchQuery:this.searchQuery},{reload:!0})}}]),e}();t.$inject=["$state"],angular.module(e.name+".feature.tracker").controller("TrackerContainerController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i){"ngInject";_classCallCheck(this,e),this.$state=t,this.$scope=s,this.myJumpFactory=a,this.myTrackerApi=i;var o=this.$state.params.entityType,l=o.split(":");switch(this.datasetType=n,this.datasetExplorable=Array.isArray(r)&&-1!==r.indexOf("explore"),l[0]){case"streams":this.entityInfo={name:"Stream",icon:"icon-streams"};break;case"datasets":this.entityInfo={name:"Dataset",icon:"icon-datasets"};break;case"views":this.entityInfo={name:"Stream View",icon:"icon-streams"}}this.fetchTruthMeter()}return e.$inject=["$state","myJumpFactory","rDatasetType","rSystemTags","$scope","myTrackerApi"],_createClass(e,[{key:"fetchTruthMeter",value:function(){var e=this,t={namespace:this.$state.params.namespace,scope:this.$scope},a=[],n=[];if("Stream"===this.entityInfo.name)n.push(this.$state.params.entityId);else{if("Dataset"!==this.entityInfo.name)return;a.push(this.$state.params.entityId)}this.myTrackerApi.getTruthMeter(t,{streams:n,datasets:a}).$promise.then(function(t){e.truthMeterMap=t},function(e){console.log("error",e)})}},{key:"goBack",value:function(){this.$state.go("tracker.detail.result",{namespace:this.$state.params.namespace,searchQuery:this.$state.params.searchTerm})}}]),e}();t.$inject=["$state","myJumpFactory","rDatasetType","rSystemTags","$scope","myTrackerApi"],angular.module(e.name+".feature.tracker").controller("TrackerEntityController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i,o,l,c){var u=this;_classCallCheck(this,e),this.$state=t,this.myTrackerApi=a,this.$scope=n,this.myAlertOnValium=r,this.MyChartHelpers=i,this.MyMetricsQueryHelper=o,this.$uibModal=l,this.UI_CONFIG=c,this.dataSrc=new s(n),this.navigatorSetup={isOpen:!1,isSetup:!1,isEnabled:!1,popoverEnabled:!0},this.showConfig=!1,this.optionalSettings={navigator:!1,kafka:!1},this.navigatorInfo={navigatorConfig:{navigatorHostName:"",username:"",password:"",navigatorPort:"",autocommit:"",namespace:"",applicationURL:"",fileFormat:"",navigatorURL:"",metadataParentURI:""},auditKafkaConfig:{zookeeperString:"",topic:"",numPartitions:"",offsetDataset:""}},this.originalConfig=angular.copy(this.navigatorInfo),this.chartSettings={chartMetadata:{showx:!1,showy:!1,legend:{show:!1,position:"inset"}},color:{pattern:["#35c853"]},isLive:!0,interval:1e3,aggregate:5},this.navigatorState={},this.getNavigatorApp(),this.pollId=null,n.$watch("IntegrationsController.navigatorSetup.isOpen",function(){!u.navigatorSetup.isOpen&&u.navigatorSetup.isSetup&&(u.navigatorSetup.popoverEnabled=!1,u.cancelSetup()),u.optionalSettings.navigator=!1,u.optionalSettings.kafka=!1})}return e.$inject=["$state","myTrackerApi","$scope","myAlertOnValium","MyCDAPDataSource","MyChartHelpers","MyMetricsQueryHelper","$uibModal","UI_CONFIG"],_createClass(e,[{key:"getKafkaBrokerList",value:function(){var e=this;this.myTrackerApi.getCDAPConfig({scope:this.$scope}).$promise.then(function(t){var a=t.filter(function(e){return"zookeeper.quorum"===e.name}),n=t.filter(function(e){return"kafka.zookeeper.namespace"===e.name}),r=a[0].value+"/"+n[0].value;e.navigatorInfo.auditKafkaConfig.zookeeperString=r,e.originalConfig.auditKafkaConfig.zookeeperString=r})}},{key:"getNavigatorApp",value:function(){var e=this,t={namespace:this.$state.params.namespace,scope:this.$scope};this.myTrackerApi.getNavigatorApp(t).$promise.then(function(t){e.navigatorSetup.isSetup=!0,e.navigatorSetup.popoverEnabled=!1,e.optionalSettings.navigator=!1,e.optionalSettings.kafka=!1;var a={};try{a=JSON.parse(t.configuration),e.originalConfig=angular.copy(a),e.navigatorInfo.navigatorConfig=a.navigatorConfig,e.navigatorInfo.auditKafkaConfig=a.auditKafkaConfig,e.getNavigatorStatus()}catch(n){console.log("Cannot parse configuration JSON")}},function(){e.getKafkaBrokerList()})}},{key:"getNavigatorStatus",value:function(){var e=this,t={namespace:this.$state.params.namespace,scope:this.$scope};this.myTrackerApi.getNavigatorStatus(t).$promise.then(function(t){t.length?(e.navigatorState=t[0],"RUNNING"===t[0].status?(e.navigatorSetup.isEnabled=!0,e.fetchMetrics(),e.logsParams={namespace:e.$state.params.namespace,appId:e.UI_CONFIG.navigator.appId,programType:"flows",programId:e.UI_CONFIG.navigator.programId,runId:t[0].runid.length?t[0].runid:""}):e.dataSrc.stopPoll(e.pollId.__pollId__)):e.navigatorState={status:"DISABLED"}})}},{key:"toggleNavigator",value:function(){var e=this;if(this.navigatorSetup.isEnabled){var t=this.$uibModal.open({templateUrl:"/old_assets/features/tracker/templates/partial/navigator-confirm-modal.html",size:"md",windowClass:"navigator-confirm-modal"});t.result.then(function(t){"disable"===t&&(e.navigatorSetup.isEnabled=!1,e.navigatorState.status="STOPPING",e.navigatorFlowAction("stop"))})}else this.navigatorState.status="STARTING",this.navigatorFlowAction("start"),this.navigatorSetup.isEnabled=!0}},{key:"navigatorFlowAction",value:function(e){var t=this,a={namespace:this.$state.params.namespace,action:e,scope:this.$scope};this.myTrackerApi.toggleNavigator(a,{}).$promise.then(function(){t.getNavigatorStatus()},function(e){t.myAlertOnValium.show({type:"danger",content:e.data})})}},{key:"fetchMetrics",value:function(){var e=this,t={startTime:"now-1h",endTime:"now",resolution:"1m",names:["system.process.events.processed"]},a={namespace:this.$state.params.namespace,app:this.UI_CONFIG.navigator.appId,flow:this.UI_CONFIG.navigator.programId};this.pollId=this.dataSrc.poll({_cdapPath:"/metrics/query",method:"POST",body:this.MyMetricsQueryHelper.constructQuery("qid",a,t)},function(a){var n=e.MyChartHelpers.processData(a,"qid",t.names,t.resolution);n=e.MyChartHelpers.c3ifyData(n,t,t.names),e.chartData={x:"x",columns:n.columns,keys:{x:"x"}},e.eventsSentAggregate=_.sum(e.chartData.columns[0])})}},{key:"editConfiguration",value:function(e){e.stopPropagation(),this.navigatorSetup.popoverEnabled=!0}},{key:"saveNavigatorSetup",value:function(){var e=this;this.saving=!0;var t={namespace:this.$state.params.namespace,scope:this.$scope},a={navigatorConfig:{},auditKafkaConfig:{}};angular.forEach(this.navigatorInfo.navigatorConfig,function(e,t){e.length&&(a.navigatorConfig[t]=e)}),angular.forEach(this.navigatorInfo.auditKafkaConfig,function(e,t){e.length&&(a.auditKafkaConfig[t]=e)});var n={artifact:this.UI_CONFIG.navigator.artifact,config:a};this.myTrackerApi.deployNavigator(t,n).$promise.then(function(){e.navigatorSetup.isOpen=!1,e.saving=!1,e.getNavigatorApp()},function(t){e.saving=!1,e.myAlertOnValium.show({type:"danger",content:t.data})})}},{key:"validateFields",value:function(){return this.navigatorInfo.navigatorConfig.navigatorHostName&&this.navigatorInfo.navigatorConfig.username&&this.navigatorInfo.navigatorConfig.password&&this.navigatorInfo.auditKafkaConfig.zookeeperString}},{key:"cancelSetup",value:function(){this.navigatorSetup.isOpen=!1,this.navigatorInfo.navigatorConfig=angular.copy(this.originalConfig.navigatorConfig),this.navigatorInfo.auditKafkaConfig=angular.copy(this.originalConfig.auditKafkaConfig),this.optionalSettings.navigator=!1,this.optionalSettings.kafka=!1}}]),e}();t.$inject=["$state","myTrackerApi","$scope","myAlertOnValium","MyCDAPDataSource","MyChartHelpers","MyMetricsQueryHelper","$uibModal","UI_CONFIG"],angular.module(e.name+".feature.tracker").controller("TrackerIntegrationsController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s){_classCallCheck(this,e),this.$state=t,this.myTrackerApi=a,this.$scope=n,this.LineageActions=r,s.setDefaults(),this.timeRangeOptions=[{label:"Last 7 days",start:"now-7d",end:"now"},{label:"Last 14 days",start:"now-14d",end:"now"},{label:"Last month",start:"now-30d",end:"now"},{label:"Last 6 months",start:"now-180d",end:"now"},{label:"Last 12 months",start:"now-365d",end:"now"}],this.lineageInfo={},this.loading=!1,this.customTimeRange={startTime:null,endTime:null},this.timeRange={start:t.params.start||"now-7d",end:t.params.end||"now"},this.selectedTimeRange=this.findTimeRange(),this.getLineage(this.$state.params.entityType,this.$state.params.entityId)}return e.$inject=["$state","myTrackerApi","$scope","LineageActions","LineageStore"],_createClass(e,[{key:"findTimeRange",value:function(){var e=this,t=this.timeRangeOptions.filter(function(t){return t.start===e.timeRange.start&&t.end===e.timeRange.end});return 0===t.length&&(this.isCustom=!0,this.customTimeRange.startTime=new Date(1e3*parseInt(this.$state.params.start,10)),this.customTimeRange.endTime=new Date(1e3*parseInt(this.$state.params.end,10))),t.length>0?t[0]:{label:"Custom"}}},{key:"goToCustomTimeRangeEntityDetailView",value:function(){var e=parseInt(this.customTimeRange.startTime.valueOf()/1e3,10),t=parseInt(this.customTimeRange.endTime.valueOf()/1e3,10);this.$state.go("tracker.detail.entity.lineage",{start:e,end:t})}},{key:"selectCustom",value:function(){this.isCustom=!0,this.selectedTimeRange.label="Custom"}},{key:"getLineage",value:function(e,t){var a=this;this.loading=!0;var n={namespace:this.$state.params.namespace,entityType:e,entityId:t,scope:this.$scope,start:this.timeRange.start,end:this.timeRange.end,levels:1};this.myTrackerApi.getLineage(n).$promise.then(function(e){a.LineageActions.loadLineageData(e,n,a.$state.params.method),a.loading=!1},function(e){console.log("Error",e),a.loading=!1})}}]),e}();t.$inject=["$state","myTrackerApi","$scope","LineageActions","LineageStore"],angular.module(e.name+".feature.tracker").controller("TrackerLineageController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n){_classCallCheck(this,e),this.$state=t,this.$scope=a,this.searchQuery="",this.myTrackerApi=n,this.fetchTopDatasets()}return e.$inject=["$state","$scope","myTrackerApi"],_createClass(e,[{key:"fetchTopDatasets",value:function(){var e=this,t={namespace:this.$state.params.namespace,limit:5,start:"now-7d",end:"now",scope:this.$scope,entity:"datasets"};this.myTrackerApi.getTopEntities(t).$promise.then(function(t){e.topDatasets=t,e.emptyRows=!1,e.serviceUnavailable=!1,e.topDatasets.length>0&&(e.emptyRows=!0,e.totalEmptyRows=Array.apply(null,{length:5-e.topDatasets.length}).map(Number.call,Number))},function(t){503===t.statusCode&&(e.serviceUnavailable=!0),console.log("Error",t)})}},{key:"search",value:function(e){13===e.keyCode&&this.searchQuery&&this.$state.go("tracker.detail.result",{searchQuery:this.searchQuery})}}]),e}();t.$inject=["$state","$scope","myTrackerApi"],angular.module(e.name+".feature.tracker").controller("TrackerMainController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i){var o=this;_classCallCheck(this,e),this.$state=t,this.myTrackerApi=a,this.$scope=n,this.myAlertOnValium=r,this.$timeout=s,this.$q=i,this.duplicateTag=!1,this.propertyInput={key:"",value:""};var l=this.$state.params.entityType.split(":");this.entityType=l;var c={scope:this.$scope,namespace:this.$state.params.namespace,entityType:l[0]},u=void 0;l.length>1?(c.entityId=l[1],c.entityType="streams",c.viewId=this.$state.params.entityId,u=this.myTrackerApi.viewsProperties(c).$promise):(c.entityId=this.$state.params.entityId,c.entityType=l[0],u=this.myTrackerApi.properties(c).$promise),this.systemTags={},this.tags={preferredTags:[],userTags:[],allPreferredTags:[],allUserTags:[],availableTags:[]},this.fetchEntityTags(),this.fetchAllTags(),this.schema=[],this.properties={},this.activePropertyTab=0,this.loading=!0,u.then(function(e){o.loading=!1,o.processResponse(e)},function(e){o.loading=!1,console.log("Error",e)})}return e.$inject=["$state","myTrackerApi","$scope","myAlertOnValium","$timeout","$q"],_createClass(e,[{key:"processResponse",value:function(e){var t=void 0,a=void 0;angular.forEach(e,function(e){"USER"===e.scope?a=e:"SYSTEM"===e.scope&&(t=e)}),this.systemTags={system:t.tags},this.properties={system:t.properties,user:a.properties,isUserEmpty:!1,isSystemEmpty:!1},"externalDataset"===t.properties.type&&this.fetchExternalDatasetProperties(),0===Object.keys(a.properties).length&&(this.activePropertyTab=1,this.properties.isUserEmpty=!0),this.properties.isSystemEmpty=0===Object.keys(t.properties).length,this.schema=t.properties.schema}},{key:"fetchExternalDatasetProperties",value:function(){var e=this,t={namespace:this.$state.params.namespace,entityId:this.$state.params.entityId,scope:this.$scope};this.myTrackerApi.getDatasetDetail(t).$promise.then(function(t){e.externalDatasetProperties=t.spec.properties,Object.keys(e.externalDatasetProperties).length>0&&(e.activePropertyTab=0,e.properties.isUserEmpty=!1)})}},{key:"deleteProperty",value:function(e){var t=this,a={namespace:this.$state.params.namespace,entityType:this.$state.params.entityType,entityId:this.$state.params.entityId,key:e,scope:this.$scope};this.myTrackerApi.deleteEntityProperty(a).$promise.then(function(){delete t.properties.user[e]},function(e){t.myAlertOnValium.show({type:"danger",content:e.data})})}},{key:"addProperty",value:function(){var e=this;if(this.propertyInput.key&&this.propertyInput.value){var t={namespace:this.$state.params.namespace,entityType:this.$state.params.entityType,entityId:this.$state.params.entityId,scope:this.$scope},a={};a[this.propertyInput.key]=this.propertyInput.value,this.myTrackerApi.addEntityProperty(t,a).$promise.then(function(){e.properties.user[e.propertyInput.key]=e.propertyInput.value,e.propertyInput.key="",e.propertyInput.value="",e.propertyFocus()},function(t){e.myAlertOnValium.show({type:"danger",content:t.data})})}}},{key:"propertyKeypress",value:function(e){switch(e.keyCode){case 13:this.addProperty()}}},{key:"propertyFocus",value:function(){this.$timeout(function(){var e=document.getElementById("property-key-input");angular.element(e)[0].focus()})}},{key:"fetchEntityTags",value:function(){var e=this,t={namespace:this.$state.params.namespace,entityId:this.$state.params.entityId,entityType:"streams"===this.$state.params.entityType?"stream":"dataset",scope:this.$scope};return this.myTrackerApi.getEntityTags(t).$promise.then(function(t){var a=function(e){return Object.keys(e).map(function(e){return{name:e}})};e.tags.preferredTags=a(t.preferredTags),e.tags.userTags=a(t.userTags),e.updateAvailableTags()},function(e){console.log("Error",e)})}},{key:"fetchAllTags",value:function(){var e=this,t={namespace:this.$state.params.namespace,scope:this.$scope};this.myTrackerApi.getTags(t).$promise.then(function(t){e.response=t;var a=function(e){return Object.keys(e).map(function(t){return{name:t,count:e[t],label:t+" ("+e[t]+")",preferredTag:!0}})},n=function(e){return Object.keys(e).map(function(t){return{name:t,count:e[t],label:t}})};e.tags.allPreferredTags=a(t.preferredTags),e.tags.allUserTags=n(t.userTags),e.updateAvailableTags()},function(e){console.log("Error",e)})}},{key:"updateAvailableTags",value:function(){var e=function(e,t){var a=t.map(function(e){return e.name});return e.filter(function(e){return-1===a.indexOf(e.name)})},t=e(this.tags.allPreferredTags,this.tags.preferredTags),a=e(this.tags.allUserTags,this.tags.userTags);return this.tags.availableTags=t.concat(a),this.tags.availableTags}},{key:"addTag",value:function(e){var t=this;this.invalidFormat=!1,this.duplicateTag=!1;var a=this.$q.defer();if(!e)return a.reject(),a.promise;var n=this.tags.userTags.filter(function(t){return e===t.name}).length>0?!0:!1,r=this.tags.preferredTags.filter(function(t){return e===t.name}).length>0?!0:!1;if(this.duplicateTag=n||r,this.duplicateTag)a.reject("duplicate");else{var s={namespace:this.$state.params.namespace,entityId:this.$state.params.entityId,entityType:"streams"===this.$state.params.entityType?"stream":"dataset",scope:this.$scope};this.myTrackerApi.addEntityTag(s,[e]).$promise.then(function(){t.fetchEntityTags().then(t.updateAvailableTags.bind(t)),a.resolve("success")},function(e){500===e.statusCode&&(t.invalidFormat=!0),a.reject("error")})}return a.promise}},{key:"deleteTag",value:function(e){var t=this;this.tag=e;var a={namespace:this.$state.params.namespace,tagname:e,entityId:this.$state.params.entityId,entityType:"streams"===this.$state.params.entityType?"stream":"dataset",scope:this.$scope};this.myTrackerApi.deleteEntityTag(a).$promise.then(function(){t.fetchEntityTags()},function(e){t.myAlertOnValium.show({type:"danger",content:e.data})})}},{key:"goToTag",value:function(e,t){e.stopPropagation(),this.$state.go("tracker.detail.result",{searchQuery:t})}},{key:"openTagInput",value:function(e){var t=this;e.stopPropagation(),this.inputOpen=!0,this.eventFunction=function(){t.escapeInput()},document.body.addEventListener("click",this.eventFunction,!1)}},{key:"escapeInput",value:function(){this.invalidFormat=!1,this.duplicateTag=!1,this.inputOpen=!1,document.body.removeEventListener("click",this.eventFunction,!1),this.eventFunction=null}}]),e}();t.$inject=["$state","myTrackerApi","$scope","myAlertOnValium","$timeout","$q"],angular.module(e.name+".feature.tracker").controller("TrackerMetadataController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r){_classCallCheck(this,e),this.$state=t,this.myTrackerApi=a,this.$scope=n,this.dataSrc=new r(n),this.loading=!0,this.viewLimit=10,this.generatePreview()}return e.$inject=["$state","myTrackerApi","$scope","MyCDAPDataSource"],_createClass(e,[{key:"generatePreview",value:function(){var e=this,t={namespace:this.$state.params.namespace,scope:this.$scope},a=void 0;"streams"===this.$state.params.entityType?a="stream":"datasets"===this.$state.params.entityType&&(a="dataset");var n="SELECT * FROM "+a+"_"+this.$state.params.entityId+" LIMIT 500";this.myTrackerApi.postQuery(t,{query:n}).$promise.then(function(t){e.pollQueryStatus(t.handle)})}},{key:"pollQueryStatus",value:function(e){var t=this,a="/data/explore/queries/"+e+"/status";this.dataSrc.poll({_cdapPath:a,interval:2e3},function(a){"FINISHED"===a.status&&(t.dataSrc.stopPoll(a.__pollId__),t.fetchQueryResults(e))})}},{key:"fetchQueryResults",value:function(e){var t=this,a={handle:e,scope:this.$scope};this.myTrackerApi.getQuerySchema(a).$promise.then(function(e){angular.forEach(e,function(e){-1!==e.name.indexOf(".")&&(e.name=e.name.split(".")[1])}),t.previewSchema=e}),this.myTrackerApi.getQueryResults(a,{size:500}).$promise.then(function(e){t.previewData=e,t.loading=!1})}},{key:"loadNextData",value:function(){this.viewLimit+=10}}]),e}();t.$inject=["$state","myTrackerApi","$scope","MyCDAPDataSource"],angular.module(e.name+".feature.tracker").controller("TrackerPreviewController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r){_classCallCheck(this,e),this.$state=t,this.$scope=n,this.myTrackerApi=a,this.myHelpers=r,
this.loading=!1,this.entitiesShowAllButton=!1,this.metadataShowAllButton=!1,this.currentPage=1,this.fullResults=[],this.searchResults=[],this.sortByOptions=[{name:"Oldest First",sort:"createDate"},{name:"Newest First",sort:"-createDate"},{name:"A → Z",sort:"name"},{name:"Z → A",sort:"-name"},{name:"Highest Score",sort:"-meter"},{name:"Lowest Score",sort:"meter"}],this.sortBy=this.sortByOptions[0],this.entityFiltersList=[{name:"Datasets",isActive:!0,isHover:!1,filter:"Dataset",count:0},{name:"Streams",isActive:!0,isHover:!1,filter:"Stream",count:0},{name:"Stream Views",isActive:!0,isHover:!1,filter:"Stream View",count:0}],this.metadataFiltersList=[{name:"Name",isActive:!0,isHover:!1,count:0},{name:"Description",isActive:!0,isHover:!1,count:0},{name:"User Tags",isActive:!0,isHover:!1,count:0},{name:"System Tags",isActive:!0,isHover:!1,count:0},{name:"User Properties",isActive:!0,isHover:!1,count:0},{name:"System Properties",isActive:!0,isHover:!1,count:0},{name:"Schema",isActive:!0,isHover:!1,count:0}],this.fetchResults()}return e.$inject=["$state","myTrackerApi","$scope","myHelpers"],_createClass(e,[{key:"fetchResults",value:function(){var e=this;this.loading=!0;var t={namespace:this.$state.params.namespace,query:this.$state.params.searchQuery,scope:this.$scope};this.myTrackerApi.search(t).$promise.then(function(t){e.fullResults=t.map(e.parseResult.bind(e)),e.searchResults=angular.copy(e.fullResults),e.searchResults.length&&e.fetchTruthMeter(),e.loading=!1},function(t){console.log("error",t),e.loading=!1})}},{key:"parseResult",value:function(e){var t={};return"datasetinstance"===e.entityId.type?(angular.extend(t,{name:e.entityId.id.instanceId,type:"Dataset",entityTypeState:"datasets",icon:"icon-datasets",description:e.metadata.SYSTEM.properties.description||"No description provided for this Dataset.",createDate:e.metadata.SYSTEM.properties["creation-time"],datasetType:e.metadata.SYSTEM.properties.type}),-1!==e.metadata.SYSTEM.tags.indexOf("explore")&&(t.datasetExplorable=!0),t.queryFound=this.findQueries(e,t),this.entityFiltersList[0].count++):"stream"===e.entityId.type?(angular.extend(t,{name:e.entityId.id.streamName,type:"Stream",entityTypeState:"streams",icon:"icon-streams",description:e.metadata.SYSTEM.properties.description||"No description provided for this Stream.",createDate:e.metadata.SYSTEM.properties["creation-time"]}),t.queryFound=this.findQueries(e,t),this.entityFiltersList[1].count++):"view"===e.entityId.type&&(angular.extend(t,{name:e.entityId.id.id,type:"Stream View",entityTypeState:"views:"+e.entityId.id.stream.streamName,icon:"icon-streams",description:e.metadata.SYSTEM.properties.description||"No description provided for this Stream View.",createDate:e.metadata.SYSTEM.properties["creation-time"]}),t.queryFound=this.findQueries(e,t),this.entityFiltersList[2].count++),t}},{key:"findQueries",value:function(e,t){var a=new RegExp("[^a-zA-Z0-9]","g"),n=this.$state.params.searchQuery.replace(a,""),r=new RegExp(n,"ig"),s=[];t.name.search(r)>-1&&(s.push("Name"),this.metadataFiltersList[0].count++),e.metadata.SYSTEM.properties.description&&e.metadata.SYSTEM.properties.description.search(r)>-1&&(s.push("Description"),this.metadataFiltersList[1].count++);var i=this.myHelpers.objectQuery(e,"metadata","USER","tags")||"";i=i.toString();var o=this.myHelpers.objectQuery(e,"metadata","SYSTEM","tags")||"";o=o.toString(),i.search(r)>-1&&(s.push("User Tags"),this.metadataFiltersList[2].count++),o.search(r)>-1&&(s.push("System Tags"),this.metadataFiltersList[3].count++);var l=this.myHelpers.objectQuery(e,"metadata","USER","properties")||{};l=JSON.stringify(l);var c=this.myHelpers.objectQuery(e,"metadata","SYSTEM","properties")||{};c=JSON.stringify(c),l.search(r)>-1&&(s.push("User Properties"),this.metadataFiltersList[4].count++),c.search(r)>-1&&(s.push("System Properties"),this.metadataFiltersList[5].count++);var u=this.myHelpers.objectQuery(e,"metadata","SYSTEM","properties","schema")||"";return u.search(r)>-1&&(s.push("Schema"),this.metadataFiltersList[6].count++),s}},{key:"onlyFilter",value:function(e,t,a){e.preventDefault();var n=[];"ENTITIES"===a?n=this.entityFiltersList:"METADATA"===a&&(n=this.metadataFiltersList),angular.forEach(n,function(e){e.isActive=e.name===t.name?!0:!1}),this.filterResults()}},{key:"filterResults",value:function(){var e=[];angular.forEach(this.entityFiltersList,function(t){t.isActive&&e.push(t.filter)});var t=this.fullResults.filter(function(t){return e.indexOf(t.type)>-1?!0:!1}),a=[];angular.forEach(this.metadataFiltersList,function(e){e.isActive&&a.push(e.name)}),this.searchResults=t.filter(function(e){return _.intersection(a,e.queryFound).length>0})}},{key:"showAll",value:function(e){var t=[];"ENTITIES"===e?t=this.entityFiltersList:"METADATA"===e&&(t=this.metadataFiltersList),angular.forEach(t,function(e){e.isActive=!0}),this.filterResults()}},{key:"evaluateShowResultCount",value:function(){var e=10*(this.currentPage-1)+1,t=10*(this.currentPage-1)+10;return t=t>this.searchResults.length?this.searchResults.length:t,0===this.searchResults.length?"0":e+"-"+t}},{key:"fetchTruthMeter",value:function(){var e=this,t={namespace:this.$state.params.namespace,scope:this.$scope},a=[],n=[];angular.forEach(this.fullResults,function(e){"Stream"===e.type?a.push(e.name):"Dataset"===e.type&&n.push(e.name)}),this.myTrackerApi.getTruthMeter(t,{streams:a,datasets:n}).$promise.then(function(t){t&&(e.truthMeterMap=t,angular.forEach(e.fullResults,function(e){t[e.entityTypeState]&&(e.meter=t[e.entityTypeState][e.name])}),e.filterResults())},function(e){console.log("error",e)})}}]),e}();t.$inject=["$state","myTrackerApi","$scope","myHelpers"],angular.module(e.name+".feature.tracker").controller("TrackerResultsController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){function t(e,t,a){"ngInject";function n(e){var t=[];return e?(angular.forEach(e.split("\n"),function(e){e&&(t=t.concat(e.split(",").map(function(e){return e.trim()})))}),t):t}var r=this;this.proceedToNextStep=!1,this.validatePreferredTags=function(){var s=n(r.tags),i={namespace:a.params.namespace,scope:t};e.validatePreferredTags(i,s).$promise.then(function(e){r.tagList=e,r.tagList.validTags.length>0&&(r.proceedToNextStep=!0)},function(e){console.log("Error",e)})},this.promoteUserTags=function(n){var r={namespace:a.params.namespace,scope:t};e.promoteUserTags(r,n).$promise.then(function(){t.$close("success")},function(e){console.log("Error",e)})},this.importTags=function(){document.getElementById("file-select").click()},this.importFiles=function(e){if(-1===e[0].name.indexOf(".txt")&&-1===e[0].name.indexOf(".csv"))return void(r.invalidFormat=!0);var t=new FileReader;t.readAsText(e[0],"UTF-8"),r.invalidFormat=!1,t.onload=function(e){var t=e.target.result;r.tags=t}}}function a(e,t,a,n,r){"ngInject";this.tag=e,this.deletePreferredTags=function(){var s={namespace:n.params.namespace,scope:a,tag:e};t.deletePreferredTags(s).$promise.then(function(){a.$close("success")},function(e){r.show({type:"danger",content:e.data})})}}t.$inject=["myTrackerApi","$scope","$state"],a.$inject=["tag","myTrackerApi","$scope","$state","myAlertOnValium"];var n=function(){function e(t,a,n,r){_classCallCheck(this,e),this.$state=t,this.$scope=a,this.myTrackerApi=n,this.$uibModal=r,this.currentPreferredPage=1,this.currentUserPage=1,this.tags={preferredTags:[],userTags:[]},this.fetchTags()}return e.$inject=["$state","$scope","myTrackerApi","$uibModal"],_createClass(e,[{key:"fetchTags",value:function(){var e=this,t={namespace:this.$state.params.namespace,scope:this.$scope};this.myTrackerApi.getTags(t).$promise.then(function(t){var a=function(e){return Object.keys(e).map(function(t){return{name:t,count:e[t]}})};if(e.tags.preferredTags=a(t.preferredTags),e.tags.preferredTags.length%10!==0){var n=10-e.tags.preferredTags.length%10;e.tags.emptyPreferredTags={emptyArr:Array(n),numPages:Math.ceil(e.tags.preferredTags.length/10)}}if(e.tags.userTags=a(t.userTags),e.tags.userTags.length%10!==0){var r=10-e.tags.userTags.length%10;e.tags.emptyUserTags={emptyArr:Array(r),numPages:Math.ceil(e.tags.userTags.length/10)}}},function(e){console.log("Error",e)})}},{key:"promoteUserTag",value:function(e){var t=this,a={namespace:this.$state.params.namespace,scope:this.$scope};this.myTrackerApi.promoteUserTags(a,[e]).$promise.then(function(e){t.response=e,t.fetchTags()},function(e){console.log("Error",e)})}},{key:"demotePreferredTag",value:function(e){var t=this,a={namespace:this.$state.params.namespace,scope:this.$scope};this.myTrackerApi.demotePreferredTags(a,[e]).$promise.then(function(e){t.response=e,t.fetchTags()},function(e){console.log("Error",e)})}},{key:"showDeleteModal",value:function(e){var t=this,n=this.$uibModal.open({templateUrl:"/old_assets/features/tracker/templates/partial/delete-preferred-tags-popover.html",size:"sm",backdrop:!0,keyboard:!0,windowTopClass:"tracker-modal delete-modal",controller:a,controllerAs:"DeleteTags",resolve:{tag:function(){return e}}});n.result.then(function(e){"success"===e&&t.fetchTags()})}},{key:"showAddModal",value:function(){var e=this,a=this.$uibModal.open({templateUrl:"/old_assets/features/tracker/templates/partial/add-preferred-tags-popover.html",size:"sm",backdrop:!0,keyboard:!0,windowTopClass:"tracker-modal add-preferred-tags-modal",controller:t,controllerAs:"AddTags"});a.result.then(function(t){"success"===t&&e.fetchTags()})}}]),e}();n.$inject=["$state","$scope","myTrackerApi","$uibModal"],angular.module(e.name+".feature.tracker").controller("TrackerTagsController",n)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i){_classCallCheck(this,e),this.$state=t,this.myTrackerApi=a,this.$scope=n,this.enableTrackerLoading=!1,this.myAlertOnValium=r,this.$q=s,this.UI_CONFIG=i,this.trackerServiceRunning=!1,this.auditFlowRunning=!1}return e.$inject=["$state","myTrackerApi","$scope","myAlertOnValium","$q","UI_CONFIG"],_createClass(e,[{key:"enableTracker",value:function(){var e=this;this.enableTrackerLoading=!0,this.myTrackerApi.getTrackerApp({namespace:this.$state.params.namespace,scope:this.$scope}).$promise.then(function(t){t.artifact.version!==e.UI_CONFIG.tracker.artifact.version?e.stopOldPrograms(t):e.startPrograms()},function(){e.createTrackerApp()})}},{key:"stopOldPrograms",value:function(e){var t=this,a={namespace:this.$state.params.namespace,scope:this.$scope},n=e.programs.map(function(e){return{appId:t.UI_CONFIG.tracker.appId,programType:e.type,programId:e.id}});this.myTrackerApi.stopMultiplePrograms(a,n).$promise.then(function(){t.createTrackerApp()},function(e){t.enableTrackerLoading=!1,t.myAlertOnValium.show({type:"danger",content:e.data})})}},{key:"createTrackerApp",value:function(){var e=this;this.myTrackerApi.getCDAPConfig({scope:this.$scope}).$promise.then(function(t){var a=t.filter(function(e){return"zookeeper.quorum"===e.name})[0].value,n=t.filter(function(e){return"kafka.zookeeper.namespace"===e.name})[0].value,r=t.filter(function(e){return"kafka.server.num.partitions"===e.name})[0].value,s=t.filter(function(e){return"audit.kafka.topic"===e.name})[0].value,i={artifact:e.UI_CONFIG.tracker.artifact,config:{auditLogKafkaConfig:{zookeeperString:a+"/"+n,topic:s,numPartitions:r}}};e.myTrackerApi.deployTrackerApp({namespace:e.$state.params.namespace,scope:e.$scope},i).$promise.then(function(){e.startPrograms()},function(t){e.myAlertOnValium.show({type:"danger",content:t.data}),e.enableTrackerLoading=!1})})}},{key:"startPrograms",value:function(){var e=this,t={namespace:this.$state.params.namespace,programType:"services",programId:this.UI_CONFIG.tracker.serviceId,scope:this.$scope},a={namespace:this.$state.params.namespace,programType:"flows",programId:this.UI_CONFIG.tracker.flowProgramId,scope:this.$scope};this.myTrackerApi.startTrackerProgram(t,{}).$promise.then(function(){e.trackerServiceRunning=!0,e.onSuccessStartingPrograms()},function(t){return 409===t.statusCode?(e.trackerServiceRunning=!0,void e.onSuccessStartingPrograms()):void e.onErrorStartingPrograms(t)}),this.myTrackerApi.startTrackerProgram(a,{}).$promise.then(function(){e.auditFlowRunning=!0,e.onSuccessStartingPrograms()},function(t){return 409===t.statusCode?(e.auditFlowRunning=!0,void e.onSuccessStartingPrograms()):void e.onErrorStartingPrograms(t)})}},{key:"onSuccessStartingPrograms",value:function(){this.auditFlowRunning&&this.trackerServiceRunning&&(this.$state.go("tracker.home"),this.enableTrackerLoading=!1)}},{key:"onErrorStartingPrograms",value:function(e){this.myAlertOnValium.show({type:"danger",content:e.data}),this.enableTrackerLoading=!1}}]),e}();t.$inject=["$state","myTrackerApi","$scope","myAlertOnValium","$q","UI_CONFIG"],angular.module(e.name+".feature.tracker").controller("TrackerEnableController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n){_classCallCheck(this,e),this.$state=t,this.$scope=a,this.myTrackerApi=n;var r=this.$state.params.entityType.split(":");this.entityType=r,this.timeRangeOptions=[{label:"Last 7 days",startTime:"now-7d",endTime:"now"},{label:"Last 14 days",startTime:"now-14d",endTime:"now"},{label:"Last month",startTime:"now-30d",endTime:"now"},{label:"Last 6 months",startTime:"now-180d",endTime:"now"},{label:"Last 12 months",startTime:"now-365d",endTime:"now"}],this.timeRange={startTime:t.params.startTime||"now-7d",endTime:t.params.endTime||"now"},this.customTimeRange={startTime:null,endTime:null},this.selectedTimeRange=this.findTimeRange(),this.fetchAuditHistogram(),this.fetchTopDatasets(),this.fetchTimeSince()}return e.$inject=["$state","$scope","myTrackerApi"],_createClass(e,[{key:"findTimeRange",value:function(){var e=this,t=this.timeRangeOptions.filter(function(t){return t.startTime===e.timeRange.startTime&&t.endTime===e.timeRange.endTime});return 0===t.length&&(this.isCustom=!0,this.customTimeRange.startTime=new Date(1e3*parseInt(this.$state.params.startTime,10)),this.customTimeRange.endTime=new Date(1e3*parseInt(this.$state.params.endTime,10))),t.length>0?t[0]:{label:"Custom"}}},{key:"goToCustomTimeRangeEntityDetailView",value:function(){var e=parseInt(this.customTimeRange.startTime.valueOf()/1e3,10),t=parseInt(this.customTimeRange.endTime.valueOf()/1e3,10);this.$state.go("tracker.detail.entity.usage",{startTime:e,endTime:t})}},{key:"selectCustom",value:function(){this.isCustom=!0,this.selectedTimeRange.label="Custom"}},{key:"fetchAuditHistogram",value:function(){var e=this,t={namespace:this.$state.params.namespace,startTime:this.timeRange.startTime,endTime:this.timeRange.endTime,scope:this.$scope,entityName:this.$state.params.entityId,entityType:"streams"===this.$state.params.entityType?"stream":"dataset"};this.myTrackerApi.getAuditHistogram(t).$promise.then(function(t){e.auditHistogram=t,e.serviceUnavailable=!1},function(t){503===t.statusCode&&(e.serviceUnavailable=!0),console.log("Error",t)})}},{key:"fetchTopDatasets",value:function(){var e=this,t={namespace:this.$state.params.namespace,limit:5,scope:this.$scope,entity:"datasets"};this.myTrackerApi.getTopEntities(t).$promise.then(function(t){e.topDatasets=t},function(e){console.log("Error",e)})}},{key:"fetchTimeSince",value:function(){var e=this,t={namespace:this.$state.params.namespace,scope:this.$scope,entityName:this.$state.params.entityId,entityType:"streams"===this.$state.params.entityType?"stream":"dataset"};this.myTrackerApi.getTimeSince(t).$promise.then(function(t){e.timeSince=t,e.serviceUnavailable=!1},function(t){503===t.statusCode&&(e.serviceUnavailable=!0),console.log("Error",t)})}}]),e}();t.$inject=["$state","$scope","myTrackerApi"],angular.module(e.name+".feature.tracker").controller("TrackerUsageController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t,a){"ngInject";function n(a){var n={namespace:e.params.namespace,entityId:a};t.getStreamProperties(n).$promise.then(function(t){var n=angular.copy(h);n.config.source={name:a,plugin:{name:"Stream",label:a,artifact:f,properties:{schema:JSON.stringify(t.format.schema),name:a,format:t.format.name}}},e.go("hydratorplusplus.create",{data:n,type:"cdap-etl-batch"})})}function r(t){var a=angular.copy(y);a.config.sinks=[{name:t,plugin:{name:"Stream",label:t,artifact:f,properties:{name:t}}}],e.go("hydratorplusplus.create",{data:a,type:"cdap-etl-realtime"})}function s(a){var n={namespace:e.params.namespace,entityType:"datasets",entityId:a};t.getDatasetSystemProperties(n).$promise.then(function(e){var t=e.type;t===v.Table?l(a):t===v.KVTable&&u(a)})}function i(a){var n={namespace:e.params.namespace,entityType:"datasets",entityId:a};t.getDatasetSystemProperties(n).$promise.then(function(e){var t=e.type;t===v.Table?c(a):t===v.KVTable&&p(a)})}function o(e){var t=_.values(v);return t.indexOf(e)>-1}function l(a){var n={namespace:e.params.namespace,entityId:a};t.getDatasetDetail(n).$promise.then(function(t){var n=angular.copy(h);n.config.source={name:a,plugin:{name:"Table",label:a,artifact:f,properties:{name:a,schema:t.spec.properties.schema,"schema.row.field":t.spec.properties["schema.row.field"]}}},e.go("hydratorplusplus.create",{data:n,type:"cdap-etl-batch"})})}function c(a){var n={namespace:e.params.namespace,entityId:a};t.getDatasetDetail(n).$promise.then(function(t){var n=angular.copy(g);n.config.sinks=[{name:a,plugin:{name:"Table",label:a,artifact:f,properties:{name:a,schema:t.spec.properties.schema,"schema.row.field":t.spec.properties["schema.row.field"]}}}],e.go("hydratorplusplus.create",{data:n,type:"cdap-etl-batch"})})}function u(t){var a=angular.copy(h);a.config.source={name:t,plugin:{name:"KVTable",label:t,artifact:f,properties:{name:t}}},e.go("hydratorplusplus.create",{data:a,type:"cdap-etl-batch"})}function p(t){var a=angular.copy(g);a.config.sinks=[{name:t,plugin:{name:"KVTable",label:t,artifact:f,properties:{name:t}}}],e.go("hydratorplusplus.create",{data:a,type:"cdap-etl-batch"})}var d={name:"cdap-etl-batch",scope:"SYSTEM",version:a.cdapVersion},m={name:"cdap-etl-realtime",scope:"SYSTEM",version:a.cdapVersion},f={name:"core-plugins",scope:"SYSTEM",version:"1.4.1"},h={artifact:d,config:{sinks:[],transforms:[],connections:[]}},g={artifact:d,config:{source:{},transforms:[],connections:[]}},y={artifact:m,config:{source:{},transforms:[],connections:[]}},v={Table:"co.cask.cdap.api.dataset.table.Table",KVTable:"co.cask.cdap.api.dataset.lib.KeyValueTable"};return{streamBatchSource:n,streamRealtimeSink:r,datasetBatchSource:s,datasetBatchSink:i,isAvailableDataset:o}}t.$inject=["$state","myTrackerApi","$rootScope"],angular.module(e.name+".feature.tracker").factory("myJumpFactory",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a){_classCallCheck(this,e),this.$state=t,this.myTrackerApi=a}return e.$inject=["$state","myTrackerApi"],_createClass(e,[{key:"parseLineageResponse",value:function(e,t){var a=this,n=["datasets"===t.entityType?"dataset":"stream",t.namespace,t.entityId].join("."),r=[],s={},i=[];angular.forEach(e.programs,function(e,t){var n={label:e.entityId.id.id,id:t,nodeType:"program",applicationId:e.entityId.id.application.applicationId,entityId:e.entityId.id.id,entityType:a.parseProgramType(e.entityId.id.type),displayType:e.entityId.id.type,icon:a.getProgramIcon(e.entityId.id.type),runs:[]};s[t]=n}),angular.forEach(e.data,function(e,t){var n=a.parseDataInfo(e),r={label:n.name,id:t,nodeType:"data",entityId:n.name,entityType:n.type,displayType:n.displayType,icon:n.icon};if(s[t]=r,"datasets"===n.type){var i={namespace:a.$state.params.namespace,entityType:n.type,entityId:n.name};a.myTrackerApi.getDatasetSystemProperties(i).$promise.then(function(e){var t=e.type.split(".");r.displayType=t[t.length-1]})}}),angular.forEach(e.relations,function(e){var t="both"===e.access||"unknown"===e.access;if("read"===e.access||t){var a=e.data===n?e.data:e.data+"-read",o=e.data===n?e.program+"-read":e.program+"-write";r.push({source:a,target:o,type:"read"}),i.push({dataId:a,uniqueNodeId:e.data,isLeftEdge:e.data!==n}),i.push({dataId:o,uniqueNodeId:e.program})}if("write"===e.access||t){var l=e.data===n?e.data:e.data+"-write",c=e.data===n?e.program+"-write":e.program+"-read";r.push({source:c,target:l,type:"write"}),i.push({dataId:l,uniqueNodeId:e.data,isRightEdge:e.data!==n}),i.push({dataId:c,uniqueNodeId:e.program})}s[e.program].runs=s[e.program].runs.concat(e.runs),s[e.program].runs=_.uniq(s[e.program].runs)}),i=_.uniq(i,function(e){return e.dataId});var o=this.getGraphLayout(i,r);return this.mapNodesLocation(i,o),{connections:r,nodes:i,uniqueNodes:s,graph:o}}},{key:"secondLineageParser",value:function(e,t){var a=this,n=["datasets"===t.entityType?"dataset":"stream",t.namespace,t.entityId].join("."),r=[],s={},i=[];angular.forEach(e.programs,function(e,t){var n={label:e.entityId.id.id,id:t,nodeType:"program",applicationId:e.entityId.id.application.applicationId,entityId:e.entityId.id.id,entityType:a.parseProgramType(e.entityId.id.type),displayType:e.entityId.id.type,icon:a.getProgramIcon(e.entityId.id.type),runs:[]};s[t]=n}),angular.forEach(e.data,function(e,t){var n=a.parseDataInfo(e),r={label:n.name,id:t,nodeType:"data",entityId:n.name,entityType:n.type,displayType:n.displayType,icon:n.icon};if(s[t]=r,"datasets"===n.type){var i={namespace:a.$state.params.namespace,entityType:n.type,entityId:n.name};a.myTrackerApi.getDatasetSystemProperties(i).$promise.then(function(e){var t=e.type.split(".");r.displayType=t[t.length-1]})}}),angular.forEach(e.relations,function(e){var t=e.accesses.length>1;if(!t&&"read"===e.accesses[0]){var a=e.data,o=e.program;r.push({source:a,target:o,type:"read"}),i.push({dataId:a,uniqueNodeId:e.data,isLeftEdge:e.data!==n}),i.push({dataId:o,uniqueNodeId:e.program})}if("read"!==e.accesses[0]||t){var l=e.data,c=e.program;r.push({source:c,target:l,type:"write"}),i.push({dataId:l,uniqueNodeId:e.data,isRightEdge:e.data!==n}),i.push({dataId:c,uniqueNodeId:e.program})}s[e.program].runs=s[e.program].runs.concat(e.runs),s[e.program].runs=_.uniq(s[e.program].runs)}),i=_.uniq(i,function(e){return e.dataId});var o=this.getGraphLayout(i,r);return this.mapNodesLocation(i,o),{connections:r,nodes:i,uniqueNodes:s,graph:o}}},{key:"parseProgramType",value:function(e){switch(e){case"Flow":case"flow":case"Flows":case"flows":return"flows";case"Mapreduce":case"mapreduce":return"mapreduce";case"Spark":case"spark":return"spark";case"Worker":case"worker":case"Workers":case"workers":return"workers";case"Workflow":case"workflow":case"Workflows":case"workflows":return"workflows";case"Service":case"service":case"Services":case"service":return"services"}}},{key:"parseDataInfo",value:function(e){return"datasetinstance"===e.entityId.type?{name:e.entityId.id.instanceId,type:"datasets",icon:"icon-datasets",displayType:"Dataset"}:{name:e.entityId.id.streamName,type:"streams",icon:"icon-streams",displayType:"Stream"}}},{key:"getProgramIcon",value:function(e){var t={Flow:"icon-tigon",Mapreduce:"icon-mapreduce",Spark:"icon-spark",Worker:"icon-worker",Workflow:"icon-workflow",Service:"icon-service"};return t[e]}},{key:"getGraphLayout",value:function(e,t){var a=new dagre.graphlib.Graph;return a.setGraph({nodesep:50,ranksep:90,rankdir:"LR",marginx:100,marginy:50}),a.setDefaultEdgeLabel(function(){return{}}),angular.forEach(e,function(e){var t=e.dataId;a.setNode(t,{width:180,height:60})}),angular.forEach(t,function(e){a.setEdge(e.source,e.target)}),dagre.layout(a),a}},{key:"mapNodesLocation",value:function(e,t){angular.forEach(e,function(e){e._uiLocation={top:t._nodes[e.dataId].y-20+"px",left:t._nodes[e.dataId].x-90+"px"}})}}]),e}();t.$inject=["$state","myTrackerApi"],angular.module(e.name+".feature.tracker").service("myLineageService",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t,a,n,r){var s=e.constructUrl,i="/namespaces/:namespace/metadata/search?target=stream&target=dataset&target=view",o="/namespaces/:namespace/:entityType/:entityId",l="/namespaces/:namespace/apps/:appId/:programType/:programId/runs/:runId",c="/namespaces/:namespace/apps/"+r.tracker.appId+"/services/"+r.tracker.serviceId+"/methods/v1/auditlog/:entityType/:entityId",u="/namespaces/:namespace/apps/"+r.navigator.appId,p="/namespaces/:namespace/apps/"+r.tracker.appId,d="/namespaces/:namespace/:entityType/:entityId/metadata/properties",m="/namespaces/:namespace/apps/"+r.tracker.appId+"/services/"+r.tracker.serviceId+"/methods/v1/auditmetrics/top-entities/:entity",f="/namespaces/:namespace/apps/"+r.tracker.appId+"/services/"+r.tracker.serviceId+"/methods/v1/auditmetrics/audit-histogram",h="/namespaces/:namespace/apps/"+r.tracker.appId+"/services/"+r.tracker.serviceId+"/methods/v1/auditmetrics/time-since",g="/namespaces/:namespace/data/explore/queries",y="/data/explore/queries/:handle",v="/namespaces/:namespace/apps/"+r.tracker.appId+"/services/"+r.tracker.serviceId+"/methods/v1/tracker-meter",S="/namespaces/:namespace/apps/"+r.tracker.appId+"/services/"+r.tracker.serviceId+"/methods/v1/tags";return t(s({_cdapPath:i}),{namespace:"@namespace"},{search:n.getConfig("GET","REQUEST",i,!0),properties:n.getConfig("GET","REQUEST",o+"/metadata",!0),viewsProperties:n.getConfig("GET","REQUEST",o+"/views/:viewId/metadata",!0),getLineage:n.getConfig("GET","REQUEST",o+"/lineage?collapse=access&collapse=run&collapse=component"),getProgramRunStatus:n.getConfig("GET","REQUEST",l),getAuditLogs:n.getConfig("GET","REQUEST",c,!1,{suppressErrors:!0}),getStreamProperties:n.getConfig("GET","REQUEST","/namespaces/:namespace/streams/:entityId"),getDatasetSystemProperties:n.getConfig("GET","REQUEST",o+"/metadata/properties?scope=SYSTEM",!1,{suppressErrors:!0}),getSystemTags:n.getConfig("GET","REQUEST",o+"/metadata/tags?scope=SYSTEM",!0),getDatasetDetail:n.getConfig("GET","REQUEST","/namespaces/:namespace/data/datasets/:entityId"),deployNavigator:n.getConfig("PUT","REQUEST",u,!1,{contentType:"application/json"}),getCDAPConfig:n.getConfig("GET","REQUEST","/config/cdap",!0),getNavigatorApp:n.getConfig("GET","REQUEST",u,!1,{suppressErrors:!0}),getNavigatorStatus:n.getConfig("GET","REQUEST",u+"/flows/MetadataFlow/runs",!0),toggleNavigator:n.getConfig("POST","REQUEST",u+"/flows/MetadataFlow/:action",!1),getTrackerApp:n.getConfig("GET","REQUEST",p,!1,{suppressErrors:!0}),deployTrackerApp:n.getConfig("PUT","REQUEST",p),stopMultiplePrograms:n.getConfig("POST","REQUEST","/namespaces/:namespace/stop",!0,{suppressErrors:!0}),startTrackerProgram:n.getConfig("POST","REQUEST",p+"/:programType/:programId/start",!1,{suppressErrors:!0}),trackerProgramStatus:n.getConfig("GET","REQUEST",p+"/:programType/:programId/status",!1,{suppressErrors:!0}),getTopEntities:n.getConfig("GET","REQUEST",m,!0,{suppressErrors:!0}),getAuditHistogram:n.getConfig("GET","REQUEST",f,!1,{suppressErrors:!0}),getTimeSince:n.getConfig("GET","REQUEST",h,!1,{suppressErrors:!0}),getTruthMeter:n.getConfig("POST","REQUEST",v,!1,{suppressErrors:!0}),getTags:n.getConfig("GET","REQUEST",S,!1,{suppressErrors:!0}),demotePreferredTags:n.getConfig("POST","REQUEST",S+"/demote",!1,{suppressErrors:!0}),promoteUserTags:n.getConfig("POST","REQUEST",S+"/promote",!1,{suppressErrors:!0}),validatePreferredTags:n.getConfig("POST","REQUEST",S+"/validate",!1,{suppressErrors:!0}),getEntityTags:n.getConfig("GET","REQUEST",S+"/:entityType/:entityId",!1,{suppressErrors:!0}),addEntityTag:n.getConfig("POST","REQUEST",S+"/promote/:entityType/:entityId",!1,{suppressErrors:!0}),deletePreferredTags:n.getConfig("DELETE","REQUEST",S+"/preferred",!1,{suppressErrors:!0}),deleteEntityTag:n.getConfig("DELETE","REQUEST",S+"/delete/:entityType/:entityId",!1,{suppressErrors:!0}),deleteEntityProperty:n.getConfig("DELETE","REQUEST",d+"/:key",!1,{suppressErrors:!0}),addEntityProperty:n.getConfig("POST","REQUEST",d,!1,{suppressErrors:!0}),postQuery:n.getConfig("POST","REQUEST",g),getQueryResults:n.getConfig("POST","REQUEST",y+"/next",!0),getQuerySchema:n.getConfig("GET","REQUEST",y+"/schema",!0)})}t.$inject=["myCdapUrl","$resource","myAuth","myHelpers","UI_CONFIG"],angular.module(e.name+".feature.tracker").factory("myTrackerApi",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.userprofile").controller("UserProfileController",["$scope","$http","myAlert","myAuth","MY_CONFIG",function(e,t,a,n,r){e.reAuthenticated=!1,e.isAuthenticated=r.securityEnabled,e.credentials={username:n.currentUser.username},e.readonlyUsername=!0,e.doLogin=function(n){t({method:"POST",url:"/accessToken",data:{profile_view:!0,username:n.username,password:n.password}}).success(function(t){e.token=t.access_token,e.expirationTime=Date.now()+1e3*t.expires_in,e.reAuthenticated=!0}).error(function(){a({title:"User Authentication Error",content:"Either Username or Password is wrong. Please try again",type:"danger"})})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".services").factory("GraphHelpers",function(){function e(e,a){for(var n=["ACTION","JOINNODE","FORKNODE","CONDITIONNODE","CONDITIONEND"],r=0;r<e.length-1;r++)if(n.indexOf(e[r].nodeType)>-1&&n.indexOf(e[r+1].nodeType)>-1){if(e[r].nodeId===e[r+1].nodeId)continue;a.push({sourceName:e[r].program.programName+e[r].nodeId,targetName:e[r+1].program.programName+e[r+1].nodeId,sourceType:e[r].nodeType,targetType:e[r+1].nodeType})}else("FORK"===e[r].nodeType||"CONDITION"===e[r].nodeType)&&t(e[r-1],e[r],e[r+1],a)}function t(t,a,n,r){for(var s=a.branches,i=[],o=0;o<s.length;o++)i=s[o],t&&i.unshift(t),n&&i.push(n),e(i,r)}function a(e,t){var n,r;for(n=0;n<e.length;n++)if("ACTION"===e[n].nodeType)e[n].label=e[n].program.programName,t.push(e[n]);else if("FORK"===e[n].nodeType)for(r=0;r<e[n].branches.length;r++)t.push({label:"FORK",nodeType:"FORKNODE",nodeId:"FORK"+n,program:{programName:"FORKNODE"}}),a(e[n].branches[r],t),t.push({label:"JOIN",nodeType:"JOINNODE",nodeId:"FORK"+n,program:{programName:"JOINNODE"}});else if("CONDITION"===e[n].nodeType)for(e[n].branches=[e[n].ifBranch,e[n].elseBranch],r=0;r<e[n].branches.length;r++)t.push({label:"IF",nodeType:"CONDITIONNODE",nodeId:e[n].nodeId,program:{programName:e[n].predicateClassName}}),a(e[n].branches[r],t),t.push({label:"ENDIF",nodeType:"CONDITIONEND",nodeId:e[n].nodeId,program:{programName:"CONDITIONEND"}})}function n(e){return e.unshift({type:"START",nodeType:"ACTION",nodeId:"",program:{programName:"Start"}}),e.push({label:"end",type:"END",nodeType:"ACTION",nodeId:"",program:{programName:"End"}}),e}return{convertNodesToEdges:e,expandNodes:a,addStartAndEnd:n}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r){_classCallCheck(this,e),this.GLOBALS=a,this.MyDAGFactory=n,this.DAGPlusPlusNodesStore=r,this.nodesDispatcher=t.getDispatcher()}return e.$inject=["DAGPlusPlusNodesDispatcher","GLOBALS","DAGPlusPlusFactory","DAGPlusPlusNodesStore"],_createClass(e,[{key:"addNode",value:function(e){var t=this.DAGPlusPlusNodesStore.getCanvasPanning(),a={
top:150-t.top,left:.1*document.documentElement.clientWidth-t.left},n={top:150-t.top,left:.3*document.documentElement.clientWidth-t.left},r={top:150-t.top,left:.5*document.documentElement.clientWidth-t.left},s=35;switch(this.GLOBALS.pluginConvert[e.type]){case"source":var i=this.DAGPlusPlusNodesStore.getSourceCount()*s;e._uiPosition={top:a.top+i+"px",left:a.left+i+"px"},this.nodesDispatcher.dispatch("onAddSourceCount");break;case"sink":var o=this.DAGPlusPlusNodesStore.getSinkCount()*s;e._uiPosition={top:r.top+o+"px",left:r.left+o+"px"},this.nodesDispatcher.dispatch("onAddSinkCount");break;default:var l=this.DAGPlusPlusNodesStore.getTransformCount()*s;e._uiPosition={top:n.top+l+"px",left:n.left+l+"px"},this.nodesDispatcher.dispatch("onAddTransformCount")}this.nodesDispatcher.dispatch("onNodeAdd",e)}},{key:"updateNode",value:function(e,t){this.nodesDispatcher.dispatch("onNodeUpdate",e,t)}},{key:"removeNode",value:function(e){this.nodesDispatcher.dispatch("onRemoveNode",e)}},{key:"setNodes",value:function(e){this.nodesDispatcher.dispatch("onSetNodes",e)}},{key:"addConnection",value:function(e){this.nodesDispatcher.dispatch("onConnect",e)}},{key:"setConnections",value:function(e){this.nodesDispatcher.dispatch("onConnectionsUpdate",e)}},{key:"removeConnection",value:function(e){this.nodesDispatcher.dispatch("onRemoveConnection",e)}},{key:"resetNodesAndConnections",value:function(){this.nodesDispatcher.dispatch("onReset")}},{key:"selectNode",value:function(e){this.nodesDispatcher.dispatch("onNodeSelect",e)}},{key:"resetSelectedNode",value:function(){this.nodesDispatcher.dispatch("onNodeSelectReset")}},{key:"resetPluginCount",value:function(){this.nodesDispatcher.dispatch("onResetPluginCount")}},{key:"setCanvasPanning",value:function(e){this.nodesDispatcher.dispatch("onSetCanvasPanning",e)}},{key:"createGraphFromConfig",value:function(e,t,a){this.DAGPlusPlusNodesStore.setDefaults(),this.nodesDispatcher.dispatch("onCreateGraphFromConfig",e,t,a)}},{key:"addComment",value:function(e){this.nodesDispatcher.dispatch("onAddComment",e)}},{key:"setComments",value:function(e){this.nodesDispatcher.dispatch("onSetComments",e)}},{key:"deleteComment",value:function(e){this.nodesDispatcher.dispatch("onDeleteComment",e)}},{key:"updateComment",value:function(e,t){this.nodesDispatcher.dispatch("onUpdateComment",e,t)}}]),e}();t.$inject=["DAGPlusPlusNodesDispatcher","GLOBALS","DAGPlusPlusFactory","DAGPlusPlusNodesStore"],angular.module(e.name+".commons").service("DAGPlusPlusNodesActionsFactory",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){_classCallCheck(this,e),this.baseDispatcher=t,this.__dispatcher__=null}return e.$inject=["CaskAngularDispatcher"],_createClass(e,[{key:"getDispatcher",value:function(){return this.__dispatcher__||(this.__dispatcher__=new this.baseDispatcher),this.__dispatcher__}},{key:"destroyDispatcher",value:function(){delete this.__dispatcher__}}]),e}();t.$inject=["CaskAngularDispatcher"],angular.module(e.name+".commons").service("DAGPlusPlusNodesDispatcher",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n){_classCallCheck(this,e),this.state={},this.setDefaults(),this.changeListeners=[],this.uuid=a,this.GLOBALS=n;var r=t.getDispatcher();r.register("onNodeAdd",this.addNode.bind(this)),r.register("onRemoveNode",this.removeNode.bind(this)),r.register("onConnect",this.addConnection.bind(this)),r.register("onConnectionsUpdate",this.updateConnections.bind(this)),r.register("onRemoveConnection",this.removeConnection.bind(this)),r.register("onReset",this.setDefaults.bind(this)),r.register("onNodeSelect",this.setActiveNodeId.bind(this)),r.register("onCreateGraphFromConfig",this.setNodesAndConnections.bind(this)),r.register("onNodeSelectReset",this.resetActiveNode.bind(this)),r.register("onNodeUpdate",this.updateNode.bind(this)),r.register("onAddSourceCount",this.addSourceCount.bind(this)),r.register("onAddSinkCount",this.addSinkCount.bind(this)),r.register("onAddTransformCount",this.addTransformCount.bind(this)),r.register("onResetPluginCount",this.resetPluginCount.bind(this)),r.register("onSetCanvasPanning",this.setCanvasPanning.bind(this)),r.register("onAddComment",this.addComment.bind(this)),r.register("onSetComments",this.setComments.bind(this)),r.register("onDeleteComment",this.deleteComment.bind(this)),r.register("onUpdateComment",this.updateComment.bind(this))}return e.$inject=["DAGPlusPlusNodesDispatcher","uuid","GLOBALS"],_createClass(e,[{key:"setDefaults",value:function(){this.state={nodes:[],connections:[],comments:[],activeNodeId:null,currentSourceCount:0,currentTransformCount:0,currentSinkCount:0,canvasPanning:{top:0,left:0}}}},{key:"reset",value:function(){this.changeListeners=[],this.setDefaults()}},{key:"registerOnChangeListener",value:function(e){this.changeListeners.push(e)}},{key:"emitChange",value:function(){this.changeListeners.forEach(function(e){return e()})}},{key:"addSourceCount",value:function(){this.state.currentSourceCount++}},{key:"addTransformCount",value:function(){this.state.currentTransformCount++}},{key:"addSinkCount",value:function(){this.state.currentSinkCount++}},{key:"resetSourceCount",value:function(){this.state.currentSourceCount=0}},{key:"resetTransformCount",value:function(){this.state.currentTransformCount=0}},{key:"resetSinkCount",value:function(){this.state.currentSinkCount=0}},{key:"resetPluginCount",value:function(){this.state.currentSourceCount=0,this.state.currentTransformCount=0,this.state.currentSinkCount=0}},{key:"setCanvasPanning",value:function(e){this.state.canvasPanning.top=e.top,this.state.canvasPanning.left=e.left}},{key:"getSourceCount",value:function(){return this.state.currentSourceCount}},{key:"getTransformCount",value:function(){return this.state.currentTransformCount}},{key:"getSinkCount",value:function(){return this.state.currentSinkCount}},{key:"getCanvasPanning",value:function(){return this.state.canvasPanning}},{key:"addNode",value:function(e){e.name||(e.name=e.plugin.label+"-"+this.uuid.v4()),this.state.nodes.push(e),this.emitChange()}},{key:"updateNode",value:function(e,t){var a=this.state.nodes.filter(function(t){return t.name===e});a.length&&(a=a[0],angular.extend(a,t),this.emitChange())}},{key:"removeNode",value:function(e){var t=this.state.nodes.filter(function(t){return t.name===e});switch(this.GLOBALS.pluginConvert[t[0].type]){case"source":this.resetSourceCount();break;case"transform":this.resetTransformCount();break;case"sink":this.resetSinkCount()}this.state.nodes.splice(this.state.nodes.indexOf(t[0]),1),this.state.activeNodeId=null,this.emitChange()}},{key:"getNodes",value:function(){return this.state.nodes}},{key:"getNodesAsObjects",value:function(){var e={};return angular.forEach(this.state.nodes,function(t){e[t.name]=t}),e}},{key:"setNodes",value:function(e){var t=this;e.forEach(function(e){e.name||(e.name=e.label+"-"+t.uuid.v4())}),this.state.nodes=e,this.emitChange()}},{key:"getActiveNodeId",value:function(){return this.state.activeNodeId}},{key:"setActiveNodeId",value:function(e){this.state.activeNodeId=e,this.emitChange()}},{key:"resetActiveNode",value:function(){this.state.activeNodeId=null,angular.forEach(this.state.nodes,function(e){e.selected=!1}),this.emitChange()}},{key:"addConnection",value:function(e){this.state.connections.push(e),this.emitChange()}},{key:"updateConnections",value:function(e){this.state.connections=e,this.emitChange()}},{key:"removeConnection",value:function(e){var t=this.state.connections.indexOf(e);this.state.connections.splice(t,1),this.emitChange()}},{key:"getConnections",value:function(){return this.state.connections}},{key:"setConnections",value:function(e){this.state.connections=e,this.emitChange()}},{key:"setNodesAndConnections",value:function(e,t,a){this.setNodes(e),this.state.connections=t,this.state.comments=a?a:[],this.emitChange()}},{key:"addComment",value:function(e){this.state.comments.push(e),this.emitChange()}},{key:"setComments",value:function(e){this.state.comments=e,this.emitChange()}},{key:"deleteComment",value:function(e){var t=this.state.comments.indexOf(e);t>-1&&(this.state.comments.splice(t,1),this.emitChange())}},{key:"updateComment",value:function(e,t){var a=this.state.comments.filter(function(t){return t.id===e});a.length&&(a=a[0],angular.extend(a,t),this.emitChange())}},{key:"getComments",value:function(){return this.state.comments}}]),e}();t.$inject=["DAGPlusPlusNodesDispatcher","uuid","GLOBALS"],angular.module(e.name+".commons").service("DAGPlusPlusNodesStore",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("getSchema",function(){return{restrict:"E",templateUrl:"plugin-functions/functions/get-schema/get-schema.html",scope:{node:"=",fnConfig:"="},controller:["$scope","$uibModal","EventPipe","myPipelineApi",function(e,t,a,n){var r=this,s=e.fnConfig,i=s["plugin-method"]||"getSchema",o=s.method||"GET",l=function(e){switch(e){case"POST":return n.postPluginMethod;case"GET":return n.getPluginMethod;case"PUT":return n.putPluginMethod;case"DELETE":return n.deletePluginMethod}},c=l(o);r.openModal=function(){var n=t.open({templateUrl:"plugin-functions/functions/get-schema/get-schema-modal.html",windowClass:"hydrator-modal node-config-modal layered-modal",keyboard:!0,controller:["$scope","nodeInfo","$state",function(e,t,a){var n=this;n.node=angular.copy(t),n.query=n.node.plugin.properties.importQuery,n.fetchSchema=function(){var e=n.node.plugin.properties;e.query=n.query,delete e.importQuery;var t={namespace:a.params.namespace,artifactName:n.node.plugin.artifact.name,version:n.node.plugin.artifact.version,pluginType:n.node.type,pluginName:n.node.plugin.name,methodName:i,scope:n.node.plugin.artifact.scope};c(t,e).$promise.then(function(e){n.error=null,n.schema=e},function(e){n.schema=null,n.error=e.data})},n.apply=function(){e.$close({schema:n.schema,query:n.query})}}],controllerAs:"GetSchemaModalController",resolve:{nodeInfo:function(){return e.node}}});n.result.then(function(t){a.emit("schema.import",JSON.stringify(t.schema)),e.node.plugin.properties.importQuery=t.query})}}],controllerAs:"GetSchemaController"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".commons").directive("outputSchema",function(){return{restrict:"E",templateUrl:"plugin-functions/functions/output-schema/output-schema.html",scope:{node:"=",fnConfig:"="},controller:["$scope","$uibModal","EventPipe","myPipelineApi",function(e,t,a,n){var r=this,s=e.fnConfig,i=s["plugin-method"]||"getSchema",o=s.method||"GET";r.label=s.label||"Get Schema",r.btnClass=s["button-class"]||"btn-default";var l=function(e){switch(e){case"POST":return n.postPluginMethod;case"GET":return n.getPluginMethod;case"PUT":return n.putPluginMethod;case"DELETE":return n.deletePluginMethod}},c=l(o);r.node=e.node;var u=function(){return s["required-fields"]?s["required-fields"].map(function(t){return e.node.plugin.properties[t]}):[]};r.requiredProperties=u(),r.requiredFieldsWatch=e.$watch("OutputSchemaController.node.plugin.properties",function(){r.requiredProperties=u()},!0),r.missingFieldsWarningMessage=s["missing-required-fields-message"]||"",r.openModal=function(){var n=t.open({templateUrl:"plugin-functions/functions/output-schema/output-schema-modal.html",windowClass:"hydrator-modal node-config-modal layered-modal",keyboard:!0,controller:["$scope","nodeInfo","$state","HydratorPlusPlusHydratorService",function(e,t,a,n){var r=this;r.node=angular.copy(t),r.fetchSchema=function(){var e=r.node.plugin.properties;if(s["multiple-inputs"]&&"false"!==s["multiple-inputs"]){var o={};angular.forEach(t.inputSchema,function(e){var t=void 0;try{t=JSON.parse(e.schema)}catch(a){return void console.log("ERROR: ",a)}o[e.name]=t}),e.inputSchemas=o}else{var l,u=t.inputSchema[0];try{l=JSON.parse(u.schema).fields||[],e.inputSchema=JSON.parse(n.formatOutputSchema(l))}catch(p){e.inputSchema=""}}r.showLoading=!0;var d={namespace:a.params.namespace,artifactName:r.node.plugin.artifact.name,version:r.node.plugin.artifact.version,pluginType:r.node.type,pluginName:r.node.plugin.name,methodName:i,scope:r.node.plugin.artifact.scope};c(d,e).$promise.then(function(e){r.error=null,r.schema=e,r.showLoading=!1},function(e){r.schema=null,r.error=e.data,r.showLoading=!1})},r.fetchSchema(),r.apply=function(){e.$close({schema:r.schema})}}],controllerAs:"GetSchemaModalController",resolve:{nodeInfo:function(){return e.node}}});n.result.then(function(e){a.emit("schema.import",JSON.stringify(e.schema))})},e.$on("$destroy",function(){r.requiredFieldsWatch()})}],controllerAs:"OutputSchemaController"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("NamespaceAppController",["$scope","$state","myAppUploader","MyCDAPDataSource","myNamespace","myAlertOnValium","GLOBALS","myHydratorFactory","myLoadingService","getHydratorUrl",function(e,t,a,n,r,s,i,o,l,c){e.getHydratorUrl=c,e.apps=[],e.GLOBALS=i,e.myHydratorFactory=o,e.nsname=r.getDisplayName(t.params.nsadmin);var u=new n(e),p="/namespaces/"+t.params.nsadmin+"/apps";u.request({_cdapPath:p}).then(function(t){e.apps=e.apps.concat(t)}),e.deleteApp=function(e){l.showLoadingIcon(),u.request({_cdapPath:p+"/"+e,method:"DELETE"},function(){l.hideLoadingIconImmediate(),t.reload().then(function(){s.show({type:"success",title:e,content:"Application deleted successfully"})})},function(e){l.hideLoadingIconImmediate(),s.show({type:"danger",title:"Delete failed",content:e})})},e.onFileSelected=function(e){a.upload(e,t.params.nsadmin)}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("NamespaceAppMetadataController",["$scope","$state","myAlertOnValium","MyCDAPDataSource","myHydratorFactory","myLoadingService",function(e,t,a,n,r,s){var i=new n(e),o="/namespaces/"+t.params.nsadmin+"/apps/"+t.params.appId;e.myHydratorFactory=r,i.request({_cdapPath:o}).then(function(t){e.app=t}),e.deleteApp=function(e){s.showLoadingIcon(),i.request({_cdapPath:o,method:"DELETE"}).then(function(){s.hideLoadingIconImmediate(),t.go("^.apps").then(function(){a.show({type:"success",title:e,content:"Application deleted successfully"})})},function(e){s.hideLoadingIconImmediate(),a.show({type:"danger",title:"Delete failed",content:e})})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("NamespaceCreateController",["$scope","$uibModalInstance","MyCDAPDataSource","myNamespace","EventPipe","myAlertOnValium","$state",function(e,t,a,n,r,s,i){e.model={name:"",description:""},e.isSaving=!1;var o=new a(e);e.submitHandler=function(){e.isSaving||(e.isSaving=!0,o.request({method:"PUT",_cdapPath:"/namespaces/"+e.model.name,body:{name:e.model.name,description:e.model.description},suppressErrors:!0}).then(function(t){e.isSaving=!1,n.getList(!0).then(function(){r.emit("namespace.update"),i.go("admin.overview",{},{reload:!0}).then(function(){s.show({type:"success",content:t})})})},function(t){e.isSaving=!1,e.error=t.data}))},e.closeModal=function(){t.close()},e.enter=function(t){13===t.keyCode&&e.submitHandler()}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("NamespaceDatasetMetadataController",["$scope","$state","myAlertOnValium","$filter","myDatasetApi","myExploreApi","EventPipe",function(e,t,a,n,r,s,i){var o={namespace:t.params.nsadmin,scope:e};s.list(o).$promise.then(function(a){var r=t.params.datasetId;r=r.replace(/[\.\-]/g,"_");var i=n("filter")(a,r);i.length>0?(o.table="dataset_"+r,s.getInfo(o).$promise.then(function(t){e.metadata=t})):e.metadata=null}),e.deleteDataset=function(){i.emit("showLoadingIcon");var n={namespace:t.params.nsadmin,datasetId:t.params.datasetId,scope:e};r["delete"](n,{},function(){i.emit("hideLoadingIcon.immediate"),t.go("admin.namespace.detail.data",{},{reload:!0}).then(function(){a.show({type:"success",content:"Successfully deleted dataset"})})},function(){i.emit("hideLoadingIcon.immediate")})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("NamespaceDatasetsController",["$scope","$stateParams","myStreamApi","myDatasetApi",function(e,t,a,n){e.dataList=[],e.currentPage=1;var r={namespace:t.nsadmin,scope:e};n.list(r).$promise.then(function(t){Array.isArray(t)&&(e.dataList=t.filter(function(e){return"externalDataset"!==e.type}).concat(e.dataList))}),a.list(r).$promise.then(function(t){angular.forEach(t,function(e){e.type="Stream"}),e.dataList=e.dataList.concat(t)})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("NamespaceSettingsController",["$scope","MyCDAPDataSource","$state","myAlertOnValium","myNamespace","EventPipe",function(e,t,a,n,r,s){var i=new t(e);e.loading=!1,i.request({_cdapPath:"/namespaces/"+a.params.nsadmin}).then(function(t){e.description=t.description}),e.save=function(){i.request({_cdapPath:"/namespaces/"+a.params.nsadmin+"/properties",method:"PUT",body:{description:e.description}}).then(function(){n.show({type:"success",content:"Namespace successfully updated"})})},e.deleteNamespace=function(){e.loading=!0,s.emit("showLoadingIcon"),i.request({_cdapPath:"/unrecoverable/namespaces/"+a.params.nsadmin,method:"DELETE"}).then(function(){r.getList(!0).then(function(){s.emit("namespace.update"),s.emit("hideLoadingIcon.immediate"),a.go("admin.overview",{},{reload:!0}).then(function(){n.show({type:"success",content:"You have successfully deleted a namespace"})})})},function(){s.emit("hideLoadingIcon.immediate")})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("NamespaceStreamMetadataController",["$scope","$stateParams","myHelpers","myStreamApi","$state","EventPipe","myAlertOnValium",function(e,t,a,n,r,s,i){e.avro={},e.formatOptions=["avro","clf","csv","grok","syslog","text","tsv","stream"];var o={namespace:t.nsadmin,streamId:t.streamId,scope:e};e.reload=function(){n.get(o).$promise.then(function(t){e.ttl=a.objectQuery(t,"ttl"),e.format=a.objectQuery(t,"format","name"),e.threshold=a.objectQuery(t,"notification.threshold.mb"),e.avro.schema=a.objectQuery(t,"format","schema");var n=a.objectQuery(t,"format","schema","fields");e.properties=[],angular.forEach(n,function(t){angular.isArray(t.type)?e.properties.push({name:t.name,type:t.type[0],nullable:!0}):angular.isObject(t.type)?e.properties.push({name:t.name,type:t.type.items,nullable:!1}):e.properties.push({name:t.name,type:t.type,nullable:!1})});var r=a.objectQuery(t,"format","settings");e.settings=[],angular.forEach(r,function(t,a){e.settings.push({key:a,value:t})})})},e.reload(),e.save=function(){e.error=null;var a=[];angular.forEach(e.properties,function(e){e.name&&a.push({name:e.name,type:e.nullable?[e.type,"null"]:e.type})});var r={name:"stream"===e.format?"text":e.format},s=["clf","syslog","avro"];0!==a.length&&-1===s.indexOf(e.format)?r.schema={type:"record",name:t.streamid+"Body",fields:a}:"avro"===e.format&&(r.schema=e.avro.schema);var l={};angular.forEach(e.settings,function(e){e.key&&(l[e.key]=e.value)}),0!==Object.keys(l).length&&-1===s.indexOf(e.format)&&(r.settings=l);var c={ttl:e.ttl,format:r,"notification.threshold.mb":e.threshold};n.setProperties(o,c).$promise.then(function(){e.reload(),i.show({type:"success",title:"Success",content:"Stream properties have been successfully saved"})},function(e){i.show({type:"danger",content:e.data})})},e.$watch("format",function(){return"stream"===e.format?(e.properties=[{name:"body",type:"string"}],e.settings=[],void(e.disableButtons=!1)):"grok"!==e.format?void(e.disableButtons=!1):(e.disableButtons=!0,void(e.settings=[{key:"pattern",value:e.settings[0]?e.settings[0].value:""}]))}),e.addProperties=function(){e.properties.push({name:"",type:"string"})},e.removeProperty=function(t){var a=e.properties.indexOf(t);e.properties.splice(a,1)},e.addSetting=function(){e.settings.push({key:"",value:""})},e.removeSetting=function(t){var a=e.settings.indexOf(t);e.settings.splice(a,1)},e.deleteStream=function(){s.emit("showLoadingIcon"),n["delete"](o,{},function(){s.emit("hideLoadingIcon.immediate"),r.go("admin.namespace.detail.data",{},{reload:!0}).then(function(){i.show({type:"success",content:"Successfully deleted stream"})})},function(){s.emit("hideLoadingIcon.immediate")})},e.enter=function(t,a,n){a&&13===t.keyCode&&("settings"===n?e.addSetting():"preference"===n&&e.addProperties())}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("NamespaceStreamsCreateController",["$scope","$uibModalInstance","caskFocusManager","$stateParams","myStreamApi","myAlertOnValium","$state",function(e,t,a,n,r,s,i){a.focus("streamId"),e.isSaving=!1,e.streamId="",e.createStream=function(){if(!e.isSaving){e.isSaving=!0;var t={namespace:n.nsadmin,streamId:e.streamId,scope:e};r.create(t,{}).$promise.then(function(){e.isSaving=!1,i.go("admin.namespace.detail.data",{},{reload:!0}).then(function(){s.show({type:"success",content:"Stream "+e.streamId+" created successfully"})})},function(t){e.isSaving=!1,e.error=t.data})}},e.closeModal=function(){t.close()},e.enter=function(t){13===t.keyCode&&e.createStream()}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("NamespaceTemplatesController",["$scope","myPipelineApi","HydratorPlusPlusPluginConfigFactory","myHelpers","mySettings","$stateParams","$state","GLOBALS","$rootScope","myAlertOnValium",function(e,t,a,n,r,s,i,o,l,c){function u(){if(d.pluginName){d.configFetched=!1;var e;switch(d.pluginType){case o.pluginTypes[d.templateType].source:e=t.fetchSourceProperties;break;case o.pluginTypes[d.templateType].transform:e=t.fetchTransformProperties;break;case o.pluginTypes[d.templateType].sink:e=t.fetchSinkProperties}h={name:d.pluginName};var a={namespace:s.nsadmin,pipelineType:d.templateType,extensionType:d.pluginType,pluginName:d.pluginName,version:l.cdapVersion};e(a).$promise.then(function(e){d.pluginVersions=e,d.isEdit&&(d.plugin=e.filter(function(e){return angular.equals(e.artifact,d.pluginConfig.artifact)})[0],d.onPluginVersionSelect())})}}var p,d=this;d.GLOBALS=o,d.pluginList=[],d.isEdit=!1,d.isDisabled=!1,d.configFetched=!1,d.noConfig=!1,d.pipelineTypeOptions=[d.GLOBALS.etlBatch,d.GLOBALS.etlRealtime];var m=[o.pluginTypes[d.GLOBALS.etlBatch].source,o.pluginTypes[d.GLOBALS.etlBatch].sink,o.pluginTypes[d.GLOBALS.etlBatch].transform],f=[o.pluginTypes[d.GLOBALS.etlRealtime].source,o.pluginTypes[d.GLOBALS.etlRealtime].sink,o.pluginTypes[d.GLOBALS.etlRealtime].transform];d.pluginDescription="";var h;d.onPipelineTypeChange=function(){d.pluginList=[],d.pluginVersions=[],d.pluginType=null,d.pluginTypeOptions=d.templateType===d.GLOBALS.etlBatch?m:f},d.getPluginsList=function(){d.pluginName=null,d.pluginVersions=[],h=null,d.pluginConfig=null,d.configFetched=!1;var e,a={pipelineType:d.templateType,namespace:s.nsadmin,version:l.cdapVersion};switch(d.pluginType){case o.pluginTypes[d.templateType].source:a.extensionType=o.pluginTypes[d.templateType].source,e=t.fetchSources(a).$promise;break;case o.pluginTypes[d.templateType].transform:a.extensionType=o.pluginTypes[d.templateType].transform,e=t.fetchTransforms(a).$promise;break;case o.pluginTypes[d.templateType].sink:a.extensionType=o.pluginTypes[d.templateType].sink,e=t.fetchSinks(a).$promise}e.then(function(e){d.pluginList=_.uniq(e.map(function(e){return e.name}))})},d.onPluginSelect=function(){u()},d.onPluginVersionSelect=function(){if(d.plugin){d.pluginConfig?d.pluginConfig._backendProperties=d.plugin.properties:d.pluginConfig={_backendProperties:d.plugin.properties,properties:{},lock:{}};var e={name:d.plugin.artifact.name,version:d.plugin.artifact.version,scope:d.plugin.artifact.scope,key:"widgets."+d.plugin.name+"-"+d.plugin.type};a.fetchWidgetJson(e.name,e.version,e.scope,e.key).then(function(e){d.configFetched=!0,d.noConfig=!1,d.groupsConfig=a.generateNodeConfig(d.pluginConfig._backendProperties,e),angular.forEach(d.groupsConfig.groups,function(e){angular.forEach(e.fields,function(e){e.defaultValue&&(d.pluginConfig.properties[e.name]=d.pluginConfig.properties[e.name]||e.defaultValue)})});var t=d.groupsConfig.outputSchema;if(t.implicitSchema){var n=Object.keys(t.implicitSchema),r=[];angular.forEach(n,function(e){r.push({name:e,type:t.implicitSchema[e]})}),d.pluginConfig.outputSchema=JSON.stringify({fields:r})}},function(){d.noConfig=!0,d.configFetched=!0})}},s.pluginTemplate&&(d.isEdit=!0,d.configFetched=!1,r.get("pluginTemplates").then(function(e){var t=e[s.nsadmin][s.templateType][s.pluginType][s.pluginTemplate];d.templateType=t.templateType,d.pluginType=t.pluginType,d.pluginName=t.pluginName,d.pluginConfig={artifact:t.artifact,pluginTemplate:t.pluginTemplate,properties:t.properties,outputSchema:t.outputSchema,lock:t.lock},p=t.pluginTemplate,d.pluginDescription=t.description,u()})),d.save=function(){if(!d.pluginConfig||!d.pluginConfig.pluginTemplate)return void c.show({type:"danger",title:"Error!",content:o.en.admin.templateNameMissingError});var e=d.pluginList.map(function(e){return e.name});if(-1!==e.indexOf(d.pluginConfig.pluginTemplate))return void c.show({type:"danger",title:"Error!",content:o.en.admin.pluginSameNameError});d.loading=!0;var t=n.objectQuery(d.groupsConfig,"outputSchema","outputSchemaProperty","0");t&&d.pluginConfig._backendProperties&&d.pluginConfig._backendProperties[t]&&(d.pluginConfig.properties[t]=d.pluginConfig.outputSchema);var a={artifact:d.plugin.artifact,pluginTemplate:d.pluginConfig.pluginTemplate,description:d.pluginDescription,properties:d.pluginConfig.properties,pluginType:d.pluginType,templateType:d.templateType,pluginName:d.pluginName,outputSchema:d.pluginConfig.outputSchema,lock:d.pluginConfig.lock},l=s.nsadmin;r.get("pluginTemplates").then(function(e){angular.isObject(e)||(e={});var t=n.objectQuery(e,l,a.templateType,a.pluginType,a.pluginTemplate);if(t&&!d.isEdit)return c.show({type:"danger",content:o.en.admin.templateNameExistsError}),void(d.loading=!1);if(d.isEdit&&p!==d.pluginConfig.pluginTemplate){if(t)return c.show({type:"danger",content:o.en.admin.templateNameExistsError}),void(d.loading=!1);delete e[l][a.templateType][a.pluginType][p]}var s=[l,a.templateType,a.pluginType,a.pluginTemplate];n.objectSetter(e,s,a),r.set("pluginTemplates",e).then(function(){d.loading=!1,i.go("admin.namespace.detail.templateslist").then(function(){c.show({type:"success",content:"Success saving template"})})})})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("NamespaceTemplatesListController",["$scope","mySettings","$stateParams","myAlertOnValium","myHelpers","GLOBALS","myLoadingService",function(e,t,a,n,r,s,i){function o(e){var t=[];return angular.forEach(e,function(e){t.push(e)}),t}function l(e){e&&(c.list=[],[s.etlBatch,s.etlRealtime].forEach(function(t){[s.pluginTypes[t].source,s.pluginTypes[t].transform,s.pluginTypes[t].sink].forEach(function(n){var s=r.objectQuery(e,a.nsadmin,t,n),i=o(s);c.list=c.list.concat(i)})}))}var c=this;c.list=[],t.get("pluginTemplates").then(l),c.isEmpty=function(){return 0===c.list.length},c["delete"]=function(e){i.showLoadingIcon(),t.get("pluginTemplates").then(function(r){delete r[a.nsadmin][e.templateType][e.pluginType][e.pluginTemplate],l(r),t.set("pluginTemplates",r).then(function(){i.hideLoadingIcon(),n.show({type:"success",content:"Successfully deleted template"})},function(e){i.hideLoadingIcon(),n.show({type:"danger",title:"Delete failed",content:e})})},function(){i.hideLoadingIcon(),n.show({type:"danger",title:"User store acces failed"})})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("SystemConfigurationController",["$scope","MyCDAPDataSource",function(e,t){var a=new t(e);e.config=[],a.request({_cdapPath:"/config/cdap"}).then(function(t){e.config=t})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("SystemServiceDetailController",["$scope","$state","MyCDAPDataSource",function(e,t,a){e.basePath="/system/services/"+t.params.serviceName;var n=new a(e);n.request({_cdapPath:e.basePath+"/instances"}).then(function(t){e.instances=t})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("SystemServiceLogController",["$scope","$state","MyCDAPDataSource","$timeout",function(e,t,a,n){var r=new a(e),s="/system/services/"+encodeURIComponent(t.params.serviceName)+"/logs/";e.loadingNext=!0,r.request({_cdapPath:s+"next?&maxSize=50"}).then(function(t){e.logs=t,e.loadingNext=!1}),e.loadNextLogs=function(){if(!e.loadingNext){e.loadingNext=!0;var t=e.logs[e.logs.length-1].offset;r.request({_cdapPath:s+"next?&maxSize=50&fromOffset="+t}).then(function(t){e.logs=_.uniq(e.logs.concat(t)),e.loadingNext=!1})}},e.loadPrevLogs=function(){if(!e.loadingPrev){e.loadingPrev=!0;var t=e.logs[0].offset;r.request({_cdapPath:s+"prev?maxSize=50&fromOffset="+t}).then(function(a){e.logs=_.uniq(a.concat(e.logs)),e.loadingPrev=!1,n(function(){document.getElementById(t).scrollIntoView()})})}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.admin").controller("SystemServicesController",["$scope","MyCDAPDataSource",function(e,t){e.services=[];var a=new t(e);a.request({_cdapPath:"/system/services"}).then(function(t){e.services=t})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s){var i=this;_classCallCheck(this,e),this.$state=t,this.$stateParams=n,this.programs=[],this.datasrc=new r(a),s.programs.forEach(function(e){e.type_plural=e.type+(-1===["Mapreduce","Spark"].indexOf(e.type)?"s":""),i.fetchStatus(e.type_plural.toLowerCase(),e.name)}),this.programs=s.programs}return e.$inject=["$state","$scope","$stateParams","MyCDAPDataSource","rAppData"],_createClass(e,[{key:"fetchStatus",value:function(e,t){var a=this,n="/apps/"+this.$stateParams.appId;this.datasrc.poll({_cdapNsPath:n+"/"+e+"/"+t+"/status"},function(e){var n=a.programs.filter(function(e){return e.name===t});n[0].status=e.status})}},{key:"goToDetail",value:function(e,t){this.$state.go(e.toLowerCase()+".detail",{programId:t})}},{key:"goToList",value:function(e){this.$state.go(e.toLowerCase()+".list")}}]),e}();t.$inject=["$state","$scope","$stateParams","MyCDAPDataSource","rAppData"],angular.module(e.name+".feature.apps").controller("AppDetailProgramsController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=function a(e,t,n,r){_classCallCheck(this,a),e.init(n);var s=e.getCloneConfig();t.createGraphFromConfig(s.__ui__.nodes,s.config.connections),r.$on("$destroy",function(){e.reset()})};t.$inject=["HydratorPlusPlusDetailNonRunsStore","DAGPlusPlusNodesActionsFactory","rPipelineDetail","$scope"],angular.module(e.name+".feature.apps").controller("AppDetailStatusController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.dashboard").controller("WidgetTableCtrl",["$scope","MyCDAPDataSource","MyChartHelpers","MyMetricsQueryHelper",function(e,t,a,n){e.metrics=e.wdgt.metric;var r=new t(e);r.request({_cdapPath:"/metrics/query",method:"POST",body:n.constructQuery("qid",n.contextToTags(e.metrics.context),e.metrics)
}).then(function(t){var n=a.processData(t,"qid",e.metrics.names,e.metrics.resolution);n=a.c3ifyData(n,e.metrics,{});var r=[];n.xCoords.forEach(function(e,t){if(0!==t){var a=[e];n.columns.forEach(function(e){e.length&&"x"!==e[0]&&a.push(e[t])}),r.push(a)}}),e.tableData=r})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.dashboard").controller("C3WidgetTimeseriesCtrl",["$scope","myHelpers","$timeout",function(e,t,a){e.chartSize={height:200};var n,r,s=t.objectQuery(e,"gridsterItem","$element",0);s&&(n=parseInt(s.style.height,10),r=parseInt(s.style.width,10),n>300&&(e.wdgt.height=n-70),e.wdgt.width=r-32),e.$on("gridster-resized",function(){a(function(){e.chartSize.height=parseInt(e.gridsterItem.$element[0].style.height,10)-70,e.chartSize.width=parseInt(e.gridsterItem.$element[0].style.width,10)-32})}),e.$watch("wdgt.height",function(t){e.chartSize.height=t}),e.$watch("wdgt.width",function(t){t&&(e.chartSize.width=t)})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.datasets").controller("DatasetExploreController",["$state",function(e){var t=e.params.datasetId;t=t.replace(/[\.\-]/g,"_"),this.name=t}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.datasets").controller("DatasetMetadataController",["$scope","$state","myExploreApi",function(e,t,a){var n=t.params.datasetId;n=n.replace(/[\.\-]/g,"_");var r={namespace:t.params.namespace,table:"dataset_"+n,scope:e};this.metadata={},a.getInfo(r).$promise.then(function(e){this.metadata=e}.bind(this))}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.datasets").controller("DatasetDetailProgramsController",["$scope","$state","myDatasetApi",function(e,t,a){var n={namespace:t.params.namespace,datasetId:t.params.datasetId,scope:e};a.programsList(n).$promise.then(function(e){this.programs=e}.bind(this))}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.datasets").controller("DatasetDetailStatusController",["$scope","MyCDAPDataSource","$state","myHelpers","MyMetricsQueryHelper","myExploreApi","explorableDatasets",function(e,t,a,n,r,s,i){function o(e){var t="/metrics/query?metric="+e.name+"&"+r.tagsToParams(p)+"&start=now-1s&end=now-1s&resolution=1s";c.poll({_cdapPath:t,method:"POST"},function(t){var a=l(t,"series",0,"data",0,"value");this[e.scopeProperty]=a}.bind(this))}if(this.writes=0,this.reads=0,this.storage=0,this.transactions=0,this.explorable=i,i){var l=n.objectQuery,c=new t(e),u=a.params.datasetId,p={namespace:a.params.namespace,dataset:u};[{name:"system.dataset.store.reads",scopeProperty:"reads"},{name:"system.dataset.store.writes",scopeProperty:"writes"}].forEach(o.bind(this)),c.poll({_cdapPath:"/metrics/query?metric=system.dataset.store.bytes&"+r.tagsToParams(p)+"&aggregate=true",method:"POST"},function(e){var t=l(e,"series",0,"data",0,"value");this.storage=t}.bind(this));var d=a.params.datasetId;d=d.replace(/[\.\-]/g,"_");var m={namespace:a.params.namespace,table:"dataset_"+d,scope:e};s.getInfo(m).$promise.then(function(e){this.schema=l(e,"schema")}.bind(this))}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i){var o=this;_classCallCheck(this,e),this.$scope=t,this.$filter=a,this.runs=r,this.$uibModal=s,this.rFlowsDetail=i,this.description=i.description;var l=a("filter");if(n.params.runid){var c=l(this.runs,{runid:n.params.runid});if(!c.length)return void n.go("404");this.runs.selected=angular.copy(c[0])}else this.runs.length?this.runs.selected=angular.copy(this.runs[0]):this.runs.selected={runid:"No Runs"};this.$scope.$watch(function(){return o.runs.selected.runid},function(){n.params.runid||o.runs.length&&(o.runs.selected=angular.copy(o.runs[0]))}),this.tabs=[{title:"Status",template:"/old_assets/features/flows/templates/tabs/runs/tabs/status.html"},{title:"Flowlets",template:"/old_assets/features/flows/templates/tabs/runs/tabs/flowlets.html"},{title:"Logs",template:"/old_assets/features/flows/templates/tabs/runs/tabs/log.html"},{title:"Datasets",template:"/old_assets/features/flows/templates/tabs/data.html"}],this.activeTab=this.tabs[0],this.metadataParams={namespace:n.params.namespace,appId:n.params.appId,programType:"flows",programId:n.params.programId,scope:this.$scope}}return e.$inject=["$scope","$filter","$state","rRuns","$uibModal","rFlowsDetail"],_createClass(e,[{key:"selectTab",value:function(e,t){"Flowlets"===e.title&&(this.activeFlowlet=t),this.activeTab=e}},{key:"openHistory",value:function(){var e=this;this.$uibModal.open({size:"lg",templateUrl:"/old_assets/features/flows/templates/tabs/history.html",controller:["runs","$scope",function(e,t){t.runs=e}],resolve:{runs:function(){return e.runs}}})}}]),e}();t.$inject=["$scope","$filter","$state","rRuns","$uibModal","rFlowsDetail"],angular.module(e.name+".feature.flows").controller("FlowsRunsController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i,o,l){var c=this;_classCallCheck(this,e),this.DAGPlusPlusNodesStore=t,this.HydratorPlusPlusConfigStore=a,this.HydratorPlusPlusHydratorService=n,this.DAGPlusPlusNodesActionsFactory=i,this.GLOBALS=s,this.previewStore=o,this.$uibModal=r,this.nodes=[],this.connections=[],this.previewMode=!1,t.registerOnChangeListener(function(){c.setActiveNode(),c.setStateAndUpdateConfigStore()});var u=this.previewStore.subscribe(function(){var e=c.previewStore.getState().preview;c.previewMode=e.isPreviewModeEnabled});l.$on("$destroy",function(){u()})}return e.$inject=["DAGPlusPlusNodesStore","HydratorPlusPlusConfigStore","HydratorPlusPlusHydratorService","$uibModal","GLOBALS","DAGPlusPlusNodesActionsFactory","HydratorPlusPlusPreviewStore","$scope"],_createClass(e,[{key:"setStateAndUpdateConfigStore",value:function(){this.nodes=this.DAGPlusPlusNodesStore.getNodes(),this.connections=this.DAGPlusPlusNodesStore.getConnections(),this.HydratorPlusPlusConfigStore.setNodes(this.nodes),this.HydratorPlusPlusConfigStore.setConnections(this.connections),this.HydratorPlusPlusConfigStore.setComments(this.DAGPlusPlusNodesStore.getComments())}},{key:"setActiveNode",value:function(){var e=this.DAGPlusPlusNodesStore.getActiveNodeId();if(e){var t,a,n=this.HydratorPlusPlusConfigStore.getNodes().filter(function(t){return t.name===e});n.length?t=n[0]:(a=this.DAGPlusPlusNodesStore.getNodes().filter(function(t){return t.name===e}),t=a[0]),this.$uibModal.open({windowTemplateUrl:"/old_assets/features/hydratorplusplus/templates/partial/node-config-modal/popover-template.html",templateUrl:"/old_assets/features/hydratorplusplus/templates/partial/node-config-modal/popover.html",size:"lg",windowClass:"node-config-modal hydrator-modal",controller:"HydratorPlusPlusNodeConfigCtrl",bindToController:!0,controllerAs:"HydratorPlusPlusNodeConfigCtrl",animation:!1,resolve:{rIsStudioMode:function(){return!0},rDisabled:function(){return!1},rPlugin:["HydratorPlusPlusNodeService","HydratorPlusPlusConfigStore","GLOBALS",function(e,a,n){var r=t.name,s=a.getAppType(),i=a.getSourceNodes(r).filter(function(e){return"string"==typeof e.outputSchema}),o=a.getArtifact().version;return e.getPluginInfo(t,s,i,o).then(function(e){return{node:e,isValidPlugin:!0,type:s,isSource:"source"===n.pluginConvert[e.type],isSink:"sink"===n.pluginConvert[e.type],isTransform:"transform"===n.pluginConvert[e.type],isAction:"action"===n.pluginConvert[e.type]}})}]}}).result.then(this.deleteNode.bind(this),this.deleteNode.bind(this))}}},{key:"deleteNode",value:function(){this.DAGPlusPlusNodesActionsFactory.resetSelectedNode(),this.setStateAndUpdateConfigStore()}},{key:"generateSchemaOnEdge",value:function(e){return this.HydratorPlusPlusHydratorService.generateSchemaOnEdge(e)}}]),e}();angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusCreateCanvasCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i,o,l,c,u,p,d,m,f){function h(e){for(var t=Date.now(),a=confirm(e),n=Date.now()-t,r=0;10>r&&!a&&50>n;r++)t=Date.now(),a=confirm(e),n=Date.now()-t;return 50>n?!0:a}var g=this;_classCallCheck(this,e),this.myLocalStorage=p,this.myLocalStorage.get("hydrator++-leftpanel-isExpanded").then(function(e){return g.isExpanded=e===!1?!1:!0})["catch"](function(){return g.isExpanded=!0}),f.listen(),s.$on("$destroy",function(){f.unsubscribe(),l.resetMessages(),m.onbeforeunload=null});var y=function(){var e=void 0;return u.length&&(e=u.filter(function(e){return e.name===c})),e.length?e[0]:u[0]},v=y();if(n){n.artifact||(n.artifact=v),t.initializeConfigStore(n);var S=n;n.__ui__||(S=o.getNodesAndConnectionsFromConfig(n,!0),S.__ui__={nodes:S.nodes.map(function(e){return e.properties=e.plugin.properties,e.label=e.plugin.label,e})},S.config={connections:S.connections}),i.createGraphFromConfig(S.__ui__.nodes,S.config.connections,S.config.comments)}else{var P={};P.artifact=v,t.initializeConfigStore(P)}var T=function(e){if(d.getIsStateDirty()){e=e||m.event;var t="You have unsaved changes.";return e&&(e.returnValue=t),t}};m.onbeforeunload=T,s.$on("$stateChangeStart",function(e){if(d.getIsStateDirty()){var t=h("You have unsaved changes. Are you sure you want to exit this page?");t||e.preventDefault()}})}return e.$inject=["HydratorPlusPlusConfigActions","$stateParams","rConfig","$rootScope","$scope","DAGPlusPlusNodesActionsFactory","HydratorPlusPlusHydratorService","HydratorPlusPlusConsoleActions","rSelectedArtifact","rArtifacts","myLocalStorage","HydratorPlusPlusConfigStore","$window","HydratorPlusPlusConsoleTabService"],_createClass(e,[{key:"toggleSidebar",value:function(){this.isExpanded=!this.isExpanded,this.myLocalStorage.set("hydrator++-leftpanel-isExpanded",this.isExpanded)}}]),e}();t.$inject=["HydratorPlusPlusConfigActions","$stateParams","rConfig","$rootScope","$scope","DAGPlusPlusNodesActionsFactory","HydratorPlusPlusHydratorService","HydratorPlusPlusConsoleActions","rSelectedArtifact","rArtifacts","myLocalStorage","HydratorPlusPlusConfigStore","$window","HydratorPlusPlusConsoleTabService"],angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusStudioCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i,o,l,c,u,p,d,m,f,h,g,y,v,S,P){var T=this;_classCallCheck(this,e),this.$state=d,this.$scope=t,this.$stateParams=a,this.HydratorPlusPlusConfigStore=r,this.DAGPlusPlusFactory=o,this.DAGPlusPlusNodesActionsFactory=l,this.NonStorePipelineErrorFactory=c,this.PluginTemplatesDirActions=h,this.rVersion=n,this.leftpanelStore=s,this.myAlertOnValium=p,this.$q=m,this.HydratorPlusPlusOrderingFactory=g,this.leftpanelActions=i,this.LEFTPANELSTORE_ACTIONS=y,this.myHelpers=v,this.mySettings=P,this.pluginsMap=[],this.sourcesToVersionMap={},this.transformsToVersionMap={},this.sinksToVersionMap={},this.artifacts=f;var C=this.HydratorPlusPlusConfigStore.getArtifact();this.selectedArtifact=f.filter(function(e){return e.name===C.name})[0],this.artifactToRevert=this.selectedArtifact,this.leftpanelStore.dispatch(this.leftpanelActions.fetchExtensions({namespace:a.namespace,pipelineType:this.selectedArtifact.name,version:this.rVersion.version,scope:this.$scope})),this.leftpanelStore.dispatch(this.leftpanelActions.fetchTemplates({namespace:this.$stateParams.namespace},{namespace:a.namespace,pipelineType:this.selectedArtifact.name})),this.leftpanelStore.dispatch(this.leftpanelActions.fetchDefaultVersion());var b=this.leftpanelStore.subscribe(function(){var e=T.leftpanelStore.getState().extensions;e.forEach(function(e){var t=function(e){return T.pluginsMap.filter(function(t){return t.name===T.HydratorPlusPlusOrderingFactory.getPluginTypeDisplayName(e)})},a=function(e){return t(e).filter(function(t){return-1!==t.pluginTypes.indexOf(e)})};if(t(e).length||T.pluginsMap.push({name:T.HydratorPlusPlusOrderingFactory.getPluginTypeDisplayName(e),plugins:[],pluginTypes:[]}),a(e).length)t(e).forEach(function(e){e.plugins=e.pluginTypes.map(function(e){return T.leftpanelStore.getState().plugins.pluginTypes[e]||[]}).reduce(function(e,t){return e.concat(t)},[])});else{t(e).forEach(function(t){return t.pluginTypes.push(e)});var n={namespace:T.$stateParams.namespace,pipelineType:T.HydratorPlusPlusConfigStore.getArtifact().name,version:T.rVersion.version,extensionType:e,scope:T.$scope};T.leftpanelStore.dispatch(T.leftpanelActions.fetchPlugins(e,n))}}),e.length&&(T.pluginsMap=T.HydratorPlusPlusOrderingFactory.orderPluginTypes(T.pluginsMap))}),A=S(function(){T.leftpanelStore.dispatch({type:T.LEFTPANELSTORE_ACTIONS.PLUGIN_DEFAULT_VERSION_CHECK_AND_UPDATE});var e=T.leftpanelStore.getState().plugins.pluginToVersionMap;T.mySettings.set("plugin-default-version",e)},1e4);this.$uibModal=u,this.$scope.$on("$destroy",function(){T.leftpanelStore.dispatch({type:T.LEFTPANELSTORE_ACTIONS.RESET}),b(),S.cancel(A)})}return e.$inject=["$scope","$stateParams","rVersion","HydratorPlusPlusConfigStore","HydratorPlusPlusLeftPanelStore","HydratorPlusPlusPluginActions","DAGPlusPlusFactory","DAGPlusPlusNodesActionsFactory","NonStorePipelineErrorFactory","$uibModal","myAlertOnValium","$state","$q","rArtifacts","PluginTemplatesDirActions","HydratorPlusPlusOrderingFactory","LEFTPANELSTORE_ACTIONS","myHelpers","$timeout","mySettings"],_createClass(e,[{key:"onArtifactChange",value:function(){var e=this;this._checkAndShowConfirmationModalOnDirtyState().then(function(t){t?(e.HydratorPlusPlusConfigStore.setState(e.HydratorPlusPlusConfigStore.getDefaults()),e.$state.go("hydratorplusplus.create",{namespace:e.$state.params.namespace,artifactType:e.selectedArtifact.name,data:null},{reload:!0,inherit:!1})):e.selectedArtifact=e.artifactToRevert})}},{key:"openFileBrowser",value:function(){var e=function(){document.getElementById("pipeline-import-config-link").click()};this._checkAndShowConfirmationModalOnDirtyState(e)}},{key:"importFile",value:function(e){var t=this;if(-1===e[0].name.indexOf(".json"))return void this.myAlertOnValium.show({type:"danger",content:"Pipeline configuration should be JSON."});var a=function(e){var t=[e.source].concat(e.transforms||[]).concat(e.sinks),a=[],n=void 0;for(n=0;n<t.length-1;n++)a.push({from:t[n].name,to:t[n+1].name});return a},n=function(e){var a=[],n=[],r=t.artifacts.filter(function(t){return t.name===e.name});return a=r.filter(function(t){return t.version===e.version}),n=r.filter(function(t){return t.scope===e.scope}),{name:r.length>0,version:a.length>0,scope:n.length>0}},r=new FileReader;r.readAsText(e[0],"UTF-8"),r.onload=function(e){var r,s=e.target.result;try{r=JSON.parse(s)}catch(i){return void t.myAlertOnValium.show({type:"danger",content:"Syntax Error. Ill-formed pipeline configuration."})}r.config.connections||(r.config.connections=a(r.config));var o=t.NonStorePipelineErrorFactory.validateImportJSON(r);if(o)return void t.myAlertOnValium.show({type:"danger",content:o});var l=n(r.artifact);if(l.name&&l.version&&l.scope)r.config.connections||(r.config.connections=a(r.config)),t.HydratorPlusPlusConfigStore.setState(t.HydratorPlusPlusConfigStore.getDefaults()),t.$state.go("hydratorplusplus.create",{data:r});else{var c=[];l.name?(l.version||c.push("Artifact version"),l.scope||c.push("Artifact scope")):c.push("Artifact name"),c=1===c.length?c[0]:c.join(", "),t.myAlertOnValium.show({type:"danger",content:"Imported pipeline has invalid artifact information: "+c+"."})}}}},{key:"showTemplates",value:function(){var e=this,t=this.HydratorPlusPlusConfigStore.getArtifact().name,a=function(){e.$uibModal.open({templateUrl:"/old_assets/features/hydratorplusplus/templates/create/popovers/pre-configured-templates.html",size:"lg",backdrop:!0,keyboard:!0,controller:"HydratorPlusPlusPreConfiguredCtrl",controllerAs:"HydratorPlusPlusPreConfiguredCtrl",windowTopClass:"hydrator-template-modal hydrator-modal",resolve:{rTemplateType:function(){return t}}})};this._checkAndShowConfirmationModalOnDirtyState().then(function(e){e&&a()})}},{key:"_checkAndShowConfirmationModalOnDirtyState",value:function(e){var t=!0,a=this.HydratorPlusPlusConfigStore.getIsStateDirty();return a?this.$uibModal.open({templateUrl:"/old_assets/features/hydratorplusplus/templates/create/popovers/canvas-overwrite-confirmation.html",size:"lg",backdrop:"static",keyboard:!1,windowTopClass:"confirm-modal hydrator-modal",controller:["$scope","HydratorPlusPlusConfigStore","HydratorPlusPlusConfigActions",function(a,n,r){a.isSaving=!1,a.discard=function(){t=!0,e&&e(),a.$close()},a.save=function(){var e=n.getName();if(!e.length)return r.saveAsDraft(),t=!1,void a.$close();var s=n.registerOnChangeListener(function(){var e=n.getIsStateDirty();e||(s(),t=!0,a.$close())});r.saveAsDraft(),a.isSaving=!0},a.cancel=function(){a.$close(),t=!1}}]}).closed.then(function(){return t}):(e&&e(),this.$q.when(t))}},{key:"onLeftSidePanelItemClicked",value:function(e,t){e.stopPropagation(),"createTemplate"===t.action?this.createPluginTemplate(t.contentData,"create"):"deleteTemplate"===t.action?this.deletePluginTemplate(t.contentData):"editTemplate"===t.action?this.createPluginTemplate(t.contentData,"edit"):this.addPluginToCanvas(e,t)}},{key:"deletePluginTemplate",value:function(e){var t=this.HydratorPlusPlusConfigStore.getArtifact().name;this.$uibModal.open({templateUrl:"/old_assets/features/hydratorplusplus/templates/partial/plugin-delete-confirmation.html",size:"lg",backdrop:"static",keyboard:!1,windowTopClass:"confirm-modal hydrator-modal",controller:"PluginTemplatesDeleteCtrl",resolve:{rNode:function(){return e},rTemplateType:function(){return t}}})}},{key:"createPluginTemplate",value:function(e,t){var a=this,n=this.HydratorPlusPlusConfigStore.getArtifact().name;this.$uibModal.open({templateUrl:"/old_assets/features/hydratorplusplus/templates/create/popovers/plugin-templates.html",size:"lg",backdrop:"static",keyboard:!1,windowTopClass:"plugin-templates-modal hydrator-modal",controller:"PluginTemplatesCreateEditCtrl",resolve:{rTemplateType:function(){return n}}}).rendered.then(function(){a.PluginTemplatesDirActions.init({templateType:e.templateType||a.selectedArtifact.name,pluginType:e.pluginType||e.type,mode:"edit"===t?"edit":"create",templateName:e.pluginTemplate,pluginName:e.pluginName||e.name})})}},{key:"addPluginToCanvas",value:function(e,t){var a=this,n=function(e){if(e.pluginTemplate)return e;var n=[e],r=a.leftpanelStore.getState().plugins.pluginTypes[t.type],s=r.filter(function(e){return e.name===t.name&&!e.pluginTemplate});return s.length&&(n=s[0].allArtifacts.filter(function(t){return angular.equals(t.artifact,e.defaultArtifact)})),n[0]},r=void 0;t.templateName?r=t:(r=n(t),this.leftpanelStore.dispatch(this.leftpanelActions.updateDefaultVersion(r))),this.DAGPlusPlusNodesActionsFactory.resetSelectedNode();var s=r.name||r.pluginTemplate,i=this.HydratorPlusPlusConfigStore.getNodes().filter(function(e){return e.plugin.label?e.plugin.label.includes(s):!1}),o=void 0;o=r.pluginTemplate?{plugin:{label:i.length>0?r.pluginTemplate+(i.length+1):r.pluginTemplate,name:r.pluginName,artifact:r.artifact,properties:r.properties},icon:this.DAGPlusPlusFactory.getIcon(r.pluginName),type:r.pluginType,outputSchema:r.outputSchema,inputSchema:r.inputSchema,pluginTemplate:r.pluginTemplate,description:r.description,lock:r.lock}:{plugin:{label:i.length>0?r.name+(i.length+1):r.name,artifact:r.artifact,name:r.name,properties:{}},icon:r.icon,description:r.description,type:r.type,warning:!0},this.DAGPlusPlusNodesActionsFactory.addNode(o)}},{key:"loadArtifact",value:function(){this.$uibModal.open({templateUrl:"/old_assets/features/hydratorplusplus/templates/create/popovers/load-artifact.html",size:"lg",backdrop:"static",keyboard:!1,windowTopClass:"load-artifact-modal hydrator-modal",controller:"LoadArtifactCtrl",controllerAs:"LoadArtifactCtrl"})}}]),e}();t.$inject=["$scope","$stateParams","rVersion","HydratorPlusPlusConfigStore","HydratorPlusPlusLeftPanelStore","HydratorPlusPlusPluginActions","DAGPlusPlusFactory","DAGPlusPlusNodesActionsFactory","NonStorePipelineErrorFactory","$uibModal","myAlertOnValium","$state","$q","rArtifacts","PluginTemplatesDirActions","HydratorPlusPlusOrderingFactory","LEFTPANELSTORE_ACTIONS","myHelpers","$timeout","mySettings"],angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusLeftPanelCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i,o,l,c,u,p,d,m,f,h,g,y,v,S,P,T){var C=this;_classCallCheck(this,e),this.consoleStore=c,this.myPipelineExportModalService=u,this.HydratorPlusPlusConfigStore=a,this.GLOBALS=o,this.HydratorPlusPlusConfigActions=n,this.$uibModal=r,this.HydratorPlusPlusConsoleActions=s,this.DAGPlusPlusNodesActionsFactory=i,this.parsedDescription=this.HydratorPlusPlusConfigStore.getDescription(),this.myHelpers=l,this.$timeout=p,this.PREVIEWSTORE_ACTIONS=T,this.previewStore=m,this.previewActions=f,this.$interval=h,this.myPipelineApi=g,this.$state=y,this.dataSrc=new v(d),this.myAlertOnValium=S,this.$stateParams=t,this.setState(),this.HydratorPlusPlusConfigStore.registerOnChangeListener(this.setState.bind(this)),this.focusTimeout=null,t.isClone&&this.openMetadata(),this.isPreviewEnabled=angular.isObject(P.hydrator)&&P.hydrator.previewEnabled===!0&&this.state.artifact.name===this.GLOBALS.etlDataPipeline,this.previewMode=!1,this.previewStartTime=null,this.displayDuration={minutes:"--",seconds:"--"},this.previewTimerInterval=null,this.previewLoading=!1;var b=this.previewStore.subscribe(function(){var e=C.previewStore.getState().preview;C.previewMode=e.isPreviewModeEnabled});d.$on("$destroy",function(){b(),C.$interval.cancel(C.previewTimerInterval),C.$timeout.cancel(C.focusTimeout),C.previewStore.dispatch({type:C.PREVIEWSTORE_ACTIONS.PREVIEW_RESET})})}return e.$inject=["$stateParams","HydratorPlusPlusConfigStore","HydratorPlusPlusConfigActions","$uibModal","HydratorPlusPlusConsoleActions","DAGPlusPlusNodesActionsFactory","GLOBALS","myHelpers","HydratorPlusPlusConsoleStore","myPipelineExportModalService","$timeout","$scope","HydratorPlusPlusPreviewStore","HydratorPlusPlusPreviewActions","$interval","myPipelineApi","$state","MyCDAPDataSource","myAlertOnValium","MY_CONFIG","PREVIEWSTORE_ACTIONS"],_createClass(e,[{key:"setMetadata",value:function(e){this.state.metadata=e}},{key:"setState",value:function(){this.state={metadata:{name:this.HydratorPlusPlusConfigStore.getName(),description:this.HydratorPlusPlusConfigStore.getDescription()},viewSettings:this.myHelpers.objectQuery(this.state,"viewSettings")||!1,artifact:this.HydratorPlusPlusConfigStore.getArtifact()}}},{key:"openMetadata",value:function(){this.metadataExpanded=!0,this.invalidName=!1,this.$timeout.cancel(this.focusTimeout),this.focusTimeout=this.$timeout(function(){document.getElementById("pipeline-name-input").focus()})}},{key:"resetMetadata",value:function(e){this.setState(),this.metadataExpanded=!1,e.preventDefault(),e.stopPropagation()}},{key:"saveMetadata",value:function(e){this.HydratorPlusPlusConfigActions.setMetadataInfo(this.state.metadata.name,this.state.metadata.description),this.state.metadata.description?(this.parsedDescription=this.state.metadata.description.replace(/\n/g," "),this.tooltipDescription=this.state.metadata.description.replace(/\n/g,"<br />")):(this.parsedDescription="",this.tooltipDescription=""),this.metadataExpanded=!1,e.preventDefault(),e.stopPropagation()}},{key:"onEnterOnMetadata",value:function(e){13===e.keyCode?(this.saveMetadata(e),this.metadataExpanded=!1):27===e.keyCode&&this.resetMetadata()}},{key:"onExport",value:function(){this.DAGPlusPlusNodesActionsFactory.resetSelectedNode();var e=angular.copy(this.HydratorPlusPlusConfigStore.getDisplayConfig()),t=this.HydratorPlusPlusConfigStore.getConfigForExport();this.myPipelineExportModalService.show(e,t)}},{key:"onSaveDraft",value:function(){this.HydratorPlusPlusConfigActions.saveAsDraft()}},{key:"checkNameError",value:function(){var e=this.consoleStore.getMessages()||[],t=e.filter(function(e){return-1!==["MISSING-NAME","INVALID-NAME"].indexOf(e.type)});this.invalidName=t.length?!0:!1}},{key:"onValidate",value:function(){this.HydratorPlusPlusConsoleActions.resetMessages();var e=this.HydratorPlusPlusConfigStore.validateState(!0);return e?void this.HydratorPlusPlusConsoleActions.addMessage([{type:"success",content:"Validation success! Pipeline "+this.HydratorPlusPlusConfigStore.getName()+" is valid."}]):void this.checkNameError()}},{key:"onPublish",value:function(){this.HydratorPlusPlusConfigActions.publishPipeline(),this.checkNameError()}},{key:"showSettings",value:function(){this.state.viewSettings=!this.state.viewSettings}},{key:"startTimer",value:function(){var e=this;this.previewTimerInterval=this.$interval(function(){var t=(new Date-e.previewStartTime)/1e3;t=t>=0?t:0;var a=Math.floor(t/60),n=Math.floor(t%60);n=10>n?"0"+n:n,a=10>a?"0"+a:a,e.displayDuration={minutes:a,seconds:n}},500)}},{key:"stopTimer",value:function(){this.$interval.cancel(this.previewTimerInterval)}},{key:"runPreview",value:function(){var e=this;this.previewLoading=!0,this.displayDuration={minutes:"--",seconds:"--"};var t={namespace:this.$state.params.namespace,scope:this.$scope},a=this.HydratorPlusPlusConfigStore.getConfigForExport(),n={startStages:[],endStages:[],numOfRecords:25};return angular.forEach(a.config.stages,function(t){"source"===e.GLOBALS.pluginConvert[t.plugin.type]?n.startStages.push(t.name):"sink"===e.GLOBALS.pluginConvert[t.plugin.type]&&n.endStages.push(t.name)}),a.config.preview=n,0===n.startStages.length||0===n.endStages.length?(this.myAlertOnValium.show({type:"danger",content:this.GLOBALS.en.hydrator.studio.error.PREVIEW["NO-SOURCE-SINK"]}),void(this.previewLoading=!1)):void this.myPipelineApi.runPreview(t,a).$promise.then(function(t){e.previewStore.dispatch(e.previewActions.setPreviewId(t.preview));var a=new Date;e.previewStartTime=a,e.startTimer(),e.previewStore.dispatch(e.previewActions.setPreviewStartTime(a)),e.startPollPreviewStatus(t.preview)},function(t){e.previewLoading=!1,e.myAlertOnValium.show({type:"danger",content:t.data})})}},{key:"startPollPreviewStatus",value:function(e){var t=this,a=this.dataSrc.poll({_cdapNsPath:"/previews/"+e+"/status",interval:5e3},function(e){"RUNNING"!==e.status&&(t.stopTimer(),t.previewLoading=!1,t.dataSrc.stopPoll(e.__pollId__),"COMPLETED"===e.status?t.myAlertOnValium.show({type:"success",content:"Pipeline preview is finished."}):t.myAlertOnValium.show({type:"danger",content:"Pipeline preview failed with status: "+e.status}))},function(e){t.previewLoading=!1,t.stopTimer(),t.myAlertOnValium.show({type:"danger",content:e}),t.dataSrc.stopPoll(a.__pollId__)})}},{key:"togglePreviewMode",value:function(){this.previewStore.dispatch(this.previewActions.togglePreviewMode(!this.previewMode))}}]),e}();angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusTopPanelCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusDetailCanvasCtrl",["rPipelineDetail","DAGPlusPlusNodesActionsFactory","HydratorPlusPlusHydratorService","DAGPlusPlusNodesStore","HydratorPlusPlusDetailNonRunsStore","HydratorPlusPlusDetailMetricsStore","$uibModal",function(e,t,a,n,r,s,i){function o(e){var t={};return angular.forEach(e,function(e){t[e.nodeName]={recordsOut:e.recordsOut,recordsIn:e.recordsIn}}),t}var l=this;this.$uibModal=i,this.DAGPlusPlusNodesStore=n,this.HydratorPlusPlusDetailNonRunsStore=r,this.HydratorPlusPlusHydratorService=a,this.HydratorPlusPlusDetailMetricsStore=s,this.DAGPlusPlusNodesActionsFactory=t;try{e.config=JSON.parse(e.configuration)}catch(c){return void console.log("ERROR in configuration from backend: ",c)}var u=r.getCloneConfig();this.DAGPlusPlusNodesActionsFactory.createGraphFromConfig(u.__ui__.nodes,u.config.connections,u.config.comments),this.updateNodesAndConnections=function(){var e=this.DAGPlusPlusNodesStore.getActiveNodeId();e?this.setActiveNode():this.deleteNode()},this.setActiveNode=function(){var e=this.DAGPlusPlusNodesStore.getActiveNodeId();if(e){var t=this.HydratorPlusPlusDetailNonRunsStore.getPluginObject(e);this.$uibModal.open({windowTemplateUrl:"/old_assets/features/hydratorplusplus/templates/partial/node-config-modal/popover-template.html",templateUrl:"/old_assets/features/hydratorplusplus/templates/partial/node-config-modal/popover.html",size:"lg",backdrop:"static",windowTopClass:"node-config-modal hydrator-modal",controller:"HydratorPlusPlusNodeConfigCtrl",controllerAs:"HydratorPlusPlusNodeConfigCtrl",resolve:{rIsStudioMode:function(){return!1},rDisabled:function(){return!0},rPlugin:["HydratorPlusPlusNodeService","HydratorPlusPlusDetailNonRunsStore","GLOBALS",function(e,a,n){var r=t.name,s=a.getAppType(),i=a.getArtifact().version,o=a.getSourceNodes(r).filter(function(e){return"string"==typeof e.outputSchema});return e.getPluginInfo(t,s,o,i).then(function(e){return{node:e,isValidPlugin:!0,type:s,isSource:"source"===n.pluginConvert[e.type],isSink:"sink"===n.pluginConvert[e.type],isTransform:"transform"===n.pluginConvert[e.type],isAction:"action"===n.pluginConvert[e.type]}})}]}}).result.then(this.deleteNode.bind(this),this.deleteNode.bind(this))}},this.deleteNode=function(){l.DAGPlusPlusNodesActionsFactory.resetSelectedNode()},this.generateSchemaOnEdge=function(e){return this.HydratorPlusPlusHydratorService.generateSchemaOnEdge(e)},this.metrics=o(this.HydratorPlusPlusDetailMetricsStore.getMetrics()),this.HydratorPlusPlusDetailMetricsStore.registerOnChangeListener(function(){this.metrics=o(this.HydratorPlusPlusDetailMetricsStore.getMetrics())}.bind(this)),n.registerOnChangeListener(this.setActiveNode.bind(this))}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _slicedToArray=function(){function e(e,t){var a=[],n=!0,r=!1,s=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(l){r=!0,s=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw s}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i,o,l,c,u,p,d,m,f,h){var g=this;_classCallCheck(this,e),this.GLOBALS=r,this.myPipelineExportModalService=p,this.myAlertOnValium=u,this.$state=s,this.moment=c,this.$scope=l,this.$timeout=o,this.scheduleTimeout=null,this.HydratorPlusPlusDetailNonRunsStore=a,this.HydratorPlusPlusDetailRunsStore=t,this.HydratorPlusPlusDetailActions=n,this.config=a.getCloneConfig(),
this.myPipelineApi=d,this.myHelpers=m,this.myLoadingService=i,this.myPreferenceApi=f,this.$q=h,this.app={name:a.getPipelineName(),description:this.config.description,type:this.config.artifact.name},this.runPlayer={view:!1,action:null},this.viewSettings=!1,this.viewLogs=!1,this.pipelineType=a.getPipelineType(),this.tooltipDescription=this.app.description&&this.app.description.replace(/\n/g,"<br />")||"",this.setState(),this.setAppStatus();var y=a.getAppType();-1!==r.etlBatchPipelines.indexOf(y)&&n.fetchScheduleStatus(t.getApi(),t.getScheduleParams()),t.registerOnChangeListener(function(){g.setAppStatus(),g.setState()}),a.registerOnChangeListener(this.setScheduleStatus.bind(this)),this.macrosList="",this.runTimeWidgetConfig={"widget-type":"keyvalue","widget-attributes":{showDelimiter:"false","key-placeholder":"Argument name","value-placeholder":"Argument value"}},this.fetchMacros(),this.$scope.$on("$destroy",function(){g.$timeout.cancel(g.scheduleTimeout)})}return e.$inject=["HydratorPlusPlusDetailRunsStore","HydratorPlusPlusDetailNonRunsStore","HydratorPlusPlusDetailActions","GLOBALS","$state","myLoadingService","$timeout","$scope","moment","myAlertOnValium","myPipelineExportModalService","myPipelineApi","myHelpers","myPreferenceApi","$q"],_createClass(e,[{key:"fetchMacros",value:function(){var e=this,t=function(t,a){return t.concat(e.myHelpers.objectQuery(a,"spec","properties","macros","lookupProperties")||[])},a=function(e){return e.reduce(t,[]).map(function(e){return e+":"}).sort().join(",")},n=this.HydratorPlusPlusDetailRunsStore.getParams(),r=n.namespace,s=n.app,i={namespace:this.$state.params.namespace,appId:this.$state.params.pipelineId,scope:this.$scope},o=function(e){return console.log("ERROR",e)};return this.myPipelineApi.fetchMacros({namespace:r,pipeline:s}).$promise.then(function(t){return e.macrosList=a(t)},function(t){return e.macroError=t}).then(function(){return e.myPreferenceApi.getAppPreference(i).$promise},o).then(function(t){return e.syncPreferencesStoreWithMacros(t)},o)}},{key:"syncPreferencesStoreWithMacros",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];try{e=JSON.parse(angular.toJson(e))}catch(t){console.log("ERROR: ",t),e={}}var a=Object.assign({},this.getMacrosMap(),e);this.macrosList=Object.keys(a).map(function(e){return e+":"+(a[e]||"")}).join(",")}},{key:"isValidToStartOrSchedule",value:function(){return 0===this.macrosList.length?!0:this.macrosList.split(",").reduce(function(e,t){return e&&t&&t.split(":")[1]},!0)}},{key:"getMacrosMap",value:function(){var e={};return this.macrosList.length?(this.macrosList.split(",").forEach(function(t){var a=t.split(":"),n=_slicedToArray(a,2),r=n[0],s=n[1];e[r]=s}),e):e}},{key:"setState",value:function(){var e,t,a,n=this.HydratorPlusPlusDetailRunsStore.getRuns();for(t=0;t<n.length;t++)if(e=n[t].status,-1===["RUNNING","STARTING","STOPPING"].indexOf(e)){this.lastFinished=n[t];break}this.lastFinished?(a=this.lastFinished.end-this.lastFinished.start,this.lastRunTime=this.moment.utc(1e3*a).format("HH:mm:ss")):this.lastRunTime="N/A",this.config=this.HydratorPlusPlusDetailNonRunsStore.getCloneConfig()}},{key:"setAppStatus",value:function(){this.appStatus=this.HydratorPlusPlusDetailRunsStore.getStatus(),this.config=this.HydratorPlusPlusDetailNonRunsStore.getCloneConfig()}},{key:"setScheduleStatus",value:function(){this.scheduleStatus=this.HydratorPlusPlusDetailNonRunsStore.getScheduleStatus()}},{key:"isGreenStatus",value:function(){var e=["COMPLETED","RUNNING","SCHEDULED","STARTING"];return e.indexOf(this.appStatus)>-1?!0:!1}},{key:"exportConfig",value:function t(){var e=angular.copy(this.HydratorPlusPlusDetailNonRunsStore.getConfigJson());e.stages=e.stages.map(function(e){return{name:e.name,plugin:e.plugin}});var t=this.HydratorPlusPlusDetailNonRunsStore.getCloneConfig();this.myPipelineExportModalService.show(e,t)}},{key:"do",value:function(e){var t=this;switch(e){case"Start":this.fetchMacros().then(function(){t.runPlayer.view=!0,t.runPlayer.action="STARTING"});break;case"Schedule":this.fetchMacros().then(function(){t.runPlayer.view=!0,t.runPlayer.action="SCHEDULING"});break;case"Suspend":this.suspendPipeline();break;case"Stop":this.appStatus="STOPPING",this.stopPipeline();break;case"Delete":this.myLoadingService.showLoadingIcon();var a=this.HydratorPlusPlusDetailRunsStore.getParams();a={namespace:a.namespace,pipeline:a.app},this.HydratorPlusPlusDetailActions.deletePipeline(a).then(function(){t.$state.go("hydratorplusplus.list"),t.myLoadingService.hideLoadingIcon()},function(e){t.myLoadingService.hideLoadingIcon(),t.$timeout(function(){t.myAlertOnValium.show({type:"danger",title:"Unable to delete Pipeline",content:e.data})})})}}},{key:"startPipeline",value:function(){var e=this;this.appStatus="STARTING",this.runPlayer.view=!1,this.runPlayer.action=null,this.HydratorPlusPlusDetailActions.startPipeline(this.HydratorPlusPlusDetailRunsStore.getApi(),this.HydratorPlusPlusDetailRunsStore.getParams(),this.getMacrosMap()).then(function(){},function(t){e.myAlertOnValium.show({type:"danger",title:"Unable to start a new run",content:angular.isObject(t)?t.data:t})}).then(function(){return e.fetchMacros()})}},{key:"stopPipeline",value:function(){var e=this;this.HydratorPlusPlusDetailActions.stopPipeline(this.HydratorPlusPlusDetailRunsStore.getApi(),this.HydratorPlusPlusDetailRunsStore.getParams()).then(function(){},function(t){e.myAlertOnValium.show({type:"danger",title:"Unable to stop the current run",content:angular.isObject(t)?t.data:t})})}},{key:"schedulePipeline",value:function(){var e=this;this.scheduleStatus="SCHEDULING",this.scheduleLoading=!0;var t={namespace:this.$state.params.namespace,appId:this.$state.params.pipelineId,scope:this.$scope};this.myPreferenceApi.setAppPreference(t,this.getMacrosMap()).$promise.then(function(){return e.HydratorPlusPlusDetailActions.schedulePipeline(e.HydratorPlusPlusDetailRunsStore.getApi(),e.HydratorPlusPlusDetailRunsStore.getScheduleParams()).then(function(){e.scheduleTimeout&&e.$timeout.cancel(e.scheduleTimeout),e.scheduleTimeout=e.$timeout(function(){e.scheduleLoading=!1},1e3)})},function(t){return e.scheduleLoading=!1,e.macroError=angular.isObject(t)?t.data||"Error saving runtime arguments in preferences store":t,e.setScheduleStatus(),e.$q.reject()}).then(function(){e.HydratorPlusPlusDetailActions.fetchScheduleStatus(e.HydratorPlusPlusDetailRunsStore.getApi(),e.HydratorPlusPlusDetailRunsStore.getScheduleParams())},function(t){return e.macroError||e.myAlertOnValium.show({type:"danger",title:"Unable to schedule the pipeline",content:angular.isObject(t)?t.data:t}),e.setScheduleStatus(),e.$q.reject()}).then(function(){e.runPlayer.view=!1,e.runPlayer.action=null,e.fetchMacros()})}},{key:"suspendPipeline",value:function(){var e=this;this.scheduleLoading=!0,this.HydratorPlusPlusDetailActions.suspendSchedule(this.HydratorPlusPlusDetailRunsStore.getApi(),this.HydratorPlusPlusDetailRunsStore.getScheduleParams()).then(function(){e.HydratorPlusPlusDetailActions.fetchScheduleStatus(e.HydratorPlusPlusDetailRunsStore.getApi(),e.HydratorPlusPlusDetailRunsStore.getScheduleParams()),e.scheduleTimeout&&e.$timeout.cancel(e.scheduleTimeout),e.scheduleTimeout=e.$timeout(function(){e.scheduleLoading=!1},1e3)},function(t){e.myAlertOnValium.show({type:"danger",title:"Unable to suspend the pipeline",content:angular.isObject(t)?t.data:t}),e.scheduleLoading=!1})}}]),e}();t.$inject=["HydratorPlusPlusDetailRunsStore","HydratorPlusPlusDetailNonRunsStore","HydratorPlusPlusDetailActions","GLOBALS","$state","myLoadingService","$timeout","$scope","moment","myAlertOnValium","myPipelineExportModalService","myPipelineApi","myHelpers","myPreferenceApi","$q"],angular.module(e.name+".feature.hydratorplusplus").controller("HydratorDetailTopPanelController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.mapreduce").controller("MapreduceRunsController",["$scope","$state","$rootScope","rRuns","$filter","$uibModal","rMapreduceDetail",function(e,t,a,n,r,s,i){var o,l=r("filter");this.runs=n,this.$uibModal=s,this.description=i.description,t.params.runid?(o=l(n,{runid:t.params.runid}),o.length&&(this.runs.selected=angular.copy(o[0]))):n.length?this.runs.selected=angular.copy(n[0]):this.runs.selected={runid:"No Runs"},e.$watch(angular.bind(this,function(){return this.runs.selected.runid}),function(){t.params.runid||n.length&&(this.runs.selected=angular.copy(n[0]))}.bind(this)),this.tabs=[{title:"Status",template:"/old_assets/features/mapreduce/templates/tabs/runs/tabs/status.html"},{title:"Mappers",template:"/old_assets/features/mapreduce/templates/tabs/runs/tabs/mappers.html"},{title:"Reducers",template:"/old_assets/features/mapreduce/templates/tabs/runs/tabs/reducers.html"},{title:"Logs",template:"/old_assets/features/mapreduce/templates/tabs/runs/tabs/log.html"},{title:"Datasets",template:"/old_assets/features/mapreduce/templates/tabs/data.html"}],this.activeTab=this.tabs[0],this.selectTab=function(e){this.activeTab=e},this.openHistory=function(){this.$uibModal.open({size:"lg",templateUrl:"/old_assets/features/mapreduce/templates/tabs/history.html",controller:["runs","$scope",function(e,t){t.runs=e}],resolve:{runs:function(){return this.runs}.bind(this)}})},this.metadataParams={namespace:t.params.namespace,appId:t.params.appId,programType:"mapreduce",programId:t.params.programId,scope:e}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.services").controller("ServicesRunsController",["$scope","$filter","$state","rRuns","$uibModal","rServiceDetail",function(e,t,a,n,r,s){var i=t("filter");if(this.runs=n,this.$uibModal=r,this.description=s.description,a.params.runid){var o=i(n,{runid:a.params.runid});if(!o.length)return void a.go("404");this.runs.selected=angular.copy(o[0])}else n.length?this.runs.selected=angular.copy(n[0]):this.runs.selected={runid:"No Runs"};e.$watch(angular.bind(this,function(){return this.runs.selected.runid}),function(){a.params.runid||n.length&&(this.runs.selected=angular.copy(n[0]))}.bind(this)),this.tabs=[{title:"Status",template:"/old_assets/features/services/templates/tabs/runs/tabs/status.html"},{title:"Logs",template:"/old_assets/features/services/templates/tabs/runs/tabs/log.html"},{title:"Datasets",template:"/old_assets/features/services/templates/tabs/data.html"}],this.activeTab=this.tabs[0],this.selectTab=function(e){this.activeTab=e},this.openHistory=function(){this.$uibModal.open({size:"lg",templateUrl:"/old_assets/features/services/templates/tabs/history.html",controller:["runs","$scope",function(e,t){t.runs=e}],resolve:{runs:function(){return this.runs}.bind(this)}})},this.metadataParams={namespace:a.params.namespace,appId:a.params.appId,programType:"services",programId:a.params.programId,scope:e}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.spark").controller("SparkRunsController",["$scope","$filter","$state","rRuns","$uibModal","rSparkDetail",function(e,t,a,n,r,s){var i,o=t("filter");this.runs=n,this.$uibModal=r,this.description=s.description,a.params.runid?(i=o(n,{runid:a.params.runid}),i.length&&(this.runs.selected=angular.copy(i[0]))):n.length?this.runs.selected=angular.copy(n[0]):this.runs.selected={runid:"No Runs"},e.$watch(angular.bind(this,function(){return this.runs.selected.runid}),function(){a.params.runid||n.length&&(this.runs.selected=angular.copy(n[0]))}.bind(this)),this.tabs=[{title:"Status",template:"/old_assets/features/spark/templates/tabs/runs/tabs/status.html"},{title:"Logs",template:"/old_assets/features/spark/templates/tabs/runs/tabs/log.html"}],this.activeTab=this.tabs[0],this.selectTab=function(e){this.activeTab=e},this.openHistory=function(){this.$uibModal.open({size:"lg",templateUrl:"/old_assets/features/spark/templates/tabs/history.html",controller:["runs","$scope",function(e,t){t.runs=e}],resolve:{runs:function(){return this.runs}.bind(this)}})},this.metadataParams={namespace:a.params.namespace,appId:a.params.appId,programType:"spark",programId:a.params.programId,scope:e}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.streams").controller("StreamExploreController",["$scope","$state","EventPipe","myStreamApi",function(e,t,a,n){this.activePanel=[0],this.name=t.params.streamId;var r=Date.now();this.eventSearch={startMs:r-72e5,endMs:r,limit:10,results:[]},this.doEventSearch=function(){var a={namespace:t.params.namespace,streamId:t.params.streamId,scope:e,start:this.eventSearch.startMs,end:this.eventSearch.endMs,limit:this.eventSearch.limit};n.eventSearch(a).$promise.then(function(e){this.eventSearch.results=e}.bind(this))},this.doEventSearch()}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.streams").controller("StreamMetadataController",["$scope","$state","myExploreApi",function(e,t,a){var n={namespace:t.params.namespace,table:"stream_"+t.params.streamId,scope:e};this.metadata={},a.getInfo(n).$promise.then(function(e){this.metadata=e}.bind(this))}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.streams").controller("StreamProgramsController",["$scope","$state","myStreamApi",function(e,t,a){var n={namespace:t.params.namespace,streamId:t.params.streamId,scope:e};a.programsList(n).$promise.then(function(e){this.programs=e}.bind(this))}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.streams").controller("StreamDetailStatusController",["$scope","$state","myHelpers","MyCDAPDataSource","rStreamData",function(e,t,a,n,r){function s(e){var n="/metrics/query?metric="+e.name+"&tag=ns:"+t.params.namespace+"&tag=stream:"+t.params.streamId;i.poll({_cdapPath:n,method:"POST"},function(t){var n=a.objectQuery(t,"series",0,"data",0,"value");this[e.scopeProperty]=n}.bind(this))}var i=new n(e);this.storage=null,this.events=null,this.schema=r.format.schema.fields,[{name:"system.collect.bytes",scopeProperty:"storage"},{name:"system.collect.events",scopeProperty:"events"}].forEach(s.bind(this))}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e){angular.module(e.name+".feature.tracker").directive("myHistogram",["d3","moment",function(e,t){function a(e,t){var a,n,r=/\d+/g,s=function(e){var t=parseInt(e,10);if(Number.isNaN(t))return Date.now();var a=new Date;return a=a.setDate(a.getDate()-t)};return"string"==typeof e&&-1!==e.indexOf("now")?(a=e.match(r),Array.isArray(a)&&(a=a[0]),a=s(a)):a=1e3*parseInt(e,10),"string"==typeof t&&-1!==e.indexOf("now")?(n=t.match(r),Array.isArray(n)&&(n=n[0]),n=s(n)):n=1e3*parseInt(t,10),{startTime:a,endTime:n}}function n(n,r){n.render=function(){var s={top:20,right:10,bottom:30,left:45},i=200,o=e.select(r[0].parentNode).node().getBoundingClientRect(),l=o.width-s.left-s.right,c=i-s.top-s.bottom,u=60*(new Date).getTimezoneOffset(),p=a(n.startTime,n.endTime),d=t.duration(p.endTime-p.startTime).asDays(),m=e.time.scale().range([0,l]),f=e.scale.linear().range([c,0]),h=e.select(r[0]).select(".histogram-container").style({height:i+"px"}),g=h.append("svg").attr("width",l+s.left+s.right).attr("height",i).append("g").attr("transform","translate("+s.left+", "+s.top+")");m.domain([p.startTime,p.endTime]).nice();var y=e.time.format("%b %d, %Y"),v=e.svg.axis().scale(m).orient("bottom").tickFormat(y).outerTickSize(0),S=!0;d>=179?v.ticks(e.time.months,1).tickFormat(e.time.format("%b %Y")):d>=30&&179>d?v.ticks(e.time.weeks,1).tickFormat(e.time.format("%b-%d")):d>6&&30>d?v.ticks(e.time.days,1).tickFormat(e.time.format("%b-%d")):6>=d&&d>4?(v.ticks(e.time.days,1).tickFormat(e.time.format("%b-%d")),y=e.time.format("%b %d, %Y %I:%M %p"),d=24*d,S=!1):4>=d&&d>2?(v.ticks(e.time.hours,12).tickFormat(e.time.format("%b-%d %H:%M")),y=e.time.format("%b %d, %Y %I:%M %p"),d=24*d,S=!1):d>1?(v.ticks(e.time.hours,6).tickFormat(e.time.format("%b-%d %H:%M")),y=e.time.format("%b %d, %Y %I:%M %p"),d=24*d,S=!1):(d=24*d,d>12?v.ticks(e.time.hours,3).tickFormat(e.time.format("%b-%d %H:%M")):d>6?v.ticks(e.time.hours,2).tickFormat(e.time.format("%b-%d %H:%M")):v.ticks(e.time.hours,1).tickFormat(e.time.format("%b-%d %H:%M")),y=e.time.format("%b %d, %Y %I:%M %p"),S=!1);var P=n.model.results.map(function(e){var t=S?e.timestamp+u:e.timestamp;return{time:new Date(1e3*t),count:e.value}});f.domain([0,e.max(P,function(e){return e.count})]).nice();var T=.2*l/d,C=l/d-T;g.append("g").attr("class","x axis").attr("transform","translate(0, "+c+")").call(v);var b=e.svg.axis().scale(f).orient("left").tickPadding(10).outerTickSize(0).innerTickSize(-l).ticks(10);g.append("g").attr("class","y axis").call(b);var A=e.tip().attr("class","d3-tip tracker-audit-histogram").offset([-10,0]).html(function(e){return"<strong>"+y(e.time)+" - "+e.count+"</strong>"});g.call(A),g.selectAll(".bar").data(P).enter().append("rect").attr("class","bar").attr("x",function(e){return m(e.time)-C/2}).attr("y",function(e){return f(e.count)}).attr("width",function(){return C}).attr("height",function(e){return c-f(e.count)}).on("mouseover",A.show).on("mouseout",A.hide)}}return{restrict:"E",scope:{model:"=",startTime:"@",endTime:"@"},templateUrl:"/old_assets/features/tracker/directives/histogram/histogram.html",link:n,controller:["$scope",function(e){e.$watch("model",function(){"object"===_typeof(e.model)&&e.render()})}]}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t){"ngInject";var a=this;"datasets"===e.entityType&&(a.isAvailableDataset=t.isAvailableDataset(e.datasetType)),a.streamBatchSource=function(){t.streamBatchSource(e.entityId)},a.streamRealtimeSink=function(){t.streamRealtimeSink(e.entityId)},a.datasetBatchSource=function(){t.datasetBatchSource(e.entityId)},a.datasetBatchSink=function(){t.datasetBatchSink(e.entityId)}}t.$inject=["$scope","myJumpFactory"],angular.module(e.name+".feature.tracker").directive("myJumpButton",function(){return{restrict:"E",scope:{entityType:"=",entityId:"=",datasetType:"=?",datasetExplorable:"="},templateUrl:"/old_assets/features/tracker/directives/jump/jump.html",controller:t,controllerAs:"Jump"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){function t(e,t,a,n,r,s,i){"ngInject";function o(){t.reset(),c.instance&&c.instance.reset(),c.nodes=r.getNodes(),c.connections=r.getConnections(),c.uniqueNodes=r.getUniqueNodes(),c.graph=r.getGraph(),0!==c.nodes.length&&(c.graphInfo=c.graph.graph(),c.graphInfo.width=c.graphInfo.width<920?920:c.graphInfo.width,a(function(){angular.forEach(c.connections,function(e){c.instance.connect({source:e.source,target:e.target,detachable:!1,anchors:["Right","Left"]})}),a(function(){c.instance.repaintEverything()}),c.scaleInfo=e.getScale(c.graphInfo)}))}function l(t,a,r){var i={namespace:n.params.namespace,appId:t.applicationId,programType:t.entityType,programId:t.entityId,runId:a,scope:e};s.getProgramRunStatus(i).$promise.then(function(e){r.start=1e3*e.start,r.status=e.status,r.duration=e.end?1e3*(e.end-e.start):"-"})}var c=this;r.registerOnChangeListener(o),t.ready(function(){t.setContainer("lineage-diagram"),c.instance=t.getInstance({PaintStyle:{lineWidth:2,strokeStyle:"rgba(0,0,0, 1)"},Connector:["Flowchart",{gap:0,stub:[10,15],alwaysRespectStubs:!0,cornerRadius:0}],ConnectionOverlays:[["Arrow",{location:1,direction:1,width:10,length:10}]],Endpoints:["Blank","Blank"]}),o()}),angular.element(i).on("resize",function(){c.scaleInfo=e.getScale(c.graphInfo)}),c.nodeClick=function(e,t){var a=c.uniqueNodes[t.uniqueNodeId];"data"!==a.nodeType&&(e.preventDefault(),t.showPopover=!0,t.popover={activeRunIndex:0,activeRunId:a.runs[0],runInfo:{}},l(a,t.popover.activeRunId,t.popover.runInfo))},c.constructNodeLink=function(e){var t=c.uniqueNodes[e.uniqueNodeId];return"data"===t.nodeType?"tracker.detail.entity.metadata({ entityType:Lineage.uniqueNodes[node.uniqueNodeId].entityType, entityId: Lineage.uniqueNodes[node.uniqueNodeId].entityId })":"-"},c.constructProgramLink=function(e){var t=c.uniqueNodes[e.uniqueNodeId],a=t.entityType+".detail.run({ appId: Lineage.uniqueNodes[node.uniqueNodeId].applicationId, programId: Lineage.uniqueNodes[node.uniqueNodeId].entityId, runid: node.popover.activeRunId })";return a},c.closePopover=function(e,t){e.stopPropagation(),t.showPopover=!1},c.preventPropagation=function(e){e.stopPropagation()},c.nextRun=function(e,t){e.stopPropagation();var a=c.uniqueNodes[t.uniqueNodeId];t.popover.activeRunIndex===a.runs.length-1?t.popover.activeRunIndex=0:t.popover.activeRunIndex++,t.popover.activeRunId=a.runs[t.popover.activeRunIndex],l(a,t.popover.activeRunId,t.popover.runInfo)},c.prevRun=function(e,t){e.stopPropagation();var a=c.uniqueNodes[t.uniqueNodeId];0===t.popover.activeRunIndex?t.popover.activeRunIndex=a.runs.length-1:t.popover.activeRunIndex--,t.popover.activeRunId=a.runs[t.popover.activeRunIndex],l(a,t.popover.activeRunId,t.popover.runInfo)},c.navigationClick=function(t,a){t.stopPropagation(),t.preventDefault();var n=c.uniqueNodes[a.uniqueNodeId];e.navigationFunction().call(e.context,n.entityType,n.entityId)},e.$on("$destroy",function(){r.setDefaults()})}function a(e,t){e.getScale=function(e){var a=t.parent()[0].clientWidth;if(a>e.width)return{scale:1,padX:(a-e.width)/2+"px",padY:0};var n=a/e.width;return{scale:n,padX:(e.width*n-e.width)/2+"px",padY:(e.height*n-e.height)/2+"px"}}}t.$inject=["$scope","jsPlumb","$timeout","$state","LineageStore","myTrackerApi","$window"],angular.module(e.name+".feature.tracker").directive("myLineageDiagram",function(){return{restrict:"E",scope:{navigationFunction:"&",context:"="},templateUrl:"/old_assets/features/tracker/directives/lineage/lineage.html",controller:t,controllerAs:"Lineage",link:a}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.tracker").directive("myTopEntityGraph",["d3","$compile","$state","myTrackerApi","myLineageService",function(e,t,a,n,r){function s(s,i){function o(){var t={namespace:a.params.namespace,entity:s.type,scope:s,limit:s.limit};a.params.entityType&&(t.entityType="datasets"===a.params.entityType?"dataset":"stream"),a.params.entityId&&(t.entityName=a.params.entityId),s.start&&(t.start=s.start),s.end&&(t.end=s.end),n.getTopEntities(t).$promise.then(function(t){if(s.model={results:t},t.length>=1)l();else{var a=e.select(i[0]).select(".graph-container");a.append("div").attr("class","well").append("p").text("No "+s.type+" are accessing this dataset")}},function(t){if(503===t.statusCode){var a=e.select(i[0]).select(".graph-container");a.append("div").attr("class","well").append("p").text("Service unavailable")}console.log("ERROR",t)})}function l(){function a(){var e=angular.element(f[0]).find("div");angular.forEach(s.model.results,function(a,i){var o=a.entityName,l=d(i)+n.top+d.rangeBand()/2;if("applications"===s.type)s.programsPath='apps.detail.overview.programs({ appId: "'+a.entityName+'" })';else if("programs"===s.type){var c=r.parseProgramType(a.programType);s.programsPath=c+'.detail({ appId: "'+a.application+'", programId: "'+a.entityName+'" })',o=o+": "+a.application;var u=angular.element("<p></p>").attr("class","app-link").text(a.application),p=t(u)(s);p.css("top",l+7+"px"),e.append(p)}var m=angular.element("<a></a>").attr("class","entity-link").attr("ui-sref",s.programsPath).attr("uib-tooltip",o).attr("tooltip-ellipsis",a.entityName).attr("tooltip-append-to-body","true").attr("tooltip-class","tracker-tooltip").text(a.entityName),f=t(m)(s);f.css("top",l+"px"),e.append(f)})}var n={top:10,right:30,bottom:30,left:130},o=234,l=e.select(i[0].parentNode).node().getBoundingClientRect(),c=l.width-n.left-n.right,u=o-n.top-n.bottom,p=.7*u/s.limit,d=e.scale.ordinal().rangeRoundBands([0,u],.3),m=e.scale.linear().range([0,c]),f=e.select(i[0]).select(".top-entity-container").style({height:o+"px"});f.append("div").attr("class","sidebar").style({width:"130px",height:o+"px"});var h=f.append("svg").attr("width",c+n.left+n.right).attr("height",o).append("g").attr("transform","translate("+n.left+", "+n.top+")");d.domain(s.model.results.map(function(e,t){return t})),m.domain([0,e.max(s.model.results,function(e){return e.value})]).nice();var g=e.svg.axis().scale(m).orient("bottom").innerTickSize(-u-n.top).outerTickSize(0).tickPadding(10).ticks(5);h.append("g").attr("class","x axis").attr("transform","translate(0, "+u+")").call(g),h.select(".x.axis .tick").attr("display","none");var y=e.svg.axis().scale(d).orient("left").ticks(5);h.append("g").attr("class","y axis").call(y),h.selectAll(".bar").data(s.model.results).enter().append("rect").attr("class","bar").attr("y",function(e,t){return d(t)+(d.rangeBand()-p)/2}).attr("x",-3).attr("rx",3).attr("ry",3).attr("height",p).attr("width",function(e){return Math.abs(m(e.value))+3}),a()}o()}return{restrict:"E",scope:{type:"@",start:"=?",end:"=?",limit:"="},templateUrl:"/old_assets/features/tracker/directives/top-entity-graph/top-entity-graph.html",link:s}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.tracker").directive("myTruthMeter",function(){return{restrict:"E",scope:{score:"=",width:"@",showInfoIcon:"=",showBetaText:"="},templateUrl:"/old_assets/features/tracker/directives/truth-meter/truth-meter.html",controller:function(){this.score=this.score||0,this.showInfoIcon=this.showInfoIcon||!1,this.showBetaText=this.showBetaText||!1},bindToController:!0,controllerAs:"TruthMeter"}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.tracker").controller("TypeaheadTrackerTagsCtrl",["caskFocusManager",function(e){this.modelLoading=!1,this.isOpen=!0,this.template="/old_assets/features/tracker/directives/typeahead-tracker-tags/popup.html",this.list.sort(function(e,t){return e.preferredTag<t.preferredTag?1:-1}),this.onTagsSelect=function(t){var a=this;this.onSelect({input:t.name}).then(function(){a.model="",a.list.splice(a.list.indexOf(t),1),e.focus("tagInput")})},e.focus("tagInput")}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.tracker").directive("myTypeaheadTrackerTags",function(){return{restrict:"EA",templateUrl:"/old_assets/features/tracker/directives/typeahead-tracker-tags/typeahead-tracker-tags.html",scope:{list:"=",onSelect:"&",onChange:"&"},controller:"TypeaheadTrackerTagsCtrl",controllerAs:"TypeaheadTrackerTagsCtrl",bindToController:!0}})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.worker").controller("WorkersRunsController",["$scope","$filter","$state","rRuns","$uibModal","rWorkerDetail",function(e,t,a,n,r,s){var i=t("filter");if(this.runs=n,this.description=s.description,this.$uibModal=r,a.params.runid){var o=i(n,{runid:a.params.runid});if(!o.length)return void a.go("404");this.runs.selected=angular.copy(o[0])}else n.length?this.runs.selected=angular.copy(n[0]):this.runs.selected={runid:"No Runs"};e.$watch(angular.bind(this,function(){return this.runs.selected.runid}),function(){a.params.runid||n.length&&(this.runs.selected=angular.copy(n[0]))}.bind(this)),this.tabs=[{title:"Status",template:"/old_assets/features/workers/templates/tabs/runs/tabs/status.html"},{title:"Logs",template:"/old_assets/features/workers/templates/tabs/runs/tabs/log.html"}],this.activeTab=this.tabs[0],this.selectTab=function(e){this.activeTab=e},this.openHistory=function(){this.$uibModal.open({size:"lg",templateUrl:"/old_assets/features/workers/templates/tabs/history.html",controller:["runs","$scope",function(e,t){t.runs=e}],resolve:{runs:function(){return this.runs}.bind(this)}})},this.metadataParams={namespace:a.params.namespace,appId:a.params.appId,programType:"workers",programId:a.params.programId,scope:e}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t={},a=function(){function e(a,n,r,s,i,o,l){var c=this;_classCallCheck(this,e);var u=r("filter");if(this.runs=s,this.$scope=a,this.$state=n,this.myWorkFlowApi=i,this.runStatus=null,this.$uibModal=o,this.description=l.description,n.params.runid){var p=u(s,{runid:n.params.runid});p.length&&(this.runs.selected=angular.copy(p[0]))}else s.length?this.runs.selected=angular.copy(s[0]):this.runs.selected={runid:"No Runs"};s.length&&this.startPollingCurrentRun(),a.$watch(angular.bind(this,function(){return c.runs.selected.runid}),function(){return c.$state.params.runid?(t.runId=c.runs.selected.runid,void c.myWorkFlowApi.stopPollRunDetail(t).$promise.then(c.startPollingCurrentRun.bind(c))):void(s.length&&(c.runs.selected=angular.copy(s[0])))}),this.tabs=[{title:"Status",template:"/old_assets/features/workflows/templates/tabs/runs/tabs/status.html"},{title:"Logs",template:"/old_assets/features/workflows/templates/tabs/runs/tabs/log.html"}],a.$on("$destroy",function(){c.myWorkFlowApi.stopPollRunDetail(t)}),this.activeTab=this.tabs[0],this.metadataParams={namespace:n.params.namespace,appId:n.params.appId,programType:"workflows",programId:n.params.programId,scope:a}}return e.$inject=["$scope","$state","$filter","rRuns","myWorkFlowApi","$uibModal","rWorkflowDetail"],_createClass(e,[{key:"startPollingCurrentRun",value:function(){var e=this;t={namespace:this.$state.params.namespace,appId:this.$state.params.appId,workflowId:this.$state.params.programId,scope:this.$scope,runId:this.runs.selected.runid},this.myWorkFlowApi.pollRunDetail(t).$promise.then(function(t){e.runStatus=t.status})}},{key:"selectTab",value:function(e){this.activeTab=e}},{key:"stop",value:function(){var e=this;this.runStatus="STOPPING",this.myWorkFlowApi.stopRun(t,{}).$promise.then(function(){e.$state.go(e.$state.current,e.$state.params,{reload:!0})})}},{key:"suspend",value:function(){var e=this;this.runStatus="SUSPENDING",this.myWorkFlowApi.suspendRun(t,{}).$promise.then(function(){e.$state.go(e.$state.current,e.$state.params,{reload:!0})})}},{key:"resume",value:function(){var e=this;this.runStatus="RESUMING",this.myWorkFlowApi.resumeRun(t,{}).$promise.then(function(){e.$state.go(e.$state.current,e.$state.params,{reload:!0})})}},{key:"openHistory",value:function(){var e=this;this.$uibModal.open({size:"lg",templateUrl:"/old_assets/features/workflows/templates/tabs/history.html",controller:["runs","$scope",function(e,t){t.runs=e}],resolve:{runs:function(){return e.runs}}})}},{key:"openSchedules",value:function(){this.$uibModal.open({size:"lg",templateUrl:"/old_assets/features/workflows/templates/tabs/schedules.html",controller:"WorkflowsSchedulesController",controllerAs:"SchedulesController"})}}]),e}();a.$inject=["$scope","$state","$filter","rRuns","myWorkFlowApi","$uibModal","rWorkflowDetail"],angular.module(e.name+".feature.workflows").controller("WorkflowsRunsController",a)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s){var i=this;_classCallCheck(this,e),this.myWorkFlowApi=a,this.$state=n,this.$scope=t,this.$q=s,this.myAlert=r,this.error={};var o={namespace:this.$state.params.namespace,appId:this.$state.params.appId,workflowId:this.$state.params.programId,scope:this.$scope};this.myWorkFlowApi.schedules(o).$promise.then(function(e){i.schedules=[],angular.forEach(e,function(e){var t=e.schedule;t.isOpen=!1,t.scheduleType=e.scheduleType,i.schedules.push(t),i.getPreviousRunTime().then(function(e){return t.lastrun=e,i.myWorkFlowApi.pollScheduleStatus({namespace:i.$state.params.namespace,appId:i.$state.params.appId,scheduleId:t.name,scope:i.$scope}).$promise.then(function(e){t.status=e.status})})}),i.schedules.length>0&&(i.schedules[0].isOpen=!0)})}return e.$inject=["$scope","myWorkFlowApi","$state","myAlert","$q"],
_createClass(e,[{key:"getPreviousRunTime",value:function(e){var t,a=this.$q.defer(),n={namespace:this.$state.params.namespace,appId:this.$state.params.appId,workflowId:this.$state.params.programId,scope:this.$scope};return"TIME"===e?this.myWorkFlowApi.schedulesPreviousRunTime(n).$promise.then(function(e){t=e[0]?e[0].time:"NA",a.resolve(t)}):(t="NA",a.resolve(t)),a.promise}},{key:"scheduleActionsMediator",value:function(e,t){switch(t){case"pause":this.suspendSchedule(e);break;case"resume":this.resumeSchedule(e)}}},{key:"suspendSchedule",value:function(e){e.status="SUSPENDING",this.myWorkFlowApi.scheduleSuspend({namespace:this.$state.params.namespace,appId:this.$state.params.appId,scheduleId:e.name,scope:this.$scope},{},function(){},function(e){this.error.content=e}.bind(this))}},{key:"resumeSchedule",value:function(e){e.status="RESUMING",this.myWorkFlowApi.scheduleResume({namespace:this.$state.params.namespace,appId:this.$state.params.appId,scheduleId:e.name,scope:this.$scope},{},function(){},function(e){this.myAlert({title:"Cannot Resume Schedule",content:e})}.bind(this))}}]),e}();t.$inject=["$scope","myWorkFlowApi","$state","myAlert","$q"],angular.module(e.name+".feature.workflows").controller("WorkflowsSchedulesController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=function a(e,t,n){var r=this;_classCallCheck(this,a),this.$scope=e,this.$state=t,this.$filter=n;var s=this.$filter("filter"),i=void 0;i=s(this.$scope.RunsController.runs,{runid:this.$state.params.runid}),this.$scope.RunsController.runs.selected.runid=i[0].runid,this.$scope.RunsController.runs.selected.status=i[0].status,this.$scope.RunsController.runs.selected.start=i[0].start,this.$scope.RunsController.runs.selected.end=i[0].end,this.$scope.$on("$destroy",function(){r.$scope.RunsController.runs.selected.runid=null})};t.$inject=["$scope","$state","$filter"],angular.module(e.name+".feature.flows").controller("FlowsRunDetailController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a){_classCallCheck(this,e),this.HydratorPlusPlusConsoleStore=t,this.myAlertOnValium=a,this.setMessages()}return e.$inject=["HydratorPlusPlusConsoleStore","myAlertOnValium"],_createClass(e,[{key:"listen",value:function(){this.unsub=this.HydratorPlusPlusConsoleStore.registerOnChangeListener(this.setMessages.bind(this))}},{key:"unsubscribe",value:function(){this.unsub()}},{key:"setMessages",value:function(){var e=this.HydratorPlusPlusConsoleStore.getMessages();if(!Array.isArray(e)||e.length){var t=[],a=[],n=[];e.forEach(function(e){switch(e.type){case"NO-SINK-FOUND":t.push("sinks(s)");break;case"NO-SOURCE-FOUND":t.push("source(s)");break;case"STRAY-NODES":a.push(e.payload.nodes.map(function(e){return e.plugin.label}).join(", ")+" - nodes missing connections");break;case"INVALID-CONNECTIONS":a.push(e.payload.connections.join(", ")+" - invalid connection");break;case"success":n.push(e.content);break;case"error":a.push(e.content)}}),2===t.length?a.push("Missing "+t.join(", ")+" or actions in the pipeline."):t.length&&a.push("Missing "+t.join(", ")+" in the pipeline."),n.length?this.myAlertOnValium.show({type:"success",content:n.join(", ")}):a.length&&this.myAlertOnValium.show({type:"danger",templateUrl:"/old_assets/features/hydratorplusplus/templates/partial/error-template.html",templateScope:{content:a,currentIndex:0,moveToNextIndex:function(){a.length>this.currentIndex&&(this.currentIndex+=1)},moveToPrevIndex:function(){this.currentIndex>0&&(this.currentIndex-=1)}}})}}}]),e}();t.$inject=["HydratorPlusPlusConsoleStore","myAlertOnValium"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusConsoleTabService",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i,o,l,c,u,p,d,m,f,h,g,y){"ngInject";var v=this;_classCallCheck(this,e),this.$scope=t,this.$timeout=a,this.$state=n,this.EventPipe=s,this.HydratorPlusPlusPluginConfigFactory=r,this.GLOBALS=i,this.myHelpers=l,this.HydratorPlusPlusConfigActions=o,this.NonStorePipelineErrorFactory=c,this.requiredPropertyError=this.GLOBALS.en.hydrator.studio.error["GENERIC-MISSING-REQUIRED-FIELDS"],this.showPropagateConfirm=!1,this.$uibModal=u,this.ConfigStore=p,this.$scope.isDisabled=m,this.HydratorPlusPlusHydratorService=f,this.myPipelineApi=h,this.previewStore=g,this.setDefaults(d),this.tabs=[{label:"Configuration",templateUrl:"/old_assets/features/hydratorplusplus/templates/partial/node-config-modal/configuration-tab.html"},{label:"Preview",templateUrl:"/old_assets/features/hydratorplusplus/templates/partial/node-config-modal/preview-tab.html"},{label:"Reference",templateUrl:"/old_assets/features/hydratorplusplus/templates/partial/node-config-modal/reference-tab.html"}],this.showContents(),this.isStudioMode=y,this.isPreviewMode=this.previewStore.getState().preview.isPreviewModeEnabled,y&&this.isPreviewMode&&(this.previewLoading=!1,this.previewData=null,this.fetchPreview()),this.activeTab=this.isPreviewMode?2:1,this.setStateTimeout=null,this.importSchemaTimeout=null,this.$scope.$on("$destroy",function(){v.$timeout.cancel(v.setStateTimeout),v.$timeout.cancel(v.importSchemaTimeout)})}return e.$inject=["$scope","$timeout","$state","HydratorPlusPlusPluginConfigFactory","EventPipe","GLOBALS","HydratorPlusPlusConfigActions","myHelpers","NonStorePipelineErrorFactory","$uibModal","HydratorPlusPlusConfigStore","rPlugin","rDisabled","HydratorPlusPlusHydratorService","myPipelineApi","HydratorPlusPlusPreviewStore","rIsStudioMode"],_createClass(e,[{key:"showContents",value:function(){var e=this;angular.isArray(this.state.watchers)&&(this.state.watchers.forEach(function(e){return e()}),this.state.watchers=[]),Object.keys(this.state.node).length&&(this.configfetched=!1,this.$timeout.cancel(this.setStateTimeout),this.setStateTimeout=this.$timeout(function(){e.loadNewPlugin(),e.validateNodeLabel()}))}},{key:"validateNodeLabel",value:function(){var e=this,t=this.ConfigStore.getNodes(),a=this.myHelpers.objectQuery(this.state,"node","plugin","label");a&&this.NonStorePipelineErrorFactory.isNodeNameUnique(a,t,function(t){t?e.state.nodeLabelError=e.GLOBALS.en.hydrator.studio.error[t]:e.state.nodeLabelError=""})}},{key:"setDefaults",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.state={configfetched:!1,properties:[],noconfig:null,noproperty:!0,config:{},groupsConfig:{},windowMode:"regular",isValidPlugin:e.isValidPlugin||!1,node:angular.copy(e.node)||{},isSource:e.isSource||!1,isSink:e.isSink||!1,isTransform:e.isTransform||!1,isAction:e.isAction||!1,type:e.appType||null,watchers:[],outputSchemaUpdate:0},this.showPropagateConfirm=!1}},{key:"propagateSchemaDownStream",value:function(){this.HydratorPlusPlusConfigActions.propagateSchemaDownStream(this.state.node.name)}},{key:"loadNewPlugin",value:function(){var e=this,t=function(t){var a=Object.keys(e.state.node._backendProperties);switch(t){case"NO_JSON_FOUND":e.state.noConfigMessage=e.GLOBALS.en.hydrator.studio.info["NO-CONFIG"];break;case"CONFIG_SYNTAX_JSON_ERROR":e.state.noConfigMessage=e.GLOBALS.en.hydrator.studio.error["SYNTAX-CONFIG-JSON"];break;case"CONFIG_SEMANTICS_JSON_ERROR":e.state.noConfigMessage=e.GLOBALS.en.hydrator.studio.error["SEMANTIC-CONFIG-JSON"]}e.state.noconfig=!0,e.state.configfetched=!0,a.forEach(function(t){e.state.node.plugin.properties[t]=e.state.node.plugin.properties[t]||""}),e.state.watchers.push(e.$scope.$watch("HydratorPlusPlusNodeConfigCtrl.state.node",function(){e.validateNodeLabel(e),e.HydratorPlusPlusConfigActions.editPlugin(e.state.node.name,e.state.node)},!0))};if(this.state.noproperty=Object.keys(this.state.node._backendProperties||{}).length,this.state.noproperty){var a=this.myHelpers.objectQuery(this.state.node,"plugin","artifact","name"),n=this.myHelpers.objectQuery(this.state.node,"plugin","artifact","version"),r=this.myHelpers.objectQuery(this.state.node,"plugin","artifact","scope");this.HydratorPlusPlusPluginConfigFactory.fetchWidgetJson(a,n,r,"widgets."+this.state.node.plugin.name+"-"+this.state.node.type).then(function(a){try{e.state.groupsConfig=e.HydratorPlusPlusPluginConfigFactory.generateNodeConfig(e.state.node._backendProperties,a)}catch(n){return void t()}var r=function(e,t){var a=[],n=[],r=e.streams||[],s=e.datasets||[];return a=r.map(function(e){return{streamId:t[e["ref-property-name"]],entityType:"streams"}}),n=s.map(function(e){return{datasetId:t[e["ref-property-name"]],entityType:"datasets"}}),{streams:a,datasets:n}};if((a.errorDataset||e.state.node.errorDatasetName)&&(e.state.showErrorDataset=!0,e.state.errorDatasetTooltip=a.errorDataset&&a.errorDataset.errorDatasetTooltip||!1,e.state.node.errorDatasetName=e.state.node.errorDatasetName||""),e.$scope.isDisabled&&e.state.groupsConfig.jumpConfig&&Object.keys(e.state.groupsConfig.jumpConfig).length){var s=r(e.state.groupsConfig.jumpConfig,e.state.node.plugin.properties),i=s.streams,o=s.datasets;e.state.groupsConfig.jumpConfig.datasets=i.concat(o)}else delete e.state.groupsConfig.jumpConfig;angular.forEach(e.state.groupsConfig.groups,function(t){angular.forEach(t.fields,function(t){t.defaultValue&&(e.state.node.plugin.properties[t.name]=e.state.node.plugin.properties[t.name]||t.defaultValue)})});var l=e.state.groupsConfig.outputSchema;if(l.implicitSchema)e.state.node.outputSchema=e.HydratorPlusPlusHydratorService.formatOutputSchemaToAvro(l.implicitSchema),e.HydratorPlusPlusConfigActions.editPlugin(e.state.node.name,e.state.node);else if(l.isOutputSchemaExists){var c=l.outputSchemaProperty[0],u=e.state.node.plugin.properties;u[c]?e.state.node.outputSchema=u[c]:u[c]!==e.state.node.outputSchema&&(e.state.node.plugin.properties[l.outputSchemaProperty[0]]=e.state.node.outputSchema),e.state.watchers.push(e.$scope.$watch("HydratorPlusPlusNodeConfigCtrl.state.node.outputSchema",function(){e.validateSchema()&&(e.state.node.plugin.properties[l.outputSchemaProperty[0]]=e.state.node.outputSchema)}))}e.$scope.isDisabled||e.state.watchers.push(e.$scope.$watch("HydratorPlusPlusNodeConfigCtrl.state.node",function(){e.validateNodeLabel(e),e.HydratorPlusPlusConfigActions.editPlugin(e.state.node.name,e.state.node)},!0)),e.state.node.outputSchema||(e.state.node.outputSchema=e.myHelpers.objectQuery(e.state.node,"inputSchema",0,"schema")||""),e.state.node.plugin.label||(e.state.node.plugin.label=e.state.node.name),e.state.configfetched=!0,e.state.config=a,e.state.noconfig=!1},t)}else this.state.configfetched=!0}},{key:"schemaClear",value:function(){this.EventPipe.emit("schema.clear")}},{key:"importSchema",value:function(){this.$timeout.cancel(this.importSchemaTimeout),this.importSchemaTimeout=this.$timeout(function(){document.getElementById("schema-import-link").click()})}},{key:"importFiles",value:function(e){var t=this,a=new FileReader;a.readAsText(e[0],"UTF-8"),a.onload=function(e){var a=e.target.result;t.EventPipe.emit("schema.import",a)}}},{key:"exportSchema",value:function(){this.EventPipe.emit("schema.export")}},{key:"toggleMaximizedView",value:function(e){this.state.windowMode=e?"expand":"regular"}},{key:"validateSchema",value:function(){this.state.errors=[];var e;try{e=JSON.parse(this.state.node.outputSchema),e=e.fields}catch(t){e=null}var a=[this.hasUniqueFields],n=[];return a.forEach(function(t){t.call(this,e,n)}),n.length>0?(this.state.errors=n,!1):!0}},{key:"hasUniqueFields",value:function(e,t){if(!e)return!0;var a=e.map(function(e){return e.name}),n=_.uniq(a);a.length!==n.length&&t.push("There are two or more fields with the same name.")}},{key:"fetchPreview",value:function(){var e=this;this.previewLoading=!0;var t=this.previewStore.getState().preview.previewId;if(!t)return void(this.previewLoading=!1);var a={namespace:this.$state.params.namespace,previewId:t,stage:this.state.node.plugin.label,scope:this.$scope};this.myPipelineApi.getStagePreview(a).$promise.then(function(t){e.previewData={input:{},output:{},numInputStages:0},e.state.isSource||(e.previewData.input=e.formatMultipleRecords(t["input.records"]),e.previewData.numInputStages=Object.keys(e.previewData.input).length),e.state.isSink||(e.previewData.output=e.formatRecords(t["output.records"])),e.previewLoading=!1},function(){e.previewLoading=!1})}},{key:"formatMultipleRecords",value:function(e){var t={};return angular.forEach(e,function(e){var a={};try{a=JSON.parse(e)}catch(n){return void console.log("ERROR",n)}if(a.value.schema){var r=a.value.schema.fields.map(function(e){return e.name}),s=a.value.fields;t[a.key]||(t[a.key]={schema:r,records:[]}),t[a.key].records.push(s)}}),t}},{key:"formatRecords",value:function(e){if(!e)return{schema:[],records:[]};var t=e.map(function(e){var t={};try{t=JSON.parse(e)}catch(a){return console.log("ERROR",a),t}return t}),a=t[0].value.schema.fields.map(function(e){return e.name}),n=t.map(function(e){return e.value.fields});return{schema:a,records:n}}}]),e}();angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusNodeConfigCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r){_classCallCheck(this,e),this.GLOBALS=a,this.HydratorPlusPlusPluginConfigFactory=t,this.myHelpers=n,this.state={},this.showContents(r.node)}return e.$inject=["HydratorPlusPlusPluginConfigFactory","GLOBALS","myHelpers","$scope"],_createClass(e,[{key:"showContents",value:function(e){var t=this;e.plugin?!function(){var a="doc."+e.plugin.name+"-"+e.type;t.HydratorPlusPlusPluginConfigFactory.fetchDocJson(t.myHelpers.objectQuery(e,"plugin","artifact","name"),t.myHelpers.objectQuery(e,"plugin","artifact","version"),t.myHelpers.objectQuery(e,"plugin","artifact","scope"),a).then(function(e){e[a]?t.state.docReference=e[a]:t.state.docReference=t.GLOBALS.en.hydrator.studio.info["NO-REFERENCE"]},function(){return t.state.docReference=t.GLOBALS.en.hydrator.studio.info["NO-REFERENCE"]})}():this.state.docReference=this.GLOBALS.en.hydrator.studio.info["DEFAULT-REFERENCE"]}}]),e}();t.$inject=["HydratorPlusPlusPluginConfigFactory","GLOBALS","myHelpers","$scope"],angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusReferenceTabCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r){var s=this;if(_classCallCheck(this,e),this.GLOBALS=t,this.HydratorPlusPlusConfigActions=n,this.templateType=a.getArtifact().name,this.activeTab=0,-1!==t.etlBatchPipelines.indexOf(this.templateType)){this.initialCron=a.getSchedule(),this.cron=this.initialCron,this.engine=a.getEngine(),this.isBasic=this.checkCron(this.initialCron),this.activeTab=this.isBasic?0:1;var i=_.debounce(function(){n.setSchedule(s.cron)},1e3);r.$watch(function(){return s.cron},i)}else if(this.templateType===t.etlRealtime){this.instance=a.getInstance();var o=_.debounce(function(){n.setInstance(s.instance)},1e3);r.$watch(function(){return s.instance},o)}}return e.$inject=["GLOBALS","HydratorPlusPlusConfigStore","HydratorPlusPlusConfigActions","$scope"],_createClass(e,[{key:"checkCron",value:function(e){for(var t=/^[0-9\*\s]*$/g,a=e.split(""),n=0;n<a.length;n++)if(!a[n].match(t))return!1;return!0}},{key:"onEngineChange",value:function(){this.HydratorPlusPlusConfigActions.setEngine(this.engine)}},{key:"changeScheduler",value:function(e){if("BASIC"===e){this.activeTab=0,this.initialCron=this.cron;var t=!0;this.checkCron(this.initialCron)||(t=confirm("You have advanced configuration that is not available in basic mode. Are you sure you want to go to basic scheduler?")),t&&(this.isBasic=!0)}else this.activeTab=1,this.isBasic=!1}}]),e}();t.$inject=["GLOBALS","HydratorPlusPlusConfigStore","HydratorPlusPlusConfigActions","$scope"],angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusSettingsCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").controller("LoadArtifactCtrl",["myPipelineApi","$q","$stateParams","myAlertOnValium","$state","GLOBALS","myFileUploader",function(e,t,a,n,r,s,i){var o=this;this.jarStatus=-1,this.jsonStatus=-1,this.myPipelineApi=e,this.$q=t,this.$stateParams=a,this.myAlertOnValium=n,this.$state=r,this.myFileUploader=i,this.GLOBALS=s,this.jarLoadFailMessage=s.en.hydrator.studio.info["ARTIFACT-UPLOAD-MESSAGE-JAR"],this.jsonLoadFailMessage=s.en.hydrator.studio.info["ARTIFACT-UPLOAD-MESSAGE-JSON"];var l,c,u,p="",d="",m=[];this.openJARFileDialog=function(){document.getElementById("jar-import-config-link").click()},this.openJsonFileDialog=function(){document.getElementById("json-import-config-link").click()};var f=function(e){var t=new RegExp("(\\d+)(?:\\.(\\d+))?(?:\\.(\\d+))?(?:[.\\-](.*))?$"),a=t.exec(e)[0],n=e.substr(0,e.indexOf(a)-1);return{version:a,name:n}};this.loadJAR=function(e){if(-1===e[0].name.indexOf(".jar"))return void(o.jarStatus=2);l=e[0];var t=e[0].name.split(".jar")[0],a=f(t),n=a.name,r=a.version;p=n,d=r,o.jarStatus=1};var h=function(e){var t=o.$q.defer(),a=new FileReader;return a.readAsText(e,"UTF-8"),a.onload=function(e){var a=e.target.result;t.resolve(a)},a.onerror=function(e){t.reject(e)},t.promise};this.loadJSON=function(e){if(-1===e[0].name.indexOf(".json"))return o.jsonStatus=2,void(o.jsonLoadFailMessage=o.GLOBALS.en.hydrator.studio.info["ARTIFACT-UPLOAD-MESSAGE-JSON"]);var t=void 0;h(e[0]).then(function(e){t=e;try{t=JSON.parse(t)}catch(a){throw a}return t.parents?(c=t.properties,u=t.parents.reduce(function(e,t){return e+"/"+t}),m=t.plugins||[],void(o.jsonStatus=1)):(o.jsonStatus=2,void(o.jsonLoadFailMessage=o.GLOBALS.en.hydrator.studio.info["ARTIFACT-UPLOAD-ERROR-JSON"]))},function(){o.jsonStatus=2,o.jsonLoadFailMessage=o.GLOBALS.en.hydrator.studio.info["ARTIFACT-UPLOAD-ERROR-JSON"]})},this.upload=function(){o.errorMessage="";var e={namespace:o.$stateParams.namespace,artifactName:p},a=angular.extend({version:d},e);o.myFileUploader.upload({path:"/namespaces/"+o.$stateParams.namespace+"/artifacts/"+p,file:l},{"Content-type":"application/octet-stream",customHeader:{"Artifact-Version":d,"Artifact-Extends":u,"Artifact-Plugins":JSON.stringify(m)}}).then(function(){return!c||angular.isObject(c)&&0===Object.keys(c).length?o.$q.resolve():o.myPipelineApi.loadJson(a,c).$promise},function(e){return o.errorMessage=e,t.reject(o.errorMessage)}).then(function(){o.$state.go("hydratorplusplus.create",o.$stateParams,{reload:!0}).then(function(){o.myAlertOnValium.show({type:"success",content:"Artifact loaded successfully."})})},function(e){o.errorMessage=e&&e.data?""+e.data:""+e})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").controller("PluginTemplatesCreateEditCtrl",["$scope","PluginTemplatesDirStore","PluginTemplatesDirActions","HydratorPlusPlusPluginActions","$stateParams","myAlertOnValium","rTemplateType","HydratorPlusPlusLeftPanelStore",function(e,t,a,n,r,s,i,o){e.closeTemplateCreationModal=function(){a.reset(),e.$close()},e.pluginTemplateSaveError=null,t.registerOnChangeListener(function(){var l=t.getIsSaveSuccessfull(),c=t.getIsCloseCommand();l&&(a.reset(),o.dispatch(n.fetchTemplates({namespace:r.namespace},{namespace:r.namespace,pipelineType:i})),s.show({type:"success",content:"Plugin template save successfull"}),e.$close()),c&&(a.reset(),e.$close())})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").controller("PluginTemplatesDeleteCtrl",["rNode","$scope","mySettings","$stateParams","myAlertOnValium","HydratorPlusPlusPluginActions","HydratorPlusPlusLeftPanelStore","rTemplateType",function(e,t,a,n,r,s,i,o){var l=e;t.templateName=l.pluginTemplate,t.ok=function(){t.disableOKButton=!0,a.get("pluginTemplates",!0).then(function(e){return delete e[n.namespace][l.templateType][l.pluginType][l.pluginTemplate],a.set("pluginTemplates",e)}).then(function(){t.disableOKButton=!1,r.show({type:"success",content:"Successfully deleted template "+l.pluginTemplate}),i.dispatch(s.fetchTemplates({namespace:n.namespace},{namespace:n.namespace,pipelineType:o})),t.$close()},function(e){t.disableButtons=!1,t.error=e})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i,o,l,c){var u=this;_classCallCheck(this,e),this.currentPage=1,this.templates=[],this.HydratorPlusPlusHydratorService=r,this.HydratorPlusPlusCanvasFactory=s,this.myPipelineTemplatesApi=n,this.DAGPlusPlusNodesActionsFactory=i,this.HydratorPlusPlusConfigStore=l,this.GLOBALS=a,this.$state=o,this.myAlertOnValium=c,this.typeFilter=t,this.templateContext=this.GLOBALS.artifactConvert[t],this.fetchTemplates().then(function(e){u.templates=e})}return e.$inject=["rTemplateType","GLOBALS","myPipelineTemplatesApi","HydratorPlusPlusHydratorService","HydratorPlusPlusCanvasFactory","DAGPlusPlusNodesActionsFactory","$state","HydratorPlusPlusConfigStore","myAlertOnValium"],_createClass(e,[{key:"selectTemplate",value:function(e){this.HydratorPlusPlusConfigStore.setState(this.HydratorPlusPlusConfigStore.getDefaults()),this.$state.go("hydratorplusplus.create",{data:e._properties,draftId:null})}},{key:"fetchTemplates",value:function(){var e=this;return this.myPipelineTemplatesApi.list({apptype:this.typeFilter}).$promise.then(function(t){var a=t.map(function(t){return{name:t.name,description:t.description,type:e.typeFilter}});return angular.forEach(a,function(t){e.myPipelineTemplatesApi.get({apptype:e.typeFilter,appname:t.name}).$promise.then(function(a){t._properties=a,delete t._properties.$promise,delete t._properties.$resolved,t._source=a.config.stages.filter(function(t){return"source"===e.GLOBALS.pluginConvert[t.plugin.type]}),t._sinks=a.config.stages.filter(function(t){return"sink"===e.GLOBALS.pluginConvert[t.plugin.type]})})}),a})}}]),e}();t.$inject=["rTemplateType","GLOBALS","myPipelineTemplatesApi","HydratorPlusPlusHydratorService","HydratorPlusPlusCanvasFactory","DAGPlusPlusNodesActionsFactory","$state","HydratorPlusPlusConfigStore","myAlertOnValium"],angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusPreConfiguredCtrl",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusDetailDatasetCtrl",["HydratorPlusPlusDetailNonRunsStore",function(e){this.setDefaults=function(){this.state={data:e.getDatasets().concat(e.getStreams())}},this.setDefaults(),this.setState=function(){this.state.datasets=e.getDatasets().concat(e.getStreams())},e.registerOnChangeListener(this.setState.bind(this))}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").controller("HydratorPlusPlusDetailLogCtrl",["HydratorPlusPlusDetailRunsStore","$scope",function(e,t){this.setState=function(){this.params=e.getLogsParams()},this.setState();var a=e.registerOnChangeListener(this.setState.bind(this));t.$on("$destroy",a)}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i,o,l,c,u,p){_classCallCheck(this,e),this.HydratorPlusPlusConfigStore=r,this.mySettings=s,this.$state=n,this.myPipelineApi=a,this.HydratorPlusPlusConsoleActions=i,this.EventPipe=o,this.myAppsApi=l,this.GLOBALS=c,this.myHelpers=u,this.$stateParams=p,this.dispatcher=t.getDispatcher()}return e.$inject=["HydratorPlusPlusConfigDispatcher","myPipelineApi","$state","HydratorPlusPlusConfigStore","mySettings","HydratorPlusPlusConsoleActions","EventPipe","myAppsApi","GLOBALS","myHelpers","$stateParams"],_createClass(e,[{key:"initializeConfigStore",value:function(e){this.dispatcher.dispatch("onInitialize",e)}},{key:"setMetadataInfo",value:function(e,t){this.dispatcher.dispatch("onMetadataInfoSave",e,t)}},{key:"setDescription",value:function(e){this.dispatcher.dispatch("onDescriptionSave",e)}},{key:"setConfig",value:function(e){this.dispatcher.dispatch("onConfigSave",e)}},{key:"saveAsDraft",value:function(e){this.dispatcher.dispatch("onSaveAsDraft",e)}},{key:"setEngine",value:function(e){this.dispatcher.dispatch("onEngineChange",e)}},{key:"editPlugin",value:function(e,t){this.dispatcher.dispatch("onPluginEdit",e,t)}},{key:"propagateSchemaDownStream",value:function(e){this.dispatcher.dispatch("onSchemaPropagationDownStream",e)}},{key:"setSchedule",value:function(e){this.dispatcher.dispatch("onSetSchedule",e)}},{key:"setInstance",value:function(e){this.dispatcher.dispatch("onSetInstance",e)}},{key:"setBatchInterval",value:function(e){this.dispatcher.dispatch("onSetBatchInterval",e)}},{key:"setVirtualCores",value:function(e){this.dispatcher.dispatch("onSetVirtualCores",e)}},{key:"setMemoryMB",value:function(e){this.dispatcher.dispatch("onSetMemoryMB",e)}},{key:"setDriverVirtualCores",value:function(e){this.dispatcher.dispatch("onSetDriverVirtualCores",e)}},{key:"setDriverMemoryMB",value:function(e){this.dispatcher.dispatch("onSetDriverMemoryMB",e)}},{key:"addPostAction",value:function(e){this.dispatcher.dispatch("onAddPostAction",e)}},{key:"editPostAction",value:function(e){this.dispatcher.dispatch("onEditPostAction",e)}},{key:"deletePostAction",value:function(e){this.dispatcher.dispatch("onDeletePostAction",e)}},{key:"publishPipeline",value:function(){var e=this;this.HydratorPlusPlusConsoleActions.resetMessages();var t=this.HydratorPlusPlusConfigStore.validateState(!0);if(t){this.EventPipe.emit("showLoadingIcon","Publishing Pipeline to CDAP");var a=function(t){var a=e.HydratorPlusPlusConfigStore.getState().__ui__.draftId;e.mySettings.get("hydratorDrafts",!0).then(function(t){var n=e.myHelpers.objectQuery(t,e.$stateParams.namespace,a);return n?(delete t[e.$stateParams.namespace][a],e.mySettings.set("hydratorDrafts",t)):void 0},function(t){return e.HydratorPlusPlusConsoleActions.addMessage([{type:"error",content:t}]),e.$q.reject(!1)}).then(function(){e.EventPipe.emit("hideLoadingIcon.immediate"),e.HydratorPlusPlusConfigStore.setState(e.HydratorPlusPlusConfigStore.getDefaults()),e.$state.go("hydratorplusplus.detail",{pipelineId:t})})},n=function(t){e.myPipelineApi.save({namespace:e.$state.params.namespace,pipeline:t},r).$promise.then(a.bind(e,t),function(t){e.EventPipe.emit("hideLoadingIcon.immediate"),e.HydratorPlusPlusConsoleActions.addMessage([{type:"error",content:angular.isObject(t)?t.data:t}])})},r=this.HydratorPlusPlusConfigStore.getConfigForExport();this.myAppsApi.list({namespace:this.$state.params.namespace}).$promise.then(function(t){var a=t.map(function(e){return e.name});-1!==a.indexOf(r.name)?(e.HydratorPlusPlusConsoleActions.addMessage([{type:"error",content:e.GLOBALS.en.hydrator.studio.error["NAME-ALREADY-EXISTS"]}]),e.EventPipe.emit("hideLoadingIcon.immediate")):n(r.name)})}}}]),e}();t.$inject=["HydratorPlusPlusConfigDispatcher","myPipelineApi","$state","HydratorPlusPlusConfigStore","mySettings","HydratorPlusPlusConsoleActions","EventPipe","myAppsApi","GLOBALS","myHelpers","$stateParams"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusConfigActions",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){_classCallCheck(this,e),this.hydratorPlusPlusConsoleDispatcher=t.getDispatcher()}return e.$inject=["HydratorPlusPlusConsoleDispatcher"],_createClass(e,[{key:"addMessage",value:function(e){this.hydratorPlusPlusConsoleDispatcher.dispatch("onAddMessage",e)}},{key:"resetMessages",value:function(){this.hydratorPlusPlusConsoleDispatcher.dispatch("onResetMessages")}}]),e}();t.$inject=["HydratorPlusPlusConsoleDispatcher"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusConsoleActions",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r){_classCallCheck(this,e),this.api=t,this.GLOBALS=a,this.mySettings=n,this.leftpanelactions=r}return e.$inject=["myPipelineApi","GLOBALS","mySettings","LEFTPANELSTORE_ACTIONS"],_createClass(e,[{key:"fetchExtensions",value:function(e){var t=this;return function(a){t.api.fetchExtensions(e).$promise.then(function(n){return a({type:t.leftpanelactions.EXTENSIONS_FETCH,payload:Object.assign({},{pipelineType:e.pipelineType,extensions:n})})},function(e){return console.log("ERR: Fetching list of artifacts failed",e)})}}},{key:"fetchPlugins",value:function(e,t){var a=this;return function(n){return a.api.fetchPlugins(t).$promise.then(function(t){return n({type:a.leftpanelactions.PLUGINS_FETCH,payload:{extension:e,plugins:t}})},function(t){return console.log("ERR: Fetch list of plugins for "+e+" failed: "+t)})}}},{key:"fetchTemplates",value:function(e,t){var a=this,n=t.pipelineType,r=t.namespace;return function(e){a.mySettings.get("pluginTemplates").then(function(t){t&&e({type:a.leftpanelactions.PLUGIN_TEMPLATE_FETCH,payload:{res:t,pipelineType:n,namespace:r}})})}}},{key:"fetchDefaultVersion",value:function(){var e=this;return function(t){e.mySettings.get("plugin-default-version").then(function(a){a&&t({type:e.leftpanelactions.PLUGINS_DEFAULT_VERSION_FETCH,payload:{res:a}})})}}},{key:"updateDefaultVersion",value:function(e){var t=this;return function(a){t.mySettings.get("plugin-default-version").then(function(a){var n=e.name+"-"+e.type+"-"+e.artifact.name;return a=a||{},a[n]=e.artifact,t.mySettings.set("plugin-default-version",a)}).then(function(){return t.mySettings.get("plugin-default-version")}).then(function(e){e&&a({type:t.leftpanelactions.PLUGINS_DEFAULT_VERSION_FETCH,payload:{res:e}})})}}}]),e}();t.$inject=["myPipelineApi","GLOBALS","mySettings","LEFTPANELSTORE_ACTIONS"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusPluginActions",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){"ngInject";_classCallCheck(this,e),this.previewActions=t}return e.$inject=["PREVIEWSTORE_ACTIONS"],_createClass(e,[{key:"togglePreviewMode",value:function(e){var t=this;return function(a){a({type:t.previewActions.TOGGLE_PREVIEW_MODE,payload:{isPreviewModeEnabled:e
}})}}},{key:"setPreviewStartTime",value:function(e){var t=this;return function(a){a({type:t.previewActions.SET_PREVIEW_START_TIME,payload:{startTime:e}})}}},{key:"setPreviewId",value:function(e){var t=this;return function(a){a({type:t.previewActions.SET_PREVIEW_ID,payload:{previewId:e}})}}}]),e}();angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusPreviewActions",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){_classCallCheck(this,e),this.baseDispatcher=t,this.__dispatcher__=null}return e.$inject=["CaskAngularDispatcher"],_createClass(e,[{key:"getDispatcher",value:function(){return this.__dispatcher__||(this.__dispatcher__=new this.baseDispatcher),this.__dispatcher__}},{key:"destroyDispatcher",value:function(){delete this.__dispatcher__}}]),e}();t.$inject=["CaskAngularDispatcher"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusConfigDispatcher",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){_classCallCheck(this,e),this.baseDispatcher=t,this.__dispatcher__=null}return e.$inject=["CaskAngularDispatcher"],_createClass(e,[{key:"getDispatcher",value:function(){return this.__dispatcher__||(this.__dispatcher__=new this.baseDispatcher),this.__dispatcher__}},{key:"destroyDispatcher",value:function(){delete this.__dispatcher__}}]),e}();t.$inject=["CaskAngularDispatcher"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusConsoleDispatcher",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){_classCallCheck(this,e),this.__dispatcher__=null,this.baseDispatcher=t}return e.$inject=["CaskAngularDispatcher"],_createClass(e,[{key:"getDispatcher",value:function(){return this.__dispatcher__||(this.__dispatcher__=new this.baseDispatcher),this.__dispatcher__}},{key:"destroyDispatcher",value:function(){delete this.__dispatcher__}}]),e}();t.$inject=["CaskAngularDispatcher"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusPluginsDispatcher",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i,o,l,c,u,p,d,m,f){_classCallCheck(this,e),this.state={},this.mySettings=r,this.myHelpers=f,this.HydratorPlusPlusConsoleActions=s,this.HydratorPlusPlusCanvasFactory=a,this.GLOBALS=n,this.$stateParams=i,this.NonStorePipelineErrorFactory=o,this.HydratorPlusPlusHydratorService=l,this.$q=c,this.HydratorPlusPlusPluginConfigFactory=u,this.uuid=p,this.$state=d,this.HYDRATOR_DEFAULT_VALUES=m,this.changeListeners=[],this.setDefaults(),this.hydratorPlusPlusConfigDispatcher=t.getDispatcher(),this.hydratorPlusPlusConfigDispatcher.register("onEngineChange",this.setEngine.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onMetadataInfoSave",this.setMetadataInformation.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onPluginEdit",this.editNodeProperties.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onSetSchedule",this.setSchedule.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onSetInstance",this.setInstance.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onSetBatchInterval",this.setBatchInterval.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onSetVirtualCores",this.setVirtualCores.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onSetMemoryMB",this.setMemoryMB.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onSetDriverVirtualCores",this.setDriverVirtualCores.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onSetDriverMemoryMB",this.setDriverMemoryMB.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onSaveAsDraft",this.saveAsDraft.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onInitialize",this.init.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onSchemaPropagationDownStream",this.propagateIOSchemas.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onAddPostAction",this.addPostAction.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onEditPostAction",this.editPostAction.bind(this)),this.hydratorPlusPlusConfigDispatcher.register("onDeletePostAction",this.deletePostAction.bind(this))}return e.$inject=["HydratorPlusPlusConfigDispatcher","HydratorPlusPlusCanvasFactory","GLOBALS","mySettings","HydratorPlusPlusConsoleActions","$stateParams","NonStorePipelineErrorFactory","HydratorPlusPlusHydratorService","$q","HydratorPlusPlusPluginConfigFactory","uuid","$state","HYDRATOR_DEFAULT_VALUES","myHelpers"],_createClass(e,[{key:"registerOnChangeListener",value:function(e){var t=this,a=this.changeListeners.push(e)-1;return function(){t.changeListeners.splice(a,1)}}},{key:"emitChange",value:function(){this.changeListeners.forEach(function(e){return e()})}},{key:"setDefaults",value:function(e){this.state={artifact:{name:"",scope:"SYSTEM",version:""},__ui__:{nodes:[],draftId:null},description:"",name:""},Object.assign(this.state,{config:this.getDefaultConfig()}),e&&(angular.extend(this.state,e),this.setArtifact(this.state.artifact),this.setEngine(this.state.config.engine),this.setDriverResources(this.state.config.driverResources),this.setResources(this.state.config.resources)),this.__defaultState=angular.copy(this.state)}},{key:"getDefaults",value:function(){return this.__defaultState}},{key:"init",value:function(e){this.setDefaults(e)}},{key:"getDefaultConfig",value:function(){return{resources:angular.copy(this.HYDRATOR_DEFAULT_VALUES.resources),driverResources:angular.copy(this.HYDRATOR_DEFAULT_VALUES.resources),connections:[],comments:[],postActions:[]}}},{key:"setState",value:function(e){this.state=e}},{key:"getState",value:function(){return angular.copy(this.state)}},{key:"getDraftId",value:function(){return this.state.__ui__.draftId}},{key:"setDraftId",value:function(e){this.state.__ui__.draftId=e}},{key:"getArtifact",value:function(){return this.getState().artifact}},{key:"getAppType",value:function(){return this.getState().artifact.name}},{key:"getConnections",value:function(){return this.getConfig().connections}},{key:"getConfig",value:function(){return this.getState().config}},{key:"generateConfigFromState",value:function(){var e=this,t=this.getDefaultConfig(),a={};this.state.__ui__.nodes.forEach(function(e){a[e.name]=angular.copy(e)});var n=function(e,t,a){return e&&t?(-1!==["clf","syslog"].indexOf(a[e])&&delete a[t],a):a},r=function(e,r){if(e.outputSchemaProperty)try{var s=JSON.parse(e.outputSchema);angular.isArray(s.fields)&&(s.fields=s.fields.filter(function(e){return!e.readonly})),e.plugin.properties[e.outputSchemaProperty]=JSON.stringify(s)}catch(i){}e.plugin.properties=n(e.watchProperty,e.outputSchemaProperty,angular.copy(e.plugin.properties));var o={name:e.plugin.label||e.name||e.plugin.name,plugin:{name:e.plugin.name,type:e.type,label:e.plugin.label,artifact:e.plugin.artifact,properties:e.plugin.properties,_backendProperties:e._backendProperties},outputSchema:e.outputSchema,inputSchema:e.inputSchema};e.errorDatasetName&&(o.errorDatasetName=e.errorDatasetName),t.stages.push(o),delete a[r]},s=this.HydratorPlusPlusCanvasFactory.orderConnections(angular.copy(this.state.config.connections),this.state.artifact.name,this.state.__ui__.nodes);t.stages=[],s.forEach(function(t){var n=void 0,s=void 0,i=void 0,o=void 0;a[t.from]?(i=a[t.from].plugin.label||a[t.from].name,n=i,r(a[t.from],t.from)):(n=e.state.__ui__.nodes.filter(function(e){return e.name===t.from})[0],i=n.plugin.label||n.name,n=i),a[t.to]?(s=a[t.to].plugin.label||a[t.to].name,r(a[t.to],t.to)):(s=e.state.__ui__.nodes.filter(function(e){return e.name===t.to})[0],o=s.plugin.label||s.name,s=o),t.from=n,t.to=s}),t.connections=s;var i=this.getAppType();-1!==this.GLOBALS.etlBatchPipelines.indexOf(i)?(t.schedule=this.getSchedule(),t.engine=this.getEngine(),t.resources={memoryMB:this.getMemoryMB(),virtualCores:this.getVirtualCores()},t.driverResources={memoryMB:this.getDriverMemoryMB(),virtualCores:this.getDriverVirtualCores()}):i===this.GLOBALS.etlRealtime?t.instances=this.getInstance():this.GLOBALS.etlDataStreams&&(t.batchInterval=this.getBatchInterval(),t.resources={memoryMB:this.getMemoryMB(),virtualCores:this.getVirtualCores()},t.driverResources={memoryMB:this.getDriverMemoryMB(),virtualCores:this.getDriverVirtualCores()}),this.state.description&&(t.description=this.state.description),t.comments=this.getComments();var o=this.getPostActions();o=_.sortBy(o,function(e){return e.plugin.name});var l=0,c="";return angular.forEach(o,function(e){e.plugin.name!==c?(c=e.plugin.name,l=1):l++,e.name=e.plugin.name+"-"+l}),t.postActions=o,t}},{key:"getConfigForExport",value:function(){var e=this.getState(),t=angular.copy(this.generateConfigFromState());this.HydratorPlusPlusCanvasFactory.pruneProperties(t),e.config=angular.copy(t);var a=angular.copy(this.getNodes()).map(function(e){return e.name=e.plugin.label,e});return e.__ui__.nodes=a,angular.copy(e)}},{key:"getDisplayConfig",value:function(){var e={};if(this.HydratorPlusPlusConsoleActions.resetMessages(),this.NonStorePipelineErrorFactory.isUniqueNodeNames(this.getNodes(),function(t,a){t&&(e[a.plugin.label]=t)}),Object.keys(e).length>0)return!1;var t=this.getConfigForExport();return angular.forEach(t.config.stages,function(e){e.plugin&&(delete e.outputSchema,delete e.inputSchema)}),delete t.__ui__,angular.forEach(t.config.comments,function(e){delete e.isActive,delete e.id,delete e._uiPosition}),t}},{key:"getDescription",value:function(){return this.getState().description}},{key:"getName",value:function(){return this.getState().name}},{key:"getIsStateDirty",value:function(){var e=this.getDefaults(),t=this.getState();return!angular.equals(e,t)}},{key:"setName",value:function(e){this.state.name=e,this.emitChange()}},{key:"setDescription",value:function(e){this.state.description=e,this.emitChange()}},{key:"setMetadataInformation",value:function(e,t){this.state.name=e,this.state.description=t,this.emitChange()}},{key:"setConfig",value:function(e,t){switch(t){case"source":this.state.config.source=e;break;case"sink":this.state.config.sinks.push(e);break;case"transform":this.state.config.transforms.push(e)}this.emitChange()}},{key:"setEngine",value:function(e){-1!==this.GLOBALS.etlBatchPipelines.indexOf(this.state.artifact.name)&&(this.state.config.engine=e||"mapreduce")}},{key:"getEngine",value:function(){return this.state.config.engine||"mapreduce"}},{key:"setArtifact",value:function(e){this.state.artifact.name=e.name,this.state.artifact.version=e.version,this.state.artifact.scope=e.scope,-1!==this.GLOBALS.etlBatchPipelines.indexOf(e.name)?this.state.config.schedule=this.state.config.schedule||this.HYDRATOR_DEFAULT_VALUES.schedule:e.name===this.GLOBALS.etlRealtime&&(this.state.config.instances=this.state.config.instances||this.HYDRATOR_DEFAULT_VALUES.instance),this.emitChange()}},{key:"setNodes",value:function(e){var t=this;this.state.__ui__.nodes=e;var a=[],n=this.state.__ui__.nodes.filter(function(e){return!angular.isObject(e._backendProperties)}),r=function(e,a){var n=t.HydratorPlusPlusPluginConfigFactory.generateNodeConfig(e._backendProperties,a);if(e.implicitSchema=n.outputSchema.implicitSchema,e.outputSchemaProperty=n.outputSchema.outputSchemaProperty,angular.isArray(e.outputSchemaProperty)&&(e.outputSchemaProperty=e.outputSchemaProperty[0],e.watchProperty=n.outputSchema.schemaProperties["property-watch"]),e.outputSchemaProperty&&(e.outputSchema=e.plugin.properties[e.outputSchemaProperty]),n.outputSchema.implicitSchema){var r=t.HydratorPlusPlusHydratorService.formatOutputSchemaToAvro(n.outputSchema.implicitSchema);e.outputSchema=r}!e.outputSchema&&n.outputSchema.schemaProperties["default-schema"]&&(e.outputSchema=JSON.stringify(n.outputSchema.schemaProperties["default-schema"]),e.plugin.properties[e.outputSchemaProperty]=e.outputSchema)};n.length?n.forEach(function(e){a.push(t.HydratorPlusPlusHydratorService.fetchBackendProperties(e,t.getAppType()))}):a.push(this.$q.when(!0)),a.length&&this.$q.all(a).then(function(){t.validateState()||t.emitChange(),n.forEach(function(e){e.plugin.artifact&&t.HydratorPlusPlusPluginConfigFactory.fetchWidgetJson(e.plugin.artifact.name,e.plugin.artifact.version,e.plugin.artifact.scope,"widgets."+e.plugin.name+"-"+e.type).then(r.bind(null,e))})},function(e){return console.log("ERROR fetching backend properties for nodes",e)})}},{key:"setConnections",value:function(e){this.state.config.connections=e}},{key:"propagateIOSchemas",value:function(e){var t={},a={},n=void 0,r=void 0,s=this.state.config.connections;this.state.__ui__.nodes.forEach(function(e){return a[e.name]=e}),s.forEach(function(e){Array.isArray(t[e.from])?t[e.from].push(e.to):t[e.from]=[e.to]});var i=function l(e,n){e&&(a[e]&&a[e].implicitSchema||e.forEach(function(e){a[e].implicitSchema||(a[e].outputSchema=n,a[e].inputSchema=n,a[e].outputSchemaProperty&&(a[e].plugin.properties[a[e].outputSchemaProperty]=n),l(t[e],n))}))};n=a[e].outputSchema;try{r=JSON.parse(n),r.fields=r.fields.map(function(e){return delete e.readonly,e}),n=JSON.stringify(r)}catch(o){}i(t[e],n)}},{key:"getNodes",value:function(){return this.getState().__ui__.nodes}},{key:"getSourceNodes",value:function(e){var t={};return this.state.__ui__.nodes.forEach(function(e){return t[e.name]=e}),this.state.config.connections.filter(function(t){return t.to===e}).map(function(e){return t[e.from]})}},{key:"editNodeProperties",value:function(e,t){var a=this.state.__ui__.nodes,n=a.filter(function(t){return t.name===e});n.length&&(n=n[0],angular.forEach(t,function(e,t){return n[t]=e}),this.validateState()||this.emitChange())}},{key:"getSchedule",value:function(){return this.getState().config.schedule}},{key:"getDefaultSchedule",value:function(){return this.HYDRATOR_DEFAULT_VALUES.schedule}},{key:"setSchedule",value:function(e){this.state.config.schedule=e}},{key:"validateState",value:function(e){var t=this,a=!0,n=this.getName(),r=this.NonStorePipelineErrorFactory,s=[r.hasAtleastOneSource,r.hasAtLeastOneSink],i=this.state.__ui__.nodes,o=angular.copy(this.state.config.connections);i.forEach(function(e){e.errorCount=0});var l=[];this.HydratorPlusPlusConsoleActions.resetMessages();var c=function(t){t.error?delete t.warning:t.warning=!0,e&&(t.error=!0,delete t.warning)},u=i.filter(function(e){return"action"===t.GLOBALS.pluginConvert[e.type]}).length;(u!==i.length||0===i.length)&&s.forEach(function(e){e(i,function(e,t){e&&(a=!1,t&&(t.errorCount+=1,c(t)),l.push({type:e}))})}),r.hasValidName(n,function(e){e&&(a=!1,l.push({type:e}))}),r.isRequiredFieldsFilled(i,function(e,t,n){e&&(a=!1,t.errorCount+=n,c(t))}),r.isUniqueNodeNames(i,function(e,t){e&&(a=!1,t.errorCount+=1,c(t))});var p=[];r.allNodesConnected(i,o,function(e){e&&(a=!1,p.push(e))}),p.length&&l.push({type:"STRAY-NODES",payload:{nodes:p}});var d=[];return r.allConnectionsValid(i,o,function(e){e&&(a=!1,d.push(e))}),d.length&&l.push({type:"INVALID-CONNECTIONS",payload:{connections:d}}),r.hasValidResources(this.state.config,function(e){e&&(a=!1,l.push({type:"error",content:t.GLOBALS.en.hydrator.studio.error[e]}))}),r.hasValidDriverResources(this.state.config,function(e){e&&(a=!1,l.push({type:"error",content:t.GLOBALS.en.hydrator.studio.error[e]}))}),l.length&&e&&this.HydratorPlusPlusConsoleActions.addMessage(l),a}},{key:"getBatchInterval",value:function(){return this.getState().config.batchInterval}},{key:"setBatchInterval",value:function(e){this.state.config.batchInterval=e}},{key:"getInstance",value:function(){return this.getState().config.instances}},{key:"setInstance",value:function(e){this.state.config.instances=e}},{key:"setDriverResources",value:function(e){this.state.config.driverResources=e||angular.copy(this.HYDRATOR_DEFAULT_VALUES.resources)}},{key:"setResources",value:function(e){this.state.config.resources=e||angular.copy(this.HYDRATOR_DEFAULT_VALUES.resources)}},{key:"setDriverVirtualCores",value:function(e){this.state.config.driverResources=this.state.config.driverResources||{},this.state.config.driverResources.virtualCores=e}},{key:"getDriverVirtualCores",value:function(){return this.myHelpers.objectQuery(this.state,"config","driverResources","virtualCores")}},{key:"getDriverMemoryMB",value:function(){return this.myHelpers.objectQuery(this.state,"config","driverResources","memoryMB")}},{key:"setDriverMemoryMB",value:function(e){this.state.config.driverResources=this.state.config.driverResources||{},this.state.config.driverResources.memoryMB=e}},{key:"setVirtualCores",value:function(e){this.state.config.resources=this.state.config.resources||{},this.state.config.resources.virtualCores=e}},{key:"getVirtualCores",value:function(){return this.myHelpers.objectQuery(this.state,"config","resources","virtualCores")}},{key:"getMemoryMB",value:function(){return this.myHelpers.objectQuery(this.state,"config","resources","memoryMB")}},{key:"setMemoryMB",value:function(e){this.state.config.resources=this.state.config.resources||{},this.state.config.resources.memoryMB=e}},{key:"setComments",value:function(e){this.state.config.comments=e}},{key:"getComments",value:function(){return this.getState().config.comments}},{key:"addPostAction",value:function(e){this.state.config.postActions.push(e),this.emitChange()}},{key:"editPostAction",value:function(e){var t=_.findLastIndex(this.state.config.postActions,function(t){return e.name===t.name});this.state.config.postActions[t]=e,this.emitChange()}},{key:"deletePostAction",value:function(e){_.remove(this.state.config.postActions,function(t){return t.name===e.name}),this.emitChange()}},{key:"getPostActions",value:function(){return this.getState().config.postActions}},{key:"saveAsDraft",value:function(){var e=this;this.HydratorPlusPlusConsoleActions.resetMessages();var t=this.getName();if(!t.length)return void this.HydratorPlusPlusConsoleActions.addMessage([{type:"MISSING-NAME"}]);this.getDraftId()||(this.setDraftId(this.uuid.v4()),this.$stateParams.draftId=this.getDraftId(),this.$state.go("hydratorplusplus.create",this.$stateParams,{notify:!1}));var a=this.getState();a.__ui__.nodes=a.__ui__.nodes.map(function(e){return delete e.selected,delete e.error,e});var n=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return Object.keys(t).filter(function(a){return t[a].name===e.name&&e.__ui__.draftId!==t[a].__ui__.draftId}).length>0},r=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return t[e.__ui__.draftId]=e,t};this.mySettings.get("hydratorDrafts",!0).then(function(){var t=arguments.length<=0||void 0===arguments[0]?{isMigrated:!0}:arguments[0],s=t[e.$stateParams.namespace];if(n(a,s))throw"A Draft with the same name already exist. Plesae rename your draft";return t[e.$stateParams.namespace]=r(a,s),e.mySettings.set("hydratorDrafts",t)}).then(function(){e.HydratorPlusPlusConsoleActions.addMessage([{type:"success",content:"Draft "+a.name+" saved successfully."}]),e.__defaultState=angular.copy(e.state),e.emitChange()},function(t){e.HydratorPlusPlusConsoleActions.addMessage([{type:"error",content:t}])})}}]),e}();t.$inject=["HydratorPlusPlusConfigDispatcher","HydratorPlusPlusCanvasFactory","GLOBALS","mySettings","HydratorPlusPlusConsoleActions","$stateParams","NonStorePipelineErrorFactory","HydratorPlusPlusHydratorService","$q","HydratorPlusPlusPluginConfigFactory","uuid","$state","HYDRATOR_DEFAULT_VALUES","myHelpers"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusConfigStore",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){_classCallCheck(this,e),this.state={},this.setDefaults(),this.changeListeners=[];var a=t.getDispatcher();a.register("onAddMessage",this.addMessage.bind(this)),a.register("onResetMessages",this.resetMessages.bind(this))}return e.$inject=["HydratorPlusPlusConsoleDispatcher"],_createClass(e,[{key:"setDefaults",value:function(){this.state={messages:[]}}},{key:"registerOnChangeListener",value:function(e){var t=this,a=this.changeListeners.push(e);return function(){t.changeListeners.splice(a-1,1)}}},{key:"emitChange",value:function(){this.changeListeners.forEach(function(e){return e()})}},{key:"getMessages",value:function(){return this.state.messages}},{key:"addMessage",value:function(e){this.state.messages=e||[],this.emitChange()}},{key:"resetMessages",value:function(){this.state.messages=[],this.emitChange()}}]),e}();t.$inject=["HydratorPlusPlusConsoleDispatcher"],angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusConsoleStore",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=void 0,a=void 0,n=void 0,r=void 0,s="/old_assets/features/hydratorplusplus/templates/create/popovers/leftpanel-plugin-popover.html",i=function(){return{plugins:{pluginTypes:{},pluginToVersionMap:{}},extensions:[]}},o=function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t={};return e.forEach(function(e){t[e.name]=t[e.name]||[],t[e.name].push(e)}),t},l=function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return e.map(function(e){return Object.assign({},e,{nodeClass:"plugin-templates",name:e.pluginTemplate,pluginName:e.pluginName,type:t,icon:a.getIcon(e.pluginName),template:s})})},c=function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?"":arguments[2];if(-1!==[e.length,n.length].indexOf(0))return e;var i=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return Object.assign({},{type:t,icon:a.getIcon(e.name||e.pluginName),template:s})},o=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=arguments.length<=2||void 0===arguments[2]?"":arguments[2];if(-1!==[Object.keys(e).length,Object.keys(t).length].indexOf(0))return[];var n=e[t.name||t.pluginName];return Array.isArray(n)?[].concat(_toConsumableArray(n)).map(function(e){return Object.assign({},e,i(e,a))}):[]},l=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return Object.keys(t).length?r.objectQuery(e,t.name||t.pluginName,0,"artifact")||t.artifact:{}};return Object.keys(t).map(function(e){var a=t[e][0];return Object.assign({},a,i(a,n),{artifact:l(t,a),allArtifacts:o(t,a,n)})})},u=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(-1!==[Object.keys(e),Object.keys(t)].indexOf(0))return{};var a=Object.keys(t),n=e.name+"-"+e.type+"-"+e.artifact.name,r=-1!==a.indexOf(n),s=(e.allArtifacts||[]).filter(function(e){return angular.equals(e.artifact,t[n])});return r&&s.length?angular.copy(t[n]):e.artifact},p=function f(){var e=arguments.length<=0||void 0===arguments[0]?i().plugins:arguments[0],a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=void 0;switch(a.type){case t.PLUGINS_FETCH:n=Object.assign({},e);var s=a.payload,p=s.extension,f=s.plugins,d=o(f),m=c(f,d,p);return n.pluginTypes[p]=m.map(function(t){return t.defaultArtifact=u(t,e.pluginToVersionMap),t}).concat(e.pluginTypes[p]||[]),n.pluginTypes=Object.assign({},e.pluginTypes,n.pluginTypes),Object.assign({},e,n);case t.PLUGIN_TEMPLATE_FETCH:n=Object.assign({},e);var h=a.payload,g=h.pipelineType,y=h.namespace,v=h.res,S=r.objectQuery(v,y,g);return S?(angular.forEach(S,function(t,a){var r=_.values(t),s=(e.pluginTypes[a]||[]).filter(function(e){return!e.pluginTemplate});n.pluginTypes[a]=l(r,a).concat(s)}),Object.assign({},e,n)):e;case t.PLUGINS_DEFAULT_VERSION_FETCH:var P=a.payload.res||{};if(n=Object.assign({},i().plugins),Object.keys(P).length){var T=Object.keys(e.pluginTypes);return T.forEach(function(t){var a=e.pluginTypes[t];n.pluginTypes[t]=a.map(function(e){return e.defaultArtifact=u(e,P),e})}),n.pluginToVersionMap=P,Object.assign({},e,n)}return e;case t.PLUGIN_DEFAULT_VERSION_CHECK_AND_UPDATE:var C=Object.keys(e.pluginTypes);if(!C.length)return e;var b=angular.copy(e.pluginToVersionMap);return C.forEach(function(t){e.pluginTypes[t].forEach(function(e){if(!e.pluginTemplate){var t=e.name+"-"+e.type+"-"+e.artifact.name,a=e.allArtifacts.filter(function(e){return angular.equals(e.artifact,b[t])});a.length||delete b[t]}})}),Object.assign({},e,{pluginToVersionMap:b});case t.RESET:return i().plugins;default:return e}},d=function(){var e=arguments.length<=0||void 0===arguments[0]?i().extensions:arguments[0],a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];switch(a.type){case t.EXTENSIONS_FETCH:var r=function(e){var t=a.payload.pipelineType,r=n.pluginTypes[t];return Object.keys(r).filter(function(t){return r[t]===e}).length};return[].concat(_toConsumableArray(e),_toConsumableArray(a.payload.extensions.filter(r)));case t.RESET:return i().extensions;default:return e}},m=function(e,s,o,l,c,u){t=e,n=l,r=u,a=c;var m=s.combineReducers,f=s.applyMiddleware,h=m({plugins:p,extensions:d});return s.createStore(h,i(),s.compose(f(o["default"]),window.devToolsExtension?window.devToolsExtension():function(e){return e}))};m.$inject=["LEFTPANELSTORE_ACTIONS","Redux","ReduxThunk","GLOBALS","DAGPlusPlusFactory","myHelpers"],angular.module(e.name+".feature.hydratorplusplus").constant("LEFTPANELSTORE_ACTIONS",{PLUGINS_FETCH:"PLUGINS_FETCH",PLUGIN_TEMPLATE_FETCH:"PLUGIN_TEMPLATE_FETCH",PLUGINS_DEFAULT_VERSION_FETCH:"PLUGINS_DEFAULT_VERSION_FETCH",EXTENSIONS_FETCH:"EXTENSIONS_FETCH",RESET:"LEFTPANELSTORE_RESET",PLUGINS_DEFAULT_VERSION_UPDATE:"PLUGINS_DEFAULT_VERSION_UPDATE",PLUGIN_DEFAULT_VERSION_CHECK_AND_UPDATE:"PLUGIN_DEFAULT_VERSION_CHECK_AND_UPDATE"}).factory("HydratorPlusPlusLeftPanelStore",m)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=void 0,a=function(){return{isPreviewModeEnabled:!1,startTime:null,previewId:null}},n=function(){var e=arguments.length<=0||void 0===arguments[0]?a():arguments[0],n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=void 0;switch(n.type){case t.TOGGLE_PREVIEW_MODE:r=Object.assign({},e);var s=n.payload.isPreviewModeEnabled;return r.isPreviewModeEnabled=s,Object.assign({},e,r);case t.SET_PREVIEW_START_TIME:r=Object.assign({},e);var i=n.payload.startTime;return r.startTime=i,Object.assign({},e,r);case t.SET_PREVIEW_ID:r=Object.assign({},e);var o=n.payload.previewId;return r.previewId=o,Object.assign({},e,r);case t.PREVIEW_RESET:return a();default:return e}},r=function(e,r,s){t=e;var i=r.combineReducers,o=r.applyMiddleware,l=i({preview:n});return r.createStore(l,a(),r.compose(o(s["default"]),window.devToolsExtension?window.devToolsExtension():function(e){return e}))};r.$inject=["PREVIEWSTORE_ACTIONS","Redux","ReduxThunk"],angular.module(e.name+".feature.hydratorplusplus").constant("PREVIEWSTORE_ACTIONS",{TOGGLE_PREVIEW_MODE:"TOGGLE_PREVIEW_MODE",SET_PREVIEW_START_TIME:"SET_PREVIEW_START_TIME",SET_PREVIEW_ID:"SET_PREVIEW_ID",PREVIEW_RESET:"PREVIEW_RESET"}).factory("HydratorPlusPlusPreviewStore",r)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusDetailActions",["HydratorPlusPlusDetailDispatcher","myPipelineApi",function(e,t){var a=e.getDispatcher();this.startPipeline=function(e,t,a){return e.start(t,a||{}).$promise},this.schedulePipeline=function(e,t,a){return e.schedule(t,a||{}).$promise},this.stopPipeline=function(e,t){return e.stop(t,{}).$promise},this.suspendSchedule=function(e,t){return e.suspend(t).$promise},this.deletePipeline=function(e){return t["delete"](e).$promise},this.pollRuns=function(e,t){e.pollRuns(t).$promise.then(function(e){a.dispatch("onRunsChange",e)})},this.getNextRunTime=function(e,t){e.nextRunTime(t).$promise.then(function(e){a.dispatch("onNextRunTime",e)})},this.fetchScheduleStatus=function(e,t){e.scheduleStatus(t).$promise.then(function(e){a.dispatch("onScheduleStatusFetch",e)},function(){a.dispatch("onScheduleStatusFetchFail")})},this.getStatistics=function(e,t){e.getStatistics(t).$promise.then(function(e){a.dispatch("onStatisticsFetch",e)})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusDetailMetricsActions",["HydratorPlusPlusDetailMetricsDispatcher","MyCDAPDataSource","$filter","MyMetricsQueryHelper","HydratorPlusPlusDetailNonRunsStore","$interval",function(e,t,a,n,r,s){function i(e,t){function a(){c.request({method:"POST",_cdapPath:p}).then(function(e){var t,a,n,s,o=r.getConfigJson();o.stages?t=o.stages.map(function(e){return e.name}):(a=o.source.name,s=o.transforms.map(function(e){return e.name}),n=o.sinks.map(function(e){return e.name}),t=[a].concat(s,n));var p=[];if(e.length>0){if(angular.forEach(t,function(t){p=p.concat(u(e,t))}),0===p.length)return void l.dispatch("onEmptyMetrics");c.request({method:"POST",_cdapPath:"/metrics/query?"+i+"&metric="+p.join("&metric=")}).then(function(e){l.dispatch("onMetricsFetch",e)})}}.bind(this))}var i=e;i=n.tagsToParams(i);var p="/metrics/search?target=metric&"+i;t?(a(),o=s(a,1e4)):a()}var o,l=e.getDispatcher(),c=new t,u=a("filter");this.pollForMetrics=function(e){this.stopMetricsPoll(),i.call(this,e,!0)},this.requestForMetrics=function(e){i.call(this,e,!1)},this.stopMetricsPoll=function(){o&&(s.cancel(o),o=null)},this.reset=function(){this.stopMetricsPoll(),l.dispatch("onReset")}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusDetailDispatcher",["CaskAngularDispatcher",function(e){this.__dispatcher__=null,this.destroyDispatcher=function(){delete this.__dispatcher__},this.getDispatcher=function(){return this.__dispatcher__||(this.__dispatcher__=new e),this.__dispatcher__}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusDetailMetricsDispatcher",["CaskAngularDispatcher",function(e){this.__dispatcher__=null,this.destroyDispatcher=function(){delete this.__dispatcher__},this.getDispatcher=function(){return this.__dispatcher__||(this.__dispatcher__=new e),this.__dispatcher__}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusNodeConfigDispatcher",["CaskAngularDispatcher",function(e){this.__dispatcher__=null,this.destroyDispatcher=function(){delete this.__dispatcher__},this.getDispatcher=function(){return this.__dispatcher__||(this.__dispatcher__=new e),this.__dispatcher__}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusDetailMetricsStore",["HydratorPlusPlusDetailMetricsDispatcher",function(e){
var t=e.getDispatcher();this.changeListeners=[],this.emitChange=function(){this.changeListeners.forEach(function(e){e(this.state)}.bind(this))},this.setDefaults=function(){this.state={metrics:[]},this.emitChange()},this.setDefaults(),this.getMetrics=function(){return this.state.metrics},this.registerOnChangeListener=function(e){this.changeListeners.push(e)},this.emptyMetrics=function(){this.state.metrics=[],this.emitChange()},this.setState=function(e){var t={};angular.forEach(e.series,function(e){var a=e.metricName.split("."),n=a[1];t[n]||(t[n]={nodeName:a[1]}),-1!==e.metricName.indexOf(a[1]+".records.in")?t[n].recordsIn=e.data[0].value:-1!==e.metricName.indexOf(a[1]+".records.out")&&(t[n].recordsOut=e.data[0].value)});var a=[];angular.forEach(t,function(e){a.push(e)}),this.state.metrics=a,this.emitChange()},t.register("onMetricsFetch",this.setState.bind(this)),t.register("onEmptyMetrics",this.emptyMetrics.bind(this)),t.register("onReset",this.setDefaults.bind(this))}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusDetailNonRunsStore",["HydratorPlusPlusDetailDispatcher","HydratorPlusPlusHydratorService","myHelpers","HYDRATOR_DEFAULT_VALUES",function(e,t,a,n){this.HydratorPlusPlusHydratorService=t,this.HYDRATOR_DEFAULT_VALUES=n,this.myHelpers=a,this.setDefaults=function(e){this.state={scheduleStatus:null,name:e.name||"",type:e.type,description:e.description,datasets:e.datasets||[],streams:e.streams||[],configJson:e.configJson||{},cloneConfig:e.cloneConfig||{},DAGConfig:e.DAGConfig||{nodes:[],connections:[]}}},this.changeListeners=[];var r=e.getDispatcher();this.setDefaults({}),this.getScheduleStatus=function(){return this.state.scheduleStatus},this.registerOnChangeListener=function(e){var t=this,a=this.changeListeners.push(e);return function(){t.changeListeners.splice(a-1,1)}},this.emitChange=function(){this.changeListeners.forEach(function(e){e(this.state)}.bind(this))},this.setState=function(e){this.state.scheduleStatus=e.status||e,this.emitChange()},this.getCloneConfig=function(){return this.state.cloneConfig},this.getPipelineType=function(){return this.state.type},this.getPipelineName=function(){return this.state.name},this.getPipelineDescription=function(){return this.state.description},this.getDAGConfig=function(){var e=angular.copy(this.state.DAGConfig);return angular.forEach(e.nodes,function(e){e.plugin&&(e.label=e.plugin.label)}),e},this.getConnections=function(){return this.state.DAGConfig.connections},this.getNodes=function(){return this.state.DAGConfig.nodes},this.getSourceNodes=function(e){var t={};return this.state.DAGConfig.nodes.forEach(function(e){return t[e.name]=e}),this.state.DAGConfig.connections.filter(function(t){return t.to===e}).map(function(e){return t[e.from]})},this.getDatasets=function(){return this.state.datasets},this.getStreams=function(){return this.state.streams},this.getConfigJson=function(){return this.state.configJson},this.getAppType=function(){return this.state.type},this.getPluginObject=function(e){var t=this.getNodes(),a=t.filter(function(t){return t.name===e});return a=a.length?a[0]:null},this.getArtifact=function(){return this.state.cloneConfig.artifact},this.getSchedule=function(){return this.state.cloneConfig.config.schedule},this.getEngine=function(){return this.state.cloneConfig.config.engine},this.getPostActions=function(){return this.state.cloneConfig.config.postActions},this.getBatchInterval=function(){return this.state.cloneConfig.config.batchInterval},this.getInstance=function(){return this.state.cloneConfig.config.instances},this.getDriverMemoryMB=function(){return this.myHelpers.objectQuery(this.state.cloneConfig,"config","driverResources","memoryMB")},this.getDriverVirtualCores=function(){return this.myHelpers.objectQuery(this.state.cloneConfig,"config","driverResources","virtualCores")},this.getMemoryMB=function(){return this.myHelpers.objectQuery(this.state.cloneConfig,"config","resources","memoryMB")},this.getVirtualCores=function(){return this.myHelpers.objectQuery(this.state.cloneConfig,"config","resources","virtualCores")},this.getNode=this.getPluginObject,this.init=function(e){var t,a={};angular.extend(a,e);try{a.configJson=JSON.parse(e.configuration)}catch(n){return a.configJson=n,void console.log("ERROR cannot parse configuration")}a.configJson&&(e.config=a.configJson,t=this.HydratorPlusPlusHydratorService.getNodesAndConnectionsFromConfig(e),a.DAGConfig={nodes:t.nodes,connections:t.connections},a.description=a.configJson.description?a.configJson.description:a.description),a.type=e.artifact.name;var r=angular.copy(a);a.cloneConfig={name:e.name+"_copy",artifact:e.artifact,description:r.configJson.description,__ui__:r.DAGConfig,config:{instances:r.configJson.instances,batchInterval:r.configJson.batchInterval,resources:r.configJson.resources||angular.copy(this.HYDRATOR_DEFAULT_VALUES.resources),driverResources:r.configJson.driverResources||angular.copy(this.HYDRATOR_DEFAULT_VALUES.resources),schedule:r.configJson.schedule,connections:t.connections,comments:r.configJson.comments,postActions:r.configJson.postActions,engine:r.configJson.engine,stages:r.configJson.stages}},a.streams=e.streams.map(function(e){return e.type="Stream",e}),a.datasets=e.datasets.map(function(e){return e.type="Dataset",e}),this.setDefaults(a)},this.reset=function(){this.setDefaults({}),this.changeListeners=[]},r.register("onScheduleStatusFetch",this.setState.bind(this)),r.register("onScheduleStatusFetchFail",this.setState.bind(this,{error:"Failed to fetch schedule for the pipeline."})),r.register("onReset",this.reset.bind(this))}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.hydratorplusplus").service("HydratorPlusPlusDetailRunsStore",["HydratorPlusPlusDetailDispatcher","$state","myHelpers","GLOBALS","myPipelineCommonApi",function(e,t,a,n,r){var s=e.getDispatcher();this.changeListeners=[],this.setDefaults=function(e){this.state={runs:{list:[],latest:{},count:0,nextRunTime:null},params:e.params||{},scheduleParams:e.scheduleParams||{},logsParams:e.logsParams||{},api:e.api,type:e.type,metricProgramType:e.metricProgramType,statistics:""}},this.setDefaults({}),this.getRuns=function(){return angular.copy(this.state.runs.list)},this.getLatestRun=function(){return this.state.runs.list[0]},this.getLatestMetricRunId=function(){var e;return this.state.runs.count?e=this.state.runs.list[0].runid:!1},this.getAppType=function(){return this.state.type},this.getStatus=function(){var e;return e=0===this.state.runs.list.length?"STOPPED":a.objectQuery(this.state,"runs","latest","status")||""},this.getRunsCount=function(){return this.state.runs.count},this.getNextRunTime=function(){return this.state.runs.nextRunTime},this.setNextRunTime=function(e){this.state.runs.nextRunTime=e,this.emitChange()},this.getApi=function(){return this.state.api},this.getParams=function(){return this.state.params},this.getScheduleParams=function(){return this.state.scheduleParams},this.getLogsParams=function(){var e=angular.extend({runId:this.state.runs.latest.runid},this.state.logsParams);return e},this.getStatistics=function(){return this.state.statistics},this.getMetricProgramType=function(){return this.state.metricProgramType},this.registerOnChangeListener=function(e){var t=this,a=this.changeListeners.push(e)-1;return function(){t.changeListeners.splice(a,1)}},this.emitChange=function(){this.changeListeners.forEach(function(e){e()})},this.setRunsState=function(e){e.length&&(this.state.runs={list:e,count:e.length,latest:e[0],runsCount:e.length,nextRunTime:this.state.runs.nextRunTime||null},this.state.logsParams.runId=this.state.runs.latest.runid,this.emitChange())},this.setStatistics=function(e){this.state.statistics=e,this.emitChange()},this.init=function(e){var a,s,i,o={};switch(angular.extend(o,e),a={namespace:t.params.namespace,app:e.name},s={namespace:t.params.namespace,appId:e.name},e.artifact.name){case n.etlBatch:case n.etlDataPipeline:angular.forEach(e.programs,function(e){"Workflow"===e.type&&(a.programName=e.id,a.programType=e.type.toLowerCase()+"s",i=e.type.toLowerCase(),s.programId=e.id,s.programType=a.programType)});break;case n.etlRealtime:angular.forEach(e.programs,function(e){a.programName=e.id,a.programType=e.type.toLowerCase()+"s",i=e.type.toLowerCase(),s.programId=e.id,s.programType=e.type.toLowerCase()+"s"});break;case n.etlDataStreams:angular.forEach(e.programs,function(e){a.programName=e.id,a.programType=e.type.toLowerCase(),i=e.type.toLowerCase(),s.programId=e.id,s.programType=e.type.toLowerCase()})}o.type=e.artifact.name,o.logsParams=s,o.params=a,o.api=r,o.metricProgramType=i,o.scheduleParams={app:a.app,schedule:o.type===n.etlDataPipeline?"dataPipelineSchedule":"etlWorkflow",namespace:a.namespace},this.setDefaults(o)},this.reset=function(){this.setDefaults({}),this.changeListeners=[]},s.register("onRunsChange",this.setRunsState.bind(this)),s.register("onStatisticsFetch",this.setStatistics.bind(this)),s.register("onReset",this.setDefaults.bind(this,{})),s.register("onNextRunTime",this.setNextRunTime.bind(this))}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.mapreduce").controller("MapreduceRunsDetailController",["$scope","$state","$filter",function(e,t,a){var n=a("filter"),r=n(e.RunsController.runs,{runid:t.params.runid});e.RunsController.runs.selected.runid=r[0].runid,e.RunsController.runs.selected.status=r[0].status,e.RunsController.runs.selected.start=r[0].start,e.RunsController.runs.selected.end=r[0].end,e.$on("$destroy",function(){e.RunsController.runs.selected.runid=null})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.services").controller("ServicesRunsDetailController",["$scope","$filter","$state",function(e,t,a){var n=t("filter"),r=n(e.RunsController.runs,{runid:a.params.runid});e.RunsController.runs.selected.runid=r[0].runid,e.RunsController.runs.selected.status=r[0].status,e.RunsController.runs.selected.start=r[0].start,e.RunsController.runs.selected.end=r[0].end,e.$on("$destroy",function(){e.RunsController.runs.selected.runid=null})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.spark").controller("SparkRunDetailController",["$scope","$state","$filter",function(e,t,a){var n=a("filter"),r=n(e.RunsController.runs,{runid:t.params.runid});e.RunsController.runs.selected.runid=r[0].runid,e.RunsController.runs.selected.status=r[0].status,e.RunsController.runs.selected.start=r[0].start,e.RunsController.runs.selected.end=r[0].end,e.$on("$destroy",function(){e.RunsController.runs.selected.runid=null})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t){_classCallCheck(this,e),this.LineageStore=t}return e.$inject=["LineageStore"],_createClass(e,[{key:"loadLineageData",value:function(e,t,a){this.LineageStore.loadLineageData(e,t,a)}}]),e}();t.$inject=["LineageStore"],angular.module(e.name+".feature.tracker").service("LineageActions",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a){_classCallCheck(this,e),this.myLineageService=a,this.state={},this.setDefaults()}return e.$inject=["$state","myLineageService"],_createClass(e,[{key:"setDefaults",value:function(){this.state={nodes:[],uniqueNodes:{},connections:[],graph:{}},this.changeListeners=[]}},{key:"registerOnChangeListener",value:function(e){this.changeListeners.push(e)}},{key:"emitChange",value:function(){this.changeListeners.forEach(function(e){return e()})}},{key:"loadLineageData",value:function(e,t,a){var n=void 0;n="duplicate"===a?this.myLineageService.parseLineageResponse(e,t):this.myLineageService.secondLineageParser(e,t),this.state.nodes=n.nodes,this.state.uniqueNodes=n.uniqueNodes,this.state.connections=n.connections,this.state.graph=n.graph,this.emitChange()}},{key:"getNodes",value:function(){return this.state.nodes}},{key:"getUniqueNodes",value:function(){return this.state.uniqueNodes}},{key:"getConnections",value:function(){return this.state.connections}},{key:"getGraph",value:function(){return this.state.graph}}]),e}();t.$inject=["$state","myLineageService"],angular.module(e.name+".feature.tracker").service("LineageStore",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.worker").controller("WorkersRunDetailController",["$scope","$filter","$state",function(e,t,a){var n=t("filter"),r=n(e.RunsController.runs,{runid:a.params.runid});e.RunsController.runs.selected.runid=r[0].runid,e.RunsController.runs.selected.status=r[0].status,e.RunsController.runs.selected.start=r[0].start,e.RunsController.runs.selected.end=r[0].end,e.$on("$destroy",function(){e.RunsController.runs.selected.runid=null})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=function a(e,t,n){_classCallCheck(this,a);var r=n("filter"),s=r(e.RunsController.runs,{runid:t.params.runid});e.RunsController.runs.selected.runid=s[0].runid,e.RunsController.runs.selected.status=s[0].status,e.RunsController.runs.selected.start=s[0].start,e.RunsController.runs.selected.end=s[0].end,e.$on("$destroy",function(){e.RunsController.runs.selected.runid=null})};t.$inject=["$scope","$state","$filter"],angular.module(e.name+".feature.workflows").controller("WorkflowsRunsDetailController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i){var o=this;_classCallCheck(this,e),this.dataSrc=new n(a),this.$state=t,this.MyMetricsQueryHelper=s;var l=a.FlowletsController.activeFlowlet.name;this.datasets=[];var c={namespace:t.params.namespace,appId:t.params.appId,flowId:t.params.programId,scope:a};i.get(c).$promise.then(function(e){var t=[],a=r.objectQuery(e,"flowlets",l,"flowletSpec","dataSets");angular.forEach(a,function(e){t.push({name:e})}),o.datasets=t,o.pollDatasets()})}return e.$inject=["$state","$scope","MyCDAPDataSource","myHelpers","MyMetricsQueryHelper","myFlowsApi"],_createClass(e,[{key:"pollDatasets",value:function(){var e=this;angular.forEach(this.datasets,function(t){var a={namespace:e.$state.params.namespace,dataset:t.name,app:e.$state.params.appId,flow:e.$state.params.programId};e.dataSrc.poll({_cdapPath:"/metrics/query?"+e.MyMetricsQueryHelper.tagsToParams(a)+"&metric=system.dataset.store.reads",method:"POST"},function(e){e.series[0]&&(t.reads=e.series[0].data[0].value)}),e.dataSrc.poll({_cdapPath:"/metrics/query?"+e.MyMetricsQueryHelper.tagsToParams(a)+"&metric=system.dataset.store.writes",method:"POST"},function(e){e.series[0]&&(t.writes=e.series[0].data[0].value)})})}}]),e}();t.$inject=["$state","$scope","MyCDAPDataSource","myHelpers","MyMetricsQueryHelper","myFlowsApi"],angular.module(e.name+".feature.flows").controller("FlowletDetailDataController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r){var s=this;_classCallCheck(this,e),this.activeTab=0;var i=a.FlowletsController.activeFlowlet.name;this.myFlowsApi=r,this.params={namespace:t.params.namespace,appId:t.params.appId,flowId:t.params.programId,scope:a},r.get(this.params).$promise.then(function(e){s.description=n.objectQuery(e,"flowlets",i,"flowletSpec","description")}),this.params.flowletId=i,r.getFlowletInstance(this.params).$promise.then(function(e){s.provisionedInstances=e.instances,s.instance=e.instances}),r.pollFlowletInstance(this.params).$promise.then(function(e){this.provisionedInstances=e.instances}.bind(this))}return e.$inject=["$state","$scope","myHelpers","myFlowsApi"],_createClass(e,[{key:"setInstance",value:function(){this.myFlowsApi.setFlowletInstance(this.params,{instances:this.instance})}}]),e}();t.$inject=["$state","$scope","myHelpers","myFlowsApi"],angular.module(e.name+".feature.flows").controller("FlowsFlowletDetailController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i){var o=this;_classCallCheck(this,e),this.dataSrc=new n(a),this.$state=t,this.MyMetricsQueryHelper=r,this.$scope=a,this.MyChartHelpers=s,this.flowletid=a.FlowletsController.activeFlowlet.name,this.metric={startTime:"now-60s",endTime:"now",resolution:"1s",names:["system.queue.pending"]},this.inputs=[],this.chartSettings={chartMetadata:{showx:!0,showy:!0,legend:{show:!1,position:"inset"}},color:{pattern:["red"]},isLive:!0,interval:1e3,aggregate:5};var l={namespace:this.$state.params.namespace,appId:this.$state.params.appId,flowId:this.$state.params.programId,scope:this.$scope};i.get(l).$promise.then(function(e){angular.forEach(e.connections,function(e){e.targetName===o.flowletid&&o.inputs.push({name:e.sourceName,max:0,type:e.sourceType})}),o.inputs.length>0&&o.formatInput()})}return e.$inject=["$state","$scope","MyCDAPDataSource","MyMetricsQueryHelper","MyChartHelpers","myFlowsApi"],_createClass(e,[{key:"formatInput",value:function(){var e=this,t=void 0;angular.forEach(this.inputs,function(a){var n={namespace:e.$state.params.namespace,app:e.$state.params.appId,flow:e.$state.params.programId,consumer:e.flowletid,producer:a.name},r="/metrics/query?"+e.MyMetricsQueryHelper.tagsToParams(n)+"&metric=system.queue.pending";e.dataSrc.poll({_cdapPath:r+"&start=now-60s&end=now&aggregate=true",method:"POST",interval:2e3},function(t){var r=t.series[0]?t.series[0].data[0].value:0;e.dataSrc.request({_cdapPath:"/metrics/query",method:"POST",body:e.MyMetricsQueryHelper.constructQuery("qid",n,e.metric)}).then(function(t){e.MyChartHelpers.formatTimeseries(r,t,a,e.metric)})}),t="/metrics/query?metric=system.process.events.processed&tag=namespace:"+e.$state.params.namespace+"&tag=app:"+e.$state.params.appId+"&tag=flow"+e.$state.params.programId+"&tag=flowlet:"+e.flowletid+"&tag=run:"+e.$scope.RunsController.runs.selected.runid+"&start=now-1s&end=now",e.dataSrc.poll({_cdapPath:t,method:"POST"},function(e){e.series[0]&&(a.total=e.series[0].data[0].value)})})}}]),e}();t.$inject=["$state","$scope","MyCDAPDataSource","MyMetricsQueryHelper","MyChartHelpers","myFlowsApi"],angular.module(e.name+".feature.flows").controller("FlowletDetailInputController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=function a(e,t,n,r,s,i){var o=this;_classCallCheck(this,a);var l=new n(t),c=t.FlowletsController.activeFlowlet.name,u=t.RunsController.runs.selected.runid;this.outputs=[],this.chartSettings={chartMetadata:{showx:!0,showy:!0,legend:{show:!1,position:"inset"}},color:{pattern:["red"]},isLive:!0,interval:1e3,aggregate:5};var p={startTime:"now-90s",endTime:"now",resolution:"1s",names:["system.process.events.out"]},d={namespace:e.params.namespace,appId:e.params.appId,flowId:e.params.programId,scope:t},m={namespace:e.params.namespace,app:e.params.appId,flow:e.params.programId,run:u,flowlet:c};i.get(d).$promise.then(function(e){angular.forEach(e.connections,function(e){e.sourceName===c&&o.outputs.push(e.targetName)}),o.outputs.length>0&&(l.poll({_cdapPath:"/metrics/query",method:"POST",interval:5e3,body:r.constructQuery("qid",m,p)},function(e){var t=s.processData(e,"qid",p.names,p.resolution);t=s.c3ifyData(t,p,p.names),o.chartData={x:"x",columns:t.columns,keys:{x:"x"}}}),l.poll({_cdapPath:"/metrics/query?"+r.tagsToParams(m)+"&metric=system.process.events.out",method:"POST"},function(e){e.series[0]&&(o.total=e.series[0].data[0].value)}))})};t.$inject=["$state","$scope","MyCDAPDataSource","MyMetricsQueryHelper","MyChartHelpers","myFlowsApi"],angular.module(e.name+".feature.flows").controller("FlowletDetailOutputController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r){var s=this;_classCallCheck(this,e),this.flowlets=[],this.$filter=n;var i=this.$filter("filter");r.fetchData(a.params.appId,a.params.programId).then(function(e){var n=void 0;angular.forEach(e.flowlets,function(e){var t=e.flowletSpec.name;e.isOpen=!1,s.flowlets.push({name:t,isOpen:a.params.flowletid===t})}),t.RunsController.activeFlowlet?(n=i(s.flowlets,{name:t.RunsController.activeFlowlet}),n[0].isOpen=!0,s.activeFlowlet=n[0]):(s.flowlets[0].isOpen=!0,s.activeFlowlet=s.flowlets[0])})}return e.$inject=["$scope","$state","$filter","FlowDiagramData"],_createClass(e,[{key:"selectFlowlet",value:function(e){var t=this.$filter("filter");angular.forEach(this.flowlets,function(e){e.isOpen=!1});var a=t(this.flowlets,e);a[0].isOpen=!0,this.activeFlowlet=a[0]}}]),e}();t.$inject=["$scope","$state","$filter","FlowDiagramData"],angular.module(e.name+".feature.flows").controller("FlowletsController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=function a(e,t){_classCallCheck(this,a),this.params={namespaceId:t.params.namespace,appId:t.params.appId,programType:"flows",programId:t.params.programId,runId:e.RunsController.runs.length?e.RunsController.runs.selected.runid:""}};t.$inject=["$scope","$state"],angular.module(e.name+".feature.flows").controller("FlowsRunDetailLogController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t=function(){function e(t,a,n,r,s,i,o){var l=this;_classCallCheck(this,e),this.dataSrc=new n(a),this.$state=t,this.$scope=a,this.myHelpers=r,this.myFlowsApi=o,this.MyMetricsQueryHelper=i,this.data={},this.data.metrics={},this.data.instances={},this.onChangeFlag=1,s.fetchData(t.params.appId,t.params.programId).then(function(e){l.data=e,l.data.metrics={},l.data.instances={},l.pollMetrics(),l.onChangeFlag+=1}),a.$on("$destroy",s.reset.bind(s))}return e.$inject=["$state","$scope","MyCDAPDataSource","myHelpers","FlowDiagramData","MyMetricsQueryHelper","myFlowsApi"],_createClass(e,[{key:"pollMetrics",value:function(){var e=this,t=this.data.nodes,a=function(e){var t={namespace:this.$state.params.namespace,stream:e};return"/metrics/query?metric=system.collect.events&aggregate=true&"+this.MyMetricsQueryHelper.tagsToParams(t)};t.forEach(function(t){if("STREAM"===t.type)e.dataSrc.poll({_cdapPath:a.call(e,t.name),method:"POST",interval:2e3},function(a){e.data.metrics[t.name]=e.myHelpers.objectQuery(a,"series",0,"data",0,"value")||0,e.onChangeFlag+=1});else{var n={namespace:e.$state.params.namespace,appId:e.$state.params.appId,flowId:e.$state.params.programId,flowletId:t.name,scope:e.$scope};e.myFlowsApi.pollFlowletInstance(n).$promise.then(function(a){e.data.instances[t.name]=a.instances,e.onChangeFlag+=1})}}),this.dataSrc.poll({_cdapPath:"/metrics/query",method:"POST",body:this.MyMetricsQueryHelper.constructQuery("qid",{namespace:this.$state.params.namespace,app:this.$state.params.appId,flow:this.$state.params.programId,run:this.$scope.RunsController.runs.selected.runid},{names:["system.process.events.processed"]},!1,["flowlet","stream"])},function(t){var a=t.qid.series;a.length&&(a.forEach(function(t){e.data.metrics[t.grouping.flowlet]=t.data[0].value}),e.onChangeFlag+=1)})}},{key:"flowletClick",value:function(e){this.$scope.RunsController.selectTab(this.$scope.RunsController.tabs[1],e)}}]),e}();t.$inject=["$state","$scope","MyCDAPDataSource","myHelpers","FlowDiagramData","MyMetricsQueryHelper","myFlowsApi"],angular.module(e.name+".feature.flows").controller("FlowsRunDetailStatusController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.mapreduce").controller("MapreduceRunDetailLogsController",["$scope","$state",function(e,t){this.params={namespace:t.params.namespace,appId:t.params.appId,programType:"mapreduce",programId:t.params.programId,runId:e.RunsController.runs.length?e.RunsController.runs.selected.runid:""}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.mapreduce").controller("MapreduceStatusController",["$filter","$scope","$state","MyCDAPDataSource",function(e,t,a,n){function r(e,t){var a={completed:0,running:0,pending:0,killed:0,failed:0,total:0};if(angular.forEach(e,function(e){switch(e.state){case"SUCCEEDED":a.completed++;break;case"FAILED":a.failed++;break;case"SCHEDULED":a.pending++;break;case"RUNNING":a.running++;break;case"KILLED":a.killed++}a.total++}),t===!1){var n="NA";return{completed:n,running:n,pending:n,killed:n,failed:n,total:a.total}}return angular.forEach(Object.keys(a),function(e){a[e]=s(a[e])}),a}var s=e("myNumber");if(t.RunsController.runs.length>0){var i=t.RunsController.runs.selected.runid,o={namespace:a.params.namespace,appId:a.params.appId,mapreduceId:a.params.programId,runId:i,scope:t},l=new n(t);l.poll({_cdapNsPath:"/apps/"+o.appId+"/mapreduce/"+o.mapreduceId+"/runs/"+o.runId+"/info",json:!1},function(e){e=e.replace(/\bNaN\b/g,'"NaN"');try{e=JSON.parse(e)}catch(t){console.warn("Unable parse response for Mapreduce program: ",o.mapreduceId),e={}}this.info=e,this.mapProgress=Math.floor(100*e.mapProgress),this.reduceProgress=Math.floor(100*e.reduceProgress),this.mapperStats=r(this.info.mapTasks,this.info.complete),this.mapperStats.inputRecords=s(this.info.counters.MAP_INPUT_RECORDS),this.mapperStats.outputRecords=s(this.info.counters.MAP_OUTPUT_RECORDS),this.reducerStats=r(this.info.reduceTasks,this.info.complete),this.reducerStats.inputRecords=s(this.info.counters.REDUCE_INPUT_RECORDS),this.reducerStats.outputRecords=s(this.info.counters.REDUCE_OUTPUT_RECORDS)}.bind(this))}this.getFailedTasks=function(e){var t=0;return angular.forEach(e,function(e){"FAILED"===e.state&&t++}),t}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.services").controller("ServicesRunDetailLogController",["$scope","$state",function(e,t){this.params={namespace:t.params.namespace,appId:t.params.appId,programType:"services",programId:t.params.programId,runId:e.RunsController.runs.length?e.RunsController.runs.selected.runid:""}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.services").controller("ServicesRunsDetailStatusController",["$state","$scope","myServiceApi","$uibModal",function(e,t,a,n){var r="/apps/"+e.params.appId+"/services/"+e.params.programId;this.endPoints=[],this.basePath="/namespaces/"+e.params.namespace+r;var s={namespace:e.params.namespace,appId:e.params.appId,serviceId:e.params.programId,scope:t};a.get(s).$promise.then(function(e){angular.forEach(e.handlers,function(e){this.endPoints=this.endPoints.concat(e.endpoints)},this)}.bind(this)),t.RunsController.runs.length>0&&(s.runId=t.RunsController.runs.selected.runid,a.runDetail(s).$promise.then(function(e){this.status=e.status}.bind(this))),this.openModal=function(e){n.open({templateUrl:"/old_assets/features/services/templates/tabs/runs/tabs/status/make-request.html",keyboard:!0,backdrop:"static",size:"lg",controller:"StatusMakeRequestController",controllerAs:"RequestController",resolve:{rRequestUrl:function(){return e.path},rRequestMethod:function(){return e.method}}})}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.spark").controller("SparkRunDetailLogController",["$scope","$state",function(e,t){e.RunsController.runs.length&&(this.params={namespace:t.params.namespace,appId:t.params.appId,programType:"spark",programId:t.params.programId,runId:e.RunsController.runs.selected.runid})}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.spark").controller("SparkRunsDetailStatusController",["$state","$scope","MyCDAPDataSource","myHelpers",function(e,t,a,n){function r(t){var a="/metrics/query?tag=namespace:"+e.params.namespace+"&tag=app:"+e.params.appId+"&tag=spark:"+e.params.programId+"&tag=run:"+t+"&metric=system.driver",r={};r[a+".BlockManager.memory.remainingMem_MB&aggregate=true"]="blockRemainingMemory",r[a+".BlockManager.memory.maxMem_MB&aggregate=true"]="blockMaxMemory",r[a+".BlockManager.memory.memUsed_MB&aggregate=true"]="blockUsedMemory",r[a+".BlockManager.disk.diskSpaceUsed_MB&aggregate=true"]="blockDiskSpaceUsed",r[a+".DAGScheduler.job.activeJobs&aggregate=true"]="schedulerActiveJobs",r[a+".DAGScheduler.job.allJobs&aggregate=true"]="schedulerAllJobs",r[a+".DAGScheduler.stage.failedStages&aggregate=true"]="schedulerFailedStages",r[a+".DAGScheduler.stage.runningStages&aggregate=true"]="schedulerRunningStages",r[a+".DAGScheduler.stage.waitingStages&aggregate=true"]="schedulerWaitingStages",angular.forEach(r,function(e,t){s.poll({_cdapPath:t,method:"POST",interval:1e3},function(t){i.data[e]=n.objectQuery(t,"series",0,"data",0,"value")||0})})}var s=new a(t),i=this;i.data={blockRemainingMemory:0,blockMaxMemory:0,blockUsedMemory:0,blockDiskSpaceUsed:0,schedulerActiveJobs:0,schedulerAllJobs:0,schedulerFailedStages:0,schedulerRunningStages:0,schedulerWaitingStages:0},i.runningTooltip={title:"Running"},i.waitingTooltip={title:"Waiting"},i.failedTooltip={title:"Failed"},r(t.RunsController.runs.selected.runid),i.getStagePercentage=function(e){var t=i.data.schedulerRunningStages+i.data.schedulerFailedStages+i.data.schedulerWaitingStages;switch(e){case"running":return 100*i.data.schedulerRunningStages/t;case"waiting":return 100*i.data.schedulerWaitingStages/t;case"failed":return 100*i.data.schedulerFailedStages/t}}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.worker").controller("WorkersRunDetailLogController",["$scope","$state",function(e,t){this.params={namespace:t.params.namespace,appId:t.params.appId,programType:"workers",programId:t.params.programId,runId:e.RunsController.runs.length?e.RunsController.runs.selected.runid:""}}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.worker").controller("WorkersRunsDetailStatusController",["$state",function(e){this.basePath="/namespaces/"+e.params.namespace+"/apps/"+e.params.appId+"/workers/"+e.params.programId}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){var t=function a(e,t){_classCallCheck(this,a),e.RunsController.runs.length&&(this.params={namespace:t.params.namespace,appId:t.params.appId,programType:"workflows",programId:t.params.programId,runId:e.RunsController.runs.selected.runid})};t.$inject=["$scope","$state"],angular.module(e.name+".feature.workflows").controller("WorkFlowsRunDetailLogController",t)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){var t,a={},n=function(){function e(a,n,r,s,i,o,l,c){
var u=this;_classCallCheck(this,e),this.dataSrc=new o(n),this.$state=a,this.$scope=n,this.myWorkFlowApi=r,this.GraphHelpers=i,this.myMapreduceApi=l,this.mySparkApi=c,this.$filter=s,this.runsCtrl=n.RunsController,this.onChangeFlag=1,this.showSidepanel=!1,this.activeTab=0,this.data={metrics:{},current:{}},t={namespace:this.$state.params.namespace,appId:this.$state.params.appId,workflowId:this.$state.params.programId,scope:this.$scope},this.data={current:{},metrics:{}},this.myWorkFlowApi.get(t).$promise.then(function(e){var t=[],a=[],n=angular.copy(e.nodes);u.GraphHelpers.addStartAndEnd(n),u.GraphHelpers.expandNodes(n,a),u.GraphHelpers.convertNodesToEdges(angular.copy(a),t),a=a.map(function(e){return angular.extend({name:e.program.programName+e.nodeId,type:e.nodeType},e)}),u.data.nodes=a,u.data.edges=t,u.onChangeFlag+=1;var r=[];angular.forEach(e.nodes,function(e){return r.push(e.program)}),u.actions=r,u.pollNodes()})}return e.$inject=["$state","$scope","myWorkFlowApi","$filter","GraphHelpers","MyCDAPDataSource","myMapreduceApi","mySparkApi"],_createClass(e,[{key:"pollNodes",value:function(){var e=this;0!==this.runsCtrl.runs.length&&(a=angular.extend({runId:this.runsCtrl.runs.selected.runid},t),this.myWorkFlowApi.pollRunDetailOften(a).$promise.then(function(t){e.runStatus=t.status,e.runsCtrl.runs.selected.properties=t.properties,e.myWorkFlowApi.getNodesState(a).$promise.then(function(t){angular.forEach(t,function(t,a){t.nodeId&&(e.data.current[a+t.nodeId]=t.nodeStatus,e.onChangeFlag+=1)})}),-1!==["STOPPED","KILLED","COMPLETED","FAILED"].indexOf(e.runStatus)&&e.myWorkFlowApi.stopPollRunDetail(a)}))}},{key:"workflowProgramClick",value:function(e){if(!(["START","END"].indexOf(e.type)>-1)&&this.runsCtrl.runs.length){var t={programId:e.program.programName,runid:this.runsCtrl.runs.selected.properties[e.nodeId],sourceId:this.$state.params.programId,sourceRunId:this.$scope.RunsController.runs.selected.runid};"MAPREDUCE"===e.program.programType&&this.runsCtrl.runs.selected.properties[e.nodeId]?(t.destinationType="Mapreduce",this.$state.go("mapreduce.detail.run",t)):"SPARK"===e.program.programType&&this.runsCtrl.runs.selected.properties[e.nodeId]&&(t.destinationType="Spark",this.$state.go("spark.detail.run",t))}}},{key:"workflowTokenClick",value:function(e){var a=this,n=angular.extend({runId:this.runsCtrl.runs.selected.runid,nodeId:e.nodeId},t);this.selectedNode=e.nodeId,this.myWorkFlowApi.getUserNodeToken(n).$promise.then(function(e){delete e.$promise,delete e.$resolved,a.usertokens=[],angular.forEach(e,function(e,t){a.usertokens.push({key:t,value:e})}),a.showSidepanel=!0}),this.myWorkFlowApi.getSystemNodeToken(n).$promise.then(function(e){delete e.$promise,delete e.$resolved,a.systemtokens=[],angular.forEach(e,function(e,t){a.systemtokens.push({key:t,value:e})})})}},{key:"closeSidepanel",value:function(){this.showSidepanel=!1}}]),e}();n.$inject=["$state","$scope","myWorkFlowApi","$filter","GraphHelpers","MyCDAPDataSource","myMapreduceApi","mySparkApi"],angular.module(e.name+".feature.workflows").controller("WorkflowsRunsStatusController",n)}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){angular.module(e.name+".feature.services").controller("StatusMakeRequestController",["$scope","$state","MyCDAPDataSource","rRequestUrl","rRequestMethod",function(e,t,a,n,r){function s(){i.response=null}var i=this;i.programId=t.params.programId,i.requestUrl=n,i.requestMethod=r,i.urlParams=[],i.queryParams=[],i.response=null,i.postBody={},i.loading=!1,i.requestStatus=null;var o=/\{([\w\-]+)\}/g,l=new a(e);i.requestUrl.split("?").forEach(function(e,t){var a;0===t?e.split("/").forEach(function(e){0!==e.length&&(a=e.match(o),i.urlParams.push({key:angular.isArray(a)?a:null,value:e}))}):e.split("&").forEach(function(e){var t,a;0!==e.length&&(t=e.match(o),angular.isArray(t)?i.queryParams.push({key:t[0].substr(1,t[0].length-2),value:t[0]}):(a=e.split("="),i.queryParams.push({key:a[0],value:a[1]})))})}),i.makeRequest=function(){i.loading=!0;var e="/apps/"+t.params.appId+"/services/"+t.params.programId+"/methods";angular.forEach(i.urlParams,function(t){e=e+"/"+t.value}),angular.forEach(i.queryParams,function(t,a){e+=(0===a?"?":"&")+t.key+"="+encodeURIComponent(t.value)});var a={_cdapNsPath:e,method:i.requestMethod.toUpperCase(),suppressErrors:!0};("POST"===i.requestMethod||"PUT"===i.requestMethod)&&angular.extend(a,{body:i.postBody}),l.request(a).then(function(e){i.response=e,i.loading=!1,i.requestStatus="SUCCESS"},function(e){i.response=e.data,i.loading=!1,i.requestStatus="ERROR"})},e.$watch("queryParams",s,!0),e.$watch("urlParams",s,!0)}])}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"}),function(e){SVGElement.prototype.getTransformToElement=SVGElement.prototype.getTransformToElement||function(e){return e.getScreenCTM().inverse().multiply(this.getScreenCTM())},String.prototype.includes||(String.prototype.includes=function(){return-1!==String.prototype.indexOf.apply(this,arguments)}),"function"!=typeof Object.assign&&(Object.assign=function(e){if(null===e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var a=arguments[t];if(null!==a)for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e})}({name:"cdap-ui",v:"3.5.2-SNAPSHOT"});