apply plugin:'java'

evaluationDependsOn(':hbase-compat-0.94')

dependencies {
    compile elastic([group: 'com.continuuity', name: 'common', version: "${version}", changing: true], "common")
    compile elastic([group: 'com.continuuity', name: 'common', classifier: 'api', version: "${version}", changing: true], "common")
    compile elastic([group: 'com.continuuity', name: 'data-fabric', version: "${version}", changing: true], "data-fabric")
    testCompile files(this.project(':data-fabric').sourceSets.test.output)
    testCompile files(this.project(':data-fabric').sourceSets.test.runtimeClasspath)
    testCompile files(this.project(':tx-core').sourceSets.test.output)
    testCompile files(this.project(':tx-core').sourceSets.test.runtimeClasspath)

    compile elastic([group: 'com.continuuity', name: 'hbase-compat-0.94', version: "${version}", changing: true], "hbase-compat-0.94")
    testCompile files(this.project(':hbase-compat-0.94').sourceSets.test.output)
    testCompile files(this.project(':hbase-compat-0.94').sourceSets.test.runtimeClasspath)

    compile libraries.slf4j_api
    compile libraries.fastutil
    compile libraries.logback_core
    compile libraries.logback_classic
    compile libraries.google_guice
    compile libraries.google_guice_assistedinject
    compile libraries.leveldb
    compile libraries.jsr_305
    compile libraries.twill_core

    testCompile libraries.mockito_core
    testCompile libraries.junit

    compile libraries.hsql
    compile libraries.jcl_over_slf4j

    compile libraries.hadoop_mapreduce_client_core

    compile(libraries.hbase94) {
        exclude module: 'junit'
        exclude group: 'commons-logging'
        exclude group: 'org.apache.thrift'
    }
    testCompile(libraries.hbase94_test) {
        exclude module: 'junit'
        exclude group: 'commons-logging'
        exclude group: 'org.apache.thrift'
    }
    testCompile libraries.hadoop_minicluster
    compile libraries.continuuity_netty_http
}

test {
    jvmArgs '-Xmx4096m'
}

checkstyleMain {
    source = sourceSets.main.allJava.matching {
        exclude '**/stubs/**/*'
        exclude '**/thrift/**'
    }
}

/**
 * Exclude any config xml from jar task
 */
jar.exclude '*.xml'

/**
 * Use io.netty instead of org.jboss.netty
 */
configurations {
    all*.exclude group: 'org.jboss.netty', module: 'netty'
    all*.exclude group: 'asm', module: 'asm'
    all {
        // Need to enforce our version of guava, otherwise some other components with newer versions may take over
        resolutionStrategy.force libraries.google_guava
    }
}
